!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ccpwgl_int=t():e.ccpwgl_int=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=67)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.util=void 0;var n=r(20);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r(80);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(5));t.util=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(18);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r(94);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(104);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var o=r(48);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var s=r(117);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var u=r(120);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var l=r(27);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})});var c=r(126);Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}})});var f=r(29);Object.keys(f).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}})});var h=r(52);Object.keys(h).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return h[e]}})});var p=r(24);Object.keys(p).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return p[e]}})});var d=r(12);Object.keys(d).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}})});var v=r(6);Object.keys(v).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return v[e]}})});var m=r(15);Object.keys(m).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return m[e]}})});var y=r(128);Object.keys(y).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return y[e]}})});var b=r(129);Object.keys(b).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return b[e]}})});var _=r(58);Object.keys(_).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return _[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Curve=t.Tw2CurveKey=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.Tw2CurveKey=function e(){a(this,e),this._id=i.util.generateID(),this.name="",this.time=0};var o=t.Tw2Curve=function(){function e(){a(this,e),this._id=i.util.generateID(),this.name=""}return n(e,[{key:"Initialize",value:function(){this.Sort()}},{key:"Sort",value:function(){}},{key:"GetLength",value:function(){return 0}},{key:"UpdateValue",value:function(e){}}],[{key:"Compare",value:function(e,t){return e.time<t.time?-1:e.time>t.time?1:0}},{key:"Sort",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.keys;r&&r.length&&(r.sort(e.Compare),t.length=r[r.length-1].time)}},{key:"Sort2",value:function(t){if(t.keys&&t.keys.length){t.keys.sort(e.Compare);var r=t.keys[t.keys.length-1];if(r.time>t.length){var n=t.length,i=t.endValue,a=t.endTangent;t.length=r.time,t.endValue=r.value,t.endTangent=r.leftTangent,n>0&&(r.time=n,r.value=i,r.leftTangent=a)}}}}]),e}();o.inputDimension=null,o.outputDimension=null,o.valueProperty=null,o.curveType=null,o.Key=null,o.Interpolation=null,o.Extrapolation=null,o.Type={CURVE:1,CURVE2:2,CURVE_MAYA:3,CURVE_NO_KEYS:4,SEQUENCER:100,SEQUENCER2:101},o.global={vec3_0:i.vec3.create(),vec4_0:i.vec4.create(),quat_0:i.quat.create(),quat_1:i.quat.create()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r.d(t,"ARRAY_TYPE",function(){return i}),t.setMatrixArrayType=function(e){i=e},t.toRadian=function(e){return e*o},t.equals=function(e,t){return Math.abs(e-t)<=n*Math.max(1,Math.abs(e),Math.abs(t))};const n=1e-6;t.EPSILON=n;let i="undefined"!=typeof Float32Array?Float32Array:Array;const a=Math.random;t.RANDOM=a;const o=Math.PI/180},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2VectorParameter=t.Tw2Parameter=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=t.Tw2Parameter=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";a(this,e),this._id=i.util.generateID(),this.name=t,this._onModified=[]}return n(e,[{key:"OnValueChanged",value:function(e,t){for(var r=0;r<this._onModified.length;r++)this._onModified[r](this,e,t)}},{key:"AddCallback",value:function(e){return this._onModified.includes(e)||this._onModified.push(e),!0}},{key:"RemoveCallback",value:function(e){var t=this._onModified.indexOf(e);-1!==t&&this._onModified.splice(t,1)}},{key:"GetValue",value:function(e){}},{key:"Bind",value:function(e,t,r){return!1}},{key:"UnBind",value:function(){}},{key:"Apply",value:function(e,t,r){}},{key:"Copy",value:function(e){}},{key:"Clone",value:function(){var e=new this.constructor;return e.Copy(this,!0),e}},{key:"size",get:function(){return this.constructor.constantBufferSize}}]),e}();o.constantBufferSize=0,(t.Tw2VectorParameter=function(e){function t(e,r){a(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.value=new Float32Array(n.size),n.constantBuffer=null,n.offset=null,r&&n.value.set(r),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),n(t,[{key:"SetValue",value:function(e){this.value.set(e),this.OnValueChanged()}},{key:"SetIndexValue",value:function(e,t){if(void 0===this.value[e])throw new Error("Index Error");this.value[e]!==t&&(this.value[e]=t,this.OnValueChanged())}},{key:"GetValue",value:function(e){var t=this.constantBuffer?this.constantBuffer.subarray(this.offset,this.offset+this.size):this.value;return e?Array.from(t):new Float32Array(t)}},{key:"GetIndexValue",value:function(e){if(void 0!==this.value[e])return this.value[e];throw new Error("Index Error")}},{key:"OnValueChanged",value:function(e,r){this.constantBuffer&&this.Apply(this.constantBuffer,this.offset),function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"OnValueChanged",this).call(this,e,r)}},{key:"Bind",value:function(e,t,r){return!this.constantBuffer&&r>=this.size&&(this.constantBuffer=e,this.offset=t,this.Apply(e,t,r),!0)}},{key:"Unbind",value:function(){this.constantBuffer=null}},{key:"Apply",value:function(e,t,r){e.set(this.value,t)}},{key:"EqualsValue",value:function(e){for(var t=0;t<this.size;t++)if(this.value[t]!==e[t])return!1;return!0}},{key:"Copy",value:function(e,t){t&&(this.name=e.name),this.SetValue(e.GetValue())}}],[{key:"isValue",value:function(e){return i.util.isArrayLike(e)&&e.length===this.constantBufferSize}}]),t}()).constantBufferSize=0},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(39);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r(82);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(22);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var o=r(83);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var s=r(84);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2FeatureNotImplementedError=t.Tw2AbstractClassMethodError=t.Tw2SingleInstantiationError=t.Tw2DeclarationValueTypeError=t.Tw2ShaderLinkError=t.Tw2ShaderCompileError=t.Tw2ShaderPermutationValueError=t.Tw2ShaderHeaderSizeError=t.Tw2ShaderVersionError=t.Tw2ResourceExtensionUndefinedError=t.Tw2ResourceExtensionUnregisteredError=t.Tw2ResourcePrefixUndefinedError=t.Tw2ResourcePrefixUnregisteredError=t.Tw2GeometryFileTypeError=t.Tw2GeometryMeshEffectBindError=t.Tw2GeometryMeshInvalidBoneError=t.Tw2GeometryMeshElementComponentError=t.Tw2GeometryMeshParticleElementError=t.Tw2XMLObjectTypeUndefinedError=t.Tw2XMLBinaryError=t.HTTPReadyStateError=t.HTTPStatusError=t.HTTPInstanceError=t.HTTPRequestSendError=t.HTTPRequestError=t.Tw2Error=void 0;var n=r(5);function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}var u=(0,n.isFunction)(Error.captureStackTrace),l=t.Tw2Error=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Undefined error";i(this,t);var o=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),s=r;return"string"==typeof e?(s=e,e={}):e.message&&(s=e.message,delete e.message),o.message=(0,n.template)(s,e),o.name=o.constructor.name,o.data=e,o.data.err=o,u?Error.captureStackTrace(o,t):o.stack=new Error(o.message).stack,o}return o(t,s(Error)),t}();l.isError=!0;t.HTTPRequestError=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Communication error while requesting resource"))}return o(t,l),t}(),t.HTTPRequestSendError=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Communication send error while requesting resource"))}return o(t,l),t}(),t.HTTPInstanceError=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Could not create an XML HTTP instance"))}return o(t,l),t}(),t.HTTPStatusError=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Communication status error while loading resource "+e.status))}return o(t,l),t}(),t.HTTPReadyStateError=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Communication ready state error while loading resource"))}return o(t,l),t}(),t.Tw2XMLBinaryError=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Invalid binary"))}return o(t,l),t}(),t.Tw2XMLObjectTypeUndefinedError=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"XML Object with undefined type (%type%)"))}return o(t,l),t}(),t.Tw2GeometryMeshParticleElementError=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Input geometry mesh lacks element required by particle system"))}return o(t,l),t}(),t.Tw2GeometryMeshElementComponentError=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Input geometry mesh elements do not have the required number of components"))}return o(t,l),t}(),t.Tw2GeometryMeshInvalidBoneError=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Geometry mesh has invalid bone name for model"))}return o(t,l),t}(),t.Tw2GeometryMeshEffectBindError=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Error binding geometry mesh to effect"))}return o(t,l),t}(),t.Tw2GeometryFileTypeError=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Invalid geometry file type (%fileType%)"))}return o(t,l),t}(),t.Tw2ResourcePrefixUnregisteredError=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Unregistered resource prefix (%prefix%)"))}return o(t,l),t}(),t.Tw2ResourcePrefixUndefinedError=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Undefined resource prefix"))}return o(t,l),t}(),t.Tw2ResourceExtensionUnregisteredError=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Unregistered resource extension (%extension%)"))}return o(t,l),t}(),t.Tw2ResourceExtensionUndefinedError=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Undefined resource extension"))}return o(t,l),t}(),t.Tw2ShaderVersionError=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Invalid version of effect file (%version%)"))}return o(t,l),t}(),t.Tw2ShaderHeaderSizeError=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Effect file contains no compiled effects"))}return o(t,l),t}(),t.Tw2ShaderPermutationValueError=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Invalid shader permutation value"))}return o(t,l),t}(),t.Tw2ShaderCompileError=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Error compiling %shaderType% shader (%infoLog%)"))}return o(t,l),t}(),t.Tw2ShaderLinkError=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Error linking shaders"))}return o(t,l),t}(),t.Tw2DeclarationValueTypeError=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Invalid declaration value type (%declaration%:%valueType%)"))}return o(t,l),t}(),t.Tw2SingleInstantiationError=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Multiple class instantiations not yet supported"))}return o(t,l),t}(),t.Tw2AbstractClassMethodError=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Abstract class method not implemented directly on child class"))}return o(t,l),t}(),t.Tw2FeatureNotImplementedError=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Feature not implemented"))}return o(t,l),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2CurveSequencer=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(16);var a=t.Tw2CurveSequencer=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Tw2Curve),n(t,null,[{key:"Sort",value:function(e){var t=e.functions;if(t&&t.length)for(var r=0;r<t.length;r++)t[r]&&"Sort"in t[r]&&t[r].Sort()}},{key:"Sort2",value:function(e){var t=e.constructor.childProperties;if(t)for(var r=0;r<t.length;r++){var n=e[t[r]];n&&"Sort"in n&&n.Sort()}}}]),t}();a.childProperties=null,a.childArray=null,a.Operator=null},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveChild=void 0;var n,i,a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0);t.EveChild=(i=n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=o.util.generateID(),this.name="",this.display=!0,this.useSRT=!0,this.lowestLodVisible=2,this.staticTransform=!1,this.rotation=o.quat.create(),this.translation=o.vec3.create(),this.scaling=o.vec3.fromValues(1,1,1),this.localTransform=o.mat4.create(),this.worldTransform=o.mat4.create(),this.worldTransformLast=o.mat4.create(),this._perObjectData=null,this.isEffectChild=!0}return a(e,[{key:"GetResources",value:function(){return arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]}},{key:"Update",value:function(e,t){this.useSRT&&(o.quat.normalize(this.rotation,this.rotation),o.mat4.fromRotationTranslationScale(this.localTransform,this.rotation,this.translation,this.scaling)),o.mat4.copy(this.worldTransformLast,this.worldTransform),o.mat4.multiply(this.worldTransform,t,this.localTransform)}},{key:"GetBatches",value:function(e,t){}}]),e}(),n.global={mat4_0:o.mat4.create(),vec3_0:o.vec3.create()},n.perObjectData={FFEData:[["world",16],["worldInverseTranspose",16]]},i)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveObjectSet=t.EveObjectSetItem=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.EveObjectSetItem=function(){function e(){a(this,e),this._id=i.util.generateID(),this.name="",this.display=!0,this._rebuildPending=!0,this._onModified=null}return n(e,[{key:"OnValueChanged",value:function(){this._rebuildPending=!0,this._onModified&&this._onModified(this)}}]),e}();var o=t.EveObjectSet=function(){function e(){var t=this;a(this,e),this._id=i.util.generateID(),this.name="",this.display=!0,this.items=[],this._visibleItems=[],this._rebuildPending=!1,this._onChildModified=function(e){return t.OnValueChanged(e)}}return n(e,[{key:"Initialize",value:function(){this.Rebuild()}},{key:"OnValueChanged",value:function(){this._rebuildPending=!0}},{key:"CreateItem",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.constructor.Item;if(t&&"create"in t){var r=t.create(e);return this.AddItem(r),r}return null}},{key:"AddItem",value:function(e){this.items.includes(e)||(e._onModified=this._onChildModified,this.items.push(e),this.OnValueChanged())}},{key:"RemoveItem",value:function(e){var t=this.items.indexOf(e);-1!==t&&(e._onModified=null,this.items.splice(t,1),this.OnValueChanged())}},{key:"ClearItems",value:function(){for(var e=0;e<this.items.length;e++)this.items[e]._onModified=null;this.items=[],this.OnValueChanged()}},{key:"FindItemByID",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null!==e)for(var t=0;t<this.items.length;t++)if(this.items[t]._id===e)return this.items[t];return null}},{key:"GetResources",value:function(){return arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]}},{key:"Update",value:function(e){this._rebuildPending&&this.Rebuild()}},{key:"Unload",value:function(){}},{key:"Rebuild",value:function(){this.constructor.RebuildItems(this),this._rebuildPending=!1}},{key:"GetBatches",value:function(e,t,r){}},{key:"Render",value:function(){}}],[{key:"RebuildItems",value:function(e){e._visibleItems=[];for(var t=0;t<e.items.length;t++){var r=e.items[t];r._onModified=e._onChildModified,r._rebuildPending=!1,r.display&&e._visibleItems.push(r)}}}]),e}();o.Item=null,o.global={vec3_0:i.vec3.create(),vec3_1:i.vec3.create(),vec3_2:i.vec3.create(),vec4_0:i.vec4.create(),vec4_1:i.vec4.create(),mat4_0:i.mat4.create()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),i=r(70),a=r(71),o=r(34),s=r(72),u=r(73),l=r(74),c=r(35),f=r(36);r.d(t,"glMatrix",function(){return n}),r.d(t,"mat2",function(){return i}),r.d(t,"mat2d",function(){return a}),r.d(t,"mat3",function(){return o}),r.d(t,"mat4",function(){return s}),r.d(t,"quat",function(){return u}),r.d(t,"vec2",function(){return l}),r.d(t,"vec3",function(){return c}),r.d(t,"vec4",function(){return f})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Resource=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);var a=t.Tw2Resource=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.path="",this._isLoading=!1,this._isGood=!1,this._isPurged=!1,this._notifications=[],this.activeFrame=0,this.doNotPurge=0}return n(e,[{key:"IsLoading",value:function(){return this.KeepAlive(),this._isLoading}},{key:"IsGood",value:function(){return this.KeepAlive(),this._isGood}},{key:"IsPurged",value:function(){return this._isPurged}},{key:"Unload",value:function(){}},{key:"Reload",value:function(){this.Unload(),i.resMan.ReloadResource(this)}},{key:"KeepAlive",value:function(){this.activeFrame=i.resMan.activeFrame,this.IsPurged()&&this.Reload()}},{key:"GetErrors",value:function(){return i.resMan.motherLode.GetErrors(this.path)}},{key:"HasErrors",value:function(){return i.resMan.motherLode.HasErrors(this.path)}},{key:"OnError",value:function(e){return this._isGood=!1,i.resMan.OnResEvent("error",this.path,e),this.UpdateNotifications("OnResError"),e}},{key:"OnWarning",value:function(e){i.resMan.OnResEvent("warning",this.path,e)}},{key:"OnRequested",value:function(e){this._isLoading=!0,this._isPurged=!1,i.resMan.OnResEvent(this.IsPurged()?"reloading":"requested",this.path,e),this.UpdateNotifications("ReleaseCachedData")}},{key:"OnLoaded",value:function(e){this._isLoading=!1,this.HasErrors()||i.resMan.OnResEvent("loaded",this.path,e)}},{key:"OnPrepared",value:function(e){this._isLoading=!1,this.HasErrors()||(this._isGood=!0,i.resMan.OnResEvent("prepared",this.path,e),this.UpdateNotifications("RebuildCachedData"))}},{key:"OnUnloaded",value:function(e){i.resMan.OnResEvent(this.IsPurged()?"purged":"unloaded",this.path,e)}},{key:"RegisterNotification",value:function(e){this._notifications.includes(e)||(this._notifications.push(e),this.HasErrors()?"OnResError"in e&&e.OnResError(this):this.IsGood()&&"RebuildCachedData"in e&&e.RebuildCachedData(this))}},{key:"UnregisterNotification",value:function(e){this._notifications.splice(this._notifications.indexOf(e),1)}},{key:"UpdateNotifications",value:function(e){for(var t=0;t<this._notifications.length;t++)e in this._notifications[t]&&this._notifications[t][e](this)}}]),e}();a.prototype.DoCustomLoad=null,a.prototype.requestResponseType=null},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(87);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r(46);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveObject=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);(t.EveObject=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.name="",this.display=!0}return n(e,[{key:"Initialize",value:function(){}},{key:"GetResources",value:function(){return arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]}},{key:"Update",value:function(e){}},{key:"GetBatches",value:function(e,t){}}]),e}()).global={vec3_0:i.vec3.create(),vec3_1:i.vec3.create(),vec3_2:i.vec3.create(),vec3_3:i.vec3.create(),vec3_4:i.vec3.create(),vec3_5:i.vec3.create(),vec3_6:i.vec3.create(),vec3_7:i.vec3.create(),mat4_0:i.mat4.create(),mat4_1:i.mat4.create(),mat4_2:i.mat4.create()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleForce=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);(t.Tw2ParticleForce=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.name=""}return n(e,[{key:"ApplyForce",value:function(e,t,r,n,i){}},{key:"Update",value:function(e){}}]),e}()).global={vec3_0:i.vec3.create(),vec3_1:i.vec3.create(),vec4_0:i.vec4.create()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=new WeakMap;(t.Tw2EventEmitter=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,[{key:"emit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t.log&&!t.log.logged&&this.log(t.log),i.has(this)){var r=i.get(this);(e=e.toLowerCase())in r?r[e].forEach(function(n,i){i.call(n.context,t),n.once&&r[e].delete(i)}):(r[e]=new Set,this.emit("event_added",{eventName:e}))}return this}},{key:"on",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];i.has(this)||i.set(this,{});var o=i.get(this);return o[e=e.toLowerCase()]||(o[e]=new Set,o[e].add(function(){return r.emit("event_added",{eventName:e})},{once:!0})),o[e].add(t,{context:n,once:a}),this}},{key:"once",value:function(e,t,r){return this.on(e,t,r,!0)}},{key:"off",value:function(e,t){if(i.has(this)){var r=i.get(this);(e=e.toLowerCase())in r&&r[e].delete(t)}return this}},{key:"del",value:function(e){if(i.has(this)){var t=i.get(this);(e=e.toLowerCase())in t&&(this.emit("event_removed",{eventName:e}),delete t[e])}return this}},{key:"clr",value:function(e){if(i.has(this)){var t=i.get(this);for(var r in t)t.hasOwnProperty(r)&&t[r].has(e)&&t[r].delete(e)}return this}},{key:"kill",value:function(){return i.has(this)&&(this.emit("event_kill"),i.set(this,{})),this}},{key:"log",value:function(e){return this.constructor.logger&&this.constructor.logger.log(e),e}}],[{key:"assign",value:function(t){Object.assign(t.prototype,e.prototype)}}]),e}()).logger=null},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r(130);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(131);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var o=r(132);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var s=r(133);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var u=r(134);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var l=r(135);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})});var c=r(136);Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}})});var f=r(137);Object.keys(f).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}})});var h=r(138);Object.keys(h).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return h[e]}})});var p=r(139);Object.keys(p).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return p[e]}})});var d=r(140);Object.keys(d).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}})});var v=r(141);Object.keys(v).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return v[e]}})});var m=r(142);Object.keys(m).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return m[e]}})});var y=r(143);Object.keys(y).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return y[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleElementDeclaration=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(1),a=r(0);(t.Tw2ParticleElementDeclaration=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.elementType=4,this.customName="",this.dimension=1,this.usageIndex=0,this.usedByGPU=!0}return n(e,[{key:"GetDimension",value:function(){switch(this.elementType){case e.Type.LIFETIME:return 2;case e.Type.POSITION:case e.Type.VELOCITY:return 3;case e.Type.MASS:return 1}return this.dimension}},{key:"GetDeclaration",value:function(){var t=void 0;switch(this.elementType){case e.Type.LIFETIME:t=i.Tw2VertexDeclaration.Type.TANGENT;break;case e.Type.POSITION:t=i.Tw2VertexDeclaration.Type.POSITION;break;case e.Type.VELOCITY:t=i.Tw2VertexDeclaration.Type.NORMAL;break;case e.Type.MASS:t=i.Tw2VertexDeclaration.Type.BINORMAL;break;default:t=i.Tw2VertexDeclaration.Type.TEXCOORD}return new i.Tw2VertexElement(t,this.usageIndex,a.device.gl.FLOAT,this.GetDimension())}}]),e}()).Type={LIFETIME:0,POSITION:1,VELOCITY:2,MASS:3,CUSTOM:4}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(68);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r(91);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(26);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var o=r(92);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var s=r(25);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var u=r(93);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2TextureRes=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(11),o=r(6);t.Tw2TextureRes=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.texture=null,e.isCube=!1,e.images=[],e.width=0,e.height=0,e.hasMipMaps=!1,e._facesLoaded=0,e._currentSampler=0,e._isAttached=!1,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2Resource),n(t,[{key:"Prepare",value:function(e){var r=i.device.gl,n=this.images[0].ccpGLFormat?this.images[0].ccpGLFormat:r.RGBA;switch(e){case"cube":this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_CUBE_MAP,this.texture);var a=document.createElement("canvas");a.width=a.height=this.images[0].height;for(var s=a.getContext("2d"),u=0;u<6;++u)s.drawImage(this.images[0],u*a.width,0,a.width,a.height,0,0,a.width,a.height),r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+u,0,n,n,r.UNSIGNED_BYTE,a);r.generateMipmap(r.TEXTURE_CUBE_MAP),r.bindTexture(r.TEXTURE_CUBE_MAP,null),this.width=a.width,this.height=a.height,this.hasMipMaps=!0;break;case"png":this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texImage2D(r.TEXTURE_2D,0,n,n,r.UNSIGNED_BYTE,this.images[0]),this.hasMipMaps=t.IsPowerOfTwo(this.images[0].width)&&t.IsPowerOfTwo(this.images[0].height),this.hasMipMaps&&r.generateMipmap(r.TEXTURE_2D),r.bindTexture(r.TEXTURE_2D,null),this.width=this.images[0].width,this.height=this.images[0].height;break;default:throw new o.Tw2ResourceExtensionUnregisteredError({path:this.path,extension:e})}this.images=null,this._isAttached=!1,this.OnPrepared()}},{key:"DoCustomLoad",value:function(e,r){var n=this;switch(r){case"cube":this.isCube=!0,e=e.substr(0,e.length-5)+".png";break;case"png":this.isCube=!1;break;default:throw new o.Tw2ResourceExtensionUnregisteredError({path:e,extension:r})}return this.OnRequested(),i.resMan._pendingLoads++,this.images=[],this.images[0]=new Image,this.images[0].crossOrigin="anonymous",this.images[0].onerror=function(){i.resMan._pendingLoads--,n.images=null,n.OnError(new o.HTTPRequestError({path:e}))},this.images[0].onload=function(){i.resMan._pendingLoads--,i.resMan._prepareQueue.push([n,r,null]),n.OnLoaded()},this.images[0].src=t.AddMipLevelSkipCount(e),!0}},{key:"Unload",value:function(){return this.texture&&(i.device.gl.deleteTexture(this.texture),this.texture=null),this._isPurged=!0,this._isGood=!1,this._isAttached=!1,!0}},{key:"Attach",value:function(e){this.path="",this.texture=e,this._isPurged=!1,this._isAttached=!0,this.OnLoaded({hide:!0,data:{isAttachment:!0}}),this.OnPrepared({hide:!0,data:{isAttachment:!0}})}},{key:"Reload",value:function(){if(!this._isAttached)return function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"Reload",this).call(this)}},{key:"Bind",value:function(e,t){var r=i.device,n=r.gl;this.KeepAlive();var a=e.samplerType;if(a===(this.isCube?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D))if(this.texture)e.isVolume&&n.uniform1f(t,this.height/this.width),n.bindTexture(a,this.texture),e.hash!==this._currentSampler&&(e.Apply(this.hasMipMaps),this._currentSampler=e.hash);else{var o=a===n.TEXTURE_2D?r.GetFallbackTexture():r.GetFallbackCubeMap();n.bindTexture(a,o)}}}],[{key:"IsPowerOfTwo",value:function(e){return 0==(e&e-1)}},{key:"AddMipLevelSkipCount",value:function(e){var t=i.device,r=t.mipLevelSkipCount>0?"."+t.mipLevelSkipCount.toString():"";if(t.mipLevelSkipCount>0){var n=e.lastIndexOf(".");n>=0&&(e=e.substr(0,n-2)+r+e.substr(n))}return e}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(33);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r(69);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(37);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var o=r(38);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var s=r(75);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var u=r(76);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var l=r(77);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})});var c=r(78);Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}})});var f=r(79);Object.keys(f).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.store=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(5),a=r(15);var o=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name="Variable store",e._type={},e._path={},e._variable={},e._extension={},e._class={},e._dynamicPath={},e._schema={},e._missing={},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2EventEmitter),n(t,[{key:"HasPath",value:function(e){return e&&e in this._path}},{key:"GetPath",value:function(e){return t.GetStoreItem(this,"path",e)}},{key:"RegisterPath",value:function(e,r){return r.lastIndexOf("/")!==r.length-1&&(r+="/"),t.RestrictedPathPrefixes.includes(e)?(this.emit("error",{type:"path",key:e,value:r,log:{type:"error",title:this.name,message:'Cannot register restricted prefix "'+e+'"'}}),!1):t.SetStoreItem(this,"path",e,r,i.isString)}},{key:"RegisterPaths",value:function(e){return t.RegisterFromObject(this,"RegisterPath",e)}},{key:"HasDynamicPath",value:function(e){return e&&e in this._dynamicPath}},{key:"GetDynamicPath",value:function(e){return t.GetStoreItem(this,"dynamicPath",e)}},{key:"RegisterDynamicPath",value:function(e,r){return t.SetStoreItem(this,"dynamicPath",e,r,i.isArray)}},{key:"RegisterDynamicPaths",value:function(e){return t.RegisterFromObject(this,"RegisterDynamicPath",e)}},{key:"HasExtension",value:function(e){return e&&e in this._extension}},{key:"GetExtension",value:function(e){return t.GetStoreItem(this,"extension",e)}},{key:"RegisterExtension",value:function(e,r){return t.SetStoreItem(this,"extension",e,r,i.isFunction)}},{key:"RegisterExtensions",value:function(e){return t.RegisterFromObject(this,"RegisterExtension",e)}},{key:"HasClass",value:function(e){return e&&e in this._class}},{key:"GetClass",value:function(e){var r=t.GetStoreItem(this,"class",e);return r&&r.partialImplementation&&this.emit("warning",{type:"class",key:e,value:r,log:{type:"warning",title:this.name,message:"Feature partially implemented ("+e+")"}}),r}},{key:"RegisterClass",value:function(e,r){return t.SetStoreItem(this,"class",e,r,i.isFunction)}},{key:"RegisterClasses",value:function(e){return t.RegisterFromObject(this,"RegisterClass",e)}},{key:"HasVariable",value:function(e){return e&&e in this._variable}},{key:"GetVariable",value:function(e){return t.GetStoreItem(this,"variable",e)}},{key:"GetVariableValue",value:function(e,t){var r=this.GetVariable(e);return r&&r.GetValue?r.GetValue(t):null}},{key:"SetVariableValue",value:function(e,t){var r=this.GetVariable(e);return r&&r.SetValue?(r.SetValue(t),!0):null}},{key:"RegisterVariable",value:function(e,r,n){var i=this.CreateType(e,r,n);return t.SetStoreItem(this,"variable",e,i),i}},{key:"RegisterVariables",value:function(e){return t.RegisterFromObject(this,"RegisterVariable",e)}},{key:"GetType",value:function(e){return t.GetStoreItem(this,"type",e)}},{key:"HasType",value:function(e){return e&&e in this._type}},{key:"GetTypeByValue",value:function(e){for(var t in this._type)if(this._type.hasOwnProperty(t)&&"isValue"in this._type[t]&&this._type[t].isValue(e))return this._type[t];return null}},{key:"CreateType",value:function(e,t,r){return(0,i.isPlain)(t)&&(r=t.Type||t.type,t=t.value),r||(r=this.GetTypeByValue(t)),(0,i.isString)(r)&&(r=this.GetType(r)),(0,i.isFunction)(r)?new r(e,t):null}},{key:"RegisterType",value:function(e,r){return t.SetStoreItem(this,"type",e,r,i.isFunction)}},{key:"RegisterTypes",value:function(e){return t.RegisterFromObject(this,"RegisterType",e)}},{key:"HasSchema",value:function(e){return e&&e in this._schema}},{key:"GetSchema",value:function(e){return t.GetStoreItem(this,"schema",e)}},{key:"RegisterSchema",value:function(e,r){return t.SetStoreItem(this,"schema",e,r,function(e){return e&&"Tw2Schema"===e.constructor.name})}},{key:"RegisterSchemas",value:function(e){return t.RegisterFromObject(this,"RegisterSchema",e)}},{key:"Register",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"uuid"in e&&(0,i.enableUUID)(e.uuid),this.RegisterPaths(e.paths),this.RegisterDynamicPaths(e.dynamicPaths),this.RegisterTypes(e.types),this.RegisterClasses(e.classes),this.RegisterExtensions(e.extensions),this.RegisterVariables(e.variables),this.RegisterSchemas(e.schemas)}}],[{key:"GetStoreItem",value:function(e,t,r){var n=e["_"+t];if(n&&(0,i.isString)(r)){if(r in n)return n[r];e._missing[t]||(e._missing[t]=[]),e._missing[t].includes(r)||e._missing[t].push(r),e.emit("missing",{type:t,key:r,log:{type:"debug",title:e.name,message:"Missing "+t+': "'+r+'"'}})}return null}},{key:"SetStoreItem",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments[3],a=arguments[4];if(a&&!a(n))return e.emit("error",{type:t,key:r,value:n,log:{type:"error",title:e.name,message:"Invalid "+t+': "'+r+'"'}}),!1;var o=e["_"+t];if(o&&(0,i.isString)(r)&&!(0,i.isUndefined)(n)){var s=o[r];return o[r]=n,e.emit("registered",{type:t,key:r,value:n,oldValue:s,log:{type:"debug",title:e.name,message:(s?"Re-registered":"Registered")+" "+t+' "'+r+'"'}}),!0}return!1}},{key:"RegisterFromObject",value:function(e,t,r){if(r&&t in e){r=(0,i.toArray)(r);for(var n=0;n<r.length;n++)for(var a in r[n])r[n].hasOwnProperty(a)&&e[t](a,r[n][a]);return!0}return!1}}]),t}();o.RestrictedPathPrefixes=["dynamic","rgba"];t.store=new o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.isArrayLike=function(e){return!!e&&(a(e)||f(e))},t.isBoolean=o,t.isCanvas=function(e){return!!(e&&e instanceof HTMLCanvasElement)},t.isDescriptor=function(e){if(!e||!e.hasOwnProperty)return!1;for(var t=["value","initializer","get","set"],r=0,n=t.length;r<n;r++)if(e.hasOwnProperty(t[r]))return!0;return!1},t.isError=function(e){return!!(e&&e instanceof Error||e.constructor.isError)},t.isNumber=s,t.isFunction=function(e){return"function"==typeof e},t.isNoU=function(e){return null==e},t.isNull=function(e){return null===e},t.isObject=u,t.isObjectLike=function(e){return null!==e&&"object"===(void 0===e?"undefined":n(e))},t.isPlain=function(e){if(!u(e)||!c(e,"[object Object]"))return!1;if(null===Object.getPrototypeOf(e))return!0;var t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t},t.isPrimary=function(e){return o(e)||s(e)||l(e)},t.isString=l,t.isSymbol=function(e){return"symbol"===(void 0===e?"undefined":n(e))||c(e,"[object Symbol]")},t.isTag=c,t.isTyped=f,t.isUndefined=function(e){return void 0===e},t.isVector=function(e){if(!e)return!1;if(f(e))return!0;if(a(e)){for(var t=0;t<e.length;t++)if(!s(e[t]))return!1;return!0}};var i=Object.prototype.toString,a=t.isArray=Array.isArray;function o(e){return c(e,"[object Boolean]")}function s(e){return c(e,"[object Number]")}function u(e){var t=void 0===e?"undefined":n(e);return null!==e&&("object"===t||"function"===t)}function l(e){return c(e,"[object String]")}function c(e,t){return i.call(e)===t}function f(e){return!!e&&!!(e.buffer instanceof ArrayBuffer&&e.BYTES_PER_ELEMENT)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Effect=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(44);(t.Tw2Effect=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.name="",this.effectFilePath="",this.effectRes=null,this.parameters={},this.techniques=[],this.samplerOverrides=[],this.autoParameter=!1,this.options={},this.shader=null}return n(e,[{key:"Initialize",value:function(){if(""!==this.effectFilePath){this.effectFilePath=this.effectFilePath.toLowerCase();var t=e.ToEffectResPath(this.effectFilePath);this.effectRes=i.resMan.GetResource(t),this.effectRes.RegisterNotification(this)}}},{key:"IsGood",value:function(){return this.KeepAlive(),null!==this.shader}},{key:"KeepAlive",value:function(){for(var e=this.GetResources(),t=0;t<e.length;t++)e[t].KeepAlive()}},{key:"GetResources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(var t in this.effectRes&&!e.includes(this.effectRes)&&e.push(this.effectRes),this.parameters)this.parameters.hasOwnProperty(t)&&"GetResources"in this.parameters[t]&&this.parameters[t].GetResources(e);return e}},{key:"RebuildCachedData",value:function(e){this.shader=e.GetShader(this.options),this.BindParameters()}},{key:"UnBindParameters",value:function(){for(var e in this.techniques)if(this.techniques.hasOwnProperty(e))for(var t=this.techniques[e],r=0;r<t.length;++r)for(var n=0;n<t[r].stages.length;++n)for(var i=0;i<t[r].stages[n].reroutedParameters.length;++i)t[r].stages[n].reroutedParameters[i].Unbind();this.techniques={}}},{key:"BindParameters",value:function(){if(this.UnBindParameters(),!this.IsGood())return!1;for(var t in this.shader.techniques)if(this.shader.techniques.hasOwnProperty(t)){for(var r=this.shader.techniques[t],n=[],o=0;o<r.passes.length;++o){var s=[];s.stages=[];for(var u=0;u<r.passes[o].stages.length;++u){var l=r.passes[o].stages[u],c={};c.constantBuffer=new Float32Array(l.constantSize),c.reroutedParameters=[],c.parameters=[],c.textures=[],c.constantBuffer.set(l.constantValues);for(var f=0;f<l.constants.length;++f){var h=l.constants[f],p=h.name,d=h.Type;if(!e.ConstantIgnore.includes(p))if(p in this.parameters){var v=this.parameters[p];v.Bind(c.constantBuffer,h.offset,h.size)?c.reroutedParameters.push(v):c.parameters.push({parameter:v,constantBuffer:c.constantBuffer,offset:h.offset,size:h.size})}else if(i.store.HasVariable(p))c.parameters.push({parameter:i.store.GetVariable(p),constantBuffer:c.constantBuffer,offset:h.offset,size:h.size});else if(h.isAutoregister&&d){var m=i.store.RegisterVariable(p,void 0,d);m&&c.parameters.push({parameter:m,constantBuffer:c.constantBuffer,offset:h.offset,size:h.size})}else if(this.autoParameter&&1===h.elements){var y=c.constantBuffer.subarray(h.offset,h.offset+h.size);0===y.length?y=void 0:1===y.length&&(y=y[0]);var b=i.store.CreateType(p,y,d);b&&(this.parameters[p]=b,b.Bind(c.constantBuffer,h.offset,h.size)?c.reroutedParameters.push(b):c.parameter.push({parameter:b,constantBuffer:c.constantBuffer,offset:h.offset,size:h.size}))}}for(var _=0;_<l.textures.length;++_){var g=l.textures[_].name,E=null;if(g in this.parameters)E=this.parameters[g];else if(i.store.HasVariable(g))E=i.store.GetVariable(g);else if(l.textures[_].isAutoregister)E=i.store.RegisterVariable(g,void 0,a.Tw2TextureParameter);else{if(!this.autoParameter)continue;E=this.parameters[g]=new a.Tw2TextureParameter(g)}for(var T={parameter:E,slot:l.textures[_].registerIndex,sampler:null},O=0;O<l.samplers.length;++O)if(l.samplers[O].registerIndex===T.slot){l.samplers[O].name in this.samplerOverrides?T.sampler=this.samplerOverrides[l.samplers[O].name].GetSampler(l.samplers[O]):T.sampler=l.samplers[O];break}0===u&&(T.slot+=12),c.textures.push(T)}s.stages.push(c)}n.push(s)}this.techniques[t]=n}return i.device.effectObserver&&i.device.effectObserver.OnEffectChanged(this),this.autoParameter=!1,!0}},{key:"ApplyPass",value:function(e,t){if(this.IsGood()&&e in this.techniques&&!(t>=this.techniques[e].length)){this.shader.ApplyPass(e,t);for(var r=this.techniques[e][t],n=this.shader.techniques[e].passes[t],a=i.device,o=a.gl,s=a.IsAlphaTestEnabled()&&n.shadowShaderProgram?n.shadowShaderProgram:n.shaderProgram,u=0;u<2;++u){for(var l=r.stages[u],c=0;c<l.parameters.length;++c){var f=l.parameters[c];f.parameter.Apply(f.constantBuffer,f.offset,f.size)}for(var h=0;h<l.textures.length;++h){var p=l.textures[h];p.parameter.Apply(p.slot,p.sampler,s.volumeSlices[p.sampler.registerIndex])}}var d=s.constantBufferHandles;d[0]&&o.uniform4fv(d[0],r.stages[0].constantBuffer),d[7]&&o.uniform4fv(d[7],r.stages[1].constantBuffer),a.perFrameVSData&&d[1]&&o.uniform4fv(d[1],a.perFrameVSData.data),a.perFramePSData&&d[2]&&o.uniform4fv(d[2],a.perFramePSData.data),a.perObjectData&&a.perObjectData.SetPerObjectDataToDevice(d)}}},{key:"GetPassCount",value:function(e){return null!==this.shader&&e in this.techniques?this.techniques[e].length:0}},{key:"GetPassInput",value:function(e,t){return null===this.shader||!(e in this.techniques)||t>=this.techniques[e].length?null:i.device.IsAlphaTestEnabled()&&this.shader.techniques[e].passes[t].shadowShaderProgram?this.shader.techniques[e].passes[t].shadowShaderProgram.input:this.shader.techniques[e].passes[t].shaderProgram.input}},{key:"Render",value:function(e){for(var t=this.GetPassCount("Main"),r=0;r<t;++r)this.ApplyPass("Main",r),e(this,r)}},{key:"GetTextures",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var t in this.parameters)if(this.parameters.hasOwnProperty(t)&&this.parameters[t]instanceof a.Tw2TextureParameter){var r=this.parameters[t].GetValue();r&&(e[t]=r)}return e}},{key:"SetTextures",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!1;for(var r in e)if(e.hasOwnProperty(r)){var n=e[r],i=this.parameters[r];a.Tw2TextureParameter.isValue(n)&&(i?i.EqualsValue(n)||(i.SetTexturePath(n),t=!0):(this.parameters[r]=new a.Tw2TextureParameter(r,n),t=!0))}return t}},{key:"GetParameters",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var t in this.parameters)!this.parameters.hasOwnProperty(t)||this.parameters[t]instanceof a.Tw2TextureParameter||(e[t]=this.parameters[t].GetValue(!0));return e}},{key:"SetParameters",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!1;for(var r in e)if(e.hasOwnProperty(r)){var n=e[r],a=this.parameters[r];if(a)a.constructor.isValue(n)&&!a.EqualsValue(n)&&(this.parameters[r].SetValue(n),t=!0);else{var o=i.store.CreateType(r,n);o&&(this.parameters[r]=o,t=!0)}}return t}},{key:"SetOverrides",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!1;for(var r in e)if(e.hasOwnProperty(r)){var n=this.parameters[r];if(n&&n instanceof a.Tw2TextureParameter){var i=!1,o=e[r];for(var s in o)if(o.hasOwnProperty(s)&&a.Tw2TextureParameter.overrideProperties.includes(s)&&o[s]!==n[s]){i=!0;break}i&&(n.SetOverrides(e[r]),t=!0)}}return t}},{key:"GetOverrides",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var t in this.parameters)if(this.parameters.hasOwnProperty(t)){var r=this.parameters[t];r&&r instanceof a.Tw2TextureParameter&&r.useAllOverrides&&(e[t]=this.parameters[t].GetOverrides())}return e}},{key:"AutoParameter",value:function(){return this.autoParameter=!0,this.BindParameters()}}],[{key:"ToEffectResPath",value:function(e){return(e=e?e.substr(0,e.lastIndexOf(".")).replace("/effect/",i.device.effectDir)+".sm_"+i.device.shaderModel:"").toLowerCase()}},{key:"FromEffectResPath",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"fx";return(e=e.substr(0,e.lastIndexOf(".")).replace(i.device.effectDir,"/effect/")+"."+t).toLowerCase()}},{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new this;if(i.util.assignIfExists(t,e,["name","effectFilePath","display","autoParameter"]),"parameters"in e&&t.SetParameters(e.parameters),"textures"in e&&t.SetTextures(e.textures),"overrides"in e&&t.SetOverrides(e.overrides),""===t.name&&""!==e.effectFilePath){var r=e.effectFilePath;t.name=r.substring(r.lastIndexOf("/")+1,r.length)}return!t.name&&t.effectFilePath&&(t.name=t.effectFilePath.substring(t.effectFilePath.lastIndexOf("/")+1,t.effectFilePath.lastIndexOf("."))),t.Initialize(),t}}]),e}()).ConstantIgnore=["PerFrameVS","PerObjectVS","PerFramePS","PerObjectPS","PerObjectPSInt"]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(45);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r(86);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2RenderBatch=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);t.Tw2RenderBatch=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderMode=i.device.RM_ANY,this.perObjectData=null}return n(e,[{key:"Commit",value:function(e){}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2GeometryBatch=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(25);t.Tw2GeometryBatch=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.geometryRes=null,e.meshIx=0,e.start=0,e.count=1,e.effect=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Tw2RenderBatch),n(t,[{key:"Commit",value:function(e){this.geometryRes&&this.effect&&this.geometryRes.RenderAreas(this.meshIx,this.start,this.count,this.effect,e)}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(4);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r(97);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(98);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var o=r(99);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var s=r(100);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var u=r(101);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var l=r(102);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})});var c=r(103);Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}})});var f=r(44);Object.keys(f).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2RawData=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(0),o=r(6);t.Tw2RawData=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.nextOffset=0,this.data=null,this.elements={},t&&this.DeclareFromObject(t)}return i(e,[{key:"Set",value:function(e,t){var r=this.elements[e],n="subarray"in t?"subarray":"slice";this.data.set(t.length>r.size?t[n](0,r.size):t,r.offset)}},{key:"Get",value:function(e){return this.elements[e].array}},{key:"GetData",value:function(e){return this.data.subarray(this.elements[e].offset,this.elements[e].offset+this.elements[e].array.length)}},{key:"Create",value:function(){for(var e in this.data=new Float32Array(this.nextOffset),this.elements)if(this.elements.hasOwnProperty(e)){var t=this.elements[e];if(t.array=this.data.subarray(t.offset,t.offset+t.size),null!==t.value){if(1===t.size)a.util.isNumber(t.value)?t.array[0]=t.value:t.array[0]=t.value[0];else for(var r=0;r<t.size;r++)t.array[r]=t.value[r];t.value=null}}}},{key:"Declare",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null!==r&&!a.util.isArrayLike(r)&&!a.util.isNumber(r))throw new o.Tw2DeclarationValueTypeError({declaration:e,valueType:void 0===r?"undefined":n(r)});this.elements[e]={offset:this.nextOffset,size:t,array:null,value:r},this.nextOffset+=t}},{key:"DeclareFromObject",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=0;t<e.length;t++){var r=e[t];a.util.isArray(r)?this.Declare(r[0],r[1],r[2]):this.Declare(r.name,r.size,r.value)}this.Create()}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(43);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r(42);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveStation=t.EveSpaceObject=void 0;var n,i,a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),s=r(1),u=r(13);var l=t.EveSpaceObject=(i=n=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.visible={},e.visible.mesh=!0,e.visible.children=!0,e.visible.effectChildren=!0,e.visible.planeSets=!0,e.visible.spotlightSets=!0,e.visible.decals=!0,e.visible.spriteSets=!0,e.visible.overlayEffects=!0,e.visible.lineSets=!0,e.visible.killmarks=!0,e.visible.customMasks=!0,e.mesh=null,e.animation=new s.Tw2AnimationController,e.locators=[],e.spriteSets=[],e.turretSets=[],e.decals=[],e.spotlightSets=[],e.planeSets=[],e.curveSets=[],e.lineSets=[],e.overlayEffects=[],e.children=[],e.effectChildren=[],e.customMasks=[],e.lod=3,e.killCount=0,e.transform=o.mat4.create(),e.boundingSphereCenter=o.vec3.create(),e.boundingSphereRadius=0,e.shapeEllipsoidRadius=o.vec3.create(),e.shapeEllipsoidCenter=o.vec3.create(),e._perObjectData=new s.Tw2PerObjectData(t.perObjectData),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.EveObject),a(t,[{key:"Initialize",value:function(){if(this.mesh){this.animation.SetGeometryResource(this.mesh.geometryResource);for(var e=0;e<this.decals.length;++e)this.decals[e].SetParentGeometry(this.mesh.geometryResource)}}},{key:"ResetLod",value:function(){this.lod=3}},{key:"UpdateLod",value:function(e){var r=o.vec3.transformMat4(t.global.vec3_0,this.boundingSphereCenter,this.transform);e.IsSphereVisible(r,this.boundingSphereRadius)?e.GetPixelSizeAcross(r,this.boundingSphereRadius)<100?this.lod=1:this.lod=2:this.lod=0}},{key:"AddCustomMask",value:function(e,t,r,n,i,a){var s=o.mat4.fromRotationTranslationScale(o.mat4.create(),r,e,t);o.mat4.invert(s,s),o.mat4.transpose(s,s),this.customMasks.push({transform:s,maskData:o.vec4.fromValues(1,n?1:0,0,0),materialID:o.vec4.fromValues(i,0,0,0),targets:a})}},{key:"GetLocatorCount",value:function(e){return this.FindLocatorsByPrefix(e).length}},{key:"FindLocatorJointByName",value:function(e){var t=this.FindLocatorBoneByName(e);return t?t.worldTransform:null}},{key:"FindLocatorTransformByName",value:function(e){var t=this.FindLocatorByName(e);return t?t.transform:null}},{key:"HasLocatorPrefix",value:function(e){for(var t=0;t<this.locators.length;t++)if(this.locators[t].name.substring(0,e.length)===e)return!0;return!1}},{key:"FindLocatorBoneByName",value:function(e){var t=this.animation.FindModelForMesh(0);if(t)for(var r=0;r<t.bones.length;++r)if(t.bones[r].boneRes.name===e)return t.bones[r];return null}},{key:"FindLocatorByName",value:function(e){for(var t=0;t<this.locators.length;t++)if(this.locators[t].name===e)return this.locators[t];return null}},{key:"FindLocatorsByPrefix",value:function(e){for(var t=[],r=0;r<this.locators.length;r++)0===this.locators[r].name.indexOf(e)&&t.push(this.locators[r]);return t}},{key:"GetResources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1];return this.mesh&&this.mesh.GetResources(e),this.animation&&this.animation.GetResources(e),o.util.perArrayChild(this.spriteSets,"GetResources",e),o.util.perArrayChild(this.turretSets,"GetResources",e),o.util.perArrayChild(this.decals,"GetResources",e),o.util.perArrayChild(this.spotlightSets,"GetResources",e),o.util.perArrayChild(this.planeSets,"GetResources",e),o.util.perArrayChild(this.lineSets,"GetResources",e),o.util.perArrayChild(this.overlayEffects,"GetResources",e),o.util.perArrayChild(this.effectChildren,"GetResources",e),t||o.util.perArrayChild(this.children,"GetResources",e),e}},{key:"UpdateViewDependentData",value:function(){for(var e=0;e<this.children.length;++e)this.children[e].UpdateViewDependentData(this.transform);o.mat4.transpose(this._perObjectData.perObjectVSData.Get("WorldMat"),this.transform),o.mat4.transpose(this._perObjectData.perObjectVSData.Get("WorldMatLast"),this.transform);var t=this._perObjectData.perObjectVSData.Get("EllipsoidCenter"),r=this._perObjectData.perObjectVSData.Get("EllipsoidRadii");this.shapeEllipsoidRadius[0]>0?(t[0]=this.shapeEllipsoidCenter[0],t[1]=this.shapeEllipsoidCenter[1],t[2]=this.shapeEllipsoidCenter[2],r[0]=this.shapeEllipsoidRadius[0],r[1]=this.shapeEllipsoidRadius[1],r[2]=this.shapeEllipsoidRadius[2]):this.mesh&&this.mesh.IsGood()&&(o.vec3.subtract(t,this.mesh.geometryResource.maxBounds,this.mesh.geometryResource.minBounds),o.vec3.scale(t,t,.8660254035),o.vec3.add(r,this.mesh.geometryResource.maxBounds,this.mesh.geometryResource.minBounds),o.vec3.scale(r,r,.5));for(var n=0;n<this.customMasks.length;++n){var i=this.visible.customMasks?this.customMasks[n].targets:[0,0,0,0];this._perObjectData.perObjectVSData.Set(n?"CustomMaskMatrix1":"CustomMaskMatrix0",this.customMasks[n].transform),this._perObjectData.perObjectVSData.Set(n?"CustomMaskData1":"CustomMaskData0",this.customMasks[n].maskData),this._perObjectData.perObjectPSData.Set(n?"CustomMaskMaterialID1":"CustomMaskMaterialID0",this.customMasks[n].materialID),this._perObjectData.perObjectPSData.Set(n?"CustomMaskTarget1":"CustomMaskTarget0",i)}this.animation.animations.length&&this._perObjectData.perObjectVSData.Set("JointMat",this.animation.GetBoneMatrices(0));for(var a=0;a<this.lineSets.length;++a)this.lineSets[a].UpdateViewDependentData(this.transform)}},{key:"Update",value:function(e){if(this.lod>0){for(var t=0;t<this.spriteSets.length;++t)this.spriteSets[t].Update(e);for(var r=0;r<this.planeSets.length;r++)this.planeSets[r].Update(e);for(var n=0;n<this.spotlightSets.length;n++)this.spotlightSets[n].Update(e);for(var i=0;i<this.children.length;++i)this.children[i].Update(e);for(var a=0;a<this.effectChildren.length;++a)this.effectChildren[a].Update(e,this.transform);for(var o=0;o<this.curveSets.length;++o)this.curveSets[o].Update(e);for(var s=0;s<this.overlayEffects.length;++s)this.overlayEffects[s].Update(e);for(var u=0;u<this.lineSets.length;u++)this.lineSets[u].Update(e);this.animation.Update(e)}}},{key:"GetBatches",value:function(e,t){if(this.display){var r=this.visible;if(r.mesh&&this.mesh&&this.lod>0&&this.mesh.GetBatches(e,t,this._perObjectData),this.lod>1){if(r.spriteSets)for(var n=0;n<this.spriteSets.length;n++)this.spriteSets[n].GetBatches(e,t,this._perObjectData,this.transform);if(r.spotlightSets)for(var i=0;i<this.spotlightSets.length;i++)this.spotlightSets[i].GetBatches(e,t,this._perObjectData);if(r.planeSets)for(var a=0;a<this.planeSets.length;a++)this.planeSets[a].GetBatches(e,t,this._perObjectData);if(r.decals)for(var o=0;o<this.decals.length;o++)this.decals[o].GetBatches(e,t,this._perObjectData,r.killmarks?this.killCount:0);if(r.lineSets)for(var s=0;s<this.lineSets.length;s++)this.lineSets[s].GetBatches(e,t)}if(r.children)for(var u=0;u<this.children.length;u++)this.children[u].GetBatches(e,t,this._perObjectData);if(r.effectChildren)for(var l=0;l<this.effectChildren.length;l++)this.effectChildren[l].GetBatches(e,t,this._perObjectData);if(r.overlayEffects&&this.mesh&&this.mesh.IsGood())for(var c=0;c<this.overlayEffects.length;c++)this.overlayEffects[c].GetBatches(e,t,this._perObjectData,this.mesh)}}},{key:"RenderDebugInfo",value:function(e){this.animation.RenderDebugInfo(e)}}]),t}(),n.perObjectData={VSData:[["WorldMat",16],["WorldMatLast",16],["Shipdata",4,[0,1,0,-10]],["Clipdata1",4],["EllipsoidRadii",4],["EllipsoidCenter",4],["CustomMaskMatrix0",16,o.mat4.identity([])],["CustomMaskMatrix1",16,o.mat4.identity([])],["CustomMaskData0",4],["CustomMaskData1",4],["JointMat",696]],PSData:[["Shipdata",4,[0,1,0,1]],["Clipdata1",4],["Clipdata2",4],["ShLighting",28],["CustomMaskMaterialID0",4],["CustomMaskMaterialID1",4],["CustomMaskTarget0",4],["CustomMaskTarget1",4]]},i);t.EveStation=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleEmitter=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);t.Tw2ParticleEmitter=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.name="",this.particleSystem=null}return n(e,[{key:"Initialize",value:function(){}},{key:"Update",value:function(e){}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleAttributeGenerator=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);(t.Tw2ParticleAttributeGenerator=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.name=""}return n(e,[{key:"Bind",value:function(e){return!1}},{key:"Generate",value:function(e,t,r){}}]),e}()).global={vec3_0:i.vec3.create()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=t.num={};n.biCumulative=function(e,t){if(1===t){var r=1-e;return 1-r*r*r}return 2===t?3*e*e-2*e*e*e:e*e*e},n.dwordToFloat=function(e){var t=(16711680&e)>>16,r=(4278190080&e)>>24,n=(r<<1&255|t>>7)-127,i=(127&t)<<16|(65280&e)>>8<<8|255&e;return 0===i&&-127===n?0:(1-2*(r>>7))*(1+i*Math.pow(2,-23))*Math.pow(2,n)},n.exponentialDecay=function(e,t,r,n,i){return t*i/n+r*(e*n-t)/(n*n)*(1-Math.pow(Math.E,-n*i/r))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){let e=new n.ARRAY_TYPE(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},t.clone=function(e){let t=new n.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},t.fromValues=function(e,t,r,i,a,o,s,u,l){let c=new n.ARRAY_TYPE(9);return c[0]=e,c[1]=t,c[2]=r,c[3]=i,c[4]=a,c[5]=o,c[6]=s,c[7]=u,c[8]=l,c},t.set=function(e,t,r,n,i,a,o,s,u,l){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=a,e[5]=o,e[6]=s,e[7]=u,e[8]=l,e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.transpose=function(e,t){if(e===t){let r=t[1],n=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=n,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},t.invert=function(e,t){let r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],f=c*o-s*l,h=-c*a+s*u,p=l*a-o*u,d=r*f+n*h+i*p;if(!d)return null;return d=1/d,e[0]=f*d,e[1]=(-c*n+i*l)*d,e[2]=(s*n-i*o)*d,e[3]=h*d,e[4]=(c*r-i*u)*d,e[5]=(-s*r+i*a)*d,e[6]=p*d,e[7]=(-l*r+n*u)*d,e[8]=(o*r-n*a)*d,e},t.adjoint=function(e,t){let r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8];return e[0]=o*c-s*l,e[1]=i*l-n*c,e[2]=n*s-i*o,e[3]=s*u-a*c,e[4]=r*c-i*u,e[5]=i*a-r*s,e[6]=a*l-o*u,e[7]=n*u-r*l,e[8]=r*o-n*a,e},t.determinant=function(e){let t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8];return t*(l*a-o*u)+r*(-l*i+o*s)+n*(u*i-a*s)},t.multiply=i,t.translate=function(e,t,r){let n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],f=t[8],h=r[0],p=r[1];return e[0]=n,e[1]=i,e[2]=a,e[3]=o,e[4]=s,e[5]=u,e[6]=h*n+p*o+l,e[7]=h*i+p*s+c,e[8]=h*a+p*u+f,e},t.rotate=function(e,t,r){let n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],f=t[8],h=Math.sin(r),p=Math.cos(r);return e[0]=p*n+h*o,e[1]=p*i+h*s,e[2]=p*a+h*u,e[3]=p*o-h*n,e[4]=p*s-h*i,e[5]=p*u-h*a,e[6]=l,e[7]=c,e[8]=f,e},t.scale=function(e,t,r){let n=r[0],i=r[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},t.fromRotation=function(e,t){let r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=-r,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},t.fromQuat=function(e,t){let r=t[0],n=t[1],i=t[2],a=t[3],o=r+r,s=n+n,u=i+i,l=r*o,c=n*o,f=n*s,h=i*o,p=i*s,d=i*u,v=a*o,m=a*s,y=a*u;return e[0]=1-f-d,e[3]=c-y,e[6]=h+m,e[1]=c+y,e[4]=1-l-d,e[7]=p-v,e[2]=h-m,e[5]=p+v,e[8]=1-l-f,e},t.normalFromMat4=function(e,t){let r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],f=t[9],h=t[10],p=t[11],d=t[12],v=t[13],m=t[14],y=t[15],b=r*s-n*o,_=r*u-i*o,g=r*l-a*o,E=n*u-i*s,T=n*l-a*s,O=i*l-a*u,w=c*v-f*d,R=c*m-h*d,S=c*y-p*d,P=f*m-h*v,A=f*y-p*v,M=h*y-p*m,I=b*M-_*A+g*P+E*S-T*R+O*w;if(!I)return null;return I=1/I,e[0]=(s*M-u*A+l*P)*I,e[1]=(u*S-o*M-l*R)*I,e[2]=(o*A-s*S+l*w)*I,e[3]=(i*A-n*M-a*P)*I,e[4]=(r*M-i*S+a*R)*I,e[5]=(n*S-r*A-a*w)*I,e[6]=(v*O-m*T+y*E)*I,e[7]=(m*g-d*O-y*_)*I,e[8]=(d*T-v*g+y*b)*I,e},t.projection=function(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},t.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e},t.subtract=a,t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e},t.multiplyScalarAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},t.equals=function(e,t){let r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],f=e[8],h=t[0],p=t[1],d=t[2],v=t[3],m=t[4],y=t[5],b=t[6],_=t[7],g=t[8];return Math.abs(r-h)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(i-p)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(a-d)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(o-v)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(s-m)<=n.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(u-y)<=n.EPSILON*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(l-b)<=n.EPSILON*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(c-_)<=n.EPSILON*Math.max(1,Math.abs(c),Math.abs(_))&&Math.abs(f-g)<=n.EPSILON*Math.max(1,Math.abs(f),Math.abs(g))};var n=r(3);function i(e,t,r){let n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],f=t[8],h=r[0],p=r[1],d=r[2],v=r[3],m=r[4],y=r[5],b=r[6],_=r[7],g=r[8];return e[0]=h*n+p*o+d*l,e[1]=h*i+p*s+d*c,e[2]=h*a+p*u+d*f,e[3]=v*n+m*o+y*l,e[4]=v*i+m*s+y*c,e[5]=v*a+m*u+y*f,e[6]=b*n+_*o+g*l,e[7]=b*i+_*s+g*c,e[8]=b*a+_*u+g*f,e}function a(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}const o=i;t.mul=o;const s=a;t.sub=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.create=i,t.clone=function(e){var t=new n.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},t.length=a,t.fromValues=o,t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},t.set=function(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},t.subtract=s,t.multiply=u,t.divide=l,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},t.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e},t.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},t.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},t.scaleAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e},t.distance=c,t.squaredDistance=f,t.squaredLength=h,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},t.normalize=p,t.dot=d,t.cross=function(e,t,r){let n=t[0],i=t[1],a=t[2],o=r[0],s=r[1],u=r[2];return e[0]=i*u-a*s,e[1]=a*o-n*u,e[2]=n*s-i*o,e},t.lerp=function(e,t,r,n){let i=t[0],a=t[1],o=t[2];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e[2]=o+n*(r[2]-o),e},t.hermite=function(e,t,r,n,i,a){let o=a*a,s=o*(2*a-3)+1,u=o*(a-2)+a,l=o*(a-1),c=o*(3-2*a);return e[0]=t[0]*s+r[0]*u+n[0]*l+i[0]*c,e[1]=t[1]*s+r[1]*u+n[1]*l+i[1]*c,e[2]=t[2]*s+r[2]*u+n[2]*l+i[2]*c,e},t.bezier=function(e,t,r,n,i,a){let o=1-a,s=o*o,u=a*a,l=s*o,c=3*a*s,f=3*u*o,h=u*a;return e[0]=t[0]*l+r[0]*c+n[0]*f+i[0]*h,e[1]=t[1]*l+r[1]*c+n[1]*f+i[1]*h,e[2]=t[2]*l+r[2]*c+n[2]*f+i[2]*h,e},t.random=function(e,t){t=t||1;let r=2*n.RANDOM()*Math.PI,i=2*n.RANDOM()-1,a=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*a,e[1]=Math.sin(r)*a,e[2]=i*t,e},t.transformMat4=function(e,t,r){let n=t[0],i=t[1],a=t[2],o=r[3]*n+r[7]*i+r[11]*a+r[15];return o=o||1,e[0]=(r[0]*n+r[4]*i+r[8]*a+r[12])/o,e[1]=(r[1]*n+r[5]*i+r[9]*a+r[13])/o,e[2]=(r[2]*n+r[6]*i+r[10]*a+r[14])/o,e},t.transformMat3=function(e,t,r){let n=t[0],i=t[1],a=t[2];return e[0]=n*r[0]+i*r[3]+a*r[6],e[1]=n*r[1]+i*r[4]+a*r[7],e[2]=n*r[2]+i*r[5]+a*r[8],e},t.transformQuat=function(e,t,r){let n=t[0],i=t[1],a=t[2],o=r[0],s=r[1],u=r[2],l=r[3],c=l*n+s*a-u*i,f=l*i+u*n-o*a,h=l*a+o*i-s*n,p=-o*n-s*i-u*a;return e[0]=c*l+p*-o+f*-u-h*-s,e[1]=f*l+p*-s+h*-o-c*-u,e[2]=h*l+p*-u+c*-s-f*-o,e},t.rotateX=function(e,t,r,n){let i=[],a=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],a[0]=i[0],a[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),a[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},t.rotateY=function(e,t,r,n){let i=[],a=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],a[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),a[1]=i[1],a[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},t.rotateZ=function(e,t,r,n){let i=[],a=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],a[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),a[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),a[2]=i[2],e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},t.angle=function(e,t){let r=o(e[0],e[1],e[2]),n=o(t[0],t[1],t[2]);p(r,r),p(n,n);let i=d(r,n);return i>1?0:i<-1?Math.PI:Math.acos(i)},t.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},t.equals=function(e,t){let r=e[0],i=e[1],a=e[2],o=t[0],s=t[1],u=t[2];return Math.abs(r-o)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-s)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(a-u)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))};var n=r(3);function i(){let e=new n.ARRAY_TYPE(3);return e[0]=0,e[1]=0,e[2]=0,e}function a(e){let t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)}function o(e,t,r){let i=new n.ARRAY_TYPE(3);return i[0]=e,i[1]=t,i[2]=r,i}function s(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function u(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function l(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function c(e,t){let r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(r*r+n*n+i*i)}function f(e,t){let r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return r*r+n*n+i*i}function h(e){let t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}function p(e,t){let r=t[0],n=t[1],i=t[2],a=r*r+n*n+i*i;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e}function d(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}const v=s;t.sub=v;const m=u;t.mul=m;const y=l;t.div=y;const b=c;t.dist=b;const _=f;t.sqrDist=_;const g=a;t.len=g;const E=h;t.sqrLen=E;const T=function(){let e=i();return function(t,r,n,i,a,o){let s,u;for(r||(r=3),n||(n=0),u=i?Math.min(i*r+n,t.length):t.length,s=n;s<u;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}}();t.forEach=T},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.create=i,t.clone=function(e){let t=new n.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.fromValues=function(e,t,r,i){let a=new n.ARRAY_TYPE(4);return a[0]=e,a[1]=t,a[2]=r,a[3]=i,a},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},t.set=function(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},t.subtract=a,t.multiply=o,t.divide=s,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},t.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},t.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},t.scale=u,t.scaleAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e},t.distance=l,t.squaredDistance=c,t.length=f,t.squaredLength=h,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},t.normalize=p,t.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},t.lerp=function(e,t,r,n){let i=t[0],a=t[1],o=t[2],s=t[3];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e[2]=o+n*(r[2]-o),e[3]=s+n*(r[3]-s),e},t.random=function(e,t){return t=t||1,e[0]=n.RANDOM(),e[1]=n.RANDOM(),e[2]=n.RANDOM(),e[3]=n.RANDOM(),p(e,e),u(e,e,t),e},t.transformMat4=function(e,t,r){let n=t[0],i=t[1],a=t[2],o=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*a+r[12]*o,e[1]=r[1]*n+r[5]*i+r[9]*a+r[13]*o,e[2]=r[2]*n+r[6]*i+r[10]*a+r[14]*o,e[3]=r[3]*n+r[7]*i+r[11]*a+r[15]*o,e},t.transformQuat=function(e,t,r){let n=t[0],i=t[1],a=t[2],o=r[0],s=r[1],u=r[2],l=r[3],c=l*n+s*a-u*i,f=l*i+u*n-o*a,h=l*a+o*i-s*n,p=-o*n-s*i-u*a;return e[0]=c*l+p*-o+f*-u-h*-s,e[1]=f*l+p*-s+h*-o-c*-u,e[2]=h*l+p*-u+c*-s-f*-o,e[3]=t[3],e},t.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},t.equals=function(e,t){let r=e[0],i=e[1],a=e[2],o=e[3],s=t[0],u=t[1],l=t[2],c=t[3];return Math.abs(r-s)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-u)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(a-l)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(o-c)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))};var n=r(3);function i(){let e=new n.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function a(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function o(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function s(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function u(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function l(e,t){let r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return Math.sqrt(r*r+n*n+i*i+a*a)}function c(e,t){let r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return r*r+n*n+i*i+a*a}function f(e){let t=e[0],r=e[1],n=e[2],i=e[3];return Math.sqrt(t*t+r*r+n*n+i*i)}function h(e){let t=e[0],r=e[1],n=e[2],i=e[3];return t*t+r*r+n*n+i*i}function p(e,t){let r=t[0],n=t[1],i=t[2],a=t[3],o=r*r+n*n+i*i+a*a;return o>0&&(o=1/Math.sqrt(o),e[0]=r*o,e[1]=n*o,e[2]=i*o,e[3]=a*o),e}const d=a;t.sub=d;const v=o;t.mul=v;const m=s;t.div=m;const y=l;t.dist=y;const b=c;t.sqrDist=b;const _=f;t.len=_;const g=h;t.sqrLen=g;const E=function(){let e=i();return function(t,r,n,i,a,o){let s,u;for(r||(r=4),n||(n=0),u=i?Math.min(i*r+n,t.length):t.length,s=n;s<u;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}();t.forEach=E},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vec3=void 0;var n=r(10),i=r(33);t.vec3=n.vec3,n.vec3.fromSpherical=function(e,t,r){var n=t[0],i=t[1],a=t[2];return e[0]=a*Math.sin(n)*Math.sin(i),e[1]=a*Math.cos(i),e[2]=a*Math.cos(n)*Math.sin(i),r&&(e[0]+=r[0],e[1]+=r[1],e[2]+=r[2]),e},n.vec3.getSpherical=function(e,t){var r=0,i=0,a=n.vec3.length(t);return 0!==a&&(r=Math.acos(Math.max(t[1]/a,Math.min(-1,1))),i=Math.atan2(t[0],t[2])),e[0]=r,e[1]=i,e[2]=a,e},n.vec3.exponentialDecay=function(e,t,r,n,a,o){return e[0]=i.num.exponentialDecay(t[0],r[0],n,a,o),e[1]=i.num.exponentialDecay(t[1],r[1],n,a,o),e[2]=i.num.exponentialDecay(t[2],r[2],n,a,o),e},n.vec3.project=function(e,t,r,n){var i=t[0],a=t[1],o=t[2],s=r[0]*i+r[4]*a+r[8]*o+r[12],u=r[1]*i+r[5]*a+r[9]*o+r[13],l=r[3]*i+r[7]*a+r[11]*o+r[15],c=(s/l+1)/2,f=1-(u/l+1)/2;return e[0]=c*n[2]+n[0],e[1]=f*n[3]+n[1],e[2]=l,e},n.vec3.unproject=function(){var e=void 0;return function(t,r,i,a){e||(e=n.vec4.create());var o=r[0],s=r[1],u=r[2];if(e[0]=2*(o-a[0])/a[2]-1,e[1]=2*(s-a[1])/a[3]-1,e[2]=2*u-1,e[3]=1,n.vec4.transformMat4(e,e,i),0===e[3])throw t[0]=0,t[1]=0,t[2]=0,new Error("Perspective divide error");return t[0]=e[0]/e[3],t[1]=e[1]/e[3],t[2]=e[2]/e[3],t}}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vec4=void 0;var n=r(10);t.vec4=n.vec4},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addToArray=function(e){for(var t=!1,r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];for(var a=0;a<n.length;a++)-1===e.indexOf(n[a])&&(e.push(n[a]),t=!0);return t},t.perArrayChild=function(e,t){for(var r=e.length,n=arguments.length,i=Array(n>2?n-2:0),a=2;a<n;a++)i[a-2]=arguments[a];for(var o=0;o<r;o++){var s;t in e&&(s=e[o])[t].apply(s,i)}},t.removeFromArray=function(e){for(var t=!1,r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];for(var a=0;a<n.length;a++){var o=e.indexOf(n[a]);-1!==o&&(e.splice(o,1),t=!0)}return t},t.toArray=i,t.toUniqueArray=function(e){return Array.from(new Set(i(e)))};var n=r(22);function i(e){return(0,n.isArray)(e)?e:[e]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resMan=t.Tw2ResMan=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(21),a=r(85),o=r(41),s=r(15),u=r(5),l=r(1);var c=t.Tw2ResMan=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name="Resource manager",e.motherLode=new a.Tw2MotherLode,e.systemMirror=!1,e.maxPrepareTime=.05,e.prepareBudget=0,e.autoPurgeResources=!0,e.activeFrame=0,e.purgeTime=30,e._prepareQueue=[],e._purgeTime=0,e._purgeFrame=0,e._purgeFrameLimit=1e3,e._pendingLoads=0,e._noLoadFrames=0,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Tw2EventEmitter),n(t,[{key:"OnResError",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new l.Tw2Error({path:e});e=t.NormalizePath(e);var n=this.motherLode.Find(e);return n?n.OnError(r):this.OnResEvent("error",e,r),r}},{key:"OnResEvent",value:function(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=t.DefaultLog[e.toUpperCase()],a=Object.assign({res:this.motherLode.Find(r),path:r},n.data);if((0,u.isError)(n)){var o=this.motherLode.AddError(r,n);n={err:o,message:o.message}}i&&((n=Object.assign({title:this.name},i,n)).message=n.message.includes(r)?n.message:n.message+=' "'+r+'"',a.log=n,this.emit(e.toLowerCase(),a))}},{key:"IsLoading",value:function(){return this._noLoadFrames<2}},{key:"Clear",value:function(){this.motherLode.Clear()}},{key:"UnloadAndClear",value:function(){this.motherLode.UnloadAndClear()}},{key:"PrepareLoop",value:function(e){0===this._prepareQueue.length&&0===this._pendingLoads?this._noLoadFrames<2&&this._noLoadFrames++:this._noLoadFrames=0,this.prepareBudget=this.maxPrepareTime;for(var t=Date.now();this._prepareQueue.length;){var r=this._prepareQueue[0][0],n=this._prepareQueue[0][1],i=this._prepareQueue[0][2];this._prepareQueue.shift();try{r.Prepare(n,i)}catch(e){r.OnError(e)}if(this.prepareBudget-=.001*(Date.now()-t),this.prepareBudget<0)break}return this._purgeTime+=e,this._purgeTime>1&&(this.activeFrame+=1,this._purgeTime-=Math.floor(this._purgeTime),this._purgeFrame+=1,this._purgeFrame>=5&&this.autoPurgeResources&&this.motherLode.PurgeInactive(this._purgeFrame,this._purgeFrameLimit,this.purgeTime)),!0}},{key:"GetResource",value:function(e){var r=void 0;if(e=t.NormalizePath(e),r=this.motherLode.Find(e))return r.IsPurged()&&r.Reload(),r;if(0===e.indexOf("dynamic:/"))return this.OnResError(e,new l.Tw2FeatureNotImplementedError({message:"Dynamic resources not implemented"})),null;var n=t.GetPathExt(e);if(null===n)return this.OnResError(e,new l.Tw2ResourceExtensionUndefinedError({path:e})),null;var a=i.store.GetExtension(n);if(!a)return this.OnResError(e,new l.Tw2ResourceExtensionUnregisteredError({path:e,extension:n})),null;try{return(r=new a).path=e,t.LoadResource(this,r)}catch(t){return this.OnResError(e,t),null}}},{key:"GetObject",value:function(e,r,n){e=t.NormalizePath(e);var i=this.motherLode.Find(e);if(i)i.AddObject(r,n);else try{(i=new o.Tw2LoadingObject).path=e,i.AddObject(r,n),t.LoadResource(this,i)}catch(t){this.OnResError(e,t)}}},{key:"ReloadResource",value:function(e){var r=e.path,n=this.motherLode.Find(r);if(n&&!n.IsPurged())return n;try{return t.LoadResource(this,e)}catch(t){return this.OnResError(r,t),e}}},{key:"BuildUrl",value:function(e){var t=e.indexOf(":/");if(-1===t)throw new l.Tw2ResourcePrefixUndefinedError({path:e});var r=e.substr(0,t);if("http"===r||"https"===r)return e;var n=i.store.GetPath(r);if(!n)throw new l.Tw2ResourcePrefixUnregisteredError({path:e,prefix:r});return n+e.substr(t+2)}}],[{key:"NormalizePath",value:function(e){return"str:/"===e.substr(0,5)?e:((e=e.toLowerCase()).replace("\\","/"),e)}},{key:"GetPathExt",value:function(e){if("str:/"===e.substr(0,5)){var t=e.indexOf("/",5);return-1===t?null:e.substr(5,t-5)}var r=e.lastIndexOf(".");return-1===r?null:e.substr(r+1)}},{key:"LoadResource",value:function(e,r){var n=r.path,i=e.BuildUrl(n);if(e.motherLode.Add(n,r),r.DoCustomLoad&&r.DoCustomLoad(i,t.GetPathExt(i)))return r;var a=t.CreateHttpRequest(r);a.onreadystatechange=t.DoLoadResource(e,r),a.open("GET",i);try{a.send(),e._pendingLoads++,r.OnRequested()}catch(e){throw new l.HTTPRequestSendError({path:n})}return r}},{key:"DoLoadResource",value:function(e,t){var r=t.path;return function(){var n=0;try{n=this.readyState}catch(n){return e._pendingLoads--,void t.OnError(new l.HTTPReadyStateError({path:r}))}if(4===n){var i=this.status;if(200===i){var a=null,o=null;try{a=this.responseText,o=this.responseXML}catch(e){a=this.response}e._prepareQueue.push([t,a,o]),t.OnLoaded()}else t.OnError(new l.HTTPStatusError({path:r,status:i}));e._pendingLoads--}}}},{key:"CreateHttpRequest",value:function(e){var t=null;if(window.XMLHttpRequest)t=new XMLHttpRequest;else if(window.ActiveXObject)try{t=new window.ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{t=new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}if(!t)throw new l.HTTPInstanceError({path:e.path});return e.requestResponseType&&(t.responseType=e.requestResponseType),t}}]),t}();c.DefaultLog={ERROR:{type:"error",message:"Uncaught error"},WARNING:{type:"warn",message:"Undefined warning"},REQUESTED:{type:"info",message:"Requested"},RELOADING:{type:"info",message:"Reloading"},LOADED:{type:"info",message:"Loaded"},PREPARED:{type:"log",message:"Prepared"},PURGED:{type:"debug",message:"Purged"},UNLOADED:{type:"debug",message:"Unloaded"}};t.resMan=new c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2LoadingObject=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(n):void 0},a=r(0),o=r(11),s=r(42);(t.Tw2LoadingObject=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.path="",e._redContents=null,e._inPrepare=null,e._objects=[],e._constructor=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Tw2Resource),n(t,[{key:"AddObject",value:function(e,t){this.HasErrors()?t&&t(this.GetErrors()[0]):this._objects.push({onResolved:e,onRejected:t})}},{key:"Prepare",value:function(e){for(null===this._inPrepare&&(this._redContents=e,this._constructor=new s.Tw2ObjectReader(this._redContents),this._inPrepare=0,this._constructor.Construct());this._inPrepare<this._objects.length;){var t=this._objects[this._inPrepare];try{t.onResolved(this._constructor.Construct())}catch(e){t.onRejected&&(t.onRejected(e),t.onRejected=null),this.OnWarning({err:e,message:"Error preparing child object"})}this._inPrepare++}this.OnPrepared()}},{key:"OnError",value:function(e){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"OnError",this).call(this,e);for(var r=0;r<this._objects.length;r++){var n=this._objects[r];n.onRejected&&n.onRejected(e)}return a.resMan.motherLode.Remove(this.path),this._objects=[],e}},{key:"OnPrepared",value:function(e){a.resMan.motherLode.Remove(this.path),this._objects=[],i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"OnPrepared",this).call(this,e)}}]),t}()).prototype.requestResponseType="arraybuffer"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ObjectReader=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(43),o=r(6);var s=t.Tw2ObjectReader=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.xmlNode=t,this._inputStack=null,this._initializeObjects=null,this._ids={},this._reader=null,this._stringTable=null,this._start=null,t&&this.Initialize()}return n(e,[{key:"Initialize",value:function(){if(!e.IsValidXML(this.xmlNode))throw new o.Tw2XMLBinaryError({message:"Invalid binary, expected binred"});this._reader=new a.Tw2BinaryReader(new Uint8Array(this.xmlNode)),this._reader.cursor+=6,this._stringTable=[];for(var t=this._reader.ReadUInt32(),r=0;r<t;++r){var n=this._reader.ReadUInt16();this._stringTable.push(String.fromCharCode.apply(null,this._reader.data.subarray(this._reader.cursor,this._reader.cursor+n))),this._reader.cursor+=n}this._start=this._reader.cursor}},{key:"Construct",value:function(){return this._reader.cursor=this._start,e.ReadElement(this)}}],[{key:"IsValidXML",value:function(e){return e&&"binred"===String.fromCharCode.apply(null,new Uint8Array(e).subarray(0,6))}},{key:"ConstructObject",value:function(t){if("json"===t.type)return t;var r=i.store.GetClass(t.type);if(!r){if(!e.DEBUG_ENABLED)throw new o.Tw2XMLObjectTypeUndefinedError({type:t.type});r=Object}var n=new r;for(var a in t)if(t.hasOwnProperty(a)&&"type"!==a)if(t[a].constructor===Object){if(this.DEBUG_ENABLED&&(n[a]=n[a]||{}),n[a])for(var s in t[a])t[a].hasOwnProperty(s)&&(n[a][s]=t[a][s])}else n[a]=t[a];return"Initialize"in n&&n.Initialize(),n}},{key:"ReadUint",value:function(e,t){switch(48&t){case this.ElementSize.SMALL:return e._reader.ReadUInt8();case this.ElementSize.MEDIUM:return e._reader.ReadUInt16();default:return e._reader.ReadUInt32()}}},{key:"ReadElementData",value:function(e,t){var r=void 0,n=void 0,i=void 0,a=void 0,s=void 0;switch(15&t){case this.ElementRawType.NULL:return null;case this.ElementRawType.BOOL:switch(48&t){case this.ElementSize.SMALL:return 0!==e._reader.ReadUInt8();case this.ElementSize.MEDIUM:return!1;default:return!0}case this.ElementRawType.INT:switch(48&t){case this.ElementSize.SMALL:return e._reader.ReadInt8();case this.ElementSize.MEDIUM:return e._reader.ReadInt16();default:return e._reader.ReadInt32()}case this.ElementRawType.UINT:return this.ReadUint(e,t);case this.ElementRawType.FLOAT:switch(48&t){case this.ElementSize.SMALL:return e._reader.ReadFloat16();case this.ElementSize.MEDIUM:return e._reader.ReadFloat32();default:throw new o.Tw2FeatureNotImplementedError({value:"Float64"})}case this.ElementRawType.STRING:return r=this.ReadUint(e,t),e._stringTable[r];case this.ElementRawType.ARRAY:for(a=this.ReadUint(e,t),i=[],n=0;n<a;++n)i.push(this.ReadElement(e));return i;case this.ElementRawType.MAPPING:for(a=this.ReadUint(e,t),i={},n=0;n<a;++n)i[e._stringTable[this.ReadUint(e,t)]]=this.ReadElement(e);return i;case this.ElementRawType.OBJECT:for(a=this.ReadUint(e,t),i={},n=0;n<a;++n)i[e._stringTable[this.ReadUint(e,t)]]=this.ReadElement(e);return this.ConstructObject(i);case this.ElementRawType.TYPED_ARRAY:for(a=this.ReadUint(e,t),s=e._reader.ReadUInt8(),i=[],n=0;n<a;++n)i.push(this.ReadElementData(e,s));return s in this.TypedArrays&&(i=new this.TypedArrays[s](i)),i;case this.ElementRawType.TYPED_MAPPING:for(a=this.ReadUint(e,t),s=e._reader.ReadUInt8(),i={},n=0;n<a;++n)i[e._stringTable[this.ReadUint(e,t)]]=this.ReadElementData(e,s);return i}}},{key:"ReadElement",value:function(e){var t=e._reader.ReadUInt8();if(t===this.REFERENCE_BIT)return e._ids[e._reader.ReadUInt16()];var r=void 0;0!=(t&this.ID_BIT)&&(r=e._reader.ReadUInt16());var n=this.ReadElementData(e,63&t);return 0!=(t&this.ID_BIT)&&(e._ids[r]=n),n}}]),e}();s.DEBUG_ENABLED=!1,s.ID_BIT=64,s.REFERENCE_BIT=128,s.ElementRawType={NULL:0,BOOL:1,INT:2,UINT:3,FLOAT:4,STRING:5,ARRAY:6,MAPPING:7,OBJECT:8,TYPED_ARRAY:9,TYPED_MAPPING:10},s.ElementSize={SMALL:0,MEDIUM:16,LARGE:32},s.ElementTypes={NULL:s.ElementRawType.NULL|s.ElementSize.SMALL,BOOL:s.ElementRawType.BOOL|s.ElementSize.SMALL,FALSE:s.ElementRawType.BOOL|s.ElementSize.MEDIUM,TRUE:s.ElementRawType.BOOL|s.ElementSize.LARGE,INT8:s.ElementRawType.INT|s.ElementSize.SMALL,UINT8:s.ElementRawType.UINT|s.ElementSize.SMALL,INT16:s.ElementRawType.INT|s.ElementSize.MEDIUM,UINT16:s.ElementRawType.UINT|s.ElementSize.MEDIUM,INT32:s.ElementRawType.INT|s.ElementSize.LARGE,UINT32:s.ElementRawType.UINT|s.ElementSize.LARGE,FLOAT16:s.ElementRawType.FLOAT|s.ElementSize.SMALL,FLOAT32:s.ElementRawType.FLOAT|s.ElementSize.MEDIUM,FLOAT64:s.ElementRawType.FLOAT|s.ElementSize.LARGE,SHORT_STRING:s.ElementRawType.STRING|s.ElementSize.SMALL,MEDIUM_STRING:s.ElementRawType.STRING|s.ElementSize.MEDIUM,LARGE_STRING:s.ElementRawType.STRING|s.ElementSize.LARGE,SHORT_ARRAY:s.ElementRawType.ARRAY|s.ElementSize.SMALL,MEDIUM_ARRAY:s.ElementRawType.ARRAY|s.ElementSize.MEDIUM,LARGE_ARRAY:s.ElementRawType.ARRAY|s.ElementSize.LARGE,SHORT_MAPPING:s.ElementRawType.MAPPING|s.ElementSize.SMALL,MEDIUM_MAPPING:s.ElementRawType.MAPPING|s.ElementSize.MEDIUM,LARGE_MAPPING:s.ElementRawType.MAPPING|s.ElementSize.LARGE,SHORT_OBJECT:s.ElementRawType.OBJECT|s.ElementSize.SMALL,MEDIUM_OBJECT:s.ElementRawType.OBJECT|s.ElementSize.MEDIUM,LARGE_OBJECT:s.ElementRawType.OBJECT|s.ElementSize.LARGE,SHORT_TYPED_ARRAY:s.ElementRawType.TYPED_ARRAY|s.ElementSize.SMALL,MEDIUM_TYPED_ARRAY:s.ElementRawType.TYPED_ARRAY|s.ElementSize.MEDIUM,LARGE_TYPED_ARRAY:s.ElementRawType.TYPED_ARRAY|s.ElementSize.LARGE,SHORT_TYPED_MAPPING:s.ElementRawType.TYPED_MAPPING|s.ElementSize.SMALL,MEDIUM_TYPED_MAPPING:s.ElementRawType.TYPED_MAPPING|s.ElementSize.MEDIUM,LARGE_TYPED_MAPPING:s.ElementRawType.TYPED_MAPPING|s.ElementSize.LARGE},s.TypedArrays={2:Int8Array,3:Uint8Array,18:Int16Array,19:Uint16Array,34:Int32Array,35:Uint32Array,4:Float32Array,20:Float32Array,36:Float64Array}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.Tw2BinaryReader=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data=t,this.cursor=0}return n(e,[{key:"ReadUInt8",value:function(){return this.data[this.cursor++]}},{key:"ReadInt8",value:function(){var e=this.data[this.cursor++];return e>127&&(e=e-255-1),e}},{key:"ReadUInt16",value:function(){return this.data[this.cursor++]+(this.data[this.cursor++]<<8)}},{key:"ReadInt16",value:function(){var e=this.data[this.cursor++]+(this.data[this.cursor++]<<8);return e>32767&&(e=e-65535-1),e}},{key:"ReadUInt32",value:function(){return this.data[this.cursor++]+(this.data[this.cursor++]<<8)+(this.data[this.cursor++]<<16)+(this.data[this.cursor++]<<24>>>0)}},{key:"ReadInt32",value:function(){var e=this.data[this.cursor++]+(this.data[this.cursor++]<<8)+(this.data[this.cursor++]<<16)+(this.data[this.cursor++]<<24>>>0);return e>2147483647&&(e=e-4294967295-1),e}},{key:"ReadFloat16",value:function(){var e=this.data[this.cursor++],t=this.data[this.cursor++],r=(t>>2&31)-15,n=(3&t)<<8|e;return 0===n&&-15===r?0:(1-2*(t>>7))*(1+n*Math.pow(2,-10))*Math.pow(2,r)}},{key:"ReadFloat32",value:function(){var e=this.data[this.cursor++],t=this.data[this.cursor++],r=this.data[this.cursor++],n=this.data[this.cursor++],i=(n<<1&255|r>>7)-127,a=(127&r)<<16|t<<8|e;return 0===a&&-127===i?0:(1-2*(n>>7))*(1+a*Math.pow(2,-23))*Math.pow(2,i)}},{key:"ReadString",value:function(){for(var e=this.data[this.cursor++],t="",r=0;r<e;++r)t+=String.fromCharCode(this.data[this.cursor++]);return t}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2TextureParameter=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(24),o=r(4),s=r(19);var u=t.Tw2TextureParameter=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.resourcePath=r,n.useAllOverrides=!1,n.addressUMode=1,n.addressVMode=1,n.addressWMode=1,n.filterMode=2,n.mipFilterMode=2,n.maxAnisotropy=4,n.textureRes=null,n._sampler=null,r&&n.Initialize(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Tw2Parameter),n(t,[{key:"Initialize",value:function(){this.OnValueChanged()}},{key:"SetTexturePath",value:function(e){this.resourcePath=e,this.OnValueChanged()}},{key:"GetValue",value:function(){return this.isTextureAttached?null:this.resourcePath}},{key:"SetTextureRes",value:function(e){this.textureRes!==e&&(this.resourcePath="",this.textureRes=e),this.textureRes._isAttached=!0}},{key:"OnValueChanged",value:function(e,r){if(""!==this.resourcePath)if(0===this.resourcePath.indexOf("rgba:/")){if(!this.textureRes||this.textureRes.path!==this.resourcePath){var n=this.resourcePath.replace("rgba:/","").split(","),a=i.device.CreateSolidTexture([parseFloat(n[0]),parseFloat(n[1]),parseFloat(n[2]),void 0!==n[3]?parseFloat(n[3]):255]);this.textureRes=new s.Tw2TextureRes,this.textureRes.path=this.resourcePath,this.textureRes.Attach(a)}}else this.resourcePath=this.resourcePath.toLowerCase(),this.textureRes=""!==this.resourcePath?i.resMan.GetResource(this.resourcePath):null;this.UpdateOverrides(),function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"OnValueChanged",this).call(this,e,r)}},{key:"Apply",value:function(e,t,r){this.textureRes&&(this.useAllOverrides&&this._sampler&&(this._sampler.samplerType=t.samplerType,this._sampler.isVolume=t.isVolume,this._sampler.registerIndex=t.registerIndex,t=this._sampler),i.device.gl.activeTexture(i.device.gl.TEXTURE0+e),this.textureRes.Bind(t,r))}},{key:"SetOverrides",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i.util.assignIfExists(this,e,t.overrideProperties),this.OnValueChanged()}},{key:"GetOverrides",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i.util.assignIfExists(e,this,t.overrideProperties),e}},{key:"UpdateOverrides",value:function(){if(this.useAllOverrides){this._sampler=this._sampler||new a.Tw2SamplerState;var e=i.device.wrapModes,t=i.device.gl,r=this._sampler;if(1===this.filterMode){switch(this.mipFilterMode){case 0:r.minFilter=t.NEAREST;break;case 1:r.minFilter=t.NEAREST_MIPMAP_NEAREST;break;default:r.minFilter=t.NEAREST_MIPMAP_LINEAR}r.minFilterNoMips=t.NEAREST,r.magFilter=t.NEAREST}else{switch(this.mipFilterMode){case 0:r.minFilter=t.LINEAR;break;case 1:r.minFilter=t.LINEAR_MIPMAP_NEAREST;break;default:r.minFilter=t.LINEAR_MIPMAP_LINEAR}r.minFilterNoMips=t.LINEAR,r.magFilter=t.LINEAR}r.addressU=e[this.addressUMode],r.addressV=e[this.addressVMode],r.addressW=e[this.addressWMode],r.anisotropy=this.maxAnisotropy,r.ComputeHash()}else this._sampler&&(this._sampler=null)}},{key:"EqualsValue",value:function(e){return e.toLowerCase()===this.GetValue()}},{key:"Copy",value:function(e,t){t&&(this.name=e.name),this.resourcePath=e.resourcePath,this.SetOverrides(e.GetOverrides)}},{key:"Clone",value:function(){var e=new t;return e.Copy(this,!0),e}},{key:"GetResources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.textureRes&&!e.includes(this.textureRes)&&e.push(this.textureRes),e}},{key:"isTextureAttached",get:function(){return this.textureRes&&this.textureRes._isAttached}}],[{key:"isValue",value:function(e){return i.util.isString(e)}}]),t}();u.prototype.SetValue=u.prototype.SetTexturePath,u.overrideProperties=["useAllOverrides","addressUMode","addressVMode","addressWMode","filterMode","mipFilterMode","maxAnisotropy"]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2SamplerState=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);var a=t.Tw2SamplerState=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var t=i.device.gl;this.name="",this.registerIndex=0,this.minFilter=t.LINEAR,this.maxFilter=t.LINEAR,this.minFilterNoMips=t.LINEAR,this.addressU=t.REPEAT,this.addressV=t.REPEAT,this.addressW=t.REPEAT,this.anisotropy=1,this.samplerType=t.TEXTURE_2D,this.isVolume=!1,this.hash=0}return n(e,[{key:"ComputeHash",value:function(){this.hash=2166136261,this.hash*=16777619,this.hash^=this.minFilter,this.hash*=16777619,this.hash^=this.maxFilter,this.hash*=16777619,this.hash^=this.addressU,this.hash*=16777619,this.hash^=this.addressV,this.hash*=16777619,this.hash^=this.anisotropy}},{key:"Apply",value:function(e){var t=this.samplerType,r=i.device,n=r.gl;n.texParameteri(t,n.TEXTURE_WRAP_S,e?this.addressU:n.CLAMP_TO_EDGE),n.texParameteri(t,n.TEXTURE_WRAP_T,e?this.addressV:n.CLAMP_TO_EDGE),n.texParameteri(t,n.TEXTURE_MIN_FILTER,e?this.minFilter:this.minFilterNoMips),n.texParameteri(t,n.TEXTURE_MAG_FILTER,this.magFilter),r.ext.AnisotropicFilter&&r.enableAnisotropicFiltering&&n.texParameterf(t,r.ext.AnisotropicFilter.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(this.anisotropy,r.ext.AnisotropicFilter.maxAnisotropy))}},{key:"GetFilterMode",value:function(){return this.minFilterNoMips in e.FilterMode?e.FilterMode[this.minFilterNoMips]:2}},{key:"GetMipFilterMode",value:function(){return this.minFilter in e.MipFilterMode?e.MipFilterMode[this.minFilter]:2}}]),e}();a.FilterMode={9728:1,9729:2},a.MipFilterMode={9728:0,9729:0,9984:1,9985:1,9986:2,9987:2}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Tw2VertexElement=function e(t,r,n,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.usage=t,this.usageIndex=r,this.type=n,this.elements=i,this.offset=a,this.location=null,this.customSetter=null}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2PerObjectData=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(28);t.Tw2PerObjectData=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.perObjectVSData=null,this.perObjectPSData=null,t&&this.DeclareFromObject(t)}return n(e,[{key:"SetPerObjectDataToDevice",value:function(e){var t=i.device.gl;this.perObjectVSData&&e[3]&&t.uniform4fv(e[3],this.perObjectVSData.data),this.perObjectPSData&&e[4]&&t.uniform4fv(e[4],this.perObjectPSData.data)}},{key:"DeclareFromObject",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.VSData&&(this.perObjectVSData=new a.Tw2RawData(e.VSData)),e.PSData&&(this.perObjectPSData=new a.Tw2RawData(e.PSData))}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(106);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r(107);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(108);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var o=r(109);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var s=r(110);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var u=r(111);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var l=r(112);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})});var c=r(113);Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}})});var f=r(114);Object.keys(f).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}})});var h=r(115);Object.keys(h).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return h[e]}})});var p=r(116);Object.keys(p).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return p[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Mesh=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);t.Tw2Mesh=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.name="",this.display=!0,this.visible={},this.visible.opaqueAreas=!0,this.visible.transparentAreas=!0,this.visible.additiveAreas=!0,this.visible.pickableAreas=!0,this.visible.decalAreas=!0,this.visible.depthAreas=!0,this.opaqueAreas=[],this.transparentAreas=[],this.additiveAreas=[],this.pickableAreas=[],this.decalAreas=[],this.depthAreas=[],this.meshIndex=0,this.geometryResPath="",this.lowDetailGeometryResPath="",this.geometryResource=null}return n(e,[{key:"Initialize",value:function(){""!==this.geometryResPath&&(this.geometryResource=i.resMan.GetResource(this.geometryResPath))}},{key:"IsGood",value:function(){return this.geometryResource&&this.geometryResource.IsGood()}},{key:"GetResources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.includes(this.geometryResource)||e.push(this.geometryResource),i.util.perArrayChild(this.opaqueAreas,"GetResources",e),i.util.perArrayChild(this.transparentAreas,"GetResources",e),i.util.perArrayChild(this.additiveAreas,"GetResources",e),i.util.perArrayChild(this.pickableAreas,"GetResources",e),i.util.perArrayChild(this.decalAreas,"GetResources",e),i.util.perArrayChild(this.depthAreas,"GetResources",e),e}},{key:"GetBatches",value:function(e,t,r){if(!this.IsGood()||!this.display)return!1;var n=this.constructor.GetAreaBatches;switch(e){case i.device.RM_OPAQUE:return void(this.visible.opaqueAreas&&n(this,this.opaqueAreas,e,t,r));case i.device.RM_DECAL:return void(this.visible.decalAreas&&n(this,this.opaqueAreas,e,t,r));case i.device.RM_TRANSPARENT:return void(this.visible.transparentAreas&&n(this,this.transparentAreas,e,t,r));case i.device.RM_ADDITIVE:return void(this.visible.transparentAreas&&n(this,this.additiveAreas,e,t,r));case i.device.RM_PICKABLE:return void(this.visible.pickableAreas&&n(this,this.pickableAreas,e,t,r))}}}],[{key:"GetAreaBatches",value:function(e,t,r,n,i){for(var a=0;a<t.length;++a){var o=t[a];if(o.effect&&o.display){var s=new o.constructor.batchType;s.renderMode=r,s.perObjectData=i,s.geometryRes=e.geometryResource,s.meshIx=e.meshIndex,s.start=o.index,s.count=o.count,s.effect=o.effect,n.Commit(s)}}}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2MeshArea=void 0;var n=r(18),i=r(0);(t.Tw2MeshArea=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.name="",this.effect=null,this.meshIndex=0,this.index=0,this.count=1,this.display=!0}).batchType=n.Tw2GeometryBatch},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.Tw2Animation=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.animationRes=null,this.time=0,this.timeScale=1,this.cycle=!1,this.isPlaying=!1,this.callback=null,this.trackGroups=[]}return n(e,[{key:"IsFinished",value:function(){return!this.cycle&&this.time>=this.animationRes.duration}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(122);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r(124);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(41);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var o=r(11);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var s=r(19);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var u=r(125);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Bone=void 0;var n=r(0);t.Tw2Bone=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.boneRes=null,this.localTransform=n.mat4.create(),this.worldTransform=n.mat4.create(),this.offsetTransform=n.mat4.create()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Tw2Model=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.modelRes=null,this.bones=[],this.bonesByName={}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Tw2Track=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.trackRes=null,this.bone=null}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Tw2TrackGroup=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.trackGroupRes=null,this.model=null,this.transformTracks=[]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2PostEffect=void 0;var n,i,a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),s=r(5),u=r(58),l=r(19),c=r(27),f=r(59);t.Tw2PostEffect=(i=n=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=(0,s.generateID)(),this.name="",this.display=!0,this.index=-1,this.width=0,this.height=0,this.texture=null,this.curveSet=null,this.targets={},this.items=[],this._visibleItems=[],this._rebuildPending=!0,this._onChildModified=function(e){return t.OnValueChanged(e)}}return a(e,[{key:"OnValueChanged",value:function(){this._rebuildPending=!0}},{key:"IsGood",value:function(){for(var e=0,t=0;t<this.items.length;t++)this.items[t].IsGood()&&e++;return e===this.items.length}},{key:"KeepAlive",value:function(){this.items.forEach(function(e){return e.KeepAlive()})}},{key:"GetResources",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=0;t<this.items.length;t++)this.items[t].GetResources(e);return e}},{key:"CreateItem",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=f.Tw2PostEffectStep.create(e);return this.AddItem(t),t}},{key:"AddItem",value:function(e){this.items.includes(e)||(e._onModified=this._onChildModified,-1===e.index&&(e.index=this.items.length),this.items.push(e),this.OnValueChanged())}},{key:"RemoveItem",value:function(e){var t=this.items.indexOf(e);-1!==t&&(e._onModified=null,this.items.splice(t,1),this.OnValueChanged())}},{key:"ClearItems",value:function(){for(var e=0;e<this.items.length;e++)this.items[e]._onModified=null;this.items=[],this.OnValueChanged()}},{key:"GetTarget",value:function(e){return e&&e in this.targets?this.targets[e]:null}},{key:"HasTarget",value:function(e){return!(!e||!this.targets[e])}},{key:"CreateTarget",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.device.viewportWidth,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.device.viewportHeight;return this.targets[e]||(this.targets[e]=new u.Tw2RenderTarget,this.targets[e].name=e),this.targets[e].Create(t,r,!1),this.targets[e]}},{key:"Update",value:function(e){this.curveSet&&this.curveSet.Update(e)}},{key:"Render",value:function(){var e=o.device,t=e.gl,r=e.viewportWidth,n=e.viewportHeight;if(!this.IsGood()||!this.display||r<=0||n<=0)return!1;if(r!==this.width||n!==this.height||this._rebuildPending||!this.texture){for(var i in this.texture||(this.texture=new l.Tw2TextureRes,this.texture.Attach(t.createTexture())),t.bindTexture(t.TEXTURE_2D,this.texture.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r,n,0,t.RGBA,t.UNSIGNED_BYTE,null),t.bindTexture(t.TEXTURE_2D,null),this.width=r,this.height=n,this.targets)this.targets.hasOwnProperty(i)&&this.CreateTarget(i,r,n);this._visibleItems=[];for(var a=0;a<this.items.length;++a){var s=this.items[a],u=s.inputs,f=s.effect,h=f.shader,p=f.parameters;for(var d in h.HasTexture(!p.BlitCurrent)&&(p.BlitCurrent=new c.Tw2TextureParameter("BlitCurrent","rgba:/0,0,0,255")),h.HasTexture(!p.BlitOriginal)&&(p.BlitOriginal=new c.Tw2TextureParameter("BlitOriginal","rgba:/0,0,0,255")),s.target?(this.HasTarget(s.target)||this.CreateTarget(s.target,r,n),s._renderTarget=this.GetTarget(s.target)):s._renderTarget=null,u)if(u.hasOwnProperty(d))if(h.HasTexture(d)){p[d]||(p[d]=new c.Tw2TextureParameter(d));var v=p[d],m=u[d];m?(this.HasTarget(m)||this.CreateTarget(m,r,n),v.SetTextureRes(this.GetTarget(m).texture)):v.SetTextureRes(this.texture)}else console.warn("Invalid input parameter "+d),delete u[d];if("BlitCurrent"in u&&h.HasConstant("g_texelSize")){p.g_texelSize||(p.g_texelSize=new c.Tw2Vector4Parameter("g_texelSize",[1,1,1,1]));var y=p.g_texelSize,b=this.GetTarget(u.BlitCurrent);b?(y.value[0]=1/b.width,y.value[1]=1/b.width):(y.value[0]=1/r,y.value[1]=1/r),y.OnValueChanged()}s.display&&this._visibleItems.push(s),s._rebuildPending=!1}this._visibleItems.sort(function(e,t){return e.index-t.index}),this.rebuildPending=!1}t.bindTexture(t.TEXTURE_2D,this.texture.texture),t.copyTexImage2D(t.TEXTURE_2D,0,e.alphaBlendBackBuffer?t.RGBA:t.RGB,0,0,r,n,0),t.bindTexture(t.TEXTURE_2D,null),e.SetStandardStates(o.device.RM_OPAQUE);for(var _=0,g=0;g<this._visibleItems.length;++g){var E=this._visibleItems[g];E.display&&(E._renderTarget?E._renderTarget.Set():(t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport(0,0,r,n)),e.RenderFullScreenQuad(E.effect),_++)}return!!_}},{key:"steps",get:function(){return this.items}}],[{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new this;if((0,s.assignIfExists)(t,e,["name","display","index"]),e.targets)for(var r=0;r<e.targets.length;r++)t.targets[e.targets[r]]=null;if(e.steps)for(var n=0;n<e.steps.length;n++)t.CreateItem(e.steps[n]);return t}}]),e}(),n.Item=f.Tw2PostEffectStep,i)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2RenderTarget=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(19);t.Tw2RenderTarget=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.name="",this.texture=null,this.width=null,this.height=null,this.hasDepth=null,this._frameBuffer=null,this._renderBuffer=null}return n(e,[{key:"Destroy",value:function(){this.texture&&(i.device.gl.deleteTexture(this.texture.texture),this.texture=null),this._renderBuffer&&(i.device.gl.deleteRenderbuffer(this._renderBuffer),this._renderBuffer=null),this._frameBuffer&&(i.device.gl.deleteFramebuffer(this._frameBuffer),this._frameBuffer=null)}},{key:"Create",value:function(e,t,r){this.Destroy(),this.texture=new a.Tw2TextureRes,this.texture.Attach(i.device.gl.createTexture()),this._frameBuffer=i.device.gl.createFramebuffer(),i.device.gl.bindFramebuffer(i.device.gl.FRAMEBUFFER,this._frameBuffer),i.device.gl.bindTexture(i.device.gl.TEXTURE_2D,this.texture.texture),i.device.gl.texImage2D(i.device.gl.TEXTURE_2D,0,i.device.gl.RGBA,e,t,0,i.device.gl.RGBA,i.device.gl.UNSIGNED_BYTE,null),i.device.gl.texParameteri(i.device.gl.TEXTURE_2D,i.device.gl.TEXTURE_MAG_FILTER,i.device.gl.LINEAR),i.device.gl.texParameteri(i.device.gl.TEXTURE_2D,i.device.gl.TEXTURE_MIN_FILTER,i.device.gl.LINEAR),i.device.gl.bindTexture(i.device.gl.TEXTURE_2D,null),this._renderBuffer=null,r&&(this._renderBuffer=i.device.gl.createRenderbuffer(),i.device.gl.bindRenderbuffer(i.device.gl.RENDERBUFFER,this._renderBuffer),i.device.gl.renderbufferStorage(i.device.gl.RENDERBUFFER,i.device.gl.DEPTH_COMPONENT16,e,t)),i.device.gl.framebufferTexture2D(i.device.gl.FRAMEBUFFER,i.device.gl.COLOR_ATTACHMENT0,i.device.gl.TEXTURE_2D,this.texture.texture,0),r&&i.device.gl.framebufferRenderbuffer(i.device.gl.FRAMEBUFFER,i.device.gl.DEPTH_ATTACHMENT,i.device.gl.RENDERBUFFER,this._renderBuffer),i.device.gl.bindRenderbuffer(i.device.gl.RENDERBUFFER,null),i.device.gl.bindFramebuffer(i.device.gl.FRAMEBUFFER,null),this.texture.width=this.width=e,this.texture.height=this.height=t,this.hasDepth=r}},{key:"Set",value:function(){i.device.gl.bindFramebuffer(i.device.gl.FRAMEBUFFER,this._frameBuffer),i.device.gl.viewport(0,0,this.width,this.height)}},{key:"Unset",value:function(){i.device.gl.bindFramebuffer(i.device.gl.FRAMEBUFFER,null),i.device.gl.viewport(0,0,i.device.viewportWidth,i.device.viewportHeight)}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2PostEffectStep=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(5),a=r(23);t.Tw2PostEffectStep=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=(0,i.generateID)(),this.name="",this.index=-1,this.display=!0,this.effect=null,this.target=null,this.inputs={},this._renderTarget=null,this._rebuildPending=!0,this._onModified=null}return n(e,[{key:"OnValueChanged",value:function(){this._rebuildPending=!0,this._onModified&&this._onModified(this)}},{key:"IsGood",value:function(){return!!this.effect&&this.effect.IsGood()}},{key:"KeepAlive",value:function(){this.effect&&this.effect.KeepAlive()}},{key:"GetResources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.effect&&this.effect.GetResources(e),e}}],[{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new this;return(0,i.assignIfExists)(t,e,["name","display","target","index"]),e.inputs&&Object.assign(t.inputs,e.inputs),t.effect=a.Tw2Effect.create({name:e.name,autoParameter:!0,effectFilePath:e.effectFilePath,parameters:e.parameters,textures:e.textures,overrides:e.overrides}),t}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(16);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r(144);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(153);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var o=r(156);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(8);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r(162);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(163);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var o=r(164);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var s=r(165);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var u=r(166);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var l=r(167);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveOccluder=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(1);(t.EveOccluder=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.name="",this.value=1,this.sprites=[],e.init()}return n(e,[{key:"UpdateValue",value:function(t,r){if(i.device.alphaBlendBackBuffer){var n=i.device,a=e.global,o=a.mat4_0,s=a.vec4_0;a.accumulator.Clear();for(var u=0;u<this.sprites.length;++u)this.sprites[u].UpdateViewDependentData(t),this.sprites[u].GetBatches(n.RM_DECAL,a.accumulator);i.store.SetVariableValue("OccluderValue",[(1<<2*r)/255,(2<<2*r)/255,0,0]),a.accumulator.Render(),i.mat4.multiply(o,n.viewProjection,this.sprites[0].worldTransform),i.vec4.transformMat4(s,[0,0,0,1],o);var l=.5*(s[0]/s[3]+1),c=.5*(s[1]/s[3]+1);i.vec4.set(s,.5,.5,0,1),i.vec4.transformMat4(s,s,o);var f=.5*(s[0]/s[3]+1),h=.5*(s[1]/s[3]+1);s[0]=l,s[1]=c,s[2]=f-l,s[3]=h-c,a.effect.parameters.OccluderPosition.SetValue(s)}}}],[{key:"CollectSamples",value:function(e,t,r,n){var a=i.device,o=this.global,s=o.effect,u=o.vertexBuffer,l=o.decl;if(!s.effectRes||!s.effectRes.IsGood())return!1;s.parameters.BackBuffer.textureRes=e,s.parameters.OccluderIndex.SetValue([t,r,n]),a.SetStandardStates(a.RM_ADDITIVE),a.gl.bindBuffer(a.gl.ARRAY_BUFFER,u);for(var c=0;c<s.GetPassCount("Main");++c){if(s.ApplyPass("Main",c),l.SetDeclaration(s.GetPassInput("Main",c),16))return!1;a.ApplyShadowState(),a.gl.drawArrays(a.gl.TRIANGLES,0,1530)}return!0}},{key:"init",value:function(){if(!e.global){var t=i.device,r=e.global={};r.mat4_0=i.mat4.create(),r.vec4_0=i.vec4.create(),r.accumulator=new a.Tw2BatchAccumulator,r.effect=a.Tw2Effect.create({name:"Occluder sampler",effectFilePath:"res:/graphics/effect/managed/space/specialfx/lensflares/collectsamples.fx",parameters:{OccluderPosition:[1,1,1,1],OccluderIndex:[1,1,1],BackBuffer:""}}),r.vertexBuffer=null,r.decl=new a.Tw2VertexDeclaration,r.decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.POSITION,0,t.gl.FLOAT,2,0)),r.decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,0,t.gl.FLOAT,2,8)),r.decl.RebuildHash();for(var n=new Float32Array(6120),o=0,s=0;s<16;++s)for(var u=0;u<16;++u){var l=(s+Math.random())/16*2-1,c=(u+Math.random())/16*2-1;n[o++]=1,n[o++]=1,n[o++]=l,n[o++]=c,n[o++]=-1,n[o++]=1,n[o++]=l,n[o++]=c,n[o++]=1,n[o++]=-1,n[o++]=l,n[o++]=c,n[o++]=-1,n[o++]=1,n[o++]=l,n[o++]=c,n[o++]=1,n[o++]=-1,n[o++]=l,n[o++]=c,n[o++]=-1,n[o++]=-1,n[o++]=l,n[o++]=c}r.vertexBuffer=t.gl.createBuffer(),t.gl.bindBuffer(t.gl.ARRAY_BUFFER,r.vertexBuffer),t.gl.bufferData(t.gl.ARRAY_BUFFER,n,t.gl.STATIC_DRAW),t.gl.bindBuffer(t.gl.ARRAY_BUFFER,null)}}}]),e}()).global=null},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(13);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r(174);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(175);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var o=r(176);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var s=r(177);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var u=r(30);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var l=r(64);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveTransform=void 0;var n,i,a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),s=r(1),u=r(13);(t.EveTransform=(i=n=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.visible={},e.visible.mesh=!0,e.visible.children=!0,e.mesh=null,e.curveSets=[],e.children=[],e.particleSystems=[],e.particleEmitters=[],e.modifier=t.Modifier.NONE,e.sortValueMultiplier=1,e.distanceBasedScaleArg1=.2,e.distanceBasedScaleArg2=.63,e.useDistanceBasedScale=!1,e.scaling=o.vec3.fromValues(1,1,1),e.translation=o.vec3.create(),e.rotation=o.quat.create(),e.localTransform=o.mat4.create(),e.worldTransform=o.mat4.create(),e._perObjectData=new s.Tw2BasicPerObjectData(t.perObjectData),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.EveObject),a(t,[{key:"Initialize",value:function(){o.mat4.fromRotationTranslationScale(this.localTransform,this.rotation,this.translation,this.scaling)}},{key:"GetResources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1];if(this.mesh&&this.mesh.GetResources(e),!t)for(var r=0;r<this.children;r++)this.children[r].GetResources(e);return e}},{key:"UpdateViewDependentData",value:function(e){var r=o.device,n=t.global,i=n.vec3_0,a=n.vec3_1,s=n.vec3_2,u=r.viewInverse;switch(o.quat.normalize(this.rotation,this.rotation),o.mat4.fromRotationTranslationScale(this.localTransform,this.rotation,this.translation,this.scaling),o.mat4.getScaling(a,e),this.modifier){case t.Modifier.BILLBOARD:case t.Modifier.SIMPLE_HALO:var l=n.vec3_3;if(o.mat4.multiply(this.worldTransform,e,this.localTransform),o.vec3.multiply(i,this.scaling,a),this.modifier===t.Modifier.SIMPLE_HALO){o.vec3.subtract(s,r.GetEyePosition(s),this.worldTransform.subarray(12)),o.vec3.normalize(l,this.worldTransform.subarray(8)),o.vec3.normalize(s,s);var c=o.vec3.dot(s,l);c<0&&(c=0),o.vec3.scale(i,i,c*c)}this.worldTransform[0]=u[0]*i[0],this.worldTransform[1]=u[1]*i[0],this.worldTransform[2]=u[2]*i[0],this.worldTransform[4]=u[4]*i[1],this.worldTransform[5]=u[5]*i[1],this.worldTransform[6]=u[6]*i[1],this.worldTransform[8]=u[8]*i[2],this.worldTransform[9]=u[9]*i[2],this.worldTransform[10]=u[10]*i[2];break;case t.Modifier.EVE_CAMERA_ROTATION:var f=n.vec3_3;o.vec3.transformMat4(f,this.translation,e),o.mat4.fromRotationTranslationScale(this.localTransform,this.rotation,f,this.scaling),o.mat4.multiply(this.worldTransform,u,this.localTransform),this.worldTransform[12]=this.localTransform[12],this.worldTransform[13]=this.localTransform[13],this.worldTransform[14]=this.localTransform[14];break;case t.Modifier.EVE_CAMERA_ROTATION_ALIGNED:case t.Modifier.EVE_SIMPLE_HALO:var h=n.vec3_3,p=n.vec3_4,d=n.vec3_5,v=n.vec3_6,m=n.vec3_7,y=n.mat4_0,b=n.mat4_1,_=n.mat4_2;if(o.mat4.translate(this.worldTransform,e,this.translation),o.mat4.transpose(y,e),r.GetEyePosition(s),s[0]-=this.worldTransform[12],s[1]-=this.worldTransform[13],s[2]-=this.worldTransform[14],o.vec3.copy(h,s),o.vec3.transformMat4(h,h,y),o.vec3.divide(h,h,a),o.vec3.normalize(h,h),o.vec3.set(p,r.view[0],r.view[4],r.view[8]),o.vec3.transformMat4(p,p,y),o.vec3.normalize(p,p),o.vec3.cross(d,h,p),o.vec3.normalize(d,d),o.vec3.cross(p,d,h),b[0]=p[0],b[1]=p[1],b[2]=p[2],b[4]=d[0],b[5]=d[1],b[6]=d[2],b[8]=h[0],b[9]=h[1],b[10]=h[2],b[15]=1,o.mat4.fromQuat(_,this.rotation),o.mat4.multiply(b,b,_),this.modifier===t.Modifier.EVE_SIMPLE_HALO){o.vec3.normalize(v,this.worldTransform.subarray(8)),o.vec3.normalize(m,s);var g=-o.vec3.dot(m,v);g<0&&(g=0),o.mat4.multiply(this.worldTransform,this.worldTransform,b),o.mat4.scale(this.worldTransform,this.worldTransform,[this.scaling[0]*g,this.scaling[1]*g,this.scaling[2]*g])}else o.mat4.scale(this.worldTransform,this.worldTransform,this.scaling),o.mat4.multiply(this.worldTransform,this.worldTransform,b);break;case t.Modifier.LOOK_AT_CAMERA:var E=n.mat4_0;o.mat4.multiply(this.worldTransform,e,this.localTransform),o.mat4.lookAt(E,u.subarray(12),this.worldTransform.subarray(12),[0,1,0]),o.mat4.transpose(E,E),o.vec3.multiply(i,this.scaling,a),this.worldTransform[0]=E[0]*i[0],this.worldTransform[1]=E[1]*i[0],this.worldTransform[2]=E[2]*i[0],this.worldTransform[4]=E[4]*i[1],this.worldTransform[5]=E[5]*i[1],this.worldTransform[6]=E[6]*i[1],this.worldTransform[8]=E[8]*i[2],this.worldTransform[9]=E[9]*i[2],this.worldTransform[10]=E[10]*i[2];break;default:o.mat4.multiply(this.worldTransform,e,this.localTransform)}for(var T=0;T<this.children.length;++T)this.children[T].UpdateViewDependentData(this.worldTransform)}},{key:"Update",value:function(e){for(var t=0;t<this.children.length;++t)this.children[t].Update(e);for(var r=0;r<this.particleEmitters.length;++r)this.particleEmitters[r].Update(e);for(var n=0;n<this.particleSystems.length;++n)this.particleSystems[n].Update(e);for(var i=0;i<this.curveSets.length;++i)this.curveSets[i].Update(e)}},{key:"GetBatches",value:function(e,t,r){if(this.display&&(this.visible.mesh&&this.mesh&&(o.mat4.transpose(this._perObjectData.perObjectFFEData.Get("World"),this.worldTransform),o.mat4.invert(this._perObjectData.perObjectFFEData.Get("WorldInverseTranspose"),this.worldTransform),r&&(this._perObjectData.perObjectVSData=r.perObjectVSData,this._perObjectData.perObjectPSData=r.perObjectPSData),this.mesh.GetBatches(e,t,this._perObjectData)),this.visible.children))for(var n=0;n<this.children.length;++n)this.children[n].GetBatches(e,t,r)}}],[{key:"Multiply3x3",value:function(e,t,r){r||(r=t);var n=t[0],i=t[1];return t=t[2],r[0]=e[0]*n+e[4]*i+e[8]*t,r[1]=e[1]*n+e[5]*i+e[9]*t,r[2]=e[2]*n+e[6]*i+e[10]*t,r}}]),t}(),n.perObjectData={FFEData:[["World",16],["WorldInverseTranspose",16]]},i)).Modifier={NONE:0,BILLBOARD:1,TRANSLATE_WITH_CAMERA:2,LOOK_AT_CAMERA:3,SIMPLE_HALO:4,EVE_CAMERA_ROTATION_ALIGNED:100,EVE_BOOSTER:101,EVE_SIMPLE_HALO:102,EVE_CAMERA_ROTATION:103}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(9);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r(178);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(179);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var o=r(180);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var s=r(181);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var u=r(182);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var l=r(183);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})});var c=r(184);Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}})});var f=r(185);Object.keys(f).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Tw2ParticleElement=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.elementType=t.elementType,this.customName=t.customName,this.dimension=t.GetDimension(),this.usageIndex=t.usageIndex,this.usedByGPU=t.usedByGPU,this.buffer=null,this.startOffset=0,this.offset=0,this.instanceStride=0,this.vertexStride=0,this.dirty=!1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logger=t.resMan=t.store=t.device=t.util=t.math=void 0;var n=r(1);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r(60);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(161);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var o=r(188);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var s=p(r(20)),u=p(n),l=p(i),c=p(a),f=p(o),h=r(0);function p(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}t.math=s,t.util=h.util,t.device=h.device,t.store=h.store,t.resMan=h.resMan,t.logger=h.logger;var d=s.vec4,v=s.mat4;h.store.Register({paths:{res:"https://developers.eveonline.com/ccpwgl/assetpath/1097993/"},extensions:{sm_hi:u.Tw2EffectRes,sm_lo:u.Tw2EffectRes,wbg:u.Tw2GeometryRes,png:u.Tw2TextureRes,cube:u.Tw2TextureRes,mp4:u.Tw2VideoRes,ogg:u.Tw2VideoRes,webm:u.Tw2VideoRes},classes:[u,l,c,f],types:{float:u.Tw2FloatParameter,number:u.Tw2FloatParameter,texture:u.Tw2TextureParameter,vector2:u.Tw2Vector2Parameter,vector3:u.Tw2Vector3Parameter,vector4:u.Tw2Vector4Parameter,matrix4:u.Tw2MatrixParameter},variables:{WorldMat:v.create(),ViewMat:v.create(),ProjectionMat:v.create(),ViewProjectionMat:v.create(),ViewportSize:d.create(),Time:d.create(),u_DecalMatrix:v.create(),u_InvDecalMatrix:v.create(),EveSpaceSceneEnvMap:"",EnvMap1:"",EnvMap2:"",EnvMap3:"",ShadowLightness:0,OccluderValue:d.fromValues(1,1,0,0),LensflareFxOccScale:d.fromValues(1,1,0,0),LensflareFxDirectionScale:d.create()}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2BatchAccumulator=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);t.Tw2BatchAccumulator=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.batches=[],this._sortMethod=t}return n(e,[{key:"Commit",value:function(e){this.batches.push(e)}},{key:"Clear",value:function(){this.batches=[]}},{key:"Render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Main";this._sortMethod&&this.batches.sort(this._sortMethod);for(var r=0;r<this.batches.length;++r)this.batches[r]instanceof e?this.batches[r].Render(t):(this.batches[r].renderMode!==i.device.RM_ANY&&i.device.SetStandardStates(this.batches[r].renderMode),i.device.perObjectData=this.batches[r].perObjectData,this.batches[r].Commit(t))}},{key:"length",get:function(){return this.batches.length}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vec2=void 0;var n=r(10);t.vec2=n.vec2},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){let e=new n.ARRAY_TYPE(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},t.clone=function(e){let t=new n.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},t.fromValues=function(e,t,r,i){let a=new n.ARRAY_TYPE(4);return a[0]=e,a[1]=t,a[2]=r,a[3]=i,a},t.set=function(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e},t.transpose=function(e,t){if(e===t){let r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},t.invert=function(e,t){let r=t[0],n=t[1],i=t[2],a=t[3],o=r*a-i*n;if(!o)return null;return o=1/o,e[0]=a*o,e[1]=-n*o,e[2]=-i*o,e[3]=r*o,e},t.adjoint=function(e,t){let r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e},t.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},t.multiply=i,t.rotate=function(e,t,r){let n=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(r),u=Math.cos(r);return e[0]=n*u+a*s,e[1]=i*u+o*s,e[2]=n*-s+a*u,e[3]=i*-s+o*u,e},t.scale=function(e,t,r){let n=t[0],i=t[1],a=t[2],o=t[3],s=r[0],u=r[1];return e[0]=n*s,e[1]=i*s,e[2]=a*u,e[3]=o*u,e},t.fromRotation=function(e,t){let r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=-r,e[3]=n,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},t.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},t.LDU=function(e,t,r,n){return e[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-e[2]*r[1],[e,t,r]},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},t.subtract=a,t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},t.equals=function(e,t){let r=e[0],i=e[1],a=e[2],o=e[3],s=t[0],u=t[1],l=t[2],c=t[3];return Math.abs(r-s)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-u)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(a-l)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(o-c)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))},t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},t.multiplyScalarAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e};var n=r(3);function i(e,t,r){let n=t[0],i=t[1],a=t[2],o=t[3],s=r[0],u=r[1],l=r[2],c=r[3];return e[0]=n*s+a*u,e[1]=i*s+o*u,e[2]=n*l+a*c,e[3]=i*l+o*c,e}function a(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}const o=i;t.mul=o;const s=a;t.sub=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){let e=new n.ARRAY_TYPE(6);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},t.clone=function(e){let t=new n.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},t.fromValues=function(e,t,r,i,a,o){let s=new n.ARRAY_TYPE(6);return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s[4]=a,s[5]=o,s},t.set=function(e,t,r,n,i,a,o){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=a,e[5]=o,e},t.invert=function(e,t){let r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=r*a-n*i;if(!u)return null;return u=1/u,e[0]=a*u,e[1]=-n*u,e[2]=-i*u,e[3]=r*u,e[4]=(i*s-a*o)*u,e[5]=(n*o-r*s)*u,e},t.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},t.multiply=i,t.rotate=function(e,t,r){let n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=Math.sin(r),c=Math.cos(r);return e[0]=n*c+a*l,e[1]=i*c+o*l,e[2]=n*-l+a*c,e[3]=i*-l+o*c,e[4]=s,e[5]=u,e},t.scale=function(e,t,r){let n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=r[0],c=r[1];return e[0]=n*l,e[1]=i*l,e[2]=a*c,e[3]=o*c,e[4]=s,e[5]=u,e},t.translate=function(e,t,r){let n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=r[0],c=r[1];return e[0]=n,e[1]=i,e[2]=a,e[3]=o,e[4]=n*l+a*c+s,e[5]=i*l+o*c+u,e},t.fromRotation=function(e,t){let r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=-r,e[3]=n,e[4]=0,e[5]=0,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},t.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+1)},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e},t.subtract=a,t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e},t.multiplyScalarAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},t.equals=function(e,t){let r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=t[0],c=t[1],f=t[2],h=t[3],p=t[4],d=t[5];return Math.abs(r-l)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-c)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(a-f)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(o-h)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(s-p)<=n.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(u-d)<=n.EPSILON*Math.max(1,Math.abs(u),Math.abs(d))};var n=r(3);function i(e,t,r){let n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=r[0],c=r[1],f=r[2],h=r[3],p=r[4],d=r[5];return e[0]=n*l+a*c,e[1]=i*l+o*c,e[2]=n*f+a*h,e[3]=i*f+o*h,e[4]=n*p+a*d+s,e[5]=i*p+o*d+u,e}function a(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}const o=i;t.mul=o;const s=a;t.sub=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){let e=new n.ARRAY_TYPE(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.clone=function(e){let t=new n.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.fromValues=function(e,t,r,i,a,o,s,u,l,c,f,h,p,d,v,m){let y=new n.ARRAY_TYPE(16);return y[0]=e,y[1]=t,y[2]=r,y[3]=i,y[4]=a,y[5]=o,y[6]=s,y[7]=u,y[8]=l,y[9]=c,y[10]=f,y[11]=h,y[12]=p,y[13]=d,y[14]=v,y[15]=m,y},t.set=function(e,t,r,n,i,a,o,s,u,l,c,f,h,p,d,v,m){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=a,e[5]=o,e[6]=s,e[7]=u,e[8]=l,e[9]=c,e[10]=f,e[11]=h,e[12]=p,e[13]=d,e[14]=v,e[15]=m,e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.transpose=function(e,t){if(e===t){let r=t[1],n=t[2],i=t[3],a=t[6],o=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=a,e[11]=t[14],e[12]=i,e[13]=o,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},t.invert=function(e,t){let r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],f=t[9],h=t[10],p=t[11],d=t[12],v=t[13],m=t[14],y=t[15],b=r*s-n*o,_=r*u-i*o,g=r*l-a*o,E=n*u-i*s,T=n*l-a*s,O=i*l-a*u,w=c*v-f*d,R=c*m-h*d,S=c*y-p*d,P=f*m-h*v,A=f*y-p*v,M=h*y-p*m,I=b*M-_*A+g*P+E*S-T*R+O*w;if(!I)return null;return I=1/I,e[0]=(s*M-u*A+l*P)*I,e[1]=(i*A-n*M-a*P)*I,e[2]=(v*O-m*T+y*E)*I,e[3]=(h*T-f*O-p*E)*I,e[4]=(u*S-o*M-l*R)*I,e[5]=(r*M-i*S+a*R)*I,e[6]=(m*g-d*O-y*_)*I,e[7]=(c*O-h*g+p*_)*I,e[8]=(o*A-s*S+l*w)*I,e[9]=(n*S-r*A-a*w)*I,e[10]=(d*T-v*g+y*b)*I,e[11]=(f*g-c*T-p*b)*I,e[12]=(s*R-o*P-u*w)*I,e[13]=(r*P-n*R+i*w)*I,e[14]=(v*_-d*E-m*b)*I,e[15]=(c*E-f*_+h*b)*I,e},t.adjoint=function(e,t){let r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],f=t[9],h=t[10],p=t[11],d=t[12],v=t[13],m=t[14],y=t[15];return e[0]=s*(h*y-p*m)-f*(u*y-l*m)+v*(u*p-l*h),e[1]=-(n*(h*y-p*m)-f*(i*y-a*m)+v*(i*p-a*h)),e[2]=n*(u*y-l*m)-s*(i*y-a*m)+v*(i*l-a*u),e[3]=-(n*(u*p-l*h)-s*(i*p-a*h)+f*(i*l-a*u)),e[4]=-(o*(h*y-p*m)-c*(u*y-l*m)+d*(u*p-l*h)),e[5]=r*(h*y-p*m)-c*(i*y-a*m)+d*(i*p-a*h),e[6]=-(r*(u*y-l*m)-o*(i*y-a*m)+d*(i*l-a*u)),e[7]=r*(u*p-l*h)-o*(i*p-a*h)+c*(i*l-a*u),e[8]=o*(f*y-p*v)-c*(s*y-l*v)+d*(s*p-l*f),e[9]=-(r*(f*y-p*v)-c*(n*y-a*v)+d*(n*p-a*f)),e[10]=r*(s*y-l*v)-o*(n*y-a*v)+d*(n*l-a*s),e[11]=-(r*(s*p-l*f)-o*(n*p-a*f)+c*(n*l-a*s)),e[12]=-(o*(f*m-h*v)-c*(s*m-u*v)+d*(s*h-u*f)),e[13]=r*(f*m-h*v)-c*(n*m-i*v)+d*(n*h-i*f),e[14]=-(r*(s*m-u*v)-o*(n*m-i*v)+d*(n*u-i*s)),e[15]=r*(s*h-u*f)-o*(n*h-i*f)+c*(n*u-i*s),e},t.determinant=function(e){let t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=e[9],f=e[10],h=e[11],p=e[12],d=e[13],v=e[14],m=e[15];return(t*o-r*a)*(f*m-h*v)-(t*s-n*a)*(c*m-h*d)+(t*u-i*a)*(c*v-f*d)+(r*s-n*o)*(l*m-h*p)-(r*u-i*o)*(l*v-f*p)+(n*u-i*s)*(l*d-c*p)},t.multiply=i,t.translate=function(e,t,r){let n,i,a,o,s,u,l,c,f,h,p,d,v=r[0],m=r[1],y=r[2];t===e?(e[12]=t[0]*v+t[4]*m+t[8]*y+t[12],e[13]=t[1]*v+t[5]*m+t[9]*y+t[13],e[14]=t[2]*v+t[6]*m+t[10]*y+t[14],e[15]=t[3]*v+t[7]*m+t[11]*y+t[15]):(n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],f=t[8],h=t[9],p=t[10],d=t[11],e[0]=n,e[1]=i,e[2]=a,e[3]=o,e[4]=s,e[5]=u,e[6]=l,e[7]=c,e[8]=f,e[9]=h,e[10]=p,e[11]=d,e[12]=n*v+s*m+f*y+t[12],e[13]=i*v+u*m+h*y+t[13],e[14]=a*v+l*m+p*y+t[14],e[15]=o*v+c*m+d*y+t[15]);return e},t.scale=function(e,t,r){let n=r[0],i=r[1],a=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.rotate=function(e,t,r,i){let a,o,s,u,l,c,f,h,p,d,v,m,y,b,_,g,E,T,O,w,R,S,P,A,M=i[0],I=i[1],j=i[2],C=Math.sqrt(M*M+I*I+j*j);if(Math.abs(C)<n.EPSILON)return null;M*=C=1/C,I*=C,j*=C,a=Math.sin(r),o=Math.cos(r),s=1-o,u=t[0],l=t[1],c=t[2],f=t[3],h=t[4],p=t[5],d=t[6],v=t[7],m=t[8],y=t[9],b=t[10],_=t[11],g=M*M*s+o,E=I*M*s+j*a,T=j*M*s-I*a,O=M*I*s-j*a,w=I*I*s+o,R=j*I*s+M*a,S=M*j*s+I*a,P=I*j*s-M*a,A=j*j*s+o,e[0]=u*g+h*E+m*T,e[1]=l*g+p*E+y*T,e[2]=c*g+d*E+b*T,e[3]=f*g+v*E+_*T,e[4]=u*O+h*w+m*R,e[5]=l*O+p*w+y*R,e[6]=c*O+d*w+b*R,e[7]=f*O+v*w+_*R,e[8]=u*S+h*P+m*A,e[9]=l*S+p*P+y*A,e[10]=c*S+d*P+b*A,e[11]=f*S+v*P+_*A,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);return e},t.rotateX=function(e,t,r){let n=Math.sin(r),i=Math.cos(r),a=t[4],o=t[5],s=t[6],u=t[7],l=t[8],c=t[9],f=t[10],h=t[11];t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);return e[4]=a*i+l*n,e[5]=o*i+c*n,e[6]=s*i+f*n,e[7]=u*i+h*n,e[8]=l*i-a*n,e[9]=c*i-o*n,e[10]=f*i-s*n,e[11]=h*i-u*n,e},t.rotateY=function(e,t,r){let n=Math.sin(r),i=Math.cos(r),a=t[0],o=t[1],s=t[2],u=t[3],l=t[8],c=t[9],f=t[10],h=t[11];t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);return e[0]=a*i-l*n,e[1]=o*i-c*n,e[2]=s*i-f*n,e[3]=u*i-h*n,e[8]=a*n+l*i,e[9]=o*n+c*i,e[10]=s*n+f*i,e[11]=u*n+h*i,e},t.rotateZ=function(e,t,r){let n=Math.sin(r),i=Math.cos(r),a=t[0],o=t[1],s=t[2],u=t[3],l=t[4],c=t[5],f=t[6],h=t[7];t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);return e[0]=a*i+l*n,e[1]=o*i+c*n,e[2]=s*i+f*n,e[3]=u*i+h*n,e[4]=l*i-a*n,e[5]=c*i-o*n,e[6]=f*i-s*n,e[7]=h*i-u*n,e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromRotation=function(e,t,r){let i,a,o,s=r[0],u=r[1],l=r[2],c=Math.sqrt(s*s+u*u+l*l);if(Math.abs(c)<n.EPSILON)return null;return s*=c=1/c,u*=c,l*=c,i=Math.sin(t),a=Math.cos(t),o=1-a,e[0]=s*s*o+a,e[1]=u*s*o+l*i,e[2]=l*s*o-u*i,e[3]=0,e[4]=s*u*o-l*i,e[5]=u*u*o+a,e[6]=l*u*o+s*i,e[7]=0,e[8]=s*l*o+u*i,e[9]=u*l*o-s*i,e[10]=l*l*o+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromXRotation=function(e,t){let r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromYRotation=function(e,t){let r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromZRotation=function(e,t){let r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromRotationTranslation=function(e,t,r){let n=t[0],i=t[1],a=t[2],o=t[3],s=n+n,u=i+i,l=a+a,c=n*s,f=n*u,h=n*l,p=i*u,d=i*l,v=a*l,m=o*s,y=o*u,b=o*l;return e[0]=1-(p+v),e[1]=f+b,e[2]=h-y,e[3]=0,e[4]=f-b,e[5]=1-(c+v),e[6]=d+m,e[7]=0,e[8]=h+y,e[9]=d-m,e[10]=1-(c+p),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},t.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},t.getScaling=function(e,t){let r=t[0],n=t[1],i=t[2],a=t[4],o=t[5],s=t[6],u=t[8],l=t[9],c=t[10];return e[0]=Math.sqrt(r*r+n*n+i*i),e[1]=Math.sqrt(a*a+o*o+s*s),e[2]=Math.sqrt(u*u+l*l+c*c),e},t.getRotation=function(e,t){let r=t[0]+t[5]+t[10],n=0;r>0?(n=2*Math.sqrt(r+1),e[3]=.25*n,e[0]=(t[6]-t[9])/n,e[1]=(t[8]-t[2])/n,e[2]=(t[1]-t[4])/n):t[0]>t[5]&t[0]>t[10]?(n=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/n,e[0]=.25*n,e[1]=(t[1]+t[4])/n,e[2]=(t[8]+t[2])/n):t[5]>t[10]?(n=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/n,e[0]=(t[1]+t[4])/n,e[1]=.25*n,e[2]=(t[6]+t[9])/n):(n=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/n,e[0]=(t[8]+t[2])/n,e[1]=(t[6]+t[9])/n,e[2]=.25*n);return e},t.fromRotationTranslationScale=function(e,t,r,n){let i=t[0],a=t[1],o=t[2],s=t[3],u=i+i,l=a+a,c=o+o,f=i*u,h=i*l,p=i*c,d=a*l,v=a*c,m=o*c,y=s*u,b=s*l,_=s*c,g=n[0],E=n[1],T=n[2];return e[0]=(1-(d+m))*g,e[1]=(h+_)*g,e[2]=(p-b)*g,e[3]=0,e[4]=(h-_)*E,e[5]=(1-(f+m))*E,e[6]=(v+y)*E,e[7]=0,e[8]=(p+b)*T,e[9]=(v-y)*T,e[10]=(1-(f+d))*T,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},t.fromRotationTranslationScaleOrigin=function(e,t,r,n,i){let a=t[0],o=t[1],s=t[2],u=t[3],l=a+a,c=o+o,f=s+s,h=a*l,p=a*c,d=a*f,v=o*c,m=o*f,y=s*f,b=u*l,_=u*c,g=u*f,E=n[0],T=n[1],O=n[2],w=i[0],R=i[1],S=i[2];return e[0]=(1-(v+y))*E,e[1]=(p+g)*E,e[2]=(d-_)*E,e[3]=0,e[4]=(p-g)*T,e[5]=(1-(h+y))*T,e[6]=(m+b)*T,e[7]=0,e[8]=(d+_)*O,e[9]=(m-b)*O,e[10]=(1-(h+v))*O,e[11]=0,e[12]=r[0]+w-(e[0]*w+e[4]*R+e[8]*S),e[13]=r[1]+R-(e[1]*w+e[5]*R+e[9]*S),e[14]=r[2]+S-(e[2]*w+e[6]*R+e[10]*S),e[15]=1,e},t.fromQuat=function(e,t){let r=t[0],n=t[1],i=t[2],a=t[3],o=r+r,s=n+n,u=i+i,l=r*o,c=n*o,f=n*s,h=i*o,p=i*s,d=i*u,v=a*o,m=a*s,y=a*u;return e[0]=1-f-d,e[1]=c+y,e[2]=h-m,e[3]=0,e[4]=c-y,e[5]=1-l-d,e[6]=p+v,e[7]=0,e[8]=h+m,e[9]=p-v,e[10]=1-l-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.frustum=function(e,t,r,n,i,a,o){let s=1/(r-t),u=1/(i-n),l=1/(a-o);return e[0]=2*a*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*u,e[6]=0,e[7]=0,e[8]=(r+t)*s,e[9]=(i+n)*u,e[10]=(o+a)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*a*2*l,e[15]=0,e},t.perspective=function(e,t,r,n,i){let a=1/Math.tan(t/2),o=1/(n-i);return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(i+n)*o,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*i*n*o,e[15]=0,e},t.perspectiveFromFieldOfView=function(e,t,r,n){let i=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),u=2/(o+s),l=2/(i+a);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-(o-s)*u*.5,e[9]=(i-a)*l*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e},t.ortho=function(e,t,r,n,i,a,o){let s=1/(t-r),u=1/(n-i),l=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+r)*s,e[13]=(i+n)*u,e[14]=(o+a)*l,e[15]=1,e},t.lookAt=function(e,t,r,i){let a,o,s,u,l,c,f,h,p,d,v=t[0],m=t[1],y=t[2],b=i[0],_=i[1],g=i[2],E=r[0],T=r[1],O=r[2];if(Math.abs(v-E)<n.EPSILON&&Math.abs(m-T)<n.EPSILON&&Math.abs(y-O)<n.EPSILON)return mat4.identity(e);f=v-E,h=m-T,p=y-O,d=1/Math.sqrt(f*f+h*h+p*p),a=_*(p*=d)-g*(h*=d),o=g*(f*=d)-b*p,s=b*h-_*f,(d=Math.sqrt(a*a+o*o+s*s))?(a*=d=1/d,o*=d,s*=d):(a=0,o=0,s=0);u=h*s-p*o,l=p*a-f*s,c=f*o-h*a,(d=Math.sqrt(u*u+l*l+c*c))?(u*=d=1/d,l*=d,c*=d):(u=0,l=0,c=0);return e[0]=a,e[1]=u,e[2]=f,e[3]=0,e[4]=o,e[5]=l,e[6]=h,e[7]=0,e[8]=s,e[9]=c,e[10]=p,e[11]=0,e[12]=-(a*v+o*m+s*y),e[13]=-(u*v+l*m+c*y),e[14]=-(f*v+h*m+p*y),e[15]=1,e},t.targetTo=function(e,t,r,n){let i=t[0],a=t[1],o=t[2],s=n[0],u=n[1],l=n[2],c=i-r[0],f=a-r[1],h=o-r[2],p=c*c+f*f+h*h;p>0&&(p=1/Math.sqrt(p),c*=p,f*=p,h*=p);let d=u*h-l*f,v=l*c-s*h,m=s*f-u*c;return e[0]=d,e[1]=v,e[2]=m,e[3]=0,e[4]=f*m-h*v,e[5]=h*d-c*m,e[6]=c*v-f*d,e[7]=0,e[8]=c,e[9]=f,e[10]=h,e[11]=0,e[12]=i,e[13]=a,e[14]=o,e[15]=1,e},t.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e},t.subtract=a,t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e},t.multiplyScalarAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},t.equals=function(e,t){let r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],f=e[8],h=e[9],p=e[10],d=e[11],v=e[12],m=e[13],y=e[14],b=e[15],_=t[0],g=t[1],E=t[2],T=t[3],O=t[4],w=t[5],R=t[6],S=t[7],P=t[8],A=t[9],M=t[10],I=t[11],j=t[12],C=t[13],k=t[14],D=t[15];return Math.abs(r-_)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(i-g)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(g))&&Math.abs(a-E)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(o-T)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(T))&&Math.abs(s-O)<=n.EPSILON*Math.max(1,Math.abs(s),Math.abs(O))&&Math.abs(u-w)<=n.EPSILON*Math.max(1,Math.abs(u),Math.abs(w))&&Math.abs(l-R)<=n.EPSILON*Math.max(1,Math.abs(l),Math.abs(R))&&Math.abs(c-S)<=n.EPSILON*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(f-P)<=n.EPSILON*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(h-A)<=n.EPSILON*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(p-M)<=n.EPSILON*Math.max(1,Math.abs(p),Math.abs(M))&&Math.abs(d-I)<=n.EPSILON*Math.max(1,Math.abs(d),Math.abs(I))&&Math.abs(v-j)<=n.EPSILON*Math.max(1,Math.abs(v),Math.abs(j))&&Math.abs(m-C)<=n.EPSILON*Math.max(1,Math.abs(m),Math.abs(C))&&Math.abs(y-k)<=n.EPSILON*Math.max(1,Math.abs(y),Math.abs(k))&&Math.abs(b-D)<=n.EPSILON*Math.max(1,Math.abs(b),Math.abs(D))};var n=r(3);function i(e,t,r){let n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],f=t[8],h=t[9],p=t[10],d=t[11],v=t[12],m=t[13],y=t[14],b=t[15],_=r[0],g=r[1],E=r[2],T=r[3];return e[0]=_*n+g*s+E*f+T*v,e[1]=_*i+g*u+E*h+T*m,e[2]=_*a+g*l+E*p+T*y,e[3]=_*o+g*c+E*d+T*b,_=r[4],g=r[5],E=r[6],T=r[7],e[4]=_*n+g*s+E*f+T*v,e[5]=_*i+g*u+E*h+T*m,e[6]=_*a+g*l+E*p+T*y,e[7]=_*o+g*c+E*d+T*b,_=r[8],g=r[9],E=r[10],T=r[11],e[8]=_*n+g*s+E*f+T*v,e[9]=_*i+g*u+E*h+T*m,e[10]=_*a+g*l+E*p+T*y,e[11]=_*o+g*c+E*d+T*b,_=r[12],g=r[13],E=r[14],T=r[15],e[12]=_*n+g*s+E*f+T*v,e[13]=_*i+g*u+E*h+T*m,e[14]=_*a+g*l+E*p+T*y,e[15]=_*o+g*c+E*d+T*b,e}function a(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}const o=i;t.mul=o;const s=a;t.sub=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.create=s,t.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},t.setAxisAngle=u,t.getAxisAngle=function(e,t){let r=2*Math.acos(t[3]),n=Math.sin(r/2);0!=n?(e[0]=t[0]/n,e[1]=t[1]/n,e[2]=t[2]/n):(e[0]=1,e[1]=0,e[2]=0);return r},t.multiply=l,t.rotateX=function(e,t,r){r*=.5;let n=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(r),u=Math.cos(r);return e[0]=n*u+o*s,e[1]=i*u+a*s,e[2]=a*u-i*s,e[3]=o*u-n*s,e},t.rotateY=function(e,t,r){r*=.5;let n=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(r),u=Math.cos(r);return e[0]=n*u-a*s,e[1]=i*u+o*s,e[2]=a*u+n*s,e[3]=o*u-i*s,e},t.rotateZ=function(e,t,r){r*=.5;let n=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(r),u=Math.cos(r);return e[0]=n*u+i*s,e[1]=i*u-n*s,e[2]=a*u+o*s,e[3]=o*u-a*s,e},t.calculateW=function(e,t){let r=t[0],n=t[1],i=t[2];return e[0]=r,e[1]=n,e[2]=i,e[3]=Math.sqrt(Math.abs(1-r*r-n*n-i*i)),e},t.slerp=c,t.invert=function(e,t){let r=t[0],n=t[1],i=t[2],a=t[3],o=r*r+n*n+i*i+a*a,s=o?1/o:0;return e[0]=-r*s,e[1]=-n*s,e[2]=-i*s,e[3]=a*s,e},t.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},t.fromMat3=f,t.fromEuler=function(e,t,r,n){let i=.5*Math.PI/180;t*=i,r*=i,n*=i;let a=Math.sin(t),o=Math.cos(t),s=Math.sin(r),u=Math.cos(r),l=Math.sin(n),c=Math.cos(n);return e[0]=a*u*c-o*s*l,e[1]=o*s*c+a*u*l,e[2]=o*u*l-a*s*c,e[3]=o*u*c+a*s*l,e},t.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"};var n=r(3),i=r(34),a=r(35),o=r(36);function s(){let e=new n.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function u(e,t,r){r*=.5;let n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function l(e,t,r){let n=t[0],i=t[1],a=t[2],o=t[3],s=r[0],u=r[1],l=r[2],c=r[3];return e[0]=n*c+o*s+i*l-a*u,e[1]=i*c+o*u+a*s-n*l,e[2]=a*c+o*l+n*u-i*s,e[3]=o*c-n*s-i*u-a*l,e}function c(e,t,r,n){let i,a,o,s,u,l=t[0],c=t[1],f=t[2],h=t[3],p=r[0],d=r[1],v=r[2],m=r[3];return(a=l*p+c*d+f*v+h*m)<0&&(a=-a,p=-p,d=-d,v=-v,m=-m),1-a>1e-6?(i=Math.acos(a),o=Math.sin(i),s=Math.sin((1-n)*i)/o,u=Math.sin(n*i)/o):(s=1-n,u=n),e[0]=s*l+u*p,e[1]=s*c+u*d,e[2]=s*f+u*v,e[3]=s*h+u*m,e}function f(e,t){let r,n=t[0]+t[4]+t[8];if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{let n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);let i=(n+1)%3,a=(n+2)%3;r=Math.sqrt(t[3*n+n]-t[3*i+i]-t[3*a+a]+1),e[n]=.5*r,r=.5/r,e[3]=(t[3*i+a]-t[3*a+i])*r,e[i]=(t[3*i+n]+t[3*n+i])*r,e[a]=(t[3*a+n]+t[3*n+a])*r}return e}const h=o.clone;t.clone=h;const p=o.fromValues;t.fromValues=p;const d=o.copy;t.copy=d;const v=o.set;t.set=v;const m=o.add;t.add=m;const y=l;t.mul=y;const b=o.scale;t.scale=b;const _=o.dot;t.dot=_;const g=o.lerp;t.lerp=g;const E=o.length;t.length=E;const T=E;t.len=T;const O=o.squaredLength;t.squaredLength=O;const w=O;t.sqrLen=w;const R=o.normalize;t.normalize=R;const S=o.exactEquals;t.exactEquals=S;const P=o.equals;t.equals=P;const A=function(){let e=a.create(),t=a.fromValues(1,0,0),r=a.fromValues(0,1,0);return function(n,i,o){let s=a.dot(i,o);return s<-.999999?(a.cross(e,t,i),a.len(e)<1e-6&&a.cross(e,r,i),a.normalize(e,e),u(n,e,Math.PI),n):s>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(a.cross(e,i,o),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=1+s,R(n,n))}}();t.rotationTo=A;const M=function(){let e=s(),t=s();return function(r,n,i,a,o,s){return c(e,n,o,s),c(t,i,a,s),c(r,e,t,2*s*(1-s)),r}}();t.sqlerp=M;const I=function(){let e=i.create();return function(t,r,n,i){return e[0]=n[0],e[3]=n[1],e[6]=n[2],e[1]=i[0],e[4]=i[1],e[7]=i[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],R(t,f(t,e))}}();t.setAxes=I},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.create=i,t.clone=function(e){let t=new n.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},t.fromValues=function(e,t){let r=new n.ARRAY_TYPE(2);return r[0]=e,r[1]=t,r},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},t.set=function(e,t,r){return e[0]=t,e[1]=r,e},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e},t.subtract=a,t.multiply=o,t.divide=s,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},t.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e},t.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},t.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e},t.scaleAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e},t.distance=u,t.squaredDistance=l,t.length=c,t.squaredLength=f,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},t.normalize=function(e,t){var r=t[0],n=t[1],i=r*r+n*n;i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i);return e},t.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},t.cross=function(e,t,r){var n=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=n,e},t.lerp=function(e,t,r,n){var i=t[0],a=t[1];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e},t.random=function(e,t){t=t||1;var r=2*n.RANDOM()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},t.transformMat2=function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i,e[1]=r[1]*n+r[3]*i,e},t.transformMat2d=function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i+r[4],e[1]=r[1]*n+r[3]*i+r[5],e},t.transformMat3=function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[3]*i+r[6],e[1]=r[1]*n+r[4]*i+r[7],e},t.transformMat4=function(e,t,r){let n=t[0],i=t[1];return e[0]=r[0]*n+r[4]*i+r[12],e[1]=r[1]*n+r[5]*i+r[13],e},t.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},t.equals=function(e,t){let r=e[0],i=e[1],a=t[0],o=t[1];return Math.abs(r-a)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-o)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))};var n=r(3);function i(){let e=new n.ARRAY_TYPE(2);return e[0]=0,e[1]=0,e}function a(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function o(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function s(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function u(e,t){var r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)}function l(e,t){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function c(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function f(e){var t=e[0],r=e[1];return t*t+r*r}const h=c;t.len=h;const p=a;t.sub=p;const d=o;t.mul=d;const v=s;t.div=v;const m=u;t.dist=m;const y=l;t.sqrDist=y;const b=f;t.sqrLen=b;const _=function(){let e=i();return function(t,r,n,i,a,o){let s,u;for(r||(r=2),n||(n=0),u=i?Math.min(i*r+n,t.length):t.length,s=n;s<u;s+=r)e[0]=t[s],e[1]=t[s+1],a(e,e,o),t[s]=e[0],t[s+1]=e[1];return t}}();t.forEach=_},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.quat=void 0;var n=r(10);t.quat=n.quat,n.quat.exp=function(e,t){var r=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return r?(e[0]=Math.sin(r)*t[0]/r,e[1]=Math.sin(r)*t[1]/r,e[2]=Math.sin(r)*t[2]/r,e[3]=Math.cos(r)):(e[0]=0,e[1]=0,e[2]=0,e[3]=1),e},n.quat.ln=function(e,t){var r=n.quat.length(t);if(r>1.0001||r<.99999)e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=0;else if(r=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])){var i=Math.atan2(r,t[3])/r;e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=0}else e[0]=0,e[1]=0,e[2]=0,e[3]=0;return e},n.quat.pow=function(e,t,r){return 1===r?n.quat.copy(e,t):(n.quat.ln(e,t),e[0]*=r,e[1]*=r,e[2]*=r,e[3]*=r,n.quat.exp(e,e),e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mat3=void 0;var n=r(10);t.mat3=n.mat3},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mat4=void 0;var n=r(10);t.mat4=n.mat4,n.mat4.arcFromForward=function(){var e=void 0;return function(t,r){e||(e=n.vec3.create());var i=n.vec3.normalize(e,r);if(n.mat4.identity(t),i[2]<-.99999)return t;if(i[2]>.99999)return t[5]=-1,t[10]=-1,t;var a=(1+i[2])/(i[0]*i[0]+i[1]*i[1]);return t[0]=a*i[1]*i[1]-i[2],t[1]=-a*i[0]*i[1],t[2]=i[0],t[4]=t[1],t[5]=a*i[0]*i[0]-i[2],t[6]=i[1],t[8]=-i[0],t[9]=-i[1],t[10]=-i[2],t}}(),n.mat4.copyTranslation=function(e,t){return e[12]=t[12],e[13]=t[13],e[14]=t[14],e},n.mat4.fromMat3=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[4]=t[3],e[5]=t[4],e[6]=t[5],e[8]=t[6],e[9]=t[7],e[10]=t[8],e[3]=e[7]=e[11]=e[12]=e[13]=e[14]=0,e[15]=1,e},n.mat4.lookAtGL=function(){var e=void 0,t=void 0,r=void 0;return function(i,a,o,s){return e||(e=n.vec3.create(),t=n.vec3.create(),r=n.vec3.create()),n.vec3.subtract(r,a,o),0===n.vec3.squaredLength(r)&&(r[2]=1),n.vec3.normalize(r,r),n.vec3.cross(e,s,r),0===n.vec3.squaredLength(e)&&(r[2]+=1e-4,n.vec3.cross(e,s,r)),n.vec3.normalize(e,e),n.vec3.cross(t,r,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[4]=t[0],i[5]=t[1],i[6]=t[2],i[8]=r[0],i[9]=r[1],i[10]=r[2],i}}(),n.mat4.perspectiveGL=function(e,t,r,i,a){var o=Math.tan(t/360*Math.PI)*i,s=o*r;return n.mat4.frustum(e,-s,s,-o,o,i,a),e},n.mat4.setTranslation=function(e,t){return e[12]=t[0],e[13]=t[1],e[14]=t[2],e},n.mat4.setTranslationFromValues=function(e,t,r,n){return e[12]=t,e[13]=r,e[14]=n,e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.noise=void 0;var n=r(37),i=r(38),a=t.noise={};a.turbulence=function(){var e=[],t=[],r=[],a=!1;return function(o,s,u,l,c,f){a||function(){for(var o=0;o<256;o++)e[o]=i.vec4.fromValues(Math.random()-.5,Math.random()-.5,Math.random()-.5,Math.random()-.5),t[o]=o;for(var s=256;--s;){var u=t[s],l=Math.floor(256*Math.random());t[s]=t[l],t[l]=u}for(var c=0;c<256;c++)t[256+c]=t[c],e[256+c]=e[c],e[512+c]=e[c];for(var f=0;f<15;++f)r[f]=n.vec3.create();a=!0}(),s+=4096,u+=4096,l+=4096,c+=4096;var h=Math.floor(s),p=Math.floor(u),d=Math.floor(l),v=Math.floor(c),m=s-h,y=u-p,b=l-d,_=c-v,g=(h&=255)+1,E=(p&=255)+1,T=(d&=255)+1,O=(v&=255)+1,w=t[h],R=t[g],S=t[w+p],P=t[R+p],A=t[w+E],M=t[R+E],I=n.vec3.lerp(r[0],e[S+d+v],e[P+d+v],m),j=n.vec3.lerp(r[1],e[A+d+v],e[M+d+v],m),C=n.vec3.lerp(r[2],e[S+T+v],e[P+T+v],m),k=n.vec3.lerp(r[3],e[S+T+v],e[P+T+v],m),D=n.vec3.lerp(r[4],I,j,y),x=n.vec3.lerp(r[5],C,k,y),L=n.vec3.lerp(r[6],D,x,b);I=n.vec3.lerp(r[7],e[S+d+O],e[P+d+O],m),j=n.vec3.lerp(r[8],e[A+d+O],e[M+d+O],m),C=n.vec3.lerp(r[9],e[S+T+O],e[P+T+O],m),k=n.vec3.lerp(r[10],e[S+T+O],e[P+T+O],m),D=n.vec3.lerp(r[11],I,j,y),x=n.vec3.lerp(r[12],C,k,y);var B=n.vec3.lerp(r[13],D,x,b),G=n.vec3.lerp(r[14],L,B,_);return o[0]+=G[0]*f,o[1]+=G[1]*f,o[2]+=G[2]*f,o}}(),a.perlin1=function(){var e=!1,t=256,r=null,n=null;return function(i){e||function(){r=new Array(t+t+2),n=new Array(t+t+2);var i=0,a=0,o=0;for(i=0;i<t;i++)r[i]=i,n[i]=2*Math.random()-1;for(;--i;)o=r[i],r[i]=r[a=Math.floor(Math.random()*t)],r[a]=o;for(i=0;i<t+2;i++)r[t+i]=r[i],n[t+i]=n[i];e=!0}();var a=i+4096,o=255&Math.floor(a),s=o+1&255,u=a-Math.floor(a),l=u-1,c=u*u*(3-2*u),f=u*n[r[o]];return f+c*(l*n[r[s]]-f)}}(),a.perlin1D=function(e,t,r,n){for(var i=0,o=e,s=1,u=0;u<n;++u)i+=a.perlin1(o)/s,s*=t,o*=r;return i}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=t.curve={};n.evaluate=function(e,t,r,n,i){for(var a=e.knots.length,o=a-1,s=0,u=0;u<e.knots.length;++u)if(e.knots[u]>t){o=u;break}if(0===e.degree)for(var l=0;l<e.dimension;++l)r[l]=e.controls[o*e.dimension+l];else if(1===e.degree){var c=n?(o+a-1)%a:0===o?0:o-1,f=e.knots[o]-e.knots[c];f<0&&(f+=i),f>0&&(s=(t-e.knots[e.knots.length-1])/f);for(var h=0;h<e.dimension;++h)r[h]=e.controls[c*e.dimension+h]*(1-s)+e.controls[o*e.dimension+h]*s}else{var p=n?(o+a-2)%a:0===o?0:o-2,d=n?(o+a-1)%a:0===o?0:o-1,v=p*e.dimension,m=d*e.dimension,y=o*e.dimension,b=e.knots[p],_=e.knots[d],g=e.knots[o],E=e.knots[(o+1)%a];b>g&&(g+=i,E+=i,t+=i),_>g&&(g+=i,E+=i,t+=i),E<g&&(E+=i);var T=t-_,O=T/(g-_),w=(t-b)/(g-b),R=w+O-O*w,S=O*(T/(E-_)),P=R-S;R=1-R;for(var A=0;A<e.dimension;++A)r[A]=R*e.controls[v+A]+P*e.controls[m+A]+S*e.controls[y+A]}},n.ag_horner1=function(e,t,r){for(var n=e[t];--t>=0;)n=r*n+e[t];return n},n.ag_zeroin2=function(e,t,r,i,a,o){var s=void 0,u=void 0,l=void 0,c=void 0,f=void 0,h=void 0,p=void 0,d=void 0,v=void 0,m=void 0;for(var y=!0;y&&(s=e,c=r,l=u=t-e),Math.abs(c)<Math.abs(i)&&(e=t,t=s,s=e,r=i,i=c,c=r),y=!1,f=2.384185792e-7*Math.abs(t)+.5*a,h=.5*(s-t),Math.abs(h)>f&&0!==i;)Math.abs(l)<f||Math.abs(r)<=Math.abs(i)?l=u=h:(m=i/r,e===s?(p=2*h*m,d=1-m):(p=m*(2*h*(d=r/c)*(d-(v=i/c))-(t-e)*(v-1)),d=(d-1)*(v-1)*(m-1)),p>0?d=-d:p=-p,m=l,l=u,2*p<3*h*d-Math.abs(f*d)&&p<Math.abs(.5*m*d)?u=p/d:l=u=h),e=t,r=i,Math.abs(u)>f?t+=u:h>0?t+=f:t-=f,(i=n.ag_horner1(o.p,o.deg,t))*(c/Math.abs(c))>0&&(y=!0);return t},n.ag_zeroin=function(e,t,r,i){var a,o;return a=n.ag_horner1(i.p,i.deg,e),Math.abs(a)<1.192092896e-7?e:(o=n.ag_horner1(i.p,i.deg,t),Math.abs(o)<1.192092896e-7?t:n.ag_zeroin2(e,t,a,o,r,i))},n.polyZeroes=function(e,t,r,i,a,o,s){var u,l,c=void 0,f=void 0,h=void 0,p=void 0,d=void 0,v=void 0,m=void 0,y=void 0,b=void 0,_=void 0,g=void 0,E=void 0,T=new Array(22),O=void 0,w=new Array(22),R=new Array(22),S={p:[],deg:0};for(m=_=0,y=0,c=0;c<t+1;++c)y+=Math.abs(e[c]);if(y<=(u=(Math.abs(r)+Math.abs(a))*(t+1)*1.192092896e-7))return-1;for(E=T,O=w,l=R,c=0;c<t+1;++c)E[c]=1/y*e[c];for(;Math.abs(E[t])<u;)t--;if(p=0,0===t)return p;if(1===t)return s[0]=-E[0]/E[1],f=i?r<s[0]+u:r<s[0]-u,h=o?a>s[0]-u:a>s[0]+u,(p=f&&h?1:0)&&(i&&s[0]<r?s[0]=r:o&&s[0]>a&&(s[0]=a)),p;for(S.p=E,S.deg=t,c=1;c<=t;c++)O[c-1]=c*E[c];if(0===(d=n.polyZeroes(O,t-1,r,0,a,0,l)).length)return 0;for(c=v=0;c<=d;c++){if(p>t)return p;0===c?(b=r,g=n.ag_horner1(E,t,b),Math.abs(g)<=u&&i&&(s[p++]=r)):(b=m,g=_),c===d?(m=a,v=0):m=l[c],_=n.ag_horner1(E,t,m),v?v=0:Math.abs(_)<u?(c!==d||o)&&(s[p++]=m,v=1):(g<0&&_>0||g>0&&_<0)&&(s[p++]=n.ag_zeroin(b,m,0,S),p>1&&s[p-2]>=s[p-1]-u&&(s[p-2]=.5*(s[p-2]+s[p-1]),p--))}return p}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(81);Object.defineProperty(t,"device",{enumerable:!0,get:function(){return n.device}});var i=r(40);Object.defineProperty(t,"resMan",{enumerable:!0,get:function(){return i.resMan}});var a=r(21);Object.defineProperty(t,"store",{enumerable:!0,get:function(){return a.store}});var o=r(90);Object.defineProperty(t,"logger",{enumerable:!0,get:function(){return o.logger}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.device=t.Tw2Device=void 0;var n,i,a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(20),s=r(21),u=r(40),l=r(23),c=r(12),f=r(15);function h(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var p=r(88),d=t.Tw2Device=(i=n=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name="Device",e.gl=null,e.glVersion=t.WebglVersion.NONE,e.vrDisplay=null,e.ext=null,e.debugMode=!1,e.debugUtils=null,e.dt=0,e.frameCounter=0,e.startTime=e.Now(),e.currentTime=e.startTime,e.previousTime=null,e.eyePosition=o.vec3.create(),e.targetResolution=o.vec4.create(),e.world=o.mat4.create(),e.view=o.mat4.create(),e.viewInverse=o.mat4.create(),e.viewTranspose=o.mat4.create(),e.projection=o.mat4.create(),e.projectionInverse=o.mat4.create(),e.projectionTranspose=o.mat4.create(),e.viewProjection=o.mat4.create(),e.viewProjectionTranspose=o.mat4.create(),e.canvas=null,e.viewportWidth=0,e.viewportHeight=0,e.viewportAspect=0,e.viewportPixelRatio="devicePixelRatio"in window?window.devicePixelRatio:1,e.effectDir="/effect.gles2/",e.mipLevelSkipCount=0,e.shaderModel="hi",e.enableAnisotropicFiltering=!0,e.alphaBlendBackBuffer=!0,e.antialiasing=!0,e.msaaSamples=0,e.wrapModes=[],e.shadowHandles=null,e.perObjectData=null,e._alphaBlendState=null,e._alphaTestState=null,e._depthOffsetState=null,e._blendTable=null,e._shadowStateBuffer=null,e._scheduled=[],e._quadBuffer=null,e._quadDecl=null,e._cameraQuadBuffer=null,e._currentRenderMode=e.RM_ANY,e._fallbackCube=null,e._fallbackTexture=null,e._blitEffect=null,e._onResize=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,f.Tw2EventEmitter),a(t,[{key:"Now",value:function(){return this.constructor.Clock.now()}},{key:"CreateDevice",value:function(e,r){var n,i,a;this.gl=null,this.glVersion=t.WebglVersion.NONE,this.effectDir="/effect.gles2/",r&&r.webgl2&&(this.gl=t.CreateContext(e,r,t.Webgl2ContextNames),this.gl&&(this.glVersion=t.WebglVersion.WEBGL2)),this.gl||(this.gl=t.CreateContext(e,r,t.WebglContextNames),this.gl&&(this.glVersion=t.WebglVersion.WEBGL));var o=function(){return!1},s=function(){return!0},u=this.gl;switch(this.ext={drawElementsInstanced:o,drawArraysInstanced:o,vertexAttribDivisor:o,hasInstancedArrays:o},this.glVersion){case t.WebglVersion.WEBGL2:this.ext={drawElementsInstanced:function(e,t,r,n,i){u.drawElementsInstanced(e,t,r,n,i)},drawArraysInstanced:function(e,t,r,n){u.drawArraysInstanced(e,t,r,n)},vertexAttribDivisor:function(e,t){u.vertexAttribDivisor(e,t)},hasInstancedArrays:s};break;case t.WebglVersion.WEBGL:this.GetExtension("OES_standard_derivatives"),this.GetExtension("OES_element_index_uint"),this.GetExtension("OES_texture_float"),this.GetExtension("EXT_shader_texture_lod");var l=this.GetExtension("ANGLE_instanced_arrays");l&&(this.ext={drawElementsInstanced:function(e,t,r,n,i){l.drawElementsInstancedANGLE(e,t,r,n,i)},drawArraysInstanced:function(e,t,r,n){l.drawArraysInstancedANGLE(e,t,r,n)},vertexAttribDivisor:function(e,t){l.vertexAttribDivisorANGLE(e,t)},hasInstancedArrays:s});break;default:return this.glVersion}u&&this.debugMode&&(this.debugUtils=p,this.gl=this.debugUtils.makeDebugContext(u)),this.emit("created",{gl:u,params:r,canvas:e,log:{type:"debug",title:this.name,message:"Webgl"+this.glVersion+" context created"}}),this.ext.CompressedTexture=this.GetExtension("compressed_texture_s3tc"),this.ext.AnisotropicFilter=this.GetExtension("EXT_texture_filter_anisotropic"),this.ext.AnisotropicFilter&&(this.ext.AnisotropicFilter.maxAnisotropy=u.getParameter(this.ext.AnisotropicFilter.MAX_TEXTURE_MAX_ANISOTROPY_EXT));var f=this.GetExtension("CCP_shader_binary");if(f){var d=u.getParameter(this.gl.RENDERER).match(/Mali-(\w+).*/);d&&(this.effectDir="/effect.gles2.mali"+d[1]+"/",this.ext.ShaderBinary=f)}this.alphaBlendBackBuffer=!r||void 0===r.alpha||r.alpha,this.msaaSamples=this.gl.getParameter(this.gl.SAMPLES),this.antialiasing=this.msaaSamples>1,this.canvas=e,this.Resize();return this._quadBuffer=u.createBuffer(),u.bindBuffer(u.ARRAY_BUFFER,this._quadBuffer),u.bufferData(u.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,1,-1,1,0,1,0,1,1,-1,0,1,1,0,-1,-1,0,1,0,0]),u.STATIC_DRAW),this._cameraQuadBuffer=u.createBuffer(),this._quadDecl=new c.Tw2VertexDeclaration([["POSITION",0,4],["TEXCOORD",0,2]]),this._alphaTestState={dirty:!1,states:(n={},h(n,this.RS_ALPHATESTENABLE,0),h(n,this.RS_ALPHAREF,-1),h(n,this.RS_ALPHAFUNC,this.CMP_GREATER),h(n,this.RS_CLIPPING,0),h(n,this.RS_CLIPPLANEENABLE,0),n)},this._alphaBlendState={dirty:!1,states:(i={},h(i,this.RS_SRCBLEND,this.BLEND_SRCALPHA),h(i,this.RS_DESTBLEND,this.BLEND_INVSRCALPHA),h(i,this.RS_BLENDOP,this.BLENDOP_ADD),h(i,this.RS_SEPARATEALPHABLENDENABLE,0),h(i,this.RS_BLENDOPALPHA,this.BLENDOP_ADD),h(i,this.RS_SRCBLENDALPHA,this.BLEND_SRCALPHA),h(i,this.RS_DESTBLENDALPHA,this.BLEND_INVSRCALPHA),i)},this._depthOffsetState={dirty:!1,states:(a={},h(a,this.RS_SLOPESCALEDEPTHBIAS,0),h(a,this.RS_DEPTHBIAS,0),a)},this.wrapModes=[0,u.REPEAT,u.MIRRORED_REPEAT,u.CLAMP_TO_EDGE,u.CLAMP_TO_EDGE,u.CLAMP_TO_EDGE],this._shadowStateBuffer=new Float32Array(24),this._blendTable=[-1,u.ZERO,u.ONE,u.SRC_COLOR,u.ONE_MINUS_SRC_COLOR,u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.DST_ALPHA,u.ONE_MINUS_DST_ALPHA,u.DST_COLOR,u.ONE_MINUS_DST_COLOR,u.SRC_ALPHA_SATURATE,-1,-1,u.CONSTANT_COLOR,u.ONE_MINUS_CONSTANT_COLOR],this.glVersion}},{key:"Schedule",value:function(e){this._scheduled.includes(e)||this._scheduled.push(e)}},{key:"OnResize",value:function(e){this._onResize=e}},{key:"Resize",value:function(){var e=this.vrDisplay&&this.vrDisplay.isPresenting;if(e){var t=this.vrDisplay.getEyeParameters("left"),r=this.vrDisplay.getEyeParameters("right");this.canvas.width=2*Math.max(t.renderWidth,r.renderWidth),this.canvas.height=Math.max(r.renderHeight,r.renderHeight)}else this.canvas.width=this.canvas.offsetWidth*this.viewportPixelRatio,this.canvas.height=this.canvas.offsetHeight*this.viewportPixelRatio;this.viewportWidth=this.canvas.clientWidth,this.viewportHeight=this.canvas.clientHeight,this.viewportAspect=this.viewportWidth/this.viewportHeight,this._onResize&&this._onResize(this.viewportWidth,this.viewportHeight),s.store.SetVariableValue("ViewportSize",[this.viewportWidth,this.viewportHeight,this.viewportWidth,this.viewportHeight]),this.emit("resized",{width:this.viewportWidth,height:this.viewportHeight,aspect:this.viewportAspect,source:e?this.vrDisplay:this.canvas})}},{key:"Tick",value:function(){this.canvas.clientWidth===this.viewportWidth&&this.canvas.clientHeight===this.viewportHeight||this.Resize();var e=null===this.previousTime?0:this.previousTime,t=this.Now();this.currentTime=.001*(t-this.startTime),this.dt=null===this.previousTime?0:.001*(t-this.previousTime),this.previousTime=t,s.store.SetVariableValue("Time",[this.currentTime,this.currentTime-Math.floor(this.currentTime),this.frameCounter,e]),this.emit("tick",{dt:this.dt,previous:e,current:this.currentTime,frame:this.frameCounter}),u.resMan.PrepareLoop(this.dt);for(var r=0;r<this._scheduled.length;++r)this._scheduled[r](this.dt)||(this._scheduled.splice(r,1),--r);this.frameCounter++}},{key:"RequestAnimationFrame",value:function(e){return this.vrDisplay?this.vrDisplay.requestAnimationFrame(e):t.RequestAnimationFrame(e)}},{key:"SetWorld",value:function(e){o.mat4.copy(this.world,e)}},{key:"SetView",value:function(e){o.mat4.copy(this.view,e),o.mat4.invert(this.viewInverse,this.view),o.mat4.transpose(this.viewTranspose,this.view),o.mat4.getTranslation(this.eyePosition,this.viewInverse),this.UpdateViewProjection()}},{key:"SetProjection",value:function(e,t){o.mat4.copy(this.projection,e),o.mat4.transpose(this.projectionTranspose,this.projection),o.mat4.invert(this.projectionInverse,this.projection),this.GetTargetResolution(this.targetResolution),t&&this.UpdateViewProjection()}},{key:"UpdateViewProjection",value:function(){o.mat4.multiply(this.viewProjection,this.projection,this.view),o.mat4.transpose(this.viewProjectionTranspose,this.viewProjection),s.store.SetVariableValue("ViewProjectionMat",this.viewProjection)}},{key:"GetTargetResolution",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.vec4.create(),t=this.projection[0]?this.projection[5]/this.projection[0]:0,r=1;t>1.6&&(r=t/1.6);var n=2*Math.atan(r/this.projection[5]);return e[0]=this.viewportWidth,e[1]=this.viewportHeight,e[2]=n,e[3]=n*t,e}},{key:"GetEyePosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.vec3.create();return o.vec3.copy(e,this.eyePosition)}},{key:"IsAlphaTestEnabled",value:function(){return this._alphaTestState.states[this.RS_ALPHATESTENABLE]}},{key:"IsFrameBufferComplete",value:function(e){return this.gl.checkFramebufferStatus(e)===this.gl.FRAMEBUFFER_COMPLETE}},{key:"GetExtension",value:function(e){var r=t.WebglVendorPrefixes;for(var n in r)if(r.hasOwnProperty(n)){var i=this.gl.getExtension(r[n]+e);if(i)return i}return null}},{key:"GetFallbackTexture",value:function(){return this._fallbackTexture||(this._fallbackTexture=this.CreateSolidTexture()),this._fallbackTexture}},{key:"GetFallbackCubeMap",value:function(){return this._fallbackCube||(this._fallbackCube=this.CreateSolidCube()),this._fallbackCube}},{key:"CreateSolidTexture",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0,0],t=this.gl,r=this.gl.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(e)),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.bindTexture(t.TEXTURE_2D,null),r}},{key:"CreateSolidCube",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0,0],t=this.gl,r=this.gl.createTexture();t.bindTexture(t.TEXTURE_CUBE_MAP,r);for(var n=0;n<6;++n)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(e));return t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.NEAREST),t.bindTexture(t.TEXTURE_CUBE_MAP,null),r}},{key:"RenderFullScreenQuad",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Main";if(!e||!e.IsGood())return!1;var r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,this._quadBuffer);for(var n=0;n<e.GetPassCount(t);++n){if(e.ApplyPass(t,n),!this._quadDecl.SetDeclaration(e.GetPassInput(t,n),24))return!1;this.ApplyShadowState(),r.drawArrays(r.TRIANGLE_STRIP,0,4)}return!0}},{key:"RenderTexture",value:function(e){return null===this._blitEffect&&(this._blitEffect=l.Tw2Effect.create({effectFilePath:"res:/graphics/effect/managed/space/system/blit.fx",textures:{BlitSource:""}})),this._blitEffect.parameters.BlitSource.textureRes=e,this.RenderFullScreenQuad(this._blitEffect)}},{key:"RenderCameraSpaceQuad",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Main";if(!e||!e.IsGood())return!1;for(var r=new Float32Array([1,1,0,1,1,1,-1,1,0,1,0,1,1,-1,0,1,1,0,-1,-1,0,1,0,0]),n=this.projectionInverse,i=0;i<4;++i){var a=r.subarray(6*i,6*i+4);o.vec4.transformMat4(a,a,n),o.vec3.scale(a,a,1/a[3]),a[3]=1}var s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,this._cameraQuadBuffer),s.bufferData(s.ARRAY_BUFFER,r,s.STATIC_DRAW);for(var u=0;u<e.GetPassCount(t);++u){if(e.ApplyPass(t,u),!this._quadDecl.SetDeclaration(e.GetPassInput(t,u),24))return!1;this.ApplyShadowState(),s.drawArrays(s.TRIANGLE_STRIP,0,4)}return!0}},{key:"SetRenderState",value:function(e,t){this._currentRenderMode=this.RM_ANY;var r=this.gl;switch(e){case this.RS_ZENABLE:return void(t?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST));case this.RS_ZWRITEENABLE:return void r.depthMask(!!t);case this.RS_ALPHATESTENABLE:case this.RS_ALPHAREF:case this.RS_ALPHAFUNC:case this.RS_CLIPPING:case this.RS_CLIPPLANEENABLE:return void(this._alphaTestState[e]!==t&&(this._alphaTestState.states[e]=t,this._alphaTestState.dirty=!0));case this.RS_SRCBLEND:case this.RS_DESTBLEND:case this.RS_BLENDOP:case this.RS_SEPARATEALPHABLENDENABLE:case this.RS_BLENDOPALPHA:case this.RS_SRCBLENDALPHA:case this.RS_DESTBLENDALPHA:return void(this._alphaBlendState[e]!==t&&(this._alphaBlendState.states[e]=t,this._alphaBlendState.dirty=!0));case this.RS_CULLMODE:switch(t){case this.CULL_NONE:return void r.disable(r.CULL_FACE);case this.CULL_CW:return r.enable(r.CULL_FACE),void r.cullFace(r.FRONT);case this.CULL_CCW:return r.enable(r.CULL_FACE),void r.cullFace(r.BACK)}return;case this.RS_ZFUNC:return void r.depthFunc(512+t-1);case this.RS_ALPHABLENDENABLE:return void(t?r.enable(r.BLEND):r.disable(r.BLEND));case this.RS_COLORWRITEENABLE:return void r.colorMask(0!=(1&t),0!=(2&t),0!=(4&t),0!=(8&t));case this.RS_SCISSORTESTENABLE:return void(t?r.enable(r.SCISSOR_TEST):r.disable(r.SCISSOR_TEST));case this.RS_SLOPESCALEDEPTHBIAS:case this.RS_DEPTHBIAS:return t=o.num.dwordToFloat(t),void(this._depthOffsetState[e]!==t&&(this._depthOffsetState.states[e]=t,this._depthOffsetState.dirty=!0))}}},{key:"ApplyShadowState",value:function(){var e=this.gl;if(this._alphaBlendState.dirty){var t=e.FUNC_ADD;this._alphaBlendState.states[this.RS_BLENDOP]===this.BLENDOP_SUBTRACT?t=e.FUNC_SUBTRACT:this._alphaBlendState.states[this.RS_BLENDOP]===this.BLENDOP_REVSUBTRACT&&(t=e.FUNC_REVERSE_SUBTRACT);var r=this._blendTable[this._alphaBlendState.states[this.RS_SRCBLEND]],n=this._blendTable[this._alphaBlendState.states[this.RS_DESTBLEND]];if(this._alphaBlendState.states[this.RS_SEPARATEALPHABLENDENABLE]){var i=e.FUNC_ADD;this._alphaBlendState.states[this.RS_BLENDOP]===this.BLENDOP_SUBTRACT?i=e.FUNC_SUBTRACT:this._alphaBlendState.states[this.RS_BLENDOP]===this.BLENDOP_REVSUBTRACT&&(i=e.FUNC_REVERSE_SUBTRACT);var a=this._blendTable[this._alphaBlendState.states[this.RS_SRCBLENDALPHA]],o=this._blendTable[this._alphaBlendState.states[this.RS_DESTBLENDALPHA]];e.blendEquationSeparate(t,i),e.blendFuncSeparate(r,n,a,o)}else e.blendEquation(t),e.blendFunc(r,n);this._alphaBlendState.dirty=!1}this._depthOffsetState.dirty&&(e.polygonOffset(this._depthOffsetState.states[this.RS_SLOPESCALEDEPTHBIAS],this._depthOffsetState.states[this.RS_DEPTHBIAS]),this._depthOffsetState.dirty=!1);var s=void 0,u=void 0,l=void 0;if(this.shadowHandles&&this._alphaTestState.states[this.RS_ALPHATESTENABLE]){switch(this._alphaTestState.states[this.RS_ALPHAFUNC]){case this.CMP_NEVER:s=0,u=1,l=-256;break;case this.CMP_LESS:s=0,u=-1,l=this._alphaTestState.states[this.RS_ALPHAREF]-1;break;case this.CMP_EQUAL:s=1,u=0,l=this._alphaTestState.states[this.RS_ALPHAREF];break;case this.CMP_LEQUAL:s=0,u=-1,l=this._alphaTestState.states[this.RS_ALPHAREF];break;case this.CMP_GREATER:s=0,u=1,l=-this._alphaTestState.states[this.RS_ALPHAREF]-1;break;case this.CMP_GREATEREQUAL:s=0,u=1,l=-this._alphaTestState.states[this.RS_ALPHAREF];break;default:s=0,u=0,l=1}e.uniform4f(this.shadowHandles.shadowStateInt,u,l,s,0)}}},{key:"SetStandardStates",value:function(e){if(this._currentRenderMode!==e){switch(this.gl.frontFace(this.gl.CW),e){case this.RM_OPAQUE:case this.RM_PICKABLE:case this.RM_DISTORTION:this.SetRenderState(this.RS_ZENABLE,!0),this.SetRenderState(this.RS_ZWRITEENABLE,!0),this.SetRenderState(this.RS_ZFUNC,this.CMP_LEQUAL),this.SetRenderState(this.RS_CULLMODE,this.CULL_CW),this.SetRenderState(this.RS_ALPHABLENDENABLE,!1),this.SetRenderState(this.RS_ALPHATESTENABLE,!1),this.SetRenderState(this.RS_SEPARATEALPHABLENDENABLE,!1),this.SetRenderState(this.RS_SLOPESCALEDEPTHBIAS,0),this.SetRenderState(this.RS_DEPTHBIAS,0),this.SetRenderState(this.RS_COLORWRITEENABLE,15);break;case this.RM_DECAL:this.SetRenderState(this.RS_ALPHABLENDENABLE,!1),this.SetRenderState(this.RS_ALPHATESTENABLE,!0),this.SetRenderState(this.RS_ALPHAFUNC,this.CMP_GREATER),this.SetRenderState(this.RS_ALPHAREF,127),this.SetRenderState(this.RS_ZENABLE,!0),this.SetRenderState(this.RS_ZWRITEENABLE,!0),this.SetRenderState(this.RS_ZFUNC,this.CMP_LEQUAL),this.SetRenderState(this.RS_CULLMODE,this.CULL_CW),this.SetRenderState(this.RS_BLENDOP,this.BLENDOP_ADD),this.SetRenderState(this.RS_SLOPESCALEDEPTHBIAS,0),this.SetRenderState(this.RS_DEPTHBIAS,0),this.SetRenderState(this.RS_SEPARATEALPHABLENDENABLE,!1),this.SetRenderState(this.RS_COLORWRITEENABLE,15);break;case this.RM_TRANSPARENT:this.SetRenderState(this.RS_CULLMODE,this.CULL_CW),this.SetRenderState(this.RS_ALPHABLENDENABLE,!0),this.SetRenderState(this.RS_SRCBLEND,this.BLEND_SRCALPHA),this.SetRenderState(this.RS_DESTBLEND,this.BLEND_INVSRCALPHA),this.SetRenderState(this.RS_BLENDOP,this.BLENDOP_ADD),this.SetRenderState(this.RS_ZENABLE,!0),this.SetRenderState(this.RS_ZWRITEENABLE,!1),this.SetRenderState(this.RS_ZFUNC,this.CMP_LEQUAL),this.SetRenderState(this.RS_ALPHATESTENABLE,!1),this.SetRenderState(this.RS_SLOPESCALEDEPTHBIAS,0),this.SetRenderState(this.RS_DEPTHBIAS,0),this.SetRenderState(this.RS_SEPARATEALPHABLENDENABLE,!1),this.SetRenderState(this.RS_COLORWRITEENABLE,15);break;case this.RM_ADDITIVE:this.SetRenderState(this.RS_CULLMODE,this.CULL_NONE),this.SetRenderState(this.RS_ALPHABLENDENABLE,!0),this.SetRenderState(this.RS_SRCBLEND,this.BLEND_ONE),this.SetRenderState(this.RS_DESTBLEND,this.BLEND_ONE),this.SetRenderState(this.RS_BLENDOP,this.BLENDOP_ADD),this.SetRenderState(this.RS_ZENABLE,!0),this.SetRenderState(this.RS_ZWRITEENABLE,!1),this.SetRenderState(this.RS_ZFUNC,this.CMP_LEQUAL),this.SetRenderState(this.RS_ALPHATESTENABLE,!1),this.SetRenderState(this.RS_SLOPESCALEDEPTHBIAS,0),this.SetRenderState(this.RS_DEPTHBIAS,0),this.SetRenderState(this.RS_SEPARATEALPHABLENDENABLE,!1),this.SetRenderState(this.RS_COLORWRITEENABLE,15);break;case this.RM_FULLSCREEN:this.SetRenderState(this.RS_ALPHABLENDENABLE,!1),this.SetRenderState(this.RS_ALPHATESTENABLE,!1),this.SetRenderState(this.RS_CULLMODE,this.CULL_NONE),this.SetRenderState(this.RS_ZENABLE,!1),this.SetRenderState(this.RS_ZWRITEENABLE,!1),this.SetRenderState(this.RS_ZFUNC,this.CMP_ALWAYS),this.SetRenderState(this.RS_SLOPESCALEDEPTHBIAS,0),this.SetRenderState(this.RS_DEPTHBIAS,0),this.SetRenderState(this.RS_SEPARATEALPHABLENDENABLE,!1),this.SetRenderState(this.RS_COLORWRITEENABLE,15);break;default:return}this._currentRenderMode=e}}}],[{key:"CreateContext",value:function(e,t,r){r=Array.isArray(r)?r:[r];for(var n=0;n<r.length;n++)try{return e.getContext(r[n],t)}catch(e){}return null}}]),t}(),n.Clock=Date,n.RequestAnimationFrame=function(){var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return v||(v=[]),v.push(window.setTimeout(e,1e3/60)),v.length-1};return function(t){return e(t)}}(),n.CancelAnimationFrame=function(){var e=window.cancelAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){if(v||(v=[]),void 0!==v[e])return window.clearTimeout(v[e]),v[e]=void 0,!0};return function(t){e(t)}}(),n.WebglVendorPrefixes=["","MOZ_","WEBKIT_","WEBGL_"],n.WebglContextNames=["webgl","experimental-webgl"],n.Webgl2ContextNames=["webgl2","experimental-webgl2"],n.WebglVersion={NONE:0,WEBGL:1,WEBGL2:2},i),v=void 0;d.prototype.RM_ANY=-1,d.prototype.RM_OPAQUE=0,d.prototype.RM_DECAL=1,d.prototype.RM_TRANSPARENT=2,d.prototype.RM_ADDITIVE=3,d.prototype.RM_DEPTH=4,d.prototype.RM_FULLSCREEN=5,d.prototype.RM_PICKABLE=6,d.prototype.RM_DISTORTION=7,d.prototype.RS_ZENABLE=7,d.prototype.RS_FILLMODE=8,d.prototype.RS_SHADEMODE=9,d.prototype.RS_ZWRITEENABLE=14,d.prototype.RS_ALPHATESTENABLE=15,d.prototype.RS_LASTPIXEL=16,d.prototype.RS_SRCBLEND=19,d.prototype.RS_DESTBLEND=20,d.prototype.RS_CULLMODE=22,d.prototype.RS_ZFUNC=23,d.prototype.RS_ALPHAREF=24,d.prototype.RS_ALPHAFUNC=25,d.prototype.RS_DITHERENABLE=26,d.prototype.RS_ALPHABLENDENABLE=27,d.prototype.RS_FOGENABLE=28,d.prototype.RS_SPECULARENABLE=29,d.prototype.RS_FOGCOLOR=34,d.prototype.RS_FOGTABLEMODE=35,d.prototype.RS_FOGSTART=36,d.prototype.RS_FOGEND=37,d.prototype.RS_FOGDENSITY=38,d.prototype.RS_RANGEFOGENABLE=48,d.prototype.RS_STENCILENABLE=52,d.prototype.RS_STENCILFAIL=53,d.prototype.RS_STENCILZFAIL=54,d.prototype.RS_STENCILPASS=55,d.prototype.RS_STENCILFUNC=56,d.prototype.RS_STENCILREF=57,d.prototype.RS_STENCILMASK=58,d.prototype.RS_STENCILWRITEMASK=59,d.prototype.RS_TEXTUREFACTOR=60,d.prototype.RS_WRAP0=128,d.prototype.RS_WRAP1=129,d.prototype.RS_WRAP2=130,d.prototype.RS_WRAP3=131,d.prototype.RS_WRAP4=132,d.prototype.RS_WRAP5=133,d.prototype.RS_WRAP6=134,d.prototype.RS_WRAP7=135,d.prototype.RS_CLIPPING=136,d.prototype.RS_LIGHTING=137,d.prototype.RS_AMBIENT=139,d.prototype.RS_FOGVERTEXMODE=140,d.prototype.RS_COLORVERTEX=141,d.prototype.RS_LOCALVIEWER=142,d.prototype.RS_NORMALIZENORMALS=143,d.prototype.RS_DIFFUSEMATERIALSOURCE=145,d.prototype.RS_SPECULARMATERIALSOURCE=146,d.prototype.RS_AMBIENTMATERIALSOURCE=147,d.prototype.RS_EMISSIVEMATERIALSOURCE=148,d.prototype.RS_VERTEXBLEND=151,d.prototype.RS_CLIPPLANEENABLE=152,d.prototype.RS_POINTSIZE=154,d.prototype.RS_POINTSIZE_MIN=155,d.prototype.RS_POINTSPRITEENABLE=156,d.prototype.RS_POINTSCALEENABLE=157,d.prototype.RS_POINTSCALE_A=158,d.prototype.RS_POINTSCALE_B=159,d.prototype.RS_POINTSCALE_C=160,d.prototype.RS_MULTISAMPLEANTIALIAS=161,d.prototype.RS_MULTISAMPLEMASK=162,d.prototype.RS_PATCHEDGESTYLE=163,d.prototype.RS_DEBUGMONITORTOKEN=165,d.prototype.RS_POINTSIZE_MAX=166,d.prototype.RS_INDEXEDVERTEXBLENDENABLE=167,d.prototype.RS_COLORWRITEENABLE=168,d.prototype.RS_TWEENFACTOR=170,d.prototype.RS_BLENDOP=171,d.prototype.RS_POSITIONDEGREE=172,d.prototype.RS_NORMALDEGREE=173,d.prototype.RS_SCISSORTESTENABLE=174,d.prototype.RS_SLOPESCALEDEPTHBIAS=175,d.prototype.RS_ANTIALIASEDLINEENABLE=176,d.prototype.RS_TWOSIDEDSTENCILMODE=185,d.prototype.RS_CCW_STENCILFAIL=186,d.prototype.RS_CCW_STENCILZFAIL=187,d.prototype.RS_CCW_STENCILPASS=188,d.prototype.RS_CCW_STENCILFUNC=189,d.prototype.RS_COLORWRITEENABLE1=190,d.prototype.RS_COLORWRITEENABLE2=191,d.prototype.RS_COLORWRITEENABLE3=192,d.prototype.RS_BLENDFACTOR=193,d.prototype.RS_SRGBWRITEENABLE=194,d.prototype.RS_DEPTHBIAS=195,d.prototype.RS_SEPARATEALPHABLENDENABLE=206,d.prototype.RS_SRCBLENDALPHA=207,d.prototype.RS_DESTBLENDALPHA=208,d.prototype.RS_BLENDOPALPHA=209,d.prototype.CULL_NONE=1,d.prototype.CULL_CW=2,d.prototype.CULL_CCW=3,d.prototype.CMP_NEVER=1,d.prototype.CMP_LESS=2,d.prototype.CMP_EQUAL=3,d.prototype.CMP_LEQUAL=4,d.prototype.CMP_GREATER=5,d.prototype.CMP_NOTEQUAL=6,d.prototype.CMP_GREATEREQUAL=7,d.prototype.CMP_ALWAYS=8,d.prototype.BLEND_ZERO=1,d.prototype.BLEND_ONE=2,d.prototype.BLEND_SRCCOLOR=3,d.prototype.BLEND_INVSRCCOLOR=4,d.prototype.BLEND_SRCALPHA=5,d.prototype.BLEND_INVSRCALPHA=6,d.prototype.BLEND_DESTALPHA=7,d.prototype.BLEND_INVDESTALPHA=8,d.prototype.BLEND_DESTCOLOR=9,d.prototype.BLEND_INVDESTCOLOR=10,d.prototype.BLEND_SRCALPHASAT=11,d.prototype.BLEND_BOTHSRCALPHA=12,d.prototype.BLEND_BOTHINVSRCALPHA=13,d.prototype.BLEND_BLENDFACTOR=14,d.prototype.BLEND_INVBLENDFACTOR=15,d.prototype.BLENDOP_ADD=1,d.prototype.BLENDOP_SUBTRACT=2,d.prototype.BLENDOP_REVSUBTRACT=3,d.prototype.BLENDOP_MIN=4,d.prototype.BLENDOP_MAX=5;t.device=new d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.assignIfExists=function(e,t,r){if(!t)return;r=(0,i.toArray)(r);for(var a=0;a<r.length;a++){var o=r[a];if(void 0!==t[o])if((0,n.isArrayLike)(e[o]))if((0,n.isTyped)(e[o]))if(e[o].length!==t[o].length){var s=e[o].constructor;e[o]=new s(t[o])}else e[o].set(t[o]);else{e[o]=e[o].splice(e[o].length,0);for(var u=0;u<t[o].length;u++)e[o].push(t[o][u])}else if((0,n.isTyped)(t[o])){var l=t[o].constructor;e[o]=new l(t[o])}else e[o]=t[o]}},t.get=function(e,t,r){return e&&t in e?e[t]:r},t.template=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.match(/%([^%]+)?%/g)||[],n=0;n<r.length;n++){var i=r[n],a=i.substring(1,i.length-1).split("="),o=a[0]in t?t[a[0]]:a[1];e=e.replace(i,o)}return e};var n=r(22),i=r(39)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.enableUUID=function(e){if(e===n)return;if(null!==n)throw new Error("Cannot change id generation type once set");if(e){a=[];for(var t=0;t<256;t++)a[t]=(t<16?"0":"")+t.toString(16).toUpperCase()}n=e},t.generateID=function(){null===n&&(n=!1);return n?function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return a[255&e]+a[e>>8&255]+a[e>>16&255]+a[e>>24&255]+"-"+a[255&t]+a[t>>8&255]+"-"+a[t>>16&15|64]+a[t>>24&255]+"-"+a[63&r|128]+a[r>>8&255]+"-"+a[r>>16&255]+a[r>>24&255]+a[255&n]+a[n>>8&255]+a[n>>16&255]+a[n>>24&255]}():i++};var n=null,i=0,a=null},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getURL=function(){return Object.assign({},n)},t.getURLString=function(e,t){return(e=e.toLowerCase())in n?n[e]:t},t.getURLInteger=function(e,t){return(e=e.toLowerCase())in n?parseInt(n[e],10):t},t.getURLFloat=function(e,t){return(e=e.toLowerCase())in n?parseFloat(n[e]):t},t.getURLBoolean=function(e,t){return(e=e.toLowerCase())in n?n[e]:t};for(var n={},i=window.location.search.substring(1).split("&"),a=0;a<i.length;a++){var o=i[a].split("="),s=o[0].toLowerCase(),u=unescape(o[1]);if(s){var l=u.toLowerCase();n[s]="true"===l||"false"!==l&&u}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.Tw2MotherLode=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._loadedObjects={},this._errors={}}return n(e,[{key:"AddError",value:function(e,t){return this._errors[e]=this._errors[e]||[],this._errors[e].includes(t)||(t.data=t.data||{},t.data.path=t.data.path||e,t.data.err=t.data.err||t,this._errors[e].push(t)),t}},{key:"GetErrors",value:function(e){return e&&e in this._errors?Object.assign([],this._errors[e]):null}},{key:"HasErrors",value:function(e){return e&&e in this._errors}},{key:"Find",value:function(e){return e in this._loadedObjects?this._loadedObjects[e]:null}},{key:"Add",value:function(e,t){this._loadedObjects[e]=t}},{key:"Remove",value:function(e){delete this._loadedObjects[e]}},{key:"Clear",value:function(){this._loadedObjects={}}},{key:"UnloadAndClear",value:function(){for(var e in this._loadedObjects)this._loadedObjects.hasOwnProperty(e)&&this._loadedObjects[e].Unload();this._loadedObjects={}}},{key:"PurgeInactive",value:function(e,t,r){for(var n in this._loadedObjects)if(this._loadedObjects.hasOwnProperty(n)){var i=this._loadedObjects[n];i.doNotPurge||(i.IsPurged()&&(i.OnUnloaded(),this.Remove(n)),i._isGood&&(e-i.activeFrame)%t>=r&&i.Unload()&&(i.OnUnloaded(),this.Remove(n)))}}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2SamplerOverride=void 0;var n=r(0),i=r(45);t.Tw2SamplerOverride=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="",this.addressU=0,this.addressV=0,this.addressW=0,this.filter=0,this.mipFilter=0,this.lodBias=0,this.maxMipLevel=0,this.maxAnisotropy=0;var t=null;this.GetSampler=function(e){if(!t){(t=new i.Tw2SamplerState).registerIndex=e.registerIndex,t.name=e.name;var r=n.device.wrapModes,a=n.device.gl;if(1===this.filter){switch(this.mipFilter){case 0:t.minFilter=a.NEAREST;break;case 1:t.minFilter=a.NEAREST_MIPMAP_NEAREST;break;default:t.minFilter=a.NEAREST_MIPMAP_LINEAR}t.minFilterNoMips=a.NEAREST}else{switch(this.mipFilter){case 0:t.minFilter=a.LINEAR;break;case 1:t.minFilter=a.LINEAR_MIPMAP_NEAREST;break;default:t.minFilter=a.LINEAR_MIPMAP_LINEAR}t.minFilterNoMips=a.LINEAR}3!==this.filter&&3!==this.mipFilter||(t.anisotropy=Math.max(this.maxAnisotropy,1)),t.magFilter=1===this.filter?a.NEAREST:a.LINEAR,t.addressU=r[this.addressU],t.addressV=r[this.addressV],t.addressW=r[this.addressW],t.samplerType=e.samplerType,t.isVolume=e.isVolume,t.ComputeHash()}return t}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2VertexDeclaration=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(46);(t.Tw2VertexDeclaration=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.elements=[],this._elementsSorted=[],void 0!==r&&(this.stride=r),t&&this.DeclareFromObject(t)}return n(e,[{key:"RebuildHash",value:function(){this._elementsSorted=[];for(var t=0;t<this.elements.length;++t)this._elementsSorted[t]=this.elements[t];this._elementsSorted.sort(e.CompareDeclarationElements)}},{key:"FindUsage",value:function(e,t){for(var r=0;r<this._elementsSorted.length;++r){var n=this._elementsSorted[r];if(n.usage===e){if(n.usageIndex===t)return n;if(n.usageIndex>t)return null}if(n.usage>e)return null}return null}},{key:"SetDeclaration",value:function(t,r){for(var n=i.device.gl,a=0,o=0;o<t._elementsSorted.length;++o){var s=t._elementsSorted[o];if(!(s.location<0))for(;;){if(a>=this._elementsSorted.length){n.disableVertexAttribArray(s.location),n.vertexAttrib4f(s.location,0,0,0,0);break}var u=this._elementsSorted[a],l=e.CompareDeclarationElements(u,s);if(l>0){n.disableVertexAttribArray(s.location),n.vertexAttrib4f(s.location,0,0,0,0);break}if(0===l){u.customSetter?u.customSetter(s):(n.enableVertexAttribArray(s.location),n.vertexAttribPointer(s.location,u.elements,u.type,!1,r,u.offset));break}a++}}return!0}},{key:"SetPartialDeclaration",value:function(t,r){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=i.device.ext,s=i.device.gl,u=[],l=0,c=0;c<t._elementsSorted.length;++c){var f=t._elementsSorted[c];if(!(f.location<0))for(;;){var h=this._elementsSorted[l],p=e.CompareDeclarationElements(h,f,n);if(0===p){h.customSetter?h.customSetter(f):(s.enableVertexAttribArray(f.location),s.vertexAttribPointer(f.location,h.elements,h.type,!1,r,h.offset),o.vertexAttribDivisor(f.location,a),a&&u.push(f.location));break}if(p>0){a||(s.disableVertexAttribArray(f.location),s.vertexAttrib4f(f.location,0,0,0,0));break}if(++l>=this._elementsSorted.length)return a||(s.disableVertexAttribArray(f.location),s.vertexAttrib4f(f.location,0,0,0,0)),u}}return u}},{key:"ResetInstanceDivisors",value:function(e){if(e)for(var t=0;t<e.length;++t)i.device.ext.vertexAttribDivisor(e[t],0)}},{key:"DeclareFromObject",value:function(t,r){this.elements.splice(0,this.elements.length);for(var n=0,o=0;o<t.length;o++){var s=t[o],u=void 0,l=void 0,c=void 0,f=void 0,h=void 0;i.util.isArray(s)?(u=s[0],l=s[1],f=s[2],c=s[3],h=s[4]):(u=s.usage,l=s.usageIndex,f=s.elements,c=s.type,h=s.offset),i.util.isString(u)&&(u=e.Type[u.toUpperCase()]),i.util.isNoU(c)&&(c="FLOAT"),i.util.isString(c)&&(c=i.device.gl[c.toUpperCase()]),i.util.isNoU(h)&&(h=n),this.elements.push(new a.Tw2VertexElement(u,l,c,f,h)),n+=4*f}void 0!==r&&(this.stride=r),this.RebuildHash()}}],[{key:"CompareDeclarationElements",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.usage<t.usage?-1:e.usage>t.usage?1:e.usageIndex+r<t.usageIndex?-1:e.usageIndex+r>t.usageIndex?1:0}}]),e}()).Type={POSITION:0,COLOR:1,NORMAL:2,TANGENT:3,BINORMAL:4,TEXCOORD:5,BLENDWEIGHT:6,BLENDINDICES:7}},function(e,t,r){(function(t){WebGLDebugUtils=function(){var e;void 0===e&&(e=t);var r=function(t){e.console&&e.console.error?e.console.error(t):function(t){e.console&&e.console.log&&e.console.log(t)}(t)},n={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},bindBuffer:{2:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}},bufferData:{3:{0:!0,2:!0},4:{0:!0,2:!0},5:{0:!0,2:!0}},bufferSubData:{3:{0:!0},4:{0:!0},5:{0:!0}},copyBufferSubData:{5:{0:!0,1:!0}},getBufferSubData:{3:{0:!0},4:{0:!0},5:{0:!0}},blitFramebuffer:{10:{8:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]},9:!0}},framebufferTextureLayer:{5:{0:!0,1:!0}},invalidateFramebuffer:{2:{0:!0}},invalidateSubFramebuffer:{6:{0:!0}},readBuffer:{1:{0:!0}},getInternalformatParameter:{3:{0:!0,1:!0,2:!0}},renderbufferStorageMultisample:{5:{0:!0,2:!0}},texStorage2D:{5:{0:!0,2:!0}},texStorage3D:{6:{0:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0},10:{0:!0,2:!0,6:!0,7:!0}},texImage3D:{10:{0:!0,2:!0,7:!0,8:!0},11:{0:!0,2:!0,7:!0,8:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0},10:{0:!0,6:!0,7:!0}},texSubImage3D:{11:{0:!0,8:!0,9:!0},12:{0:!0,8:!0,9:!0}},copyTexSubImage3D:{9:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0},8:{0:!0,2:!0},9:{0:!0,2:!0}},compressedTexImage3D:{8:{0:!0,2:!0},9:{0:!0,2:!0},10:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0},9:{0:!0,6:!0},10:{0:!0,6:!0}},compressedTexSubImage3D:{10:{0:!0,8:!0},11:{0:!0,8:!0},12:{0:!0,8:!0}},vertexAttribIPointer:{5:{2:!0}},drawArraysInstanced:{4:{0:!0}},drawElementsInstanced:{5:{0:!0,2:!0}},drawRangeElements:{6:{0:!0,4:!0}},readPixels:{7:{4:!0,5:!0},8:{4:!0,5:!0}},clearBufferfv:{3:{0:!0},4:{0:!0}},clearBufferiv:{3:{0:!0},4:{0:!0}},clearBufferuiv:{3:{0:!0},4:{0:!0}},clearBufferfi:{4:{0:!0}},beginQuery:{2:{0:!0}},endQuery:{1:{0:!0}},getQuery:{2:{0:!0,1:!0}},getQueryParameter:{2:{1:!0}},samplerParameteri:{3:{1:!0,2:!0}},samplerParameterf:{3:{1:!0}},getSamplerParameter:{2:{1:!0}},fenceSync:{2:{0:!0,1:{enumBitwiseOr:[]}}},clientWaitSync:{3:{1:{enumBitwiseOr:["SYNC_FLUSH_COMMANDS_BIT"]}}},waitSync:{3:{1:{enumBitwiseOr:[]}}},getSyncParameter:{2:{1:!0}},bindTransformFeedback:{2:{0:!0}},beginTransformFeedback:{1:{0:!0}},transformFeedbackVaryings:{3:{2:!0}},bindBufferBase:{3:{0:!0}},bindBufferRange:{5:{0:!0}},getIndexedParameter:{2:{0:!0}},getActiveUniforms:{3:{2:!0}},getActiveUniformBlockParameter:{3:{2:!0}}},i=null,a=null;function o(e){if(null==i)for(var t in i={},a={},e)"number"==typeof e[t]&&(i[e[t]]=t,a[t]=e[t])}function s(){if(null==i)throw"WebGLDebugUtils.init(ctx) not called"}function u(e){s();var t=i[e];return void 0!==t?"gl."+t:"/*UNKNOWN WebGL ENUM*/ 0x"+e.toString(16)}function l(e,t,r,i){var o;if(void 0!==(o=n[e])&&(void 0!==(o=o[t])&&o[r])){if("object"==typeof o[r]&&void 0!==o[r].enumBitwiseOr){for(var s=o[r].enumBitwiseOr,l=0,c=[],f=0;f<s.length;++f){var h=a[s[f]];0!=(i&h)&&(l|=h,c.push(u(h)))}return l===i?c.join(" | "):u(i)}return u(i)}return null===i?"null":void 0===i?"undefined":i.toString()}function c(e,t,r){e.__defineGetter__(r,function(){return t[r]}),e.__defineSetter__(r,function(e){t[r]=e})}function f(e){var t=!!e.createTransformFeedback;t&&e.bindVertexArray(null);var r=e.getParameter(e.MAX_VERTEX_ATTRIBS),n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n);for(var i=0;i<r;++i)e.disableVertexAttribArray(i),e.vertexAttribPointer(i,4,e.FLOAT,!1,0,0),e.vertexAttrib1f(i,0),t&&e.vertexAttribDivisor(i,0);e.deleteBuffer(n);var a=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(i=0;i<a;++i)e.activeTexture(e.TEXTURE0+i),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_2D,null),t&&(e.bindTexture(e.TEXTURE_2D_ARRAY,null),e.bindTexture(e.TEXTURE_3D,null),e.bindSampler(i,null));if(e.activeTexture(e.TEXTURE0),e.useProgram(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.DITHER),e.disable(e.SCISSOR_TEST),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.clearDepth(1),e.clearStencil(-1),e.colorMask(!0,!0,!0,!0),e.cullFace(e.BACK),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.UNPACK_COLORSPACE_CONVERSION_WEBGL&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.polygonOffset(0,0),e.sampleCoverage(1,!1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilMask(4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT),t){e.drawBuffers([e.BACK]),e.readBuffer(e.BACK),e.bindBuffer(e.COPY_READ_BUFFER,null),e.bindBuffer(e.COPY_WRITE_BUFFER,null),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),e.bindBuffer(e.PIXEL_UNPACK_BUFFER,null);var o=e.getParameter(e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS);for(i=0;i<o;++i)e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,i,null);var s=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);for(i=0;i<s;++i)e.bindBufferBase(e.UNIFORM_BUFFER,i,null);e.disable(e.RASTERIZER_DISCARD),e.pixelStorei(e.UNPACK_IMAGE_HEIGHT,0),e.pixelStorei(e.UNPACK_SKIP_IMAGES,0),e.pixelStorei(e.UNPACK_ROW_LENGTH,0),e.pixelStorei(e.UNPACK_SKIP_ROWS,0),e.pixelStorei(e.UNPACK_SKIP_PIXELS,0),e.pixelStorei(e.PACK_ROW_LENGTH,0),e.pixelStorei(e.PACK_SKIP_ROWS,0),e.pixelStorei(e.PACK_SKIP_PIXELS,0),e.hint(e.FRAGMENT_SHADER_DERIVATIVE_HINT,e.DONT_CARE)}for(;e.getError(););}return{init:o,mightBeEnum:function(e){return s(),void 0!==i[e]},glEnumToString:u,glFunctionArgToString:l,glFunctionArgsToString:function(e,t){for(var r="",n=t.length,i=0;i<n;++i)r+=(0==i?"":", ")+l(e,n,i,t[i]);return r},makeDebugContext:function e(t,n,i,a){a=a||t,o(t),n=n||function(e,t,n){for(var i="",a=n.length,o=0;o<a;++o)i+=(0==o?"":", ")+l(t,a,o,n[o]);r("WebGL error "+u(e)+" in "+t+"("+i+")")};var s={};function f(e,t){return function(){i&&i(t,arguments);var r=e[t].apply(e,arguments),o=a.getError();return 0!=o&&(s[o]=!0,n(o,t,arguments)),r}}var h={};for(var p in t)if("function"==typeof t[p])if("getExtension"!=p)h[p]=f(t,p);else{var d=f(t,p);h[p]=function(){var r=d.apply(t,arguments);return r?e(r,n,i,a):null}}else c(h,t,p);return h.getError=function(){for(var e in s)if(s.hasOwnProperty(e)&&s[e])return s[e]=!1,e;return t.NO_ERROR},h},makeLostContextSimulatingCanvas:function(t){var r,n,i=[],a=[],o={},s=1,u=!1,l=[],h=0,p=0,d=!1,v=0,m={};function y(e){return"function"==typeof e?e:function(t){e.handleEvent(t)}}t.getContext=function(i){return function(){var a=i.apply(t,arguments);if(a instanceof WebGLRenderingContext||e.WebGL2RenderingContext&&a instanceof WebGL2RenderingContext){if(a!=r){if(r)throw"got different context";n=e.WebGL2RenderingContext&&a instanceof WebGL2RenderingContext,o=function(e){for(var t in e)"function"==typeof e[t]?o[t]=E(e,t):c(o,e,t);o.getError=function(){if(g(),!u)for(;e=r.getError();)m[e]=!0;for(var e in m)if(m[e])return delete m[e],e;return o.NO_ERROR};var i=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"];n&&i.push("createQuery","createSampler","fenceSync","createTransformFeedback","createVertexArray");for(var a=0;a<i.length;++a){var f=i[a];o[f]=function(t){return function(){if(g(),u)return null;var r=t.apply(e,arguments);return r.__webglDebugContextLostId__=s,l.push(r),r}}(e[f])}var h=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];n&&h.push("getInternalformatParameter","getQuery","getQueryParameter","getSamplerParameter","getSyncParameter","getTransformFeedbackVarying","getIndexedParameter","getUniformIndices","getActiveUniforms","getActiveUniformBlockParameter","getActiveUniformBlockName");for(var a=0;a<h.length;++a){var f=h[a];o[f]=function(t){return function(){return g(),u?null:t.apply(e,arguments)}}(o[f])}var p=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];n&&p.push("isQuery","isSampler","isSync","isTransformFeedback","isVertexArray");for(var a=0;a<p.length;++a){var f=p[a];o[f]=function(t){return function(){return g(),!u&&t.apply(e,arguments)}}(o[f])}return o.checkFramebufferStatus=function(t){return function(){return g(),u?o.FRAMEBUFFER_UNSUPPORTED:t.apply(e,arguments)}}(o.checkFramebufferStatus),o.getAttribLocation=function(t){return function(){return g(),u?-1:t.apply(e,arguments)}}(o.getAttribLocation),o.getVertexAttribOffset=function(t){return function(){return g(),u?0:t.apply(e,arguments)}}(o.getVertexAttribOffset),o.isContextLost=function(){return u},n&&(o.getFragDataLocation=function(t){return function(){return g(),u?-1:t.apply(e,arguments)}}(o.getFragDataLocation),o.clientWaitSync=function(t){return function(){return g(),u?o.WAIT_FAILED:t.apply(e,arguments)}}(o.clientWaitSync),o.getUniformBlockIndex=function(t){return function(){return g(),u?o.INVALID_INDEX:t.apply(e,arguments)}}(o.getUniformBlockIndex)),o}(r=a)}return o}return a}}(t.getContext);var b=function(e){i.push(y(e))},_=function(e){a.push(y(e))};function g(){++p,u||h==p&&t.loseContext()}function E(e,t){var r=e[t];return function(){if(g(),!u)return r.apply(e,arguments)}}function T(e){return{statusMessage:e,preventDefault:function(){d=!0}}}return function(e){var t=e.addEventListener;e.addEventListener=function(r,n,i){switch(r){case"webglcontextlost":b(n);break;case"webglcontextrestored":_(n);break;default:t.apply(e,arguments)}}}(t),t.loseContext=function(){if(!u){for(u=!0,h=0,++s;r.getError(););!function(){for(var e=Object.keys(m),t=0;t<e.length;++t)delete m[e[t]]}(),m[r.CONTEXT_LOST_WEBGL]=!0;var e=T("context lost"),n=i.slice();setTimeout(function(){for(var r=0;r<n.length;++r)n[r](e);v>=0&&setTimeout(function(){t.restoreContext()},v)},0)}},t.restoreContext=function(){u&&a.length&&setTimeout(function(){if(!d)throw"can not restore. webglcontestlost listener did not call event.preventDefault";!function(){for(var e=0;e<l.length;++e){var t=l[e];t instanceof WebGLBuffer?r.deleteBuffer(t):t instanceof WebGLFramebuffer?r.deleteFramebuffer(t):t instanceof WebGLProgram?r.deleteProgram(t):t instanceof WebGLRenderbuffer?r.deleteRenderbuffer(t):t instanceof WebGLShader?r.deleteShader(t):t instanceof WebGLTexture?r.deleteTexture(t):n&&(t instanceof WebGLQuery?r.deleteQuery(t):t instanceof WebGLSampler?r.deleteSampler(t):t instanceof WebGLSync?r.deleteSync(t):t instanceof WebGLTransformFeedback?r.deleteTransformFeedback(t):t instanceof WebGLVertexArrayObject&&r.deleteVertexArray(t))}}(),f(r),u=!1,p=0,d=!1;for(var e=a.slice(),t=T("context restored"),i=0;i<e.length;++i)e[i](t)},0)},t.loseContextInNCalls=function(e){if(u)throw"You can not ask a lost contet to be lost";h=p+e},t.getNumCalls=function(){return p},t.setRestoreTimeout=function(e){v=e},t},resetToInitialState:f}}(),e.exports=WebGLDebugUtils}).call(t,r(89))},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logger=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(15),a=r(5);var o=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.name=e,r.display=!0,r.visible={},r.visible.log=!0,r.visible.info=!0,r.visible.debug=!1,r.visible.warn=!0,r.visible.error=!0,r.maxLogs=100,r._logs=[],r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Tw2EventEmitter),n(t,[{key:"log",value:function(e){if(e.logged)return e;if(e.type=t.Type[e.type?e.type.toUpperCase():"LOG"]||"log",e.message=e.message||"",e.title=e.title||"",!e.hide&&this.display&&this.visible[e.type]){var r=this.name+" "+e.title+":";e.err?(console.group(r,e.message),e.err&&console.debug(e.err.stack||e.err.toString()),console.groupEnd()):console[e.type](r,e.message)}return this.maxLogs?(this._logs.length>=this.maxLogs&&this._logs.splice(this.maxLogs,this._logs.length-1),this._logs.unshift(e)):this._logs=[],this.emit(e.type,e),e.logged=!0,e}},{key:"GetLogs",value:function(e){return Object.assign([],void 0===e?this._logs:this._logs.splice(0,e))}},{key:"Set",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,a.assignIfExists)(this,e,["name","maxLogs","display"]),(0,a.assignIfExists)(this.visible,e.visible,["log","info","debug","warn","error"])}}]),t}();o.Type={ERROR:"error",WARNING:"warn",INFO:"info",LOG:"log",DEBUG:"debug"};var s=t.logger=new o("CCPWGL");i.Tw2EventEmitter.logger=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ForwardingRenderBatch=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(25);t.Tw2ForwardingRenderBatch=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.geometryProvider=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Tw2RenderBatch),n(t,[{key:"Commit",value:function(e){this.geometryProvider&&this.geometryProvider.Render(this,e)}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2GeometryLineBatch=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(26);t.Tw2GeometryLineBatch=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Tw2GeometryBatch),n(t,[{key:"Commit",value:function(e){this.geometryRes&&this.effect&&this.geometryRes.RenderLines(this.meshIx,this.start,this.count,this.effect,e)}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2InstancedMeshBatch=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(26);t.Tw2InstancedMeshBatch=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.instanceMesh=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Tw2GeometryBatch),n(t,[{key:"Commit",value:function(e){this.instanceMesh&&this.effect&&this.instanceMesh.RenderAreas(this.meshIx,this.start,this.count,this.effect,e)}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(95);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r(96);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2CurveSet=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);t.Tw2CurveSet=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.name="",this.curves=[],this.bindings=[],this.scale=1,this.playOnLoad=!0,this.isPlaying=!1,this.scaledTime=0}return n(e,[{key:"Initialize",value:function(){this.playOnLoad&&this.Play()}},{key:"Play",value:function(){this.isPlaying=!0,this.scaledTime=0}},{key:"PlayFrom",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.isPlaying=!0,this.scaledTime=e}},{key:"Stop",value:function(){this.isPlaying=!1}},{key:"Update",value:function(e){if(this.isPlaying){this.scaledTime+=e*this.scale;for(var t=0;t<this.curves.length;++t)this.curves[t].UpdateValue(this.scaledTime);for(var r=0;r<this.bindings.length;++r)this.bindings[r].CopyValue()}}},{key:"GetMaxCurveDuration",value:function(){for(var e=0,t=0;t<this.curves.length;++t)"GetLength"in this.curves[t]&&(e=Math.max(e,this.curves[t].GetLength()));return e}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ValueBinding=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(0),o=r(27);t.Tw2ValueBinding=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=a.util.generateID(),this.name="",this.sourceObject=null,this.sourceAttribute="",this._sourceElement=null,this.sourceIsArray=null,this.destinationObject=null,this.destinationAttribute="",this._destinationElement=null,this.destinationIsArray=null,this.scale=1,this.offset=a.quat.create(),this._copyFunc=null}return i(e,[{key:"Initialize",value:function(){if(this.sourceObject&&""!==this.sourceAttribute&&this.destinationObject&&""!==this.destinationAttribute){var t=!1,r=!1,i=this.sourceAttribute.substr(-2);".x"===i||".r"===i?(t=!0,this._sourceElement=0,this.sourceAttribute=this.sourceAttribute.substr(0,this.sourceAttribute.length-2)):".y"===i||".g"===i?(t=!0,this._sourceElement=1,this.sourceAttribute=this.sourceAttribute.substr(0,this.sourceAttribute.length-2)):".z"===i||".b"===i?(t=!0,this._sourceElement=2,this.sourceAttribute=this.sourceAttribute.substr(0,this.sourceAttribute.length-2)):".w"===i||".a"===i?(t=!0,this._sourceElement=3,this.sourceAttribute=this.sourceAttribute.substr(0,this.sourceAttribute.length-2)):this.sourceObject instanceof o.Tw2Vector4Parameter&&("v1"===this.sourceAttribute?(t=!0,this._sourceElement=0,this.sourceAttribute="value"):"v2"===this.sourceAttribute?(t=!0,this._sourceElement=1,this.sourceAttribute="value"):"v3"===this.sourceAttribute?(t=!0,this._sourceElement=2,this.sourceAttribute="value"):"v4"===this.sourceAttribute&&(t=!0,this._sourceElement=3,this.sourceAttribute="value"));var s=this.destinationAttribute.substr(-2);".x"===s||".r"===s?(r=!0,this._destinationElement=0,this.destinationAttribute=this.destinationAttribute.substr(0,this.destinationAttribute.length-2)):".y"===s||".g"===s?(r=!0,this._destinationElement=1,this.destinationAttribute=this.destinationAttribute.substr(0,this.destinationAttribute.length-2)):".z"===s||".b"===s?(r=!0,this._destinationElement=2,this.destinationAttribute=this.destinationAttribute.substr(0,this.destinationAttribute.length-2)):".w"===s||".a"===s?(r=!0,this._destinationElement=3,this.destinationAttribute=this.destinationAttribute.substr(0,this.destinationAttribute.length-2)):this.destinationObject instanceof o.Tw2Vector4Parameter&&("v1"===this.destinationAttribute?(r=!0,this._destinationElement=0,this.destinationAttribute="value"):"v2"===this.destinationAttribute?(r=!0,this._destinationElement=1,this.destinationAttribute="value"):"v3"===this.destinationAttribute?(r=!0,this._destinationElement=2,this.destinationAttribute="value"):"v4"===this.destinationAttribute&&(r=!0,this._destinationElement=3,this.destinationAttribute="value")),this.sourceAttribute in this.sourceObject&&this.destinationAttribute in this.destinationObject&&(this.sourceIsArray=a.util.isArrayLike(this.sourceObject[this.sourceAttribute]),this.destinationIsArray=a.util.isArrayLike(this.destinationObject[this.destinationAttribute]),this.sourceIsArray===this.destinationIsArray&&n(this.sourceObject[this.sourceAttribute])===n(this.destinationObject[this.destinationAttribute])?this.sourceIsArray?t?this._copyFunc=r?e.CopyElementToElement:e.ReplicateElement:this.sourceObject[this.sourceAttribute].length<=this.destinationObject[this.destinationAttribute].length?this._copyFunc=e.CopyArray:16===this.sourceObject[this.sourceAttribute].length&&(this._copyFunc=e.ExtractPos):this._copyFunc=e.CopyValueToValue:this.sourceIsArray&&t&&a.util.isNumber(this.destinationObject[this.destinationAttribute])?this._copyFunc=e.CopyElementToValue:this.destinationIsArray&&a.util.isNumber(this.sourceObject[this.sourceAttribute])?this._copyFunc=r?e.CopyValueToElement:e.ReplicateValue:a.util.isNumber(this.sourceObject[this.sourceAttribute])&&a.util.isBoolean(this.destinationObject[this.destinationAttribute])&&(this._copyFunc=e.CopyFloatToBoolean))}}},{key:"CopyValue",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;this._copyFunc&&(this._copyFunc.call(this),"OnValueChanged"in this.destinationObject&&this.destinationObject.OnValueChanged(e,[this.destinationAttribute]))}}],[{key:"CopyValueToValue",value:function(){this.destinationObject[this.destinationAttribute]=this.sourceObject[this.sourceAttribute]*this.scale+this.offset[0]}},{key:"CopyArray",value:function(){for(var e=Math.min(this.destinationObject[this.destinationAttribute].length,this.sourceObject[this.sourceAttribute].length),t=0;t<e;++t)this.destinationObject[this.destinationAttribute][t]=this.sourceObject[this.sourceAttribute][t]*this.scale+this.offset[t]}},{key:"CopyElementToElement",value:function(){this.destinationObject[this.destinationAttribute][this._destinationElement]=this.sourceObject[this.sourceAttribute][this._sourceElement]*this.scale+this.offset[0]}},{key:"ReplicateValue",value:function(){for(var e=0;e<this.destinationObject[this.destinationAttribute].length;++e)this.destinationObject[this.destinationAttribute][e]=this.sourceObject[this.sourceAttribute]*this.scale+this.offset[e]}},{key:"ReplicateElement",value:function(){for(var e=0;e<this.destinationObject[this.destinationAttribute].length;++e)this.destinationObject[this.destinationAttribute][e]=this.sourceObject[this.sourceAttribute][this._sourceElement]*this.scale+this.offset[e]}},{key:"ExtractPos",value:function(){for(var e=0;e<this.destinationObject[this.destinationAttribute].length;++e)this.destinationObject[this.destinationAttribute][e]=this.sourceObject[this.sourceAttribute][e+12]*this.scale+this.offset[e]}},{key:"CopyElementToValue",value:function(){this.destinationObject[this.destinationAttribute]=this.sourceObject[this.sourceAttribute][this._sourceElement]*this.scale+this.offset[0]}},{key:"CopyValueToElement",value:function(){this.destinationObject[this.destinationAttribute][this._destinationElement]=this.sourceObject[this.sourceAttribute]*this.scale+this.offset[0]}},{key:"CopyFloatToBoolean",value:function(){this.destinationObject[this.destinationAttribute]=0!==this.sourceObject[this.sourceAttribute]}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2FloatParameter=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(4),a=r(0);(t.Tw2FloatParameter=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.value=a.util.isArrayLike(r)?r[0]:r,n.constantBuffer=null,n.offset=null,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Tw2Parameter),n(t,[{key:"SetValue",value:function(e){this.value=e,this.OnValueChanged()}},{key:"GetValue",value:function(){return this.value}},{key:"Apply",value:function(e,t){e[t]=this.value}},{key:"EqualsValue",value:function(e){return this.value===e}},{key:"Copy",value:function(e,t){t&&(this.name=e.name),this.SetValue(e.GetValue())}}],[{key:"isValue",value:function(e){return a.util.isNumber(e)}}]),t}()).constantBufferSize=1},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2MatrixParameter=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(4);(t.Tw2MatrixParameter=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.mat4.create();return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2VectorParameter),n(t,[{key:"Compose",value:function(e,t,r){"value"in e&&(e=e.value),"value"in t&&(t=t.value),"value"in r&&(r=r.value),i.mat4.fromRotationTranslationScale(this.value,e,t,r),this.OnValueChanged()}},{key:"Decompose",value:function(e,t,r){i.mat4.getRotation("value"in e?e.value:e,this.value),i.mat4.getTranslation("value"in t?t.value:t,this.value),i.mat4.getScaling("value"in r?r.value:r,this.value),"OnValueChanged"in e&&e.OnValueChanged(),"OnValueChanged"in t&&t.OnValueChanged(),"OnValueChanged"in r&&r.OnValueChanged()}},{key:"x",get:function(){return this.GetIndexValue(12)},set:function(e){this.SetIndexValue(12,e)}},{key:"y",get:function(){return this.GetIndexValue(13)},set:function(e){this.SetIndexValue(13,e)}},{key:"z",get:function(){return this.GetIndexValue(14)},set:function(e){this.SetIndexValue(14,e)}}]),t}()).constantBufferSize=16},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2TransformParameter=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(4);(t.Tw2TransformParameter=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.scaling=i.vec3.fromValues(1,1,1),r.rotationCenter=i.vec3.create(),r.rotation=i.quat.create(),r.translation=i.vec3.create(),r.transform=i.mat4.create(),r.worldTransform=i.mat4.create(),r.constantBuffer=null,r.offset=null,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2Parameter),n(t,[{key:"Initialize",value:function(){this.OnValueChanged()}},{key:"GetValue",value:function(e){return e?Array.from(this.transform):new Float32Array(this.transform)}},{key:"OnValueChanged",value:function(e,r){i.mat4.fromRotationTranslationScaleOrigin(this.transform,this.rotation,this.translation,this.scaling,this.rotationCenter),i.mat4.transpose(this.worldTransform,this.transform),function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"OnValueChanged",this).call(this,e,r)}},{key:"Bind",value:function(e,t,r){return!this.constantBuffer&&r>=this.size&&(this.constantBuffer=e,this.offset=t,this.Apply(e,t,r),!0)}},{key:"Apply",value:function(e,t,r){r>=this.constructor.constantBufferSize?e.set(this.worldTransform,t):e.set(this.worldTransform.subarray(0,r),t)}},{key:"Copy",value:function(e,t){t&&(this.name=e.name),i.quat.copy(this.rotation,e.rotation),i.vec3.copy(this.translation,e.translation),i.vec3.copy(this.scaling,e.scaling),i.vec3.copy(this.rotationCenter,e.rotationCenter),this.OnValueChanged()}}]),t}()).constantBufferSize=16},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2VariableParameter=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(4);t.Tw2VariableParameter=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.variableName=r,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2Parameter),n(t,[{key:"GetValue",value:function(e){return i.store.GetVariableValue(this.variableName,e)}},{key:"Apply",value:function(e,t,r){this.variable&&this.variable.Apply(e,t,r)}},{key:"AddCallback",value:function(){return!1}},{key:"Copy",value:function(e,t){t&&(this.name=e.name),this.variableName=e.variableName}},{key:"variable",get:function(){return i.store.GetVariable(this.variableName)}},{key:"size",get:function(){return this.variable?this.variable.size:0}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Vector2Parameter=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(4);(t.Tw2Vector2Parameter=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.vec2.fromValues(1,1);return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2VectorParameter),n(t,[{key:"x",get:function(){return this.GetIndexValue(0)},set:function(e){this.SetIndexValue(0,e)}},{key:"y",get:function(){return this.GetIndexValue(1)},set:function(e){this.SetIndexValue(1,e)}}]),t}()).constantBufferSize=2},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Vector3Parameter=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(4);(t.Tw2Vector3Parameter=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.vec3.fromValues(1,1,1);return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2VectorParameter),n(t,[{key:"x",get:function(){return this.GetIndexValue(0)},set:function(e){this.SetIndexValue(0,e)}},{key:"y",get:function(){return this.GetIndexValue(1)},set:function(e){this.SetIndexValue(1,e)}},{key:"z",get:function(){return this.GetIndexValue(2)},set:function(e){this.SetIndexValue(2,e)}}]),t}()).constantBufferSize=3},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Vector4Parameter=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(4);(t.Tw2Vector4Parameter=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.vec4.fromValues(1,1,1,1);return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2VectorParameter),n(t,[{key:"x",get:function(){return this.GetIndexValue(0)},set:function(e){this.SetIndexValue(0,e)}},{key:"y",get:function(){return this.GetIndexValue(1)},set:function(e){this.SetIndexValue(1,e)}},{key:"z",get:function(){return this.GetIndexValue(2)},set:function(e){this.SetIndexValue(2,e)}},{key:"w",get:function(){return this.GetIndexValue(3)},set:function(e){this.SetIndexValue(3,e)}}]),t}()).constantBufferSize=4},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(105);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r(47);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(28);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveBasicPerObjectData=t.Tw2BasicPerObjectData=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(n):void 0},a=r(0),o=r(47),s=r(28);var u=t.Tw2BasicPerObjectData=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.perObjectFFEData=null,e&&r.DeclareFromObject(e),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Tw2PerObjectData),n(t,[{key:"SetPerObjectDataToDevice",value:function(e){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"SetPerObjectDataToDevice",this).call(this,e),this.perObjectFFEData&&e[5]&&a.device.gl.uniform4fv(e[5],this.perObjectFFEData.data)}},{key:"DeclareFromObject",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"DeclareFromObject",this).call(this,e),e.FFEData&&(this.perObjectFFEData=new s.Tw2RawData(e.FFEData))}}]),t}();t.EveBasicPerObjectData=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2BlendShapeData=void 0;var n=r(12);t.Tw2BlendShapeData=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="",this.declaration=new n.Tw2VertexDeclaration,this.buffers=[],this.indexes=null,this.weightProxy=null}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Tw2GeometryAnimation=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="",this.duration=0,this.trackGroups=[]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2GeometryBone=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);(t.Tw2GeometryBone=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="",this.parentIndex=-1,this.position=i.vec3.create(),this.orientation=i.quat.create(),this.scaleShear=i.mat3.create(),this.localTransform=i.mat4.create(),this.worldTransform=i.mat4.create(),this.worldTransformInv=i.mat4.create()}return n(e,[{key:"UpdateTransform",value:function(){i.mat4.fromMat3(this.localTransform,this.scaleShear),i.quat.normalize(this.orientation,this.orientation);var t=i.mat4.fromQuat(e.global.mat4_0,this.orientation);return i.mat4.multiply(this.localTransform,this.localTransform,t),this.localTransform[12]=this.position[0],this.localTransform[13]=this.position[1],this.localTransform[14]=this.position[2],this.localTransform}}]),e}()).global={mat4_0:i.mat4.create()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Tw2GeometryCurve=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.dimension=0,this.degree=0,this.knots=null,this.controls=null}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2GeometryMesh=void 0;var n=r(0),i=r(12);t.Tw2GeometryMesh=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="",this.declaration=new i.Tw2VertexDeclaration,this.areas=[],this.buffer=null,this.bufferLength=0,this.bufferData=null,this.indexes=null,this.indexData=null,this.indexType=0,this.minBounds=n.vec3.create(),this.maxBounds=n.vec3.create(),this.boundsSpherePosition=n.vec3.create(),this.boundsSphereRadius=0,this.bones=[],this.boneBindings=[]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2GeometryMeshArea=void 0;var n=r(0);t.Tw2GeometryMeshArea=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="",this.start=0,this.count=0,this.minBounds=n.vec3.create(),this.maxBounds=n.vec3.create(),this.boundsSpherePosition=n.vec3.create(),this.boundsSphereRadius=0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Tw2GeometryMeshBinding=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mesh=null,this.bones=[]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.Tw2GeometryModel=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="",this.meshBindings=[],this.skeleton=null}return n(e,[{key:"FindBoneByName",value:function(e){if(!this.skeleton)return null;for(var t=0;t<this.skeleton.bones.length;++t)if(this.skeleton.bones[t].name===e)return this.skeleton.bones[t];return null}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Tw2GeometrySkeleton=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.bones=[]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Tw2GeometryTrackGroup=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="",this.model=null,this.transformTracks=[]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Tw2GeometryTransformTrack=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="",this.position=null,this.orientation=null,this.scaleShear=null}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(23);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r(118);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(49);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var o=r(50);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var s=r(119);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2InstancedMesh=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(n):void 0},a=r(0),o=r(18),s=r(49);t.Tw2InstancedMesh=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.instanceGeometryResource=null,e.instanceGeometryResPath="",e.instanceMeshIndex=0,e.minBounds=a.vec3.create(),e.maxBounds=a.vec3.create(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Tw2Mesh),n(t,[{key:"Initialize",value:function(){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"Initialize",this).call(this),""!==this.instanceGeometryResPath&&(this.instanceGeometryResource=a.resMan.GetResource(this.instanceGeometryResPath))}},{key:"IsGood",value:function(){var e=this.instanceGeometryResource,r=i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"IsGood",this).call(this),n=!!e&&(!e.IsGood||e.IsGood());return r&&n}},{key:"GetResources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"GetResources",this).call(this,e),this.instanceGeometryResource&&"GetResources"in this.instanceGeometryResource&&this.instanceGeometryResource.GetResources(e),e}},{key:"RenderAreas",value:function(e,t,r,n,i){if(this.IsGood()){var a=this.instanceGeometryResource.GetInstanceBuffer(this.instanceMeshIndex);a&&this.geometryResource.RenderAreasInstanced(e,t,r,n,i,a,this.instanceGeometryResource.GetInstanceDeclaration(this.instanceMeshIndex),this.instanceGeometryResource.GetInstanceStride(this.instanceMeshIndex),this.instanceGeometryResource.GetInstanceCount(this.instanceMeshIndex))}}}],[{key:"GetAreaBatches",value:function(e,t,r,n,i){for(var a=0;a<t.length;++a){var s=t[a];if(s.effect&&s.display){var u=new o.Tw2InstancedMeshBatch;u.renderMode=r,u.perObjectData=i,u.instanceMesh=e,u.meshIx=s.meshIndex,u.start=s.index,u.count=s.count,u.effect=s.effect,n.Commit(u)}}}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2MeshLineArea=void 0;var n=r(18),i=r(50);(t.Tw2MeshLineArea=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Tw2MeshArea),t}()).batchType=n.Tw2GeometryLineBatch},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(51);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r(121);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(53);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var o=r(54);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var s=r(55);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var u=r(56);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2AnimationController=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(52),o=r(51),s=r(53),u=r(54),l=r(55),c=r(56);(t.Tw2AnimationController=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.geometryResources=[],this.models=[],this.animations=[],this.meshBindings=[],this.loaded=!1,this.update=!0,this.pendingCommands=[],this.onPendingCleared=null,this._geometryResource=null,t&&this.SetGeometryResource(t)}return n(e,[{key:"GetAnimationsByName",value:function(){if(!this.loaded)return null;for(var e={},t=0;t<this.animations.length;t++)e[this.animations[t].animationRes.name]=this.animations[t];return e}},{key:"GetAnimation",value:function(e){for(var t=0;t<this.animations.length;t++)if(this.animations[t].animationRes.name===e)return this.animations[t];return null}},{key:"ResetAnimation",value:function(e){var t=this.GetAnimation(e);if(t)return t.time=0,t.isPlaying=!1,t.callback=null,!0}},{key:"PlayAnimation",value:function(e,t,r){if(0===this.animations.length)return this.pendingCommands.push({func:this.PlayAnimation,args:[e,t,r]}),!0;var n=this.GetAnimation(e);return n?(n.time=0,n.isPlaying=!0,i.util.isUndefined(t)||(n.cycle=t),r&&(n.callback=r),!0):void 0}},{key:"PlayAnimationFrom",value:function(e,t,r,n){if(0===this.animations.length)return this.pendingCommands.push({func:this.PlayAnimationFrom,args:[e,t,r,n]}),!0;var a=this.GetAnimation(e);return a?(a.time=Math.max(Math.min(t,a.animationRes.duration),0),a.isPlaying=!0,i.util.isUndefined(r)||(a.cycle=r),n&&(a.callback=n),!0):void 0}},{key:"GetPlayingAnimations",value:function(){for(var e=[],t=0;t<this.animations.length;t++)this.animations[t].isPlaying&&e.push(this.animations[t].animationRes.name);return e}},{key:"StopAnimation",value:function(e){if(0!==this.animations.length){e=i.util.toArray(e);for(var t={},r=0;r<e.length;r++)t[e[r]]=!0;for(var n=0;n<this.animations.length;++n)this.animations[n].animationRes.name in t&&(this.animations[n].isPlaying=!1)}else this.pendingCommands.push({func:this.StopAnimation,args:e})}},{key:"StopAllAnimations",value:function(){if(0!==this.animations.length)for(var e=0;e<this.animations.length;++e)this.animations[e].isPlaying=!1;else this.pendingCommands.push({func:this.StopAllAnimations,args:null})}},{key:"StopAllAnimationsExcept",value:function(e){if(0!==this.animations.length){i.util.toArray(e);for(var t={},r=0;r<e.length;r++)t[e[r]]=!0;for(var n=0;n<this.animations.length;++n)this.animations[n].animationRes.name in t||(this.animations[n].isPlaying=!1)}else this.pendingCommands.push({func:this.StopAllAnimationsExcept,args:e})}},{key:"SetGeometryResource",value:function(e){this.models=[],this.animations=[],this.meshBindings=[];for(var t=0;t<this.geometryResources.length;++t)this.geometryResources[t].UnregisterNotification(this);this.loaded=!1,this.geometryResources=[],e&&(this.geometryResources.push(e),e.RegisterNotification(this))}},{key:"AddGeometryResource",value:function(e){for(var t=0;t<this.geometryResources.length;++t)if(this.geometryResources[t]===e)return;this.geometryResources.push(e),e.RegisterNotification(this)}},{key:"AddAnimationsFromRes",value:function(e){for(var t=0;t<e.animations.length;++t){for(var r=null,n=0;n<this.animations.length;++n)if(this.animations[n].animationRes===e.animations[t]){r=this.animations[t];break}r||((r=new o.Tw2Animation).animationRes=e.animations[t],this.animations.push(r));for(var i=0;i<r.animationRes.trackGroups.length;++i){for(var a=!1,s=0;s<r.trackGroups.length;++s)if(r.trackGroups[s].trackGroupRes===r.animationRes.trackGroups[i]){a=!0;break}if(!a){for(var u=null,f=0;f<this.models.length;++f)if(this.models[f].modelRes.name===r.animationRes.trackGroups[i].name){u=this.models[f];break}if(null!==u){var h=new c.Tw2TrackGroup;h.trackGroupRes=r.animationRes.trackGroups[i];for(var p=0;p<h.trackGroupRes.transformTracks.length;++p)for(var d=0;d<u.bones.length;++d)if(u.bones[d].boneRes.name===h.trackGroupRes.transformTracks[p].name){var v=new l.Tw2Track;v.trackRes=h.trackGroupRes.transformTracks[p],v.bone=u.bones[d],h.transformTracks.push(v);break}r.trackGroups.push(h)}}}}}},{key:"ResetBoneTransforms",value:function(){for(var t=0;t<this.models.length;++t)for(var r=0;r<this.models[t].bones.length;++r){var n=this.models[t].bones[r],a=n.boneRes;i.mat4.copy(n.localTransform,a.localTransform),-1!==a.parentIndex?i.mat4.multiply(n.worldTransform,n.localTransform,this.models[t].bones[n.boneRes.parentIndex].worldTransform):i.mat4.set(n.worldTransform,n.localTransform),i.mat4.identity(n.offsetTransform)}for(var o=i.mat4.identity(e.scratch.mat4_0),s=0;s<this.meshBindings.length;++s)for(var u=0;u<this.meshBindings[s].length;++u)for(var l=0;16*l<this.meshBindings[s][u].length;++l)for(var c=0;c<16;++c)this.meshBindings[s][u][16*l+c]=o[c]}},{key:"GetBoneMatrices",value:function(t,r){if(0===this.geometryResources.length)return new Float32Array;r||(r=this.geometryResources[0]);var n=e.FindMeshBindings(this,r);return n&&t<n.length?n[t]:new Float32Array}},{key:"FindModelForMesh",value:function(e,t){if(0===this.geometryResources.length)return null;if(t||(t=this.geometryResources[0]),!t.IsGood())return null;for(var r=t.meshes[e],n=0;n<this.models.length;++n)for(;0<this.models[n].modelRes.meshBindings.length;++n)if(this.models[n].modelRes.meshBindings[0].mesh===r)return this.models[n];return null}},{key:"GetResources",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=0;t<this.geometryResources.length;t++)e.includes(this.geometryResources[t])||e.push(this.geometryResources[t]);return e}},{key:"RebuildCachedData",value:function(t){for(var r=!1,n=0;n<this.geometryResources.length;++n)if(this.geometryResources[n]===t){r=!0;break}if(r){for(var i=0;i<this.geometryResources.length;++i)if(!this.geometryResources[i].IsGood())return;for(var a=0;a<this.geometryResources.length;++a)e.DoRebuildCachedData(this,this.geometryResources[a])}}},{key:"Update",value:function(t){if(this.models&&this.update){for(var r=0;r<this.geometryResources.length;++r)this.geometryResources[r].KeepAlive();for(var n=e.scratch,a=n.mat4_0,o=n.quat_0,s=n.vec3_0,u=n.mat3_0,l=0;l<this.animations.length;++l){var c=this.animations[l];if(c.isPlaying){var f=c.animationRes;c.time+=t*c.timeScale,c.time>f.duration&&(c.callback&&c.callback(this,c),c.cycle?c.time=c.time%f.duration:(c.isPlaying=!1,c.time=f.duration));for(var h=0;h<c.trackGroups.length;++h)for(var p=0;p<c.trackGroups[h].transformTracks.length;++p){var d=c.trackGroups[h].transformTracks[p];d.trackRes.position?i.curve.evaluate(d.trackRes.position,c.time,s,c.cycle,f.duration):s[0]=s[1]=s[2]=0,d.trackRes.orientation?(i.curve.evaluate(d.trackRes.orientation,c.time,o,c.cycle,f.duration),i.quat.normalize(o,o)):i.quat.identity(o),d.trackRes.scaleShear?i.curve.evaluate(d.trackRes.scaleShear,c.time,u,c.cycle,f.duration):i.mat3.identity(u),i.mat4.fromMat3(d.bone.localTransform,u),i.mat4.multiply(d.bone.localTransform,d.bone.localTransform,i.mat4.fromQuat(a,o)),d.bone.localTransform[12]=s[0],d.bone.localTransform[13]=s[1],d.bone.localTransform[14]=s[2]}}}for(var v=0;v<this.models.length;++v)for(var m=0;m<this.models[v].bones.length;++m){var y=this.models[v].bones[m];if(-1!==y.boneRes.parentIndex?i.mat4.multiply(y.worldTransform,this.models[v].bones[y.boneRes.parentIndex].worldTransform,y.localTransform):i.mat4.copy(y.worldTransform,y.localTransform),i.mat4.multiply(y.offsetTransform,y.worldTransform,y.boneRes.worldTransformInv),y.bindingArrays)for(var b=0;b<y.bindingArrays.length;++b)y.bindingArrays[b].array[y.bindingArrays[b].offset+0]=y.offsetTransform[0],y.bindingArrays[b].array[y.bindingArrays[b].offset+1]=y.offsetTransform[4],y.bindingArrays[b].array[y.bindingArrays[b].offset+2]=y.offsetTransform[8],y.bindingArrays[b].array[y.bindingArrays[b].offset+3]=y.offsetTransform[12],y.bindingArrays[b].array[y.bindingArrays[b].offset+4]=y.offsetTransform[1],y.bindingArrays[b].array[y.bindingArrays[b].offset+5]=y.offsetTransform[5],y.bindingArrays[b].array[y.bindingArrays[b].offset+6]=y.offsetTransform[9],y.bindingArrays[b].array[y.bindingArrays[b].offset+7]=y.offsetTransform[13],y.bindingArrays[b].array[y.bindingArrays[b].offset+8]=y.offsetTransform[2],y.bindingArrays[b].array[y.bindingArrays[b].offset+9]=y.offsetTransform[6],y.bindingArrays[b].array[y.bindingArrays[b].offset+10]=y.offsetTransform[10],y.bindingArrays[b].array[y.bindingArrays[b].offset+11]=y.offsetTransform[14]}}}},{key:"RenderDebugInfo",value:function(e){for(var t=0;t<this.models.length;++t)for(var r=0;r<this.models[t].bones.length;++r){var n=this.models[t].bones[r];if(n.boneRes.parentIndex>=0){var i=this.models[t].bones[n.boneRes.parentIndex];e.AddLine([n.worldTransform[12],n.worldTransform[13],n.worldTransform[14]],[i.worldTransform[12],i.worldTransform[13],i.worldTransform[14]])}}}}],[{key:"AddModel",value:function(e,t){for(var r=0;r<e.models.length;++r)if(e.models[r].modelRes.name===t.name)return null;var n=new u.Tw2Model;n.modelRes=t;var i=t.skeleton;if(null!==i)for(var a=0;a<i.bones.length;++a){var o=new s.Tw2Bone;o.boneRes=i.bones[a],n.bones.push(o),n.bonesByName[o.boneRes.name]=o}return e.models.push(n),n}},{key:"FindMeshBindings",value:function(e,t){for(var r=0;r<e.meshBindings.length;++r)if(e.meshBindings[r].resource===t)return e.meshBindings[r];return null}},{key:"DoRebuildCachedData",value:function(t,r){var n=[];if(r.meshes.length)for(var i=0;i<r.models.length;++i){var o=e.AddModel(t,r.models[i]);o&&n.push(o)}for(var s=0;s<t.geometryResources.length;++s)t.AddAnimationsFromRes(t.geometryResources[s]);if(0===r.models.length){for(var u=0;u<r.meshes.length;++u)a.Tw2GeometryRes.BindMeshToModel(r.meshes[u],t.geometryResources[0].models[0],r);r.models.push(t.geometryResources[0].models[0])}for(var l=0;l<r.models.length;++l){for(var c=null,f=0;f<t.models.length;++f)if(t.models[f].modelRes.name===r.models[l].name){c=t.models[f];break}if(null!==c)for(var h=0;h<r.models[l].meshBindings.length;++h){var p=r.meshes.indexOf(r.models[l].meshBindings[h].mesh),d=e.FindMeshBindings(t,r);null===d&&((d=[]).resource=r,t.meshBindings.push(d)),d[p]=new Float32Array(12*r.models[l].meshBindings[h].bones.length);for(var v=0;v<r.models[l].meshBindings[h].bones.length;++v)for(var m=0;m<c.bones.length;++m)if(c.bones[m].boneRes.name===r.models[l].meshBindings[h].bones[v].name){c.bones[m].bindingArrays||(c.bones[m].bindingArrays=[]),c.bones[m].bindingArrays[c.bones[m].bindingArrays.length]={array:d[p],offset:12*v};break}}}if(r.meshes.length&&r.models.length&&t.ResetBoneTransforms(),t.loaded=!0,t.animations.length){if(t.pendingCommands.length)for(var y=0;y<t.pendingCommands.length;++y)t.pendingCommands[y].args?t.pendingCommands[y].func.apply(t,t.pendingCommands[y].args):t.pendingCommands[y].func.apply(t);t.pendingCommands=[],t.onPendingCleared&&t.onPendingCleared(t)}}}]),e}()).scratch={vec3_0:i.vec3.create(),quat_0:i.quat.create(),mat3_0:i.mat3.create(),mat4_0:i.mat4.create()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2EffectRes=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(29),a=r(11),o=r(123),s=r(6);(t.Tw2EffectRes=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.passes=[],e.annotations={},e.permutations=[],e.offsets=[],e.reader=null,e.version=0,e.stringTable="",e.shaders={},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2Resource),n(t,[{key:"Prepare",value:function(e){this.permutations=[],this.offsets=[],this.passes=[],this.annotations={},this.reader=null,this.version=0,this.stringTable="",this.shaders={};var t=new i.Tw2BinaryReader(new Uint8Array(e)),r="";function n(){for(var e=t.ReadUInt32(),n=e;r.charCodeAt(n);)++n;return r.substr(e,n-e)}var a=t.ReadUInt32();if(a<2||a>7)this.OnError(new s.Tw2ShaderVersionError({path:this.path,version:a}));else{var o=void 0,u=void 0;if(a<5){if(0===(o=t.ReadUInt32()))return void this.OnError(new s.Tw2ShaderHeaderSizeError({path:this.path}));t.ReadUInt32();var l=t.ReadUInt32();t.cursor=8+3*o*4,u=t.ReadUInt32(),this.stringTableOffset=t.cursor,r=String.fromCharCode.apply(null,t.data.subarray(t.cursor,t.cursor+u)),t.cursor=l}else{u=t.ReadUInt32(),this.stringTableOffset=t.cursor,r=String.fromCharCode.apply(null,t.data.subarray(t.cursor,t.cursor+u)),t.cursor+=u;for(var c=t.ReadUInt8(),f=0;f<c;++f){for(var h={name:n(),defaultOption:t.ReadUInt8(),description:n(),type:t.ReadUInt8(),options:{},optionCount:t.ReadUInt8()},p=0;p<h.optionCount;++p)h.options[n()]=p;this.permutations.push(h)}if(0===(o=t.ReadUInt32()))return void this.OnError(new s.Tw2ShaderHeaderSizeError({path:this.path}));for(var d=0;d<o;++d)this.offsets.push({index:t.ReadUInt32(),offset:t.ReadUInt32(),size:t.ReadUInt32()});t.ReadUInt32(),t.cursor=t.ReadUInt32()}this.reader=t,this.version=a,this.stringTable=r,this.OnPrepared()}}},{key:"GetShader",value:function(e){if(!this.IsGood())return null;for(var t=0,r=1,n=0;n<this.permutations.length;++n){var i=this.permutations[n],a=i.defaultOption;if(e.hasOwnProperty(i.name)){var u=e[i.name];if(!i.options.hasOwnProperty(u))return this.OnError(new s.Tw2ShaderPermutationValueError({path:this.path,permutation:i.name,valueName:u})),null;a=i.options[u]}t+=a*r,r*=i.optionCount}if(this.shaders.hasOwnProperty(t))return this.shaders[t];this.reader.cursor=this.offsets[t].offset;var l=null;try{l=new o.Tw2Shader(this.reader,this.version,this.stringTable,this.stringTableOffset,this.path)}catch(e){return this.OnError(e),null}return this.shaders[t]=l,l}}]),t}()).prototype.requestResponseType="arraybuffer"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Shader=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(12),o=r(24),s=r(6);(t.Tw2Shader=function(){function e(t,r,n,s,u){function l(){for(var e=t.ReadUInt32(),r=e;n.charCodeAt(r);)++r;return n.substr(e,r-e)}!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.techniques={},this.annotations={};var c=i.device.wrapModes,f=i.device.gl,h=1;r>6&&(h=t.ReadUInt8());for(var p=0;p<h;++p){var d={name:"Main",passes:[]};r>6&&(d.name=l()),this.techniques[d.name]=d;for(var v=t.ReadUInt8(),m=0;m<v;++m){for(var y={stages:[{},{}]},b=t.ReadUInt8(),_=!0,g=0;g<b;++g){var E={};E.inputDefinition=new a.Tw2VertexDeclaration,E.constants=[],E.textures=[],E.samplers=[];for(var T=t.ReadUInt8(),O=t.ReadUInt8(),w=0;w<O;++w){var R=t.ReadUInt8();t.ReadUInt8();var S=t.ReadUInt8();t.ReadUInt8(),E.inputDefinition.elements[w]=new a.Tw2VertexElement(R,S,0)}E.inputDefinition.RebuildHash();var P=void 0,A=void 0,M=void 0,I=void 0;if(r<5)P=t.ReadUInt32(),A=t.data.subarray(t.cursor,t.cursor+P),t.cursor+=P,M=t.ReadUInt32(),I=t.data.subarray(t.cursor,t.cursor+M),t.cursor+=M;else{P=t.ReadUInt32();var j=t.ReadUInt32();A=n.substr(j,P),M=t.ReadUInt32(),j=t.ReadUInt32(),I=n.substr(j,M)}E.shader=e.CompileShader(T,"",A,u),_?(E.shadowShader=0===M?e.CompileShader(T,"\n#define PS\n",A,u,!0):e.CompileShader(T,"",I,u,!0),null===E.shadowShader&&(_=!1)):E.shadowShader=null,r>=3&&(t.ReadUInt32(),t.ReadUInt32(),t.ReadUInt32()),E.constantSize=0;for(var C=t.ReadUInt32(),k=0;k<C;++k){var D={};if(D.name=l(),D.offset=t.ReadUInt32()/4,D.size=t.ReadUInt32()/4,D.type=t.ReadUInt8(),D.dimension=t.ReadUInt8(),D.elements=t.ReadUInt32(),D.isSRGB=t.ReadUInt8(),D.isAutoregister=t.ReadUInt8(),E.constants[k]=D,!e.ConstantIgnore.includes(D.name)){var x=D.offset+D.size;x>E.constantSize&&(E.constantSize=x)}}var L=t.ReadUInt32()/4;if(E.constantValues=new Float32Array(L),r<5)for(var B=0;B<L;++B)E.constantValues[B]=t.ReadFloat32();else{var G=t.ReadUInt32(),F=t.cursor;t.cursor=s+G;for(var N=0;N<L;++N)E.constantValues[N]=t.ReadFloat32();t.cursor=F}E.constantSize=Math.max(E.constantSize,L);for(var U=t.ReadUInt8(),V=0;V<U;++V){var z={};z.registerIndex=t.ReadUInt8(),z.name=l(),z.type=t.ReadUInt8(),z.isSRGB=t.ReadUInt8(),z.isAutoregister=t.ReadUInt8(),E.textures.push(z)}for(var q=t.ReadUInt8(),H=0;H<q;++H){var Y=t.ReadUInt8(),W=r>=4?l():"";t.ReadUInt8();var X=t.ReadUInt8(),K=t.ReadUInt8(),Q=t.ReadUInt8(),Z=t.ReadUInt8(),J=t.ReadUInt8(),$=t.ReadUInt8();t.ReadFloat32();var ee=t.ReadUInt8();t.ReadUInt8();var te=i.quat.create();te[0]=t.ReadFloat32(),te[1]=t.ReadFloat32(),te[2]=t.ReadFloat32(),te[3]=t.ReadFloat32(),t.ReadFloat32(),t.ReadFloat32(),r<4&&t.ReadUInt8();var re=new o.Tw2SamplerState;if(re.registerIndex=Y,re.name=W,1===X){switch(Q){case 0:re.minFilter=f.NEAREST;break;case 1:re.minFilter=f.NEAREST_MIPMAP_NEAREST;break;default:re.minFilter=f.NEAREST_MIPMAP_LINEAR}re.minFilterNoMips=f.NEAREST}else{switch(Q){case 0:re.minFilter=f.LINEAR;break;case 1:re.minFilter=f.LINEAR_MIPMAP_NEAREST;break;default:re.minFilter=f.LINEAR_MIPMAP_LINEAR}re.minFilterNoMips=f.LINEAR}re.magFilter=1===K?f.NEAREST:f.LINEAR,re.addressU=c[Z],re.addressV=c[J],re.addressW=c[$],3!==X&&3!==K&&3!==Q||(re.anisotropy=Math.max(ee,1));for(var ne=0;ne<E.textures.length;++ne)if(E.textures[ne].registerIndex===re.registerIndex){re.samplerType=4===E.textures[ne].type?f.TEXTURE_CUBE_MAP:f.TEXTURE_2D,re.isVolume=3===E.textures[ne].type;break}re.ComputeHash(),E.samplers.push(re)}r>=3&&t.ReadUInt8(),y.stages[T]=E}y.states=[];for(var ie=t.ReadUInt8(),ae=0;ae<ie;++ae){var oe=t.ReadUInt32(),se=t.ReadUInt32();y.states.push({state:oe,value:se})}y.shaderProgram=e.CreateProgram(y.stages[0].shader,y.stages[1].shader,y,u),_?(y.shadowShaderProgram=e.CreateProgram(y.stages[0].shadowShader,y.stages[1].shadowShader,y,u,!0),null===y.shadowShaderProgram&&(y.shadowShaderProgram=y.shaderProgram)):y.shadowShaderProgram=y.shaderProgram,d.passes[m]=y}}for(var ue=t.ReadUInt16(),le=0;le<ue;++le){for(var ce=l(),fe=[],he=t.ReadUInt8(),pe=0;pe<he;++pe)switch(fe[pe]={},fe[pe].name=l(),fe[pe].type=t.ReadUInt8(),fe[pe].type){case 0:fe[pe].value=0!==t.ReadUInt32();break;case 1:fe[pe].value=t.ReadInt32();break;case 2:fe[pe].value=t.ReadFloat32();break;default:fe[pe].value=l()}this.annotations[ce]=fe}}return n(e,[{key:"ApplyPass",value:function(e,t){var r=i.device,n=r.gl;t=this.techniques[e].passes[t];for(var a=0;a<t.states.length;++a)r.SetRenderState(t.states[a].state,t.states[a].value);r.IsAlphaTestEnabled()?(n.useProgram(t.shadowShaderProgram.program),r.shadowHandles=t.shadowShaderProgram):(n.useProgram(t.shaderProgram.program),r.shadowHandles=null)}},{key:"HasConstant",value:function(e){return this.constructor.Has(this.techniques,"constants",e)}},{key:"HasTexture",value:function(e){return this.constructor.Has(this.techniques,"textures",e)}},{key:"HasSampler",value:function(e){return this.constructor.Has(this.techniques,"samplers",e)}}],[{key:"Has",value:function(e,t,r){for(var n in e)if(e.hasOwnProperty(n))for(var i=e[n],a=0;a<i.passes.length;a++)for(var o=i.passes[a],s=0;s<o.stages.length;s++)for(var u=o.stages[s],l=0;l<u[t].length;l++)if(u[t][l].name===r)return!0;return!1}},{key:"CompileShader",value:function(e,t,r,n,a){var o=i.device.ext,u=i.device.gl,l=u.createShader(0===e?u.VERTEX_SHADER:u.FRAGMENT_SHADER);if(o.ShaderBinary)o.ShaderBinary.shaderBinary(l,r);else{var c=t+(i.util.isString(r)?r:String.fromCharCode.apply(null,r));c=c.substr(0,c.length-1),u.shaderSource(l,c),u.compileShader(l)}if(!u.getShaderParameter(l,u.COMPILE_STATUS)){if(!a)throw new s.Tw2ShaderCompileError({path:n,shaderType:0===e?"vertex":"fragment",infoLog:u.getShaderInfoLog(l)});return null}return l}},{key:"CreateProgram",value:function(e,t,r,n,o){var u=i.device.gl,l={};if(l.program=u.createProgram(),u.attachShader(l.program,e),u.attachShader(l.program,t),u.linkProgram(l.program),!u.getProgramParameter(l.program,u.LINK_STATUS)){if(!o)throw new s.Tw2ShaderLinkError({path:n,infoLog:u.getProgramInfoLog(l.program)});return null}u.useProgram(l.program),l.constantBufferHandles=[];for(var c=0;c<16;++c)l.constantBufferHandles[c]=u.getUniformLocation(l.program,"cb"+c);l.samplerHandles=[];for(var f=0;f<16;++f)l.samplerHandles[f]=u.getUniformLocation(l.program,"s"+f),u.uniform1i(l.samplerHandles[f],f);for(var h=0;h<16;++h)l.samplerHandles[h+12]=u.getUniformLocation(l.program,"vs"+h),u.uniform1i(l.samplerHandles[h+12],h+12);l.input=new a.Tw2VertexDeclaration;for(var p=0;p<r.stages[0].inputDefinition.elements.length;++p){var d=u.getAttribLocation(l.program,"attr"+p);if(d>=0){var v=new a.Tw2VertexElement(r.stages[0].inputDefinition.elements[p].usage,r.stages[0].inputDefinition.elements[p].usageIndex);v.location=d,l.input.elements.push(v)}}l.input.RebuildHash(),l.shadowStateInt=u.getUniformLocation(l.program,"ssi"),l.shadowStateFloat=u.getUniformLocation(l.program,"ssf"),l.shadowStateYFlip=u.getUniformLocation(l.program,"ssyf"),u.uniform3f(l.shadowStateYFlip,0,0,1),l.volumeSlices=[];for(var m=0;m<r.stages[1].samplers.length;++m)r.stages[1].samplers[m].isVolume&&(l.volumeSlices[r.stages[1].samplers[m].registerIndex]=u.getUniformLocation(l.program,"s"+r.stages[1].samplers[m].registerIndex+"sl"));return l}}]),e}()).ConstantIgnore=["PerFrameVS","PerObjectVS","PerFramePS","PerObjectPS"]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2GeometryRes=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(29),o=r(12),s=r(11),u=r(6),l=r(48);(t.Tw2GeometryRes=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.meshes=[],e.minBounds=i.vec3.create(),e.maxBounds=i.vec3.create(),e.boundsSpherePosition=i.vec3.create(),e.boundsSphereRadius=0,e.models=[],e.animations=[],e.systemMirror=!1,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Tw2Resource),n(t,[{key:"GetInstanceBuffer",value:function(e){return e<this.meshes.length?this.meshes[e].buffer:void 0}},{key:"GetInstanceDeclaration",value:function(e){return this.meshes[e].declaration}},{key:"GetInstanceStride",value:function(e){return this.meshes[e].declaration.stride}},{key:"GetInstanceCount",value:function(e){return 4*this.meshes[e].bufferLength/this.meshes[e].declaration.stride}},{key:"Prepare",value:function(e){var r=i.device.gl,n=new a.Tw2BinaryReader(new Uint8Array(e));n.ReadUInt8();for(var o=n.ReadUInt8(),s=0;s<o;++s){var u=new l.Tw2GeometryMesh;u.name=n.ReadString();var c=t.ReadVertexBuffer(n,u.declaration,this.path);c?(u.bufferLength=c.length,u.buffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,u.buffer),r.bufferData(r.ARRAY_BUFFER,c,r.STATIC_DRAW)):u.buffer=null;var f=t.ReadIndexBuffer(n);f?(u.indexes=r.createBuffer(),u.indexType=2===f.BYTES_PER_ELEMENT?r.UNSIGNED_SHORT:r.UNSIGNED_INT,r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,u.indexes),r.bufferData(r.ELEMENT_ARRAY_BUFFER,f,r.STATIC_DRAW)):u.indexes=null;for(var h=n.ReadUInt8(),p=0;p<h;++p)u.areas[p]=new l.Tw2GeometryMeshArea,u.areas[p].name=n.ReadString(),u.areas[p].start=n.ReadUInt32()*f.BYTES_PER_ELEMENT,u.areas[p].count=3*n.ReadUInt32(),u.areas[p].minBounds=i.vec3.fromValues(n.ReadFloat32(),n.ReadFloat32(),n.ReadFloat32()),u.areas[p].maxBounds=i.vec3.fromValues(n.ReadFloat32(),n.ReadFloat32(),n.ReadFloat32());var d=n.ReadUInt8();u.boneBindings=[];for(var v=0;v<d;++v)u.boneBindings[v]=n.ReadString();var m=n.ReadUInt16();if((m||this.systemMirror)&&(u.bufferData=c,u.indexData=f),m){u.blendShapes=[];for(var y=0;y<m;++y)u.blendShapes[y]=new l.Tw2BlendShapeData,u.blendShapes[y].name=n.ReadString(),u.blendShapes[y].buffer=t.ReadVertexBuffer(n,u.blendShapes[y].declaration,this.path),u.blendShapes[y].indexes=t.ReadIndexBuffer(n)}this.meshes[s]=u}for(var b=n.ReadUInt8(),_=0;_<b;++_){var g=new l.Tw2GeometryModel;g.name=n.ReadString(),g.skeleton=new l.Tw2GeometrySkeleton;for(var E=n.ReadUInt8(),T=0;T<E;++T){var O=new l.Tw2GeometryBone;O.name=n.ReadString();var w=n.ReadUInt8();if(O.parentIndex=n.ReadUInt8(),255===O.parentIndex&&(O.parentIndex=-1),0!=(1&w)?i.vec3.set(O.position,n.ReadFloat32(),n.ReadFloat32(),n.ReadFloat32()):i.vec3.set(O.position,0,0,0),0!=(2&w)?i.quat.set(O.orientation,n.ReadFloat32(),n.ReadFloat32(),n.ReadFloat32(),n.ReadFloat32()):i.quat.identity(O.orientation),0!=(4&w))for(var R=0;R<9;++R)O.scaleShear[R]=n.ReadFloat32();else i.mat3.identity(O.scaleShear);g.skeleton.bones[T]=O}for(var S=0;S<g.skeleton.bones.length;++S)g.skeleton.bones[S].UpdateTransform(),-1!==g.skeleton.bones[S].parentIndex?i.mat4.multiply(g.skeleton.bones[S].worldTransform,g.skeleton.bones[g.skeleton.bones[S].parentIndex].worldTransform,g.skeleton.bones[S].localTransform):i.mat4.copy(g.skeleton.bones[S].worldTransform,g.skeleton.bones[S].localTransform),i.mat4.invert(g.skeleton.bones[S].worldTransformInv,g.skeleton.bones[S].worldTransform);for(var P=n.ReadUInt8(),A=0;A<P;++A){var M=n.ReadUInt8();M<this.meshes.length&&t.BindMeshToModel(this.meshes[M],g,this)}this.models[this.models.length]=g}for(var I=n.ReadUInt8(),j=0;j<I;++j){var C=new l.Tw2GeometryAnimation;C.name=n.ReadString(),C.duration=n.ReadFloat32();for(var k=n.ReadUInt8(),D=0;D<k;++D){var x=new l.Tw2GeometryTrackGroup;x.name=n.ReadString();for(var L=0;L<this.models.length;++L)if(this.models[L].name===x.name){x.model=this.models[L];break}for(var B=n.ReadUInt8(),G=0;G<B;++G){var F=new l.Tw2GeometryTransformTrack;if(F.name=n.ReadString(),F.orientation=t.ReadCurve(n),F.position=t.ReadCurve(n),F.scaleShear=t.ReadCurve(n),F.orientation)for(var N=0,U=0,V=0,z=0,q=0;q<F.orientation.controls.length;q+=4){var H=F.orientation.controls[q],Y=F.orientation.controls[q+1],W=F.orientation.controls[q+2],X=F.orientation.controls[q+3];N*H+U*Y+V*W+z*X<0&&(F.orientation.controls[q]=-H,F.orientation.controls[q+1]=-Y,F.orientation.controls[q+2]=-W,F.orientation.controls[q+3]=-X),N=H,U=Y,V=W,z=X}x.transformTracks[x.transformTracks.length]=F}C.trackGroups[C.trackGroups.length]=x}this.animations[this.animations.length]=C}this.OnPrepared()}},{key:"RenderAreasInstanced",value:function(e,t,r,n,a,o,s,u,l){if(this.KeepAlive(),!this.IsGood()||!n.IsGood()||e>=this.meshes.length)return!1;var c=i.device,f=c.ext,h=c.gl,p=this.meshes[e],d=n.GetPassCount(a);h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,p.indexes);for(var v=0;v<d;++v){n.ApplyPass(a,v);var m=n.GetPassInput(a,v);if(0!==m.elements.length){h.bindBuffer(h.ARRAY_BUFFER,p.buffer),p.declaration.SetPartialDeclaration(m,p.declaration.stride),h.bindBuffer(h.ARRAY_BUFFER,o);var y=s.SetPartialDeclaration(m,u,8,1);c.ApplyShadowState();for(var b=0;b<r;++b)if(b+t<p.areas.length){for(var _=p.areas[b+t],g=_.start,E=_.count;b+1<r&&(_=p.areas[b+1+t]).start===g+2*E;)E+=_.count,++b;f.drawElementsInstanced(h.TRIANGLES,E,p.indexType,g,l)}s.ResetInstanceDivisors(y)}}return!0}},{key:"RenderAreas",value:function(e,t,r,n,a){if(this.KeepAlive(),!this.IsGood()||!n.IsGood()||e>=this.meshes.length)return!1;var o=i.device,s=o.gl,l=this.meshes[e]||this.meshes[0],c=n.GetPassCount(a);s.bindBuffer(s.ARRAY_BUFFER,l.buffer),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,l.indexes);for(var f=0;f<c;++f){n.ApplyPass(a,f);var h=n.GetPassInput(a,f);if(!l.declaration.SetDeclaration(h,l.declaration.stride))return this.OnError(new u.Tw2GeometryMeshEffectBindError({path:this.path,pass:f,passInput:h,meshStride:l.declaration.stride})),!1;o.ApplyShadowState();for(var p=0;p<r;++p)if(p+t<l.areas.length){for(var d=l.areas[p+t],v=d.start,m=d.count;p+1<r&&(d=l.areas[p+1+t]).start===v+2*m;)m+=d.count,++p;s.drawElements(s.TRIANGLES,m,l.indexType,v)}}return!0}},{key:"RenderLines",value:function(e,t,r,n,a){if(this.KeepAlive(),!this.IsGood()||!n.IsGood()||e>=this.meshes.length)return!1;var o=i.device,s=o.gl,l=this.meshes[e],c=n.GetPassCount(a);s.bindBuffer(s.ARRAY_BUFFER,l.buffer),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,l.indexes);for(var f=0;f<c;++f){n.ApplyPass(a,f);var h=n.GetPassInput(a,f);if(!l.declaration.SetDeclaration(h,l.declaration.stride))return this.OnError(new u.Tw2GeometryMeshEffectBindError({path:this.path,pass:f,passInput:h,meshStride:l.declaration.stride})),!1;o.ApplyShadowState();for(var p=0;p<r;++p)if(p+t<l.areas.length){for(var d=l.areas[p+t],v=d.start,m=d.count;p+1<r&&(d=l.areas[p+1+t]).start===v+2*m;)m+=d.count,++p;s.drawElements(s.LINES,m,l.indexType,v)}}return!0}},{key:"RenderDebugInfo",value:function(e){if(!this.IsGood())return!1;for(var t=0;t<this.models.length;++t)if(this.models[t].skeleton)for(var r=0;r<this.models[t].skeleton.bones.length;++r){var n=this.models[t].skeleton.bones[r];if(n.parentIndex>=0){var i=this.models[t].skeleton.bones[n.parentIndex];e.AddLine([n.worldTransform[12],n.worldTransform[13],n.worldTransform[14]],[i.worldTransform[12],i.worldTransform[13],i.worldTransform[14]],[0,.7,0,1],[0,.7,0,1])}}}},{key:"Unload",value:function(){for(var e=0;e<this.meshes.length;++e){var t=i.device.gl;this.meshes[e].buffer&&(t.deleteBuffer(this.meshes[e].buffer),this.meshes[e].buffer=null),this.meshes[e].indexes&&(t.deleteBuffer(this.meshes[e].indexes),this.meshes[e].indexes=null)}return this._isPurged=!0,this._isGood=!1,!0}}],[{key:"BindMeshToModel",value:function(e,t,r){var n=new l.Tw2GeometryMeshBinding;n.mesh=e;for(var i=0;i<n.mesh.boneBindings.length;++i){var a=n.mesh.boneBindings[i],o=t.FindBoneByName(a);if(!o)throw new u.Tw2GeometryMeshInvalidBoneError({path:r.path,mesh:n.mesh.name,bone:a,model:t.name});n.bones[n.bones.length]=o}t.meshBindings[t.meshBindings.length]=n}},{key:"ReadVertexBuffer",value:function(e,t,r){for(var n=e.ReadUInt8(),a=0,s=0;s<n;++s){var l=new o.Tw2VertexElement;l.usage=e.ReadUInt8(),l.usageIndex=e.ReadUInt8(),l.fileType=e.ReadUInt8(),l.type=i.device.gl.FLOAT,l.elements=1+(l.fileType>>5),l.offset=4*a,t.elements[s]=l,a+=l.elements}t.RebuildHash(),t.stride=4*a;var c=e.ReadUInt32();if(0===c)return null;for(var f=new Float32Array(a*c),h=0,p=0;p<c;++p)for(var d=0;d<n;++d){var v=t.elements[d];switch(15&v.fileType){case 0:if(0!=(16&v.fileType))for(var m=0;m<v.elements;++m)f[h++]=e.ReadInt8()/127;else for(var y=0;y<v.elements;++y)f[h++]=e.ReadInt8();break;case 1:if(0!=(16&v.fileType))for(var b=0;b<v.elements;++b)f[h++]=e.ReadInt8()/32767;else for(var _=0;_<v.elements;++_)f[h++]=e.ReadInt16();break;case 2:for(var g=0;g<v.elements;++g)f[h++]=e.ReadInt32();break;case 3:for(var E=0;E<v.elements;++E)f[h++]=e.ReadFloat16();break;case 4:for(var T=0;T<v.elements;++T)f[h++]=e.ReadFloat32();break;case 8:if(0!=(16&v.fileType))for(var O=0;O<v.elements;++O)f[h++]=e.ReadUInt8()/255;else for(var w=0;w<v.elements;++w)f[h++]=e.ReadUInt8();break;case 9:if(0!=(16&v.fileType))for(var R=0;R<t.elements[d].elements;++R)f[h++]=e.ReadUInt8()/65535;else for(var S=0;S<v.elements;++S)f[h++]=e.ReadUInt16();break;case 10:for(var P=0;P<v.elements;++P)f[h++]=e.ReadUInt32();break;default:throw new u.Tw2GeometryFileTypeError({path:r,key:"fileType",value:15&v.fileType})}}return f}},{key:"ReadIndexBuffer",value:function(e){var t=e.ReadUInt8(),r=e.ReadUInt32();if(0===t){for(var n=new Uint16Array(r),i=0;i<r;++i)n[i]=e.ReadUInt16();return n}for(var a=new Uint32Array(r),o=0;o<r;++o)a[o]=e.ReadUInt32();return a}},{key:"ReadCurve",value:function(e){if(0===e.ReadUInt8())return null;var t=new l.Tw2GeometryCurve;t.dimension=e.ReadUInt8(),t.degree=e.ReadUInt8();var r=e.ReadUInt32();t.knots=new Float32Array(r);for(var n=0;n<r;++n)t.knots[n]=e.ReadFloat32();var i=e.ReadUInt32();t.controls=new Float32Array(i);for(var a=0;a<i;++a)t.controls[a]=e.ReadFloat32();return t}}]),t}()).prototype.requestResponseType="arraybuffer"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2VideoRes=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(11),o=r(6);t.Tw2VideoRes=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.texture=null,e.video=null,e.width=0,e.height=0,e.cycle=!0,e.playOnLoad=!0,e._currentSampler=0,e._currentTime=-1,e._playable=!1,e._isPlaying=!1,e._onPlaying=null,e._onPause=null,e._onEnded=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2Resource),n(t,[{key:"IsGood",value:function(){return this.KeepAlive(),function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"IsGood",this).call(this)&&this.video&&this._playable}},{key:"KeepAlive",value:function(){this.activeFrame=i.resMan.activeFrame}},{key:"Play",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.cycle=e,this._onEnded=t,this.video&&this._playable?(this.video.loop=this.cycle,this.video.play()):this.playOnLoad=!0}},{key:"Pause",value:function(){this.video?this.video.pause():this.playOnLoad=!1}},{key:"Prepare",value:function(e){var t=i.device.gl;switch(e){case"mp4":case"webm":case"ogg":this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.video),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.bindTexture(t.TEXTURE_2D,null),this.width=this.video.width,this.height=this.video.height,this.video.loop=this.cycle,this.playOnLoad&&this.video.play();break;default:throw new o.Tw2ResourceExtensionUnregisteredError({path:this.path,extension:e})}this.OnPrepared()}},{key:"DoCustomLoad",value:function(e,t){var r=this;switch(t){case"mp4":case"webm":case"ogg":break;default:throw new o.Tw2ResourceExtensionUnregisteredError({path:e,extension:t})}return this.OnRequested(),i.resMan._pendingLoads++,this.video=document.createElement("video"),this.video.crossOrigin="anonymous",this.video.muted=!0,this.video.onerror=function(){i.resMan._pendingLoads--,r.video=null,r.OnError(new o.HTTPRequestError({path:e}))},this.video.oncanplay=function(){r._playable=!0,r.video.oncanplay=null,i.resMan._pendingLoads--,i.resMan._prepareQueue.push([r,t,null]),r.OnLoaded()},this.video.onended=function(){r._isPlaying=!1,r._onEnded&&r._onEnded(r)},this.video.onpause=function(){r._isPlaying=!1,r._onPause&&r._onPause(r)},this.video.onplaying=function(){r._isPlaying=!0,r._onPlaying&&r._onPlaying(r)},this.video.src=e,!0}},{key:"Unload",value:function(){return this.texture&&(i.device.gl.deleteTexture(this.texture),this.texture=null),this._isPlaying=!1,this._playable=!1,this.playOnLoad=!0,this.video=null,!0}},{key:"Bind",value:function(e){var t=i.device,r=t.gl;this.KeepAlive();var n=e.samplerType;n===r.TEXTURE_2D&&(this.texture?(this._currentTime=this.video.currentTime,r.bindTexture(r.TEXTURE_2D,this.texture),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,this.video),r.bindTexture(r.TEXTURE_2D,null),r.bindTexture(n,this.texture),e.hash!==this._currentSampler&&(e.Apply(!1),this._currentSampler=e.hash)):r.bindTexture(r.TEXTURE_2D,t.GetFallbackTexture()))}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(57);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r(127);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(59);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2PostEffectManager=void 0;var n,i,a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(5),s=r(57);t.Tw2PostEffectManager=(i=n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=(0,o.generateID)(),this.name="Post manager",this.display=!0,this.items=[]}return a(e,[{key:"CreateItem",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=s.Tw2PostEffect.create(e);return this.AddItem(t),t}},{key:"AddItem",value:function(e){this.items.includes(e)||(-1===e.index&&(e.index=this.items.length),this.items.push(e))}},{key:"RemoveItem",value:function(e){var t=this.items.indexOf(e);-1!==t&&this.items.splice(t,1)}},{key:"ClearItems",value:function(){for(var e=0;e<this.items.length;e++)this.items[e].ClearItems();this.items=[]}},{key:"IsGood",value:function(){for(var e=0,t=0;t<this.items.length;t++)this.items[t].IsGood()&&e++;return e===this.items.length}},{key:"KeepAlive",value:function(){for(var e=0;e<this.items.length;e++)this.items[e].KeepAlive()}},{key:"GetResources",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=0;t<this.items.length;t++)this.items[t].GetResources(e);return e}},{key:"Update",value:function(e){for(var t=0;t<this.items.length;t++)this.items[t].Update(e)}},{key:"Render",value:function(){if(!this.display)return this.KeepAlive(),!1;for(var e=0,t=0;t<this.items.length;t++)this.items[t].Render()&&e++;return!!e}},{key:"effects",get:function(){return this.items}}]),e}(),n.Item=s.Tw2PostEffect,i)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Tw2Float=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.value=0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Frustum=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);(t.Tw2Frustum=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.planes=[i.vec4.create(),i.vec4.create(),i.vec4.create(),i.vec4.create(),i.vec4.create(),i.vec4.create()],this.viewPos=i.vec3.create(),this.viewDir=i.vec3.create(),this.halfWidthProjection=1}return n(e,[{key:"Initialize",value:function(t,r,n,a,o){var s=e.global.mat4_0,u=a||i.mat4.invert(s,t);this.viewPos.set(u.subarray(12,14)),this.viewDir.set(u.subarray(8,10)),this.halfWidthProjection=r[0]*n*.5;var l=o||i.mat4.multiply(s,r,t);this.planes[0][0]=l[2],this.planes[0][1]=l[6],this.planes[0][2]=l[10],this.planes[0][3]=l[14],this.planes[1][0]=l[3]+l[0],this.planes[1][1]=l[7]+l[4],this.planes[1][2]=l[11]+l[8],this.planes[1][3]=l[15]+l[12],this.planes[2][0]=l[3]-l[1],this.planes[2][1]=l[7]-l[5],this.planes[2][2]=l[11]-l[9],this.planes[2][3]=l[15]-l[13],this.planes[3][0]=l[3]-l[0],this.planes[3][1]=l[7]-l[4],this.planes[3][2]=l[11]-l[8],this.planes[3][3]=l[15]-l[12],this.planes[4][0]=l[3]+l[1],this.planes[4][1]=l[7]+l[5],this.planes[4][2]=l[11]+l[9],this.planes[4][3]=l[15]+l[13],this.planes[5][0]=l[3]-l[2],this.planes[5][1]=l[7]-l[6],this.planes[5][2]=l[11]-l[10],this.planes[5][3]=l[15]-l[14];for(var c=0;c<6;++c){var f=i.vec3.length(this.planes[c]);this.planes[c][0]/=f,this.planes[c][1]/=f,this.planes[c][2]/=f,this.planes[c][3]/=f}}},{key:"IsSphereVisible",value:function(e,t){for(var r=0;r<6;++r)if(this.planes[r][0]*e[0]+this.planes[r][1]*e[1]+this.planes[r][2]*e[2]+this.planes[r][3]<-t)return!1;return!0}},{key:"GetPixelSizeAcross",value:function(t,r){var n=i.vec3.subtract(e.global.vec3_0,this.viewPos,t),a=i.vec3.dot(this.viewDir,n);return a<1e-5&&(a=1e-5),r<1e-5?0:r/a*this.halfWidthProjection*2}}]),e}()).global={vec3_0:i.vec3.create(),mat4_0:i.mat4.create()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ColorCurve=t.Tw2ColorKey=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(2);function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=t.Tw2ColorKey=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=i.vec4.create(),e.left=i.vec4.create(),e.right=i.vec4.create(),e.interpolation=0,e}return u(t,a.Tw2CurveKey),t}(),c=t.Tw2ColorCurve=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.start=0,e.value=i.vec4.create(),e.extrapolation=0,e.keys=[],e._currentKey=1,e.length=0,e}return u(t,a.Tw2Curve),n(t,[{key:"Sort",value:function(){a.Tw2Curve.Sort(this)}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.value)}},{key:"GetValueAt",value:function(e,r){if(0===this.length)return i.vec4.copy(r,this.value);var n=this.keys[0],a=this.keys[this.keys.length-1];if(e>=a.time)switch(this.extrapolation){case t.Extrapolation.NONE:return i.vec4.copy(r,this.value);case t.Extrapolation.CONSTANT:return i.vec4.copy(r,a.value);case t.Extrapolation.GRADIENT:return i.vec4.scaleAndAdd(r,a.value,a.right,e-a.time);default:e%=a.time}else if(e<0||e<n.time)switch(this.extrapolation){case t.Extrapolation.NONE:return i.vec4.copy(r,this.value);case t.Extrapolation.GRADIENT:return i.vec4.scaleAndAdd(r,n.value,n.left,e*this.length-a.time);default:return i.vec4.copy(r,n.value)}for(var o=this.keys[this._currentKey],s=this.keys[this._currentKey-1];e>=o.time||e<s.time;)e<s.time&&(this._currentKey=0),this._currentKey++,o=this.keys[this._currentKey],s=this.keys[this._currentKey-1];var u=(e-s.time)/(o.time-s.time);switch(s.interpolation){case t.Interpolation.CONSTANT:return i.vec4.copy(r,s.value);default:return r[0]=s.value[0]*(1-u)+o.value[0]*u,r[1]=s.value[1]*(1-u)+o.value[1]*u,r[2]=s.value[2]*(1-u)+o.value[2]*u,r[3]=s.value[3]*(1-u)+o.value[3]*u,r}}}]),t}();c.inputDimension=4,c.ouputDimension=4,c.valueProperty="value",c.curveType=a.Tw2Curve.Type.CURVE,c.Key=l,c.Extrapolation={NONE:0,CONSTANT:1,GRADIENT:2,CYCLE:3},c.Interpolation={NONE:0,CONSTANT:1,LINEAR:2}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ColorCurve2=t.Tw2ColorKey2=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(2);function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=t.Tw2ColorKey2=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=i.vec4.create(),e.leftTangent=i.vec4.create(),e.rightTangent=i.vec4.create(),e.interpolation=1,e}return u(t,a.Tw2CurveKey),t}(),c=t.Tw2ColorCurve2=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.cycle=!1,e.reversed=!1,e.timeOffset=0,e.timeScale=1,e.startValue=i.vec4.fromValues(0,0,0,1),e.currentValue=i.vec4.fromValues(0,0,0,1),e.endValue=i.vec4.fromValues(0,0,0,1),e.startTangent=i.vec4.create(),e.endTangent=i.vec4.create(),e.interpolation=1,e.keys=[],e.length=0,e}return u(t,a.Tw2Curve),n(t,[{key:"Sort",value:function(){a.Tw2Curve.Sort2(this)}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.currentValue)}},{key:"GetValueAt",value:function(e,t){if(e=e/this.timeScale+this.timeOffset,this.length<=0||e<=0)return i.vec4.copy(t,this.startValue);if(e>this.length){if(!this.cycle)return this.reversed?i.vec4.copy(t,this.startValue):i.vec4.copy(t,this.endValue);e%=this.length}if(this.reversed&&(e=this.length-e),0===this.keys.length)return this.Interpolate(e,null,null,t);var r=this.keys[0],n=this.keys[this.keys.length-1];if(e<=r.time)return this.Interpolate(e,null,r,t);if(e>=n.time)return this.Interpolate(e,n,null,t);for(var a=0;a+1<this.keys.length&&(r=this.keys[a],n=this.keys[a+1],!(r.time<=e&&n.time>e));++a);return this.Interpolate(e,r,n,t)}},{key:"Interpolate",value:function(e,r,n,a){i.vec4.copy(a,this.startValue);var o=this.startValue,s=this.endValue,u=this.interpolation,l=this.length;switch(null!==r&&(u=r.interpolation,e-=r.time),u){case t.Interpolation.LINEAR:return r&&n?(o=r.value,s=n.value,l=n.time-r.time):n?(s=n.value,l=n.time):r&&(o=r.value,l=this.length-r.time),a[0]=o[0]+(s[0]-o[0])*(e/l),a[1]=o[1]+(s[1]-o[1])*(e/l),a[2]=o[2]+(s[2]-o[2])*(e/l),a[3]=o[3]+(s[3]-o[3])*(e/l),a;default:return a}}}]),t}();c.inputDimension=4,c.outputDimension=4,c.valueProperty="currentValue",c.curveType=a.Tw2Curve.Type.CURVE2,c.Key=l,c.Interpolation={CONSTANT:0,LINEAR:1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2EventCurve=t.Tw2EventKey=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(2);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=t.Tw2EventKey=function(e){function t(){a(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value="",e}return s(t,i.Tw2CurveKey),t}(),l=t.Tw2EventCurve=function(e){function t(){a(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value="",e.keys=[],e.extrapolation=0,e._time=0,e._currentKey=0,e._length=0,e}return s(t,i.Tw2Curve),n(t,[{key:"Sort",value:function(){this.keys.length&&(this.keys.sort(i.Tw2Curve.Compare),this._length=this.keys[this.keys.length-1].time)}},{key:"GetLength",value:function(){return this._length}},{key:"UpdateValue",value:function(e){if(this._length<=0)return this.value;var r=this._time;if(this._time=e,this._time<r&&(this._currentKey=0),this.extrapolation===t.Extrapolation.CYCLE){var n=this._time%this._length;n<r&&(this._currentKey=0),this._time=n}for(;this._currentKey<this.keys.length&&this._time>=this.keys[this._currentKey].time;)this.value=this.keys[this._currentKey].value,++this._currentKey}}]),t}();l.dimension=1,l.outputDimension=1,l.valueProperty="value",l.curveType=i.Tw2Curve.Type.CURVE,l.Key=u,l.Extrapolation={NONE:0,CYCLE:3}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2PerlinCurve=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(2);var o=t.Tw2PerlinCurve=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=0,e.start=0,e.speed=1,e.alpha=1.1,e.beta=2,e.offset=0,e.scale=1,e.N=3,e._startOffset=100*Math.random(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2Curve),n(t,[{key:"UpdateValue",value:function(e){this.value=this.GetValueAt(e)}},{key:"GetValueAt",value:function(e){return e-=this._startOffset,(i.noise.perlin1D(e*this.speed,this.alpha,this.beta,this.N)+1)/2*this.scale+this.offset}}]),t}();o.outputDimension=1,o.valueProperty="value",o.curveType=a.Tw2Curve.Type.CURVE_NO_KEYS},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2QuaternionCurve=t.Tw2QuaternionKey2=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(2);function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=t.Tw2QuaternionKey2=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=i.quat.create(),e.leftTangent=i.vec4.create(),e.rightTangent=i.vec4.create(),e.interpolation=1,e}return u(t,a.Tw2CurveKey),t}(),c=t.Tw2QuaternionCurve=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.cycle=!1,e.reversed=!1,e.timeOffset=0,e.timeScale=1,e.startValue=i.quat.create(),e.currentValue=i.quat.create(),e.endValue=i.quat.create(),e.startTangent=i.vec4.create(),e.endTangent=i.vec4.create(),e.interpolation=1,e.keys=[],e.length=0,e}return u(t,a.Tw2Curve),n(t,[{key:"Sort",value:function(){a.Tw2Curve.Sort2(this)}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.currentValue)}},{key:"GetValueAt",value:function(e,t){if(e=e/this.timeScale+this.timeOffset,this.length<=0||e<=0)return t[0]=this.startValue[0],t[1]=this.startValue[1],t[2]=this.startValue[2],t;if(e>this.length){if(!this.cycle)return this.reversed?(t[0]=this.startValue[0],t[1]=this.startValue[1],t[2]=this.startValue[2],t):(t[0]=this.endValue[0],t[1]=this.endValue[1],t[2]=this.endValue[2],t);e%=this.length}if(this.reversed&&(e=this.length-e),0===this.keys.length)return this.Interpolate(e,null,null,t);var r=this.keys[0],n=this.keys[this.keys.length-1];if(e<=r.time)return this.Interpolate(e,null,r,t);if(e>=n.time)return this.Interpolate(e,n,null,t);for(var i=0;i+1<this.keys.length&&(r=this.keys[i],n=this.keys[i+1],!(r.time<=e&&n.time>e));++i);return this.Interpolate(e,r,n,t)}},{key:"Interpolate",value:function(e,r,n,a){a[0]=this.startValue[0],a[1]=this.startValue[1],a[2]=this.startValue[2];var o=this.startValue,s=this.endValue,u=this.interpolation,l=this.length;switch(null!==r&&(u=r.interpolation,e-=r.time),u){case t.Interpolation.SPHERICAL_LINEAR:return r&&n?(o=r.value,s=n.value,l=n.time-r.time):n?(s=n.value,l=n.time):r&&(o=r.value,l=this.length-r.time),i.quat.slerp(a,o,s,e/l),a;default:return a}}}]),t}();c.inputDimension=4,c.outputDimension=4,c.valueProperty="currentValue",c.curveType=a.Tw2Curve.Type.CURVE2,c.Key=l,c.Interpolation={CONSTANT:0,SPHERICAL_LINEAR:4}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2RandomConstantCurve=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(2);var a=t.Tw2RandomConstantCurve=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=0,e.min=0,e.max=1,e.hold=!0,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Tw2Curve),n(t,[{key:"UpdateValue",value:function(){this.value=this.GetValueAt()}},{key:"GetValueAt",value:function(){return this.hold?this.value:this.min+(this.max-this.min)*Math.random()}}]),t}();a.outputDimension=1,a.valueProperty="value",a.curveType=i.Tw2Curve.Type.CURVE_NO_KEYS},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2RigidOrientation=t.Tw2Torque=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(2);function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=t.Tw2Torque=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.rot0=i.quat.create(),e.omega0=i.vec3.create(),e.torque=i.vec3.create(),e}return u(t,a.Tw2CurveKey),t}(),c=t.Tw2RigidOrientation=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name="",e.I=1,e.drag=1,e.value=i.quat.create(),e.start=0,e.states=[],e.length=0,e}return u(t,a.Tw2Curve),n(t,[{key:"Sort",value:function(){a.Tw2Curve.Sort(this,this.states)}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.value)}},{key:"GetValueAt",value:function(e,t){if(0===this.states.length||e<0||e<this.states[0].time)return i.quat.copy(t,this.value);var r=0;if(e>=this.states[this.states.length-1].time)r=this.states.length-1;else for(;r+1<this.states.length&&!(e>=this.states[r].time&&e<this.states[r+1].time);++r);var n=a.Tw2Curve.global.vec3_0,o=a.Tw2Curve.global.quat_0,s=this.states[r];return i.vec3.exponentialDecay(n,s.omega0,s.torque,this.I,this.drag,e-s.time),i.quat.exp(o,n),i.quat.multiply(t,this.states[r].rot0,o),t}}]),t}();c.inputDimension=4,c.outputDimension=4,c.valueProperty="value",c.curveType=a.Tw2Curve.Type.CURVE,c.Key=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2RotationCurve=t.Tw2QuaternionKey=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(2);function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=t.Tw2QuaternionKey=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=i.quat.create(),e.left=i.vec4.create(),e.right=i.vec4.create(),e.interpolation=5,e}return u(t,a.Tw2CurveKey),t}(),c=t.Tw2RotationCurve=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.start=0,e.value=i.quat.create(),e.extrapolation=0,e.keys=[],e._currentKey=1,e.length=0,e}return u(t,a.Tw2Curve),n(t,[{key:"Sort",value:function(){a.Tw2Curve.Sort(this)}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.value)}},{key:"GetValueAt",value:function(e,r){if(0===this.length)return i.quat.copy(r,this.value);var n=a.Tw2Curve.global,o=this.keys[0],s=this.keys[this.keys.length-1];if(e>=s.time)switch(this.extrapolation){case t.Extrapolation.NONE:return i.quat.copy(r,this.value);case t.Extrapolation.CONSTANT:return i.quat.copy(r,s.value);default:e%=s.time}else if(e<0||e<o.time)switch(this.extrapolation){case t.Extrapolation.NONE:return i.quat.copy(r,this.value);default:return i.quat.copy(r,o.value)}for(var u=this.keys[this._currentKey],l=this.keys[this._currentKey-1];e>=u.time||e<l.time;)e<l.time&&(this._currentKey=0),this._currentKey++,u=this.keys[this._currentKey],l=this.keys[this._currentKey-1];var c=(e-l.time)/(u.time-l.time);switch(l.interpolation){case t.Interpolation.CONSTANT:return i.quat.copy(r,l.value);case t.Interpolation.LINEAR:return r[0]=l.value[0]*(1-c)+u.value[0]*c,r[1]=l.value[1]*(1-c)+u.value[1]*c,r[2]=l.value[2]*(1-c)+u.value[2]*c,r[3]=l.value[3]*(1-c)+u.value[3]*c,r;case t.Interpolation.HERMITE:for(var f=i.quat.identity(n.quat_0),h=[l.value,l.right,u.left,u.value],p=3;p>0;p--){var d=i.num.biCumulative(c,p);d>1&&i.quat.multiply(r,f,h[p]),r[0]=-h[p-1][0],r[1]=-h[p-1][1],r[2]=-h[p-1][2],r[3]=h[p-1][3],i.quat.multiply(r,r,h[p]),i.quat.pow(r,r,d),i.quat.multiply(f,f,r)}return i.quat.multiply(r,f,l.value);case t.Interpolation.SLERP:return i.quat.slerp(r,l.value,u.value,c);default:return i.quat.sqlerp(r,l.value,l.right,u.left,u.value,c)}}}]),t}();c.outputDimention=4,c.inputDimension=4,c.valueProperty="value",c.curveType=a.Tw2Curve.Type.CURVE,c.Child=l,c.Extrapolation={NONE:0,CONSTANT:1,GRADIENT:2,CYCLE:3},c.Interpolation={NONE:0,CONSTANT:1,LINEAR:2,HERMITE:3,SLERP:5,SQUAD:6}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ScalarCurve=t.Tw2ScalarKey=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(2);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=t.Tw2ScalarKey=function(e){function t(){a(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=0,e.left=0,e.right=0,e.interpolation=0,e}return s(t,i.Tw2CurveKey),t}(),l=t.Tw2ScalarCurve=function(e){function t(){a(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.start=0,e.timeScale=1,e.timeOffset=0,e.value=0,e.extrapolation=0,e.keys=[],e._currentKey=1,e.length=0,e}return s(t,i.Tw2Curve),n(t,[{key:"Sort",value:function(){i.Tw2Curve.Sort(this)}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.value=this.GetValueAt(e)}},{key:"GetValueAt",value:function(e){if(e=e/this.timeScale-this.timeOffset,0===this.length)return this.value;var r=this.keys[0],n=this.keys[this.keys.length-1];if(e>=n.time)switch(this.extrapolation){case t.Extrapolation.NONE:return this.value;case t.Extrapolation.CONSTANT:return n.value;case t.Extrapolation.GRADIENT:return n.value+(e-n.time)*n.right;default:e%=n.time}else if(e<0||e<r.time)switch(this.extrapolation){case t.Extrapolation.NONE:return this.value;case t.Extrapolation.GRADIENT:return r.value+(e*this.length-n.time)*r.left;default:return r.value}for(var i=this.keys[this._currentKey],a=this.keys[this._currentKey-1];e>=i.time||e<a.time;)e<a.time&&(this._currentKey=0),this._currentKey++,i=this.keys[this._currentKey],a=this.keys[this._currentKey-1];var o=(e-a.time)/(i.time-a.time);switch(a.interpolation){case t.Interpolation.CONSTANT:return a.value;case t.Interpolation.LINEAR:return a.value*(1-o)+i.value*o;case t.Interpolation.HERMITE:var s=-2*o*o*o+3*o*o,u=o*o*o-2*o*o+o,l=o*o*o-o*o;return(2*o*o*o-3*o*o+1)*a.value+s*i.value+u*a.right+l*i.left;default:var c=1+(Math.sqrt(a.value/i.value)-1)*Math.exp(-e/a.right);return c*c*i.value}}}]),t}();l.inputDimension=1,l.outputDimension=1,l.valueProperty="value",l.curveType=i.Tw2Curve.Type.CURVE,l.Key=u,l.Extrapolation={NONE:0,CONSTANT:1,GRADIENT:2,CYCLE:3},l.Interpolation={NONE:0,CONSTANT:1,LINEAR:2,HERMITE:3,CATMULROM:4}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ScalarCurve2=t.Tw2ScalarKey2=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(2);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=t.Tw2ScalarKey2=function(e){function t(){a(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=0,e.leftTangent=0,e.rightTangent=0,e.interpolation=1,e}return s(t,i.Tw2CurveKey),t}(),l=t.Tw2ScalarCurve2=function(e){function t(){a(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.cycle=!1,e.reversed=!1,e.timeOffset=0,e.timeScale=1,e.startValue=0,e.currentValue=0,e.endValue=0,e.startTangent=0,e.endTangent=0,e.interpolation=1,e.keys=[],e.length=0,e}return s(t,i.Tw2Curve),n(t,[{key:"Sort",value:function(){i.Tw2Curve.Sort2(this)}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.currentValue=this.GetValueAt(e)}},{key:"GetValueAt",value:function(e){if(e=e/this.timeScale+this.timeOffset,this.length<=0||e<=0)return this.startValue;if(e>this.length){if(!this.cycle)return this.reversed?this.startValue:this.endValue;e%=this.length}if(this.reversed&&(e=this.length-e),0===this.keys.length)return this.Interpolate(e,null,null);var t=this.keys[0],r=this.keys[this.keys.length-1];if(e<=t.time)return this.Interpolate(e,null,t);if(e>=r.time)return this.Interpolate(e,r,null);for(var n=0;n+1<this.keys.length&&(t=this.keys[n],r=this.keys[n+1],!(t.time<=e&&r.time>e));++n);return this.Interpolate(e,t,r)}},{key:"Interpolate",value:function(e,r,n){var i=this.startValue,a=this.endValue,o=this.interpolation,s=this.length;switch(null!==r&&(o=r.interpolation,e-=r.time),o){case t.Interpolation.LINEAR:return r&&n?(i=r.value,a=n.value,s=n.time-r.time):n?(a=n.value,s=n.time):r&&(i=r.value,s=this.length-r.time),i+e/s*(a-i);case t.Interpolation.HERMITE:var u=this.startTangent,l=this.endTangent;r&&n?(i=r.value,u=r.rightTangent,a=n.value,l=n.leftTangent,s=n.time-r.time):n?(a=n.value,l=n.leftTangent,s=n.time):r&&(i=r.value,u=r.rightTangent,s=this.length-r.time);var c=e/s,f=c*c,h=f*c,p=-2*h+3*f,d=h-f;return i*(1-p)+a*p+u*(c+d-f)+l*d;default:return this.startValue}}}]),t}();l.inputDimension=1,l.outputDimension=1,l.valueProperty="currentValue",l.curveType=i.Tw2Curve.Type.CURVE2,l.Key=u,l.Interpolation={CONSTANT:0,LINEAR:1,HERMITE:2}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2SineCurve=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(2);var a=t.Tw2SineCurve=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=0,e.offset=0,e.scale=1,e.speed=1,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Tw2Curve),n(t,[{key:"UpdateValue",value:function(e){this.value=this.GetValueAt(e)}},{key:"GetValueAt",value:function(e){return Math.sin(e*Math.PI*2*this.speed)*this.scale+this.offset}}]),t}();a.outputDimension=1,a.valueProperty="value",a.curveType=i.Tw2Curve.Type.CURVE_NO_KEYS},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Vector2Curve=t.Tw2Vector2Key=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(2);function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=t.Tw2Vector2Key=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=i.vec2.create(),e.leftTangent=i.vec2.create(),e.rightTangent=i.vec2.create(),e.interpolation=1,e}return u(t,a.Tw2CurveKey),t}(),c=t.Tw2Vector2Curve=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.cycle=!1,e.reversed=!1,e.timeOffset=0,e.timeScale=1,e.startValue=i.vec2.create(),e.currentValue=i.vec2.create(),e.endValue=i.vec2.create(),e.startTangent=i.vec2.create(),e.endTangent=i.vec2.create(),e.interpolation=1,e.keys=[],e.length=0,e}return u(t,a.Tw2Curve),n(t,[{key:"Sort",value:function(){a.Tw2Curve.Sort2(this)}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.currentValue)}},{key:"GetValueAt",value:function(e,t){if(e=e/this.timeScale+this.timeOffset,this.length<=0||e<=0)return i.vec2.copy(t,this.startValue);if(e>this.length){if(!this.cycle)return this.reversed?i.vec2.copy(t,this.startValue):i.vec2.copy(t,this.endValue);e%=this.length}if(this.reversed&&(e=this.length-e),0===this.keys.length)return this.Interpolate(e,null,null,t);var r=this.keys[0],n=this.keys[this.keys.length-1];if(e<=r.time)return this.Interpolate(e,null,r,t);if(e>=n.time)return this.Interpolate(e,n,null,t);for(var a=0;a+1<this.keys.length&&(r=this.keys[a],n=this.keys[a+1],!(r.time<=e&&n.time>e));++a);return this.Interpolate(e,r,n,t)}},{key:"Interpolate",value:function(e,r,n,a){i.vec2.copy(a,this.startValue);var o=this.startValue,s=this.endValue,u=this.interpolation,l=this.length;switch(null!==r&&(u=r.interpolation,e-=r.time),u){case t.Interpolation.LINEAR:return r&&n?(o=r.value,s=n.value,l=n.time-r.time):n?(s=n.value,l=n.time):r&&(o=r.value,l=this.length-r.time),a[0]=o[0]+(s[0]-o[0])*(e/l),a[1]=o[1]+(s[1]-o[1])*(e/l),a;case t.Interpolation.HERMITE:var c=this.startTangent,f=this.endTangent;r&&n?(o=r.value,c=r.rightTangent,s=n.value,f=n.leftTangent,l=n.time-r.time):n?(s=n.value,f=n.leftTangent,l=n.time):r&&(o=r.value,c=r.rightTangent,l=this.length-r.time);var h=e/l,p=h*h,d=p*h,v=-2*d+3*p,m=1-v,y=d-p,b=h+y-p;return a[0]=o[0]*m+s[0]*v+c[0]*b+f[0]*y,a[1]=o[1]*m+s[1]*v+c[1]*b+f[1]*y,a;default:return a}}}]),t}();c.inputDimension=2,c.outputDimension=2,c.valueProperty="value",c.curveType=a.Tw2Curve.Type.CURVE2,c.Key=l,c.Interpolation={CONSTANT:0,LINEAR:1,HERMITE:2}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Vector3Curve=t.Tw2Vector3Key=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(2);function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=t.Tw2Vector3Key=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=i.vec3.create(),e.leftTangent=i.vec3.create(),e.rightTangent=i.vec3.create(),e.interpolation=1,e}return u(t,a.Tw2CurveKey),t}(),c=t.Tw2Vector3Curve=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.cycle=!1,e.reversed=!1,e.timeOffset=0,e.timeScale=1,e.startValue=i.vec3.create(),e.currentValue=i.vec3.create(),e.endValue=i.vec3.create(),e.startTangent=i.vec3.create(),e.endTangent=i.vec3.create(),e.interpolation=1,e.keys=[],e.length=0,e}return u(t,a.Tw2Curve),n(t,[{key:"Sort",value:function(){a.Tw2Curve.Sort2(this)}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.currentValue)}},{key:"GetValueAt",value:function(e,t){if(e=e/this.timeScale+this.timeOffset,this.length<=0||e<=0)return i.vec3.copy(t,this.startValue);if(e>this.length){if(!this.cycle)return this.reversed?i.vec3.copy(t,this.startValue):i.vec3.copy(t,this.endValue);e%=this.length}if(this.reversed&&(e=this.length-e),0===this.keys.length)return this.Interpolate(e,null,null,t);var r=this.keys[0],n=this.keys[this.keys.length-1];if(e<=r.time)return this.Interpolate(e,null,r,t);if(e>=n.time)return this.Interpolate(e,n,null,t);for(var a=0;a+1<this.keys.length&&(r=this.keys[a],n=this.keys[a+1],!(r.time<=e&&n.time>e));++a);return this.Interpolate(e,r,n,t)}},{key:"Interpolate",value:function(e,r,n,a){i.vec3.copy(a,this.startValue);var o=this.startValue,s=this.endValue,u=this.interpolation,l=this.length;switch(null!==r&&(u=r.interpolation,e-=r.time),u){case t.Interpolation.LINEAR:return r&&n?(o=r.value,s=n.value,l=n.time-r.time):n?(s=n.value,l=n.time):r&&(o=r.value,l=this.length-r.time),a[0]=o[0]+(s[0]-o[0])*(e/l),a[1]=o[1]+(s[1]-o[1])*(e/l),a[2]=o[2]+(s[2]-o[2])*(e/l),a;case t.Interpolation.HERMITE:var c=this.startTangent,f=this.endTangent;r&&n?(o=r.value,c=r.rightTangent,s=n.value,f=n.leftTangent,l=n.time-r.time):n?(s=n.value,f=n.leftTangent,l=n.time):r&&(o=r.value,c=r.rightTangent,l=this.length-r.time);var h=e/l,p=h*h,d=p*h,v=-2*d+3*p,m=1-v,y=d-p,b=h+y-p;return a[0]=o[0]*m+s[0]*v+c[0]*b+f[0]*y,a[1]=o[1]*m+s[1]*v+c[1]*b+f[1]*y,a[2]=o[2]*m+s[2]*v+c[2]*b+f[2]*y,a;default:return a}}}]),t}();c.inputDimension=3,c.outputDimension=3,c.valueProperty="currentValue",c.curveType=a.Tw2Curve.Type.CURVE2,c.Key=l,c.Interpolation={CONSTANT:0,LINEAR:1,HERMITE:2}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2VectorCurve=t.Tw2VectorKey=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(2);function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=t.Tw2VectorKey=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=i.vec3.create(),e.left=i.vec3.create(),e.right=i.vec3.create(),e.interpolation=0,e}return u(t,a.Tw2CurveKey),t}(),c=t.Tw2VectorCurve=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.start=0,e.value=i.vec3.create(),e.extrapolation=0,e.keys=[],e._currentKey=1,e.length=0,e}return u(t,a.Tw2Curve),n(t,[{key:"Sort",value:function(){a.Tw2Curve.Sort(this)}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.value)}},{key:"GetValueAt",value:function(e,r){if(0===this.length)return i.vec3.copy(r,this.value);var n=this.keys[0],a=this.keys[this.keys.length-1];if(e>=a.time)switch(this.extrapolation){case t.Extrapolation.NONE:return i.vec3.copy(r,this.value);case t.Extrapolation.CONSTANT:return i.vec3.copy(r,a.value);case t.Extrapolation.GRADIENT:return i.vec3.scaleAndAdd(r,a.value,a.right,e-a.time);default:e%=a.time}else if(e<0||e<n.time)switch(this.extrapolation){case t.Extrapolation.NONE:return i.vec3.copy(r,this.value);case t.Extrapolation.GRADIENT:return i.vec3.scaleAndAdd(r,n.value,n.left,e*this.length-a.time);default:return i.vec3.copy(r,n.value)}for(var o=this.keys[this._currentKey],s=this.keys[this._currentKey-1];e>=o.time||e<s.time;)e<s.time&&(this._currentKey=0),this._currentKey++,o=this.keys[this._currentKey],s=this.keys[this._currentKey-1];var u=(e-s.time)/(o.time-s.time);switch(s.interpolation){case t.Interpolation.CONSTANT:return i.vec3.copy(r,s.value);case t.Interpolation.LINEAR:return r[0]=s.value[0]*(1-u)+o.value[0]*u,r[1]=s.value[1]*(1-u)+o.value[1]*u,r[2]=s.value[2]*(1-u)+o.value[2]*u,r;case t.Interpolation.HERMITE:var l=2*u*u*u-3*u*u+1,c=-2*u*u*u+3*u*u,f=u*u*u-2*u*u+u,h=u*u*u-u*u;return r[0]=l*s.value[0]+c*o.value[0]+f*s.right[0]+h*o.left[0],r[1]=l*s.value[1]+c*o.value[1]+f*s.right[1]+h*o.left[1],r[2]=l*s.value[2]+c*o.value[2]+f*s.right[2]+h*o.left[2],r;default:return r}}}]),t}();c.inputDimension=3,c.outputDimension=3,c.valueProperty="value",c.curveType=a.Tw2Curve.Type.CURVE,c.Key=l,c.Extrapolation={NONE:0,CONSTANT:1,GRADIENT:2,CYCLE:3},c.Interpolation={NONE:0,CONSTANT:1,LINEAR:2,HERMITE:3}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(145);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r(146);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(147);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var o=r(148);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var s=r(149);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var u=r(150);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var l=r(151);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})});var c=r(152);Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ColorSequencer=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(7);var o=t.Tw2ColorSequencer=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.start=0,e.value=i.vec4.create(),e.operator=0,e.functions=[],e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2CurveSequencer),n(t,[{key:"Sort",value:function(){a.Tw2CurveSequencer.Sort(this)}},{key:"GetLength",value:function(){for(var e=0,t=0;t<this.functions.length;++t)"GetLength"in this.functions[t]&&(e=Math.max(e,this.functions[t].GetLength()));return e}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.value)}},{key:"GetValueAt",value:function(e,r){var n=a.Tw2CurveSequencer.global.vec4_0;switch(this.operator){case t.Operator.MULTIPLY:i.vec4.set(r,1,1,1,1);for(var o=0;o<this.functions.length;++o)this.functions[o].GetValueAt(e,n),i.vec4.multiply(r,r,n);return r;default:i.vec4.set(r,0,0,0,0);for(var s=0;s<this.functions.length;++s)this.functions[s].GetValueAt(e,n),i.vec4.add(r,r,n);return r}}}]),t}();o.inputDimension=4,o.outputDimension=4,o.valueProperty="value",o.curveType=a.Tw2CurveSequencer.Type.SEQUENCER,o.childArray="functions",o.Operator={MULTIPLY:0,ADD:1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2EulerRotation=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(7);var o=t.Tw2EulerRotation=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.yawCurve=null,e.pitchCurve=null,e.rollCurve=null,e.currentValue=i.quat.create(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2CurveSequencer),n(t,[{key:"Sort",value:function(){a.Tw2CurveSequencer.Sort2(this)}},{key:"GetLength",value:function(){var e=0;return this.yawCurve&&"GetLength"in this.yawCurve&&(e=this.yawCurve.GetLength()),this.pitchCurve&&"GetLength"in this.pitchCurve&&(e=Math.max(e,this.pitchCurve.GetLength())),this.rollCurve&&"GetLength"in this.rollCurve&&(e=Math.max(e,this.rollCurve.GetLength())),e}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.currentValue)}},{key:"GetValueAt",value:function(e,t){var r=this.yawCurve?this.yawCurve.GetValueAt(e):0,n=this.pitchCurve?this.pitchCurve.GetValueAt(e):0,i=this.rollCurve?this.rollCurve.GetValueAt(e):0,a=Math.sin(r/2),o=Math.cos(r/2),s=Math.sin(n/2),u=Math.cos(n/2),l=Math.sin(i/2),c=Math.cos(i/2);return t[0]=a*u*l+o*s*c,t[1]=a*u*c-o*s*l,t[2]=o*u*l-a*s*c,t[3]=o*u*c+a*s*l,t}}]),t}();o.inputDimension=1,o.outputDimension=3,o.valueProperty="currentValue",o.curveType=a.Tw2CurveSequencer.Type.SEQUENCER2,o.childProperties=["yawCurve","pitchCurve","rollCurve"]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2QuaternionSequencer=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(7);var o=t.Tw2QuaternionSequencer=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.start=0,e.value=i.quat.create(),e.functions=[],e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2CurveSequencer),n(t,[{key:"Sort",value:function(){a.Tw2CurveSequencer.Sort(this)}},{key:"GetLength",value:function(){for(var e=0,t=0;t<this.functions.length;++t)"GetLength"in this.functions[t]&&(e=Math.max(e,this.functions[t].GetLength()));return e}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.value)}},{key:"GetValueAt",value:function(e,t){i.quat.identity(t);for(var r=a.Tw2CurveSequencer.global.quat_0,n=0;n<this.functions.length;++n)this.functions[n].GetValueAt(e,r),i.quat.multiply(t,t,r);return t}}]),t}();o.inputDimension=4,o.outputDimension=4,o.valueProperty="value",o.curveType=a.Tw2CurveSequencer.Type.SEQUENCER,o.childArray="functions"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2RGBAScalarSequencer=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(7);var o=t.Tw2RGBAScalarSequencer=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=i.vec4.create(),e.RedCurve=null,e.GreenCurve=null,e.BlueCurve=null,e.AlphaCurve=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2CurveSequencer),n(t,[{key:"Sort",value:function(){a.Tw2CurveSequencer.Sort2(this)}},{key:"GetLength",value:function(){var e=0;return this.RedCurve&&"GetLength"in this.RedCurve&&(e=this.RedCurve.GetLength()),this.GreenCurve&&"GetLength"in this.GreenCurve&&(e=Math.max(e,this.GreenCurve.GetLength())),this.BlueCurve&&"GetLength"in this.BlueCurve&&(e=Math.max(e,this.BlueCurve.GetLength())),this.AlphaCurve&&"GetLength"in this.AlphaCurve&&(e=Math.max(e,this.AlphaCurve.GetLength())),e}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.value)}},{key:"GetValueAt",value:function(e,t){return t[0]=this.RedCurve?this.RedCurve.GetValueAt(e):0,t[1]=this.GreenCurve?this.GreenCurve.GetValueAt(e):0,t[2]=this.BlueCurve?this.BlueCurve.GetValueAt(e):0,t[3]=this.AlphaCurve?this.AlphaCurve.GetValueAt(e):0,t}}]),t}();o.inputDimension=1,o.outputDimension=4,o.valueProperty="value",o.curveType=a.Tw2CurveSequencer.Type.SEQUENCER2,o.childProperties=["RedCurve","GreenCurve","BlueCurve","AlphaCurve"]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ScalarSequencer=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(7);var a=t.Tw2ScalarSequencer=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=0,e.operator=0,e.functions=[],e.inMinClamp=0,e.inMaxClamp=1,e.outMinClamp=0,e.outMaxClamp=1,e.clamping=!1,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Tw2CurveSequencer),n(t,[{key:"Sort",value:function(){i.Tw2CurveSequencer.Sort(this)}},{key:"GetLength",value:function(){for(var e=0,t=0;t<this.functions.length;++t)"GetLength"in this.functions[t]&&(e=Math.max(e,this.functions[t].GetLength()));return e}},{key:"UpdateValue",value:function(e){this.value=this.GetValueAt(e)}},{key:"GetValueAt",value:function(e){var r=void 0;switch(this.operator){case t.Operator.MULTIPLY:r=1;for(var n=0;n<this.functions.length;++n){var i=this.functions[n].GetValueAt(e);this.clamping&&(i=Math.min(Math.max(i,this.inMinClamp),this.inMaxClamp)),r*=i}break;default:r=0;for(var a=0;a<this.functions.length;++a){var o=this.functions[a].GetValueAt(e);this.clamping&&(o=Math.min(Math.max(o,this.inMinClamp),this.inMaxClamp)),r+=o}}return this.clamping&&(r=Math.min(Math.max(r,this.outMinClamp),this.outMaxClamp)),r}}]),t}();a.inputDimension=1,a.outputDimension=1,a.valueProperty="value",a.curveType=i.Tw2CurveSequencer.Type.SEQUENCER,a.childArray="functions",a.Operator={MULTIPLY:0,ADD:1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2VectorSequencer=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(7);var o=t.Tw2VectorSequencer=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.start=0,e.value=i.vec3.create(),e.operator=0,e.functions=[],e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2CurveSequencer),n(t,[{key:"Sort",value:function(){a.Tw2CurveSequencer.Sort(this)}},{key:"GetLength",value:function(){for(var e=0,t=0;t<this.functions.length;++t)"GetLength"in this.functions[t]&&(e=Math.max(e,this.functions[t].GetLength()));return e}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.value)}},{key:"GetValueAt",value:function(e,r){var n=a.Tw2CurveSequencer.global.vec3_0;switch(this.operator){case t.Operator.MULTIPLY:i.vec3.set(r,1,1,1);for(var o=0;o<this.functions.length;++o)this.functions[o].GetValueAt(e,n),i.vec3.multiply(r,r,n);return r;default:i.vec3.set(r,0,0,0);for(var s=0;s<this.functions.length;++s)this.functions[s].GetValueAt(e,n),i.vec3.add(r,r,n);return r}}}]),t}();o.inputDimension=3,o.outputDimension=3,o.valueProperty="value",o.curveType=a.Tw2CurveSequencer.Type.SEQUENCER,o.childArray="functions",o.Operator={MULTIPLY:0,ADD:1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2XYZScalarSequencer=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(7);var o=t.Tw2XYZScalarSequencer=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=i.vec3.create(),e.XCurve=null,e.YCurve=null,e.ZCurve=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2CurveSequencer),n(t,[{key:"Sort",value:function(){a.Tw2CurveSequencer.Sort2(this)}},{key:"GetLength",value:function(){var e=0;return this.XCurve&&"GetLength"in this.XCurve&&(e=this.XCurve.GetLength()),this.YCurve&&"GetLength"in this.YCurve&&(e=Math.max(e,this.YCurve.GetLength())),this.ZCurve&&"GetLength"in this.ZCurve&&(e=Math.max(e,this.ZCurve.GetLength())),e}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.value)}},{key:"GetValueAt",value:function(e,t){return t[0]=this.XCurve?this.XCurve.GetValueAt(e):0,t[1]=this.YCurve?this.YCurve.GetValueAt(e):0,t[2]=this.ZCurve?this.ZCurve.GetValueAt(e):0,t}}]),t}();o.inputDimension=1,o.outputDimension=3,o.valueProperty="value",o.curveType=a.Tw2CurveSequencer.Type.SEQUENCER2,o.childProperties=["XCurve","YCurve","ZCurve"]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2YPRSequencer=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(7);var o=t.Tw2YPRSequencer=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=i.quat.create(),e.YawPitchRoll=i.vec3.create(),e.YawCurve=null,e.PitchCurve=null,e.RollCurve=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2CurveSequencer),n(t,[{key:"Sort",value:function(){a.Tw2CurveSequencer.Sort2(this)}},{key:"GetLength",value:function(){var e=0;return this.YawCurve&&"GetLength"in this.YawCurve&&(e=this.YawCurve.GetLength()),this.PitchCurve&&"GetLength"in this.PitchCurve&&(e=Math.max(e,this.PitchCurve.GetLength())),this.RollCurve&&"GetLength"in this.RollCurve&&(e=Math.max(e,this.RollCurve.GetLength())),e}},{key:"UpdateValue",value:function(e){this.GetValueAt(e,this.value)}},{key:"GetValueAt",value:function(e,t){this.YawCurve&&(this.YawPitchRoll[0]=this.YawCurve.GetValueAt(e)),this.PitchCurve&&(this.YawPitchRoll[1]=this.PitchCurve.GetValueAt(e)),this.RollCurve&&(this.YawPitchRoll[2]=this.RollCurve.GetValueAt(e));var r=Math.sin(this.YawPitchRoll[0]/180*Math.PI/2),n=Math.cos(this.YawPitchRoll[0]/180*Math.PI/2),i=Math.sin(this.YawPitchRoll[1]/180*Math.PI/2),a=Math.cos(this.YawPitchRoll[1]/180*Math.PI/2),o=Math.sin(this.YawPitchRoll[2]/180*Math.PI/2),s=Math.cos(this.YawPitchRoll[2]/180*Math.PI/2);return t[0]=r*a*o+n*i*s,t[1]=r*a*s-n*i*o,t[2]=n*a*o-r*i*s,t[3]=n*a*s+r*i*o,t}}]),t}();o.inputDimension=1,o.outputDimension=4,o.valueProperty="value",o.curveType=a.Tw2CurveSequencer.Type.SEQUENCER2,o.childProperties=["YawCurve","PitchCurve","RollCurve"]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(154);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r(155);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2WbgTrack=i,t.Tw2WbgTransformTrack=a;var n=r(0);function i(){this._id=n.util.generateID(),this.name="",this.geometryResPath="",this.geometryRes=null,this.group="",this.duration=0,this.cycle=!1,this.Initialize=function(){if(this.geometryResPath){this.geometryRes=n.resMan.GetResource(this.geometryResPath);var e=this,t={OnResPrepared:function(){!function(e){if(e.name&&e.group&&e.geometryRes)for(var t=0;t<e.geometryRes.animations.length;++t)for(var r=e.geometryRes.animations[t],n=0;n<r.trackGroups.length;++n)r.trackGroups[n].name===e.group&&e._ApplyTracks(r.trackGroups[n],r.duration)}(e)}};this.geometryRes.RegisterNotification(t)}},this.UpdateValue=function(e){this._TracksReady()&&(this.cycle&&(e%=this.duration),e<=this.duration&&e>=0&&this._UpdateValue(e))}}function a(){this._id=n.util.generateID(),this.translation=n.vec3.create(),this.rotation=n.quat.create(),this.rotation[3]=1,this.scale=n.vec3.create();var e=null,t=null,r=null,i=n.mat4.create();this._TracksReady=function(){return e||t||r},this._ApplyTracks=function(n,i){for(var a=0;a<n.transformTracks.length;++a){var o=n.transformTracks[a];o.name===this.name&&(this.duration=i,e=o.position,t=o.orientation,r=o.scaleShear)}this.UpdateValue(0)},this._UpdateValue=function(a){e&&n.curve.evaluate(e,a,this.translation,this.cycle,this.duration),t&&(n.curve.evaluate(t,a,this.rotation,this.cycle,this.duration),n.quat.normalize(this.rotation,this.rotation)),r&&n.curve.evaluate(r,a,i,this.cycle,this.duration),this.scale[0]=i[0],this.scale[1]=i[5],this.scale[2]=i[10]}}a.prototype=new i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2TransformTrack=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);t.Tw2TransformTrack=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.name="",this.resPath="",this.res=null,this.group="",this.cycle=!1,this.duration=0,this.translation=i.vec3.create(),this.rotation=i.quat.create(),this.scale=i.vec3.fromValues(0,0,0),this.scaleShear=i.mat4.create(),this.positionCurve=null,this.orientationCurve=null,this.scaleCurve=null}return n(e,[{key:"Initialize",value:function(){""!==this.resPath&&(this.res=i.resMan.GetResource(this.resPath))}},{key:"GetLength",value:function(){return this.duration}},{key:"UpdateValue",value:function(e){this.res&&this.res.IsGood()&&(this.positionCurve||this.FindTracks(),this.positionCurve&&(this.cycle&&(e%=this.duration),e>this.duration||e<0||(i.curve.evaluate(this.positionCurve,e,this.translation,this.cycle,this.duration),i.curve.evaluate(this.orientationCurve,e,this.rotation,this.cycle,this.duration),i.quat.normalize(this.rotation,this.rotation),i.curve.evaluate(this.scaleCurve,e,this.scaleShear,this.cycle,this.duration),i.mat4.getScaling(this.scale,this.scaleCurve))))}},{key:"FindTracks",value:function(){for(var e=null,t=0;t<this.res.animations.length;++t)for(var r=0;r<this.res.animations[t].trackGroups.length;++r)if(this.res.animations[t].trackGroups[r].name===this.group){this.duration=this.res.animations[t].duration,e=this.res.animations[t].trackGroups[r];break}if(e)for(var n=0;n<e.transformTracks.length;++n)if(this.name===e.transformTracks[n].name){this.positionCurve=e.transformTracks[n].position,this.orientationCurve=e.transformTracks[n].orientation,this.scaleCurve=e.transformTracks[n].scaleShear;break}}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(157);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r(158);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(159);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var o=r(160);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2MayaEulerRotationCurve=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(16);var o=t.Tw2MayaEulerRotationCurve=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.xIndex=-1,e.yIndex=-1,e.zIndex=-1,e.animationEngine=null,e.eulerValue=i.vec3.create(),e.updateQuaternion=!1,e.quatValue=i.quat.create(),e.length=0,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2Curve),n(t,[{key:"Sort",value:function(){this.ComputeLength()}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){if(this.animationEngine&&(this.xIndex&&(this.eulerValue[0]=this.animationEngine.Evaluate(this.xIndex,e)),this.yIndex&&(this.yIndex===this.xIndex?this.eulerValue[1]=this.eulerValue[0]:this.eulerValue[1]=this.animationEngine.Evaluate(this.yIndex,e)),this.zIndex&&(this.zIndex===this.xIndex?this.eulerValue[2]=this.eulerValue[0]:this.eulerValue[2]=this.animationEngine.Evaluate(this.zIndex,e)),this.updateQuaternion)){var t=Math.sin(this.eulerValue[0]/2),r=Math.cos(this.eulerValue[0]/2),n=Math.sin(this.eulerValue[1]/2),i=Math.cos(this.eulerValue[1]/2),a=Math.sin(this.eulerValue[2]/2),o=Math.cos(this.eulerValue[2]/2);this.quatValue[0]=t*i*a+r*n*o,this.quatValue[1]=t*i*o-r*n*a,this.quatValue[2]=r*i*a-t*n*o,this.quatValue[3]=r*i*o+t*n*a}}},{key:"ComputeLength",value:function(){this.animationEngine&&0!==this.animationEngine.GetNumberOfCurves()&&(this.length=0,this.xIndex>=0&&(this.length=this.animationEngine.GetLength(this.xIndex)),this.yIndex>=0&&(this.length=Math.max(this.length,this.animationEngine.GetLength(this.yIndex))),this.zIndex>=0&&(this.length=Math.max(this.length,this.animationEngine.GetLength(this.zIndex))))}}]),t}();o.outputDimension=3,o.valueProperty="eulerValue",o.curveType=a.Tw2Curve.Type.CURVE_MAYA},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2MayaScalarCurve=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(16);var a=t.Tw2MayaScalarCurve=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.index=-1,e.animationEngine=null,e.value=0,e.length=0,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Tw2Curve),n(t,[{key:"Sort",value:function(){this.ComputeLength()}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.animationEngine&&(this.value=this.animationEngine.Evaluate(this.index,e))}},{key:"ComputeLength",value:function(){this.animationEngine&&0!==this.animationEngine.GetNumberOfCurves()&&this.index>=0&&(this.length=this.animationEngine.GetLength(this.index))}}]),t}();a.outputDimension=1,a.valueProperty="value",a.curveType=i.Tw2Curve.Type.CURVE_MAYA},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2MayaVector3Curve=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(16);var o=t.Tw2MayaVector3Curve=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.xIndex=-1,e.yIndex=-1,e.zIndex=-1,e.animationEngine=null,e.value=i.vec3.create(),e.length=0,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2Curve),n(t,[{key:"Sort",value:function(){this.ComputeLength()}},{key:"GetLength",value:function(){return this.length}},{key:"UpdateValue",value:function(e){this.animationEngine&&(this.xIndex&&(this.value[0]=this.animationEngine.Evaluate(this.xIndex,e)),this.yIndex&&(this.yIndex===this.xIndex?this.value[1]=this.value[0]:this.value[1]=this.animationEngine.Evaluate(this.yIndex,e)),this.zIndex&&(this.zIndex===this.xIndex?this.value[2]=this.value[0]:this.value[2]=this.animationEngine.Evaluate(this.zIndex,e)))}},{key:"ComputeLength",value:function(){this.animationEngine&&0!==this.animationEngine.GetNumberOfCurves()&&(this.length=0,this.xIndex>=0&&(this.length=this.animationEngine.GetLength(this.xIndex)),this.yIndex>=0&&(this.length=Math.max(this.length,this.animationEngine.GetLength(this.yIndex))),this.zIndex>=0&&(this.length=Math.max(this.length,this.animationEngine.GetLength(this.zIndex))))}}]),t}();o.outputDimension=3,o.valueProperty="value",o.curveType=a.Tw2Curve.Type.CURVE_MAYA},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2MayaAnimationEngine=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(1);var o=t.Tw2MayaAnimationEngine=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.curves=[],this.hermiteSegments=[],this.bezierSegments=[],this._currentCurveIndex=0,this._evalCache=null}return n(e,[{key:"Evaluate",value:function(t,r){if(this.curves.length<=t)return 0;if(this._currentCurveIndex=t,!this._evalCache){this._evalCache=new Array(this.curves.length);for(var n=0;n<this._evalCache.length;++n)this._evalCache[n]=-1}var i=this.curves[t],a=i[e.AnimCurveFields.SEGMENT_OFFSET],o=null;return r<(o=i[e.AnimCurveFields.IS_WEIGHTED]?this.bezierSegments:this.hermiteSegments)[a][e.AnimSegment.TIME]?i[e.AnimCurveFields.PRE_INFINITY]===e.INFINITY?o[a][e.AnimSegment.VALUE]:this._EvaluateInfinities(i,o,a,r,!0):r>i[e.AnimCurveFields.END_TIME]?i[e.AnimCurveFields.POST_INFINITY]===e.INFINITY?i[e.AnimCurveFields.END_VALUE]:this._EvaluateInfinities(i,o,a,r,!1):this._EvaluateImpl(i,o,a,r)}},{key:"_EvaluateImpl",value:function(t,r,n,i){var a=!1,o=null,s=null,u=void 0;if(this._evalCache[this._currentCurveIndex]>=0)if(s=n+this._evalCache[this._currentCurveIndex],this._evalCache[this._currentCurveIndex]<t[e.AnimCurveFields.NUM_SEGMENTS-1]&&i>r[s][e.AnimSegment.TIME]){if(i===r[o=n+this._evalCache[this._currentCurveIndex]+1][e.AnimSegment.TIME])return this._evalCache[this._currentCurveIndex]++,r[o][e.AnimSegment.VALUE];i<r[o][e.AnimSegment.TIME]?(u=this._evalCache[this._currentCurveIndex]+1,a=!0):o=null}else if(this._evalCache[this._currentCurveIndex]>0&&i<r[s][e.AnimSegment.TIME]){var l=n+this._evalCache[this._currentCurveIndex]-1;if(i>r[l][e.AnimSegment.TIME])u=this._evalCache[this._currentCurveIndex],a=!0;else if(i===r[l][e.AnimSegment.TIME])return this._evalCache[this._currentCurveIndex]--,r[l][e.AnimSegment.VALUE]}if(!a){var c=this._Find(t,i,r,n);if(u=c[1],c[0]||0===u)return u===t[e.AnimCurveFields.NUM_SEGMENTS]?(u--,this._evalCache[this._currentCurveIndex]=u,t[e.AnimCurveFields.END_VALUE]):(this._evalCache[this._currentCurveIndex]=u,r[n+u][e.AnimSegment.VALUE]);if(u===t[e.AnimCurveFields.NUM_SEGMENTS]+1)return this._evalCache[this._currentCurveIndex]=0,t[e.AnimCurveFields.END_VALUE]}if(this._evalCache[this._currentCurveIndex]!==u-1&&(this._evalCache[this._currentCurveIndex]=u-1,s=n+this._evalCache[this._currentCurveIndex],null===o&&(o=n+u)),t[e.AnimCurveFields.IS_WEIGHTED]){var f=r[s];if(f[e.BezierSegment.IS_STEP])return f[e.BezierSegment.VALUE];if(f[e.BezierSegment.IS_STEP_NEXT])return null===o?t[e.AnimCurveFields.END_VALUE]:r[o][e.BezierSegment.VALUE];var h=t[e.AnimCurveFields.END_TIME];return this._evalCache[this._currentCurveIndex]+1<t[e.AnimCurveFields.NUM_SEGMENTS]&&(h=r[o][e.BezierSegment.TIME]),this._EvaluateBezier(f,i,h)}var p=r[s];return p[e.HermiteSegment.IS_STEP]?p[e.HermiteSegment.VALUE]:p[e.HermiteSegment.IS_STEP_NEXT]?null===o?t[e.AnimCurveFields.END_VALUE]:r[o][e.HermiteSegment.VALUE]:this._EvaluateHermite(p,i)}},{key:"_EvaluateInfinities",value:function(e,t,r,n,i){throw new a.Tw2FeatureNotImplementedError({value:"EvaluateInfinities"})}},{key:"_EvaluateHermite",value:function(t,r){var n=r-t[e.HermiteSegment.TIME],i=t[e.HermiteSegment.COEFF];return n*(n*(n*i[0]+i[1])+i[2])+i[3]}},{key:"_EvaluateBezier",value:function(t,r,n){var a,o=void 0;if(a=(r-t[e.BezierSegment.TIME])/(n-t[e.BezierSegment.TIME]),t[e.BezierSegment.IS_LINEAR])o=a;else{var s=i.vec4.create();s[3]=t[e.BezierSegment.COEFF][3],s[2]=t[e.BezierSegment.COEFF][2],s[1]=t[e.BezierSegment.COEFF][1],s[0]=t[e.BezierSegment.COEFF][0]-a;var u=[];o=1===i.curve.polyZeroes(s,3,0,1,1,1,u)?u[0]:0}var l=t[e.BezierSegment.POLYY];return o*(o*(o*l[3]+l[2])+l[1])+l[0]}},{key:"_Find",value:function(t,r,n,i){var a,o=void 0,s=void 0,u=void 0,l=0,c=0;if((a=t[e.AnimCurveFields.NUM_SEGMENTS]+1)>0){s=0,u=a-1;do{if(r<(c=(o=s+u>>1)<a-1?n[i+o][e.AnimSegment.TIME]:t[e.AnimCurveFields.END_TIME]))u=o-1;else{if(!(r>c))return[!0,l=o];s=o+1}}while(s<=u);l=s}return[!1,l]}},{key:"GetNumberOfCurves",value:function(){return this.curves.length}},{key:"GetLength",value:function(t){if(t<0||t>=this.curves.length)return 0;var r=this.curves[t],n=void 0;return n=r[e.AnimCurveFields.IS_WEIGHTED]?this.bezierSegments[r[e.AnimCurveFields.SEGMENT_OFFSET]]:this.hermiteSegments[r[e.AnimCurveFields.SEGMENT_OFFSET]],r[e.AnimCurveFields.END_TIME]-n[e.AnimSegment.TIME]}}]),e}();o.AnimCurveFields={NUM_SEGMENTS:0,SEGMENT_OFFSET:1,END_TIME:2,END_VALUE:3,IN_TANGENT:4,OUT_TANGENT:5,PRE_INFINITY:6,POST_INFINITY:7,IS_WEIGHTED:8},o.AnimSegment={TIME:0,VALUE:1},o.HermiteSegment={TIME:0,VALUE:1,COEFF:2,IS_STEP:3,IS_STEP_NEXT:4},o.BezierSegment={TIME:0,VALUE:1,COEFF:2,POLYY:3,IS_STEP:4,IS_STEP_NEXT:5,IS_LINEAR:6},o.INFINITY=0},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(61);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r(168);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(63);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var o=r(65);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var s=r(186);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var u=r(187);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveChildBillboard=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(1),o=r(8);t.EveChildBillboard=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.mesh=null,e._perObjectData=new a.Tw2BasicPerObjectData(o.EveChild.perObjectData),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.EveChild),n(t,[{key:"GetResources",value:function(e){return this.mesh&&this.mesh.GetResources(e),e}},{key:"Update",value:function(e,r){(function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(n):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"Update",this).call(this,e,r);var n=o.EveChild.global.mat4_0,a=o.EveChild.global.vec3_0;i.mat4.lookAt(n,i.device.eyePosition,this.worldTransform.subarray(12),[0,1,0]),i.mat4.transpose(n,n),i.mat4.getScaling(a,r),i.vec3.multiply(a,a,this.scaling),this.worldTransform[0]=n[0]*a[0],this.worldTransform[1]=n[1]*a[0],this.worldTransform[2]=n[2]*a[0],this.worldTransform[4]=n[4]*a[1],this.worldTransform[5]=n[5]*a[1],this.worldTransform[6]=n[6]*a[1],this.worldTransform[8]=n[8]*a[2],this.worldTransform[9]=n[9]*a[2],this.worldTransform[10]=n[10]*a[2]}},{key:"GetBatches",value:function(e,t){this.display&&this.mesh&&(i.mat4.transpose(this._perObjectData.perObjectFFEData.Get("world"),this.worldTransform),i.mat4.invert(this._perObjectData.perObjectFFEData.Get("worldInverseTranspose"),this.worldTransform),this.mesh.GetBatches(e,t,this._perObjectData))}}]),t}()},function(e,t,r){"use strict";var n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.EveChildCloud=void 0;var a=r(8);t.EveChildCloud=(i=n=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.EveChild),t}(),n.partialImplementation=!0,i)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveChildContainer=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(8);t.EveChildContainer=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.objects=[],e.curveSets=[],e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.EveChild),n(t,[{key:"GetResources",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=0;t<this.objects.length;t++)"GetResources"in this.objects[t]&&this.objects[t].GetResources(e);return e}},{key:"Update",value:function(e,r){(function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(n):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"Update",this).call(this,e,r);for(var n=0;n<this.curveSets.length;n++)this.curveSets[n].Update(e);for(var i=0;i<this.objects.length;i++)this.objects[i].Update(e,this.worldTransform)}},{key:"GetBatches",value:function(e,t,r){if(this.display)for(var n=0;n<this.objects.length;n++)this.objects[n].GetBatches(e,t,r)}}]),t}()},function(e,t,r){"use strict";var n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.EveChildExplosion=void 0;var a=r(8);t.EveChildExplosion=(i=n=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.EveChild),t}(),n.partialImplementation=!0,i)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveChildMesh=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(1),o=r(8);t.EveChildMesh=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.mesh=null,e.useSpaceObjectData=!0,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.EveChild),n(t,[{key:"GetResources",value:function(e){return this.mesh&&this.mesh.GetResources(e),e}},{key:"GetBatches",value:function(e,t,r){this.display&&this.mesh&&(this.useSpaceObjectData?(this._perObjectData||(this._perObjectData=new a.Tw2PerObjectData,this._perObjectData.perObjectVSData=new a.Tw2RawData,this._perObjectData.perObjectVSData.data=new Float32Array(r.perObjectVSData.data.length),this._perObjectData.perObjectVSData.data[33]=1,this._perObjectData.perObjectVSData.data[35]=1,this._perObjectData.perObjectPSData=new a.Tw2RawData,this._perObjectData.perObjectPSData.data=new Float32Array(r.perObjectPSData.data.length),this._perObjectData.perObjectPSData.data[1]=1,this._perObjectData.perObjectPSData.data[3]=1),this._perObjectData.perObjectVSData.data.set(r.perObjectVSData.data),this._perObjectData.perObjectPSData.data.set(r.perObjectPSData.data),i.mat4.transpose(this._perObjectData.perObjectVSData.data,this.worldTransform),i.mat4.transpose(this._perObjectData.perObjectVSData.data.subarray(16),this.worldTransformLast)):(this._perObjectData||(this._perObjectData=new a.Tw2BasicPerObjectData(o.EveChild.perObjectData)),i.mat4.transpose(this._perObjectData.perObjectFFEData.Get("world"),this.worldTransform),i.mat4.invert(this._perObjectData.perObjectFFEData.Get("worldInverseTranspose"),this.worldTransform)),this.mesh.GetBatches(e,t,this._perObjectData))}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveChildParticleSystem=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(1),o=r(8);t.EveChildParticleSystem=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.mesh=null,e.particleEmitters=[],e.particleSystems=[],e._perObjectData=new a.Tw2BasicPerObjectData(o.EveChild.perObjectData),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.EveChild),n(t,[{key:"GetResources",value:function(e){return this.mesh&&this.mesh.GetResources(e),e}},{key:"Update",value:function(e,r){(function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(n):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"Update",this).call(this,e,r);for(var n=0;n<this.particleEmitters.length;++n)this.particleEmitters[n].Update(e);for(var i=0;i<this.particleSystems.length;++i)this.particleSystems[i].Update(e)}},{key:"GetBatches",value:function(e,t){this.display&&this.mesh&&(i.mat4.transpose(this._perObjectData.perObjectFFEData.Get("world"),this.worldTransform),i.mat4.invert(this._perObjectData.perObjectFFEData.Get("worldInverseTranspose"),this.worldTransform),this.mesh.GetBatches(e,t,this._perObjectData))}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(169);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r(170);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(62);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var o=r(171);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var s=r(172);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var u=r(173);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveLensflare=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(1),o=r(62);(t.EveLensflare=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.name="",this.display=!0,this.update=!0,this.doOcclusionQueries=!0,this.cameraFactor=20,this.position=i.vec3.create(),this.flares=[],this.occluders=[],this.backgroundOccluders=[],this.occlusionIntensity=1,this.backgroundOcclusionIntensity=1,this.distanceToEdgeCurves=[],this.distanceToCenterCurves=[],this.radialAngleCurves=[],this.xDistanceToCenter=[],this.yDistanceToCenter=[],this.bindings=[],this.curveSets=[],this.mesh=null,this._direction=i.vec3.create(),this._transform=i.mat4.create(),this._backBuffer=null,e.init()}return n(e,[{key:"GetResources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.mesh&&this.mesh.GetResources(e);for(var t=0;t<this.flares.length;t++)this.flares[t].GetResources(e);return o.EveOccluder.global&&o.EveOccluder.global.effect&&!e.includes(o.EveOccluder.global.effect)&&e.push(o.EveOccluder.global.effect),e}},{key:"UpdateOccluders",value:function(){if(this.doOcclusionQueries){var t=i.device,r=e.global;if(!r.occluderLevels[0].texture||r.occluderLevels[0].width<2*this.occluders.length)for(var n=0;n<r.occluderLevels.length;++n)r.occluderLevels[n].Create(2*this.occluders.length,1,!1);for(var a=0;a<this.flares.length;++a)"_backBuffer"in this.flares[a]&&(this.flares[a]._backBuffer.textureRes=r.occluderLevels.texture);this.occlusionIntensity=1,this.backgroundOcclusionIntensity=1,r.occluderLevels[r.occludedLevelIndex].Set(),t.SetStandardStates(t.RM_OPAQUE),t.gl.clearColor(0,0,0,1),t.gl.clear(t.gl.COLOR_BUFFER_BIT),r.occluderLevels[r.occludedLevelIndex].Unset();var s=1;t.antialiasing&&(s=t.msaaSamples,t.gl.sampleCoverage(1/s,!1));for(var u=0;u<this.occluders.length;++u)t.SetRenderState(t.RS_COLORWRITEENABLE,8),t.gl.colorMask(!1,!1,!1,!0),t.gl.clearColor(0,0,0,0),t.gl.clear(t.gl.COLOR_BUFFER_BIT),t.antialiasing&&(t.gl.enable(t.gl.SAMPLE_COVERAGE),t.gl.sampleCoverage(.25,!1)),this.occluders[u].UpdateValue(this._transform,u),t.antialiasing&&t.gl.disable(t.gl.SAMPLE_COVERAGE),r.backBuffer.texture||r.backBuffer.Attach(t.gl.createTexture()),t.gl.bindTexture(t.gl.TEXTURE_2D,r.backBuffer.texture),r.backBuffer.width===t.viewportWidth&&r.backBuffer.height===t.viewportHeight||(t.gl.texImage2D(t.gl.TEXTURE_2D,0,t.gl.RGBA,t.viewportWidth,t.viewportHeight,0,t.gl.RGBA,t.gl.UNSIGNED_BYTE,null),t.gl.texParameteri(t.gl.TEXTURE_2D,t.gl.TEXTURE_MAG_FILTER,t.gl.LINEAR),t.gl.texParameteri(t.gl.TEXTURE_2D,t.gl.TEXTURE_MIN_FILTER,t.gl.LINEAR),r.backBuffer.width=t.viewportWidth,r.backBuffer.height=t.viewportHeight),t.gl.copyTexImage2D(t.gl.TEXTURE_2D,0,t.alphaBlendBackBuffer?t.gl.RGBA:t.gl.RGB,0,0,r.backBuffer.width,r.backBuffer.height,0),t.gl.bindTexture(t.gl.TEXTURE_2D,null),r.occluderLevels[r.occludedLevelIndex].Set(),o.EveOccluder.CollectSamples(r.backBuffer,u,r.occluderLevels[0].width/2,s),r.occluderLevels[r.occludedLevelIndex].Unset();t.antialiasing&&t.gl.sampleCoverage(1,!1),r.occluderLevels[(r.occludedLevelIndex+1)%r.occluderLevels.length].Set();var l=new Uint8Array(4*r.occluderLevels[0].width);t.gl.readPixels(0,0,2,1,t.gl.RGBA,t.gl.UNSIGNED_BYTE,l),r.occluderLevels[(r.occludedLevelIndex+1)%r.occluderLevels.length].Unset(),this.occlusionIntensity=1;for(var c=0;c<2*r.occluderLevels[0].width;c+=4)this.occlusionIntensity*=l[c+1]?l[c]/l[c+1]:1;this.backgroundOcclusionIntensity=this.occlusionIntensity,i.store.SetVariableValue("LensflareFxOccScale",[this.occlusionIntensity,this.occlusionIntensity,0,0]),r.occludedLevelIndex=(r.occludedLevelIndex+1)%r.occluderLevels.length}}},{key:"GetBatches",value:function(t,r,n){if(this.display){var a=i.vec4.set(e.global.vec4_0,0,0,1,0);if(i.vec4.transformMat4(a,a,i.device.viewInverse),i.vec3.dot(a,this._direction)<0)return;for(var o=0;o<this.flares.length;++o)this.flares[o].GetBatches(t,r,n);this.mesh&&this.mesh.GetBatches(t,r,n)}}},{key:"PrepareRender",value:function(){if(this.display){var t=e.global,r=t.vec4_0,n=t.vec3_0,a=i.mat4.identity(t.mat4_0),o=t.vec3_2,s=t.vec3_3,u=t.vec3_1,l=t.vec4_1;i.vec3.transformMat4(n,[0,0,0],i.device.viewInverse),0===i.vec3.length(this.position)?i.vec3.negate(u,n):(i.vec3.negate(u,this.position),i.vec3.normalize(this._direction,u)),i.vec4.transformMat4(r,[0,0,1,0],i.device.viewInverse),i.vec3.scaleAndAdd(o,n,r,-this.cameraFactor),i.vec3.negate(s,this._direction),i.mat4.arcFromForward(this._transform,s),i.mat4.setTranslation(this._transform,o),i.mat4.scale(a,a,[this.occlusionIntensity,this.occlusionIntensity,1]);var c=this._direction;i.store.SetVariableValue("LensflareFxDirectionScale",[c[0],c[1],c[2],1]),i.vec4.set(l,c[0],c[1],c[2],0),i.vec4.transformMat4(l,l,i.device.view),i.vec4.transformMat4(l,l,i.device.projection),l[0]/=l[3],l[1]/=l[3];for(var f=1-Math.min(1-Math.abs(l[0]),1-Math.abs(l[1])),h=Math.sqrt(l[0]*l[0]+l[1]*l[1]),p=Math.atan2(l[1],l[0])+Math.PI,d=0;d<this.distanceToEdgeCurves.length;++d)this.distanceToEdgeCurves[d].UpdateValue(f);for(var v=0;v<this.distanceToCenterCurves.length;++v)this.distanceToCenterCurves[v].UpdateValue(h);for(var m=0;m<this.radialAngleCurves.length;++m)this.radialAngleCurves[m].UpdateValue(p);for(var y=0;y<this.xDistanceToCenter.length;++y)this.xDistanceToCenter[y].UpdateValue(l[0]+10);for(var b=0;b<this.yDistanceToCenter.length;++b)this.yDistanceToCenter[b].UpdateValue(l[1]+10);for(var _=0;_<this.bindings.length;++_)this.bindings[_].CopyValue();for(var g=0;g<this.flares.length;++g)this.flares[g].UpdateViewDependentData(this._transform)}}}],[{key:"init",value:function(){if(!e.global){var t=e.global={};t.vec3_0=i.vec3.create(),t.vec3_1=i.vec3.create(),t.vec3_2=i.vec3.create(),t.vec3_3=i.vec3.create(),t.vec4_0=i.vec4.create(),t.vec4_1=i.vec4.create(),t.mat4_0=i.mat4.create(),t.backBuffer=new a.Tw2TextureRes,t.backBuffer.width=0,t.backBuffer.height=0,t.backBuffer.hasMipMaps=!1,t.occludedLevelIndex=0,t.occluderLevels=[new a.Tw2RenderTarget,new a.Tw2RenderTarget,new a.Tw2RenderTarget,new a.Tw2RenderTarget]}}}]),e}()).global=null},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveMeshOverlayEffect=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(1),a=r(0);t.EveMeshOverlayEffect=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=a.util.generateID(),this.name="",this.display=!0,this.visible={},this.visible.opaqueEffects=!0,this.visible.decalEffects=!0,this.visible.transparentEffects=!0,this.visible.additiveEffects=!0,this.visible.distortionEffects=!0,this.update=!0,this.curveSet=null,this.opaqueEffects=[],this.decalEffects=[],this.transparentEffects=[],this.additiveEffects=[],this.distortionEffects=[]}return n(e,[{key:"GetResources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return a.util.perArrayChild(this.opaqueEffects,"GetResources",e),a.util.perArrayChild(this.decalEffects,"GetResources",e),a.util.perArrayChild(this.transparentEffects,"GetResources",e),a.util.perArrayChild(this.additiveEffects,"GetResources",e),a.util.perArrayChild(this.distortionEffects,"GetResources",e),e}},{key:"Update",value:function(e){this.update&&this.curveSet&&this.curveSet.Update(e)}},{key:"GetBatches",value:function(e,t,r,n){if(this.display&&n&&n.IsGood())for(var a=this.GetEffects(e),o=0;o<a.length;o++){var s=new i.Tw2GeometryBatch;s.renderMode=e,s.perObjectData=r,s.geometryRes=n.geometryResource,s.meshIx=n.meshIndex,s.start=0,s.count=n.geometryResource.meshes[n.meshIndex].areas.length,s.effect=a[o],t.Commit(s)}}},{key:"GetEffects",value:function(e){if(this.display)switch(e){case a.device.RM_OPAQUE:if(this.visible.opaqueEffects)return this.opaqueEffects;break;case a.device.RM_TRANSPARENT:if(this.visible.transparentEffects)return this.transparentEffects;break;case a.device.RM_ADDITIVE:if(this.visible.additiveEffects)return this.additiveEffects;break;case a.device.RM_DECAL:if(this.visible.decalEffects)return this.decalEffects;break;case a.device.RM_DISTORTION:if(this.visible.distortionEffects)return this.distortionEffects}return[]}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveStretch=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(1);(t.EveStretch=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.name="",this.display=!0,this.update=!0,this.curveSets=[],this.source=null,this.dest=null,this.sourceObject=null,this.destObject=null,this.stretchObject=null,this.length=new a.Tw2Float,this._time=0,this._useTransformsForStretch=!1,this._sourcePosition=i.vec3.create(),this._destinationPosition=i.vec3.create(),this._displaySourceObject=!0,this._sourceTransform=null,this._displayDestObject=!0,this._useTransformsForStretch=!1,this._isNegZForward=!1,e.init()}return n(e,[{key:"SetSourcePosition",value:function(e){this._useTransformsForStretch=!1,this._sourcePosition=e}},{key:"SetDestinationPosition",value:function(e){this._destinationPosition=e}},{key:"SetSourceTransform",value:function(e){this._useTransformsForStretch=!0,this._sourceTransform=e}},{key:"SetIsNegZForward",value:function(e){this._isNegZForward=e}},{key:"GetResources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.source&&this.source.GetResources&&this.source.GetResources(e),this.dest&&this.dest.GetResources&&this.dest.GetResources(e),this.sourceObject&&this.sourceObject.GetResources&&this.sourceObject.GetResources(e),this.destObject&&this.destObject.GetResources&&this.destObject.GetResources(e),this.stretchObject&&this.stretchObject.GetResources&&this.stretchObject.GetResources(e),e}},{key:"UpdateViewDependentData",value:function(){if(this.display){var t=e.global,r=i.vec3.subtract(t.vec3_0,this._destinationPosition,this._sourcePosition),n=i.mat4.identity(t.mat4_0),a=i.vec3.set(t.vec3_1,0,0,0),o=i.vec3.set(t.vec3_2,0,0,0),s=i.mat4.identity(t.mat4_1),u=i.vec3.length(r);i.vec3.normalize(r,r),this._useTransformsForStretch?(i.mat4.rotateX(n,n,-Math.PI/2),i.mat4.multiply(n,this._sourceTransform,n)):(Math.abs(r[1])>.9?o[2]=1:o[1]=1,i.vec3.cross(a,o,r),i.vec3.normalize(a,a),i.vec3.cross(o,r,a),n[0]=a[0],n[1]=a[1],n[2]=a[2],n[4]=-r[0],n[5]=-r[1],n[6]=-r[2],n[8]=o[0],n[9]=o[1],n[10]=o[2]),this.destObject&&this._displayDestObject&&(i.mat4.setTranslation(n,this._destinationPosition),this.destObject.UpdateViewDependentData(n)),this.sourceObject&&this._displaySourceObject&&(this._useTransformsForStretch?(i.mat4.identity(n),i.mat4.rotateX(n,n,-Math.PI/2),i.mat4.multiply(n,this._sourceTransform,n)):i.mat4.setTranslation(n,this._sourcePosition),this.sourceObject.UpdateViewDependentData(n)),this.stretchObject&&(this._useTransformsForStretch?(i.mat4.identity(n),i.mat4.scale(n,n,[1,1,u]),i.mat4.multiply(n,this._sourceTransform,n)):(n[0]=a[0],n[1]=a[1],n[2]=a[2],n[4]=o[0],n[5]=o[1],n[6]=o[2],n[8]=-r[0],n[9]=-r[1],n[10]=-r[2],this._isNegZForward&&(u=-u),i.mat4.scale(s,s,[1,1,u]),i.mat4.multiply(n,n,s)),this.stretchObject.UpdateViewDependentData(n))}}},{key:"Update",value:function(t){for(var r=0;r<this.curveSets.length;++r)this.curveSets[r].Update(t);this._time+=t,this.source?this.source.GetValueAt(this._time,this._sourcePosition):this._useTransformsForStretch&&(this._sourcePosition[0]=this._sourceTransform[12],this._sourcePosition[1]=this._sourceTransform[13],this._sourcePosition[2]=this._sourceTransform[14]),this.dest&&this.source.GetValueAt(this._time,this._destinationPosition);var n=i.vec3.subtract(e.global.vec3_0,this._destinationPosition,this._sourcePosition);this.length.value=i.vec3.length(n),i.vec3.normalize(n,n),this.sourceObject&&this._displaySourceObject&&this.sourceObject.Update(t),this.stretchObject&&this.stretchObject.Update(t),this.destObject&&this._displayDestObject&&this.destObject.Update(t)}},{key:"GetBatches",value:function(e,t,r){this.display&&(this.sourceObject&&this._displaySourceObject&&this.sourceObject.GetBatches(e,t,r),this.destObject&&this._displayDestObject&&this.destObject.GetBatches(e,t,r),this.stretchObject&&this.stretchObject.GetBatches(e,t,r))}}],[{key:"init",value:function(){e.global||(e.global={vec3_0:i.vec3.create(),vec3_1:i.vec3.create(),vec3_2:i.vec3.create(),mat4_0:i.mat4.create(),mat4_1:i.mat4.create()})}}]),e}()).global=null},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveTurretFiringFX=t.EvePerMuzzleData=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=t.EvePerMuzzleData=function e(){a(this,e),this._id=i.util.generateID(),this.started=!1,this.readyToStart=!1,this.muzzlePositionBone=null,this.muzzleTransform=i.mat4.create(),this.muzzlePosition=this.muzzleTransform.subarray(12,15),this.currentStartDelay=0,this.constantDelay=0,this.elapsedTime=0};t.EveTurretFiringFX=function(){function e(){a(this,e),this._id=i.util.generateID(),this.name="",this.display=!0,this.stretch=[],this.useMuzzleTransform=!1,this.isFiring=!1,this.isLoopFiring=!1,this.firingDelay1=0,this.firingDelay2=0,this.firingDelay3=0,this.firingDelay4=0,this.firingDelay5=0,this.firingDelay6=0,this.firingDelay7=0,this.firingDelay8=0,this.endPosition=i.vec3.create(),this._firingDuration=0,this._perMuzzleData=[]}return n(e,[{key:"Initialize",value:function(){this._firingDuration=this.GetCurveDuration();for(var e=0;e<this.stretch.length;++e)this._perMuzzleData[e]=new o;this._perMuzzleData.length>0&&(this._perMuzzleData[0].constantDelay=this.firingDelay1),this._perMuzzleData.length>1&&(this._perMuzzleData[1].constantDelay=this.firingDelay2),this._perMuzzleData.length>2&&(this._perMuzzleData[2].constantDelay=this.firingDelay3),this._perMuzzleData.length>3&&(this._perMuzzleData[3].constantDelay=this.firingDelay4),this._perMuzzleData.length>4&&(this._perMuzzleData[4].constantDelay=this.firingDelay5),this._perMuzzleData.length>5&&(this._perMuzzleData[5].constantDelay=this.firingDelay6),this._perMuzzleData.length>6&&(this._perMuzzleData[6].constantDelay=this.firingDelay7),this._perMuzzleData.length>7&&(this._perMuzzleData[7].constantDelay=this.firingDelay8)}},{key:"GetCurveDuration",value:function(){for(var e=0,t=0;t<this.stretch.length;++t)for(var r=this.stretch[t],n=0;n<r.curveSets.length;++n)e=Math.max(e,r.curveSets[n].GetMaxCurveDuration());return e}},{key:"GetPerMuzzleEffectCount",value:function(){return this.stretch.length}},{key:"SetMuzzleBoneID",value:function(e,t){this._perMuzzleData[e].muzzlePositionBone=t}},{key:"GetMuzzleTransform",value:function(e){return this._perMuzzleData[e].muzzleTransform}},{key:"PrepareFiring",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,r=0;r<this.stretch.length;++r)t<0||t===r?(this._perMuzzleData[r].currentStartDelay=e+this._perMuzzleData[r].constantDelay,this._perMuzzleData[r].started=!1,this._perMuzzleData[r].readyToStart=!1,this._perMuzzleData[r].elapsedTime=0):(this._perMuzzleData[r].currentStartDelay=Number.MAX_VALUE,this._perMuzzleData[r].started=!1,this._perMuzzleData[r].readyToStart=!1,this._perMuzzleData[r].elapsedTime=0);this.isFiring=!0}},{key:"StartMuzzleEffect",value:function(e){for(var t=this.stretch[e],r=0;r<t.curveSets.length;++r){var n=t.curveSets[r];switch(n.name){case"play_start":case"play_loop":n.PlayFrom(-this._perMuzzleData[e].currentStartDelay);break;case"play_stop":n.Stop()}}this._perMuzzleData[e].started=!0,this._perMuzzleData[e].readyToStart=!1}},{key:"StopFiring",value:function(){for(var e=0;e<this.stretch.length;++e){for(var t=this.stretch[e],r=0;r<t.curveSets.length;++r){var n=t.curveSets[r];switch(n.name){case"play_start":case"play_loop":n.Stop();break;case"play_stop":n.Play()}}this._perMuzzleData[e].started=!1,this._perMuzzleData[e].readyToStart=!1,this._perMuzzleData[e].currentStartDelay=0,this._perMuzzleData[e].elapsedTime=0}this.isFiring=!1}},{key:"GetResources",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=0;t<this.stretch.length;t++)this.stretch[t].GetResources(e);return e}},{key:"UpdateViewDependentData",value:function(){for(var e=0;e<this.stretch.length;++e)this.stretch[e].UpdateViewDependentData()}},{key:"Update",value:function(e){for(var t=0;t<this.stretch.length;++t)this._perMuzzleData[t].started&&(this._perMuzzleData[t].elapsedTime+=e),(this._perMuzzleData[t].elapsedTime<this._firingDuration||this.isLoopFiring)&&this.isFiring&&(this._perMuzzleData[t].started?(this.useMuzzleTransform?this.stretch[t].SetSourceTransform(this._perMuzzleData[t].muzzleTransform):this.stretch[t].SetSourcePosition(this._perMuzzleData[t].muzzlePosition),this.stretch[t].SetDestinationPosition(this.endPosition),this.stretch[t].SetIsNegZForward(!0)):(this._perMuzzleData[t].readyToStart?(this.StartMuzzleEffect(t),this._perMuzzleData[t].currentStartDelay=0,this._perMuzzleData[t].elapsedTime=0):this._perMuzzleData[t].currentStartDelay-=e,this._perMuzzleData[t].currentStartDelay<=0&&(this._perMuzzleData[t].readyToStart=!0))),this.stretch[t].Update(e)}},{key:"GetBatches",value:function(e,t,r){if(this.display&&this.isFiring)for(var n=0;n<this.stretch.length;++n)this._perMuzzleData[n].started&&(this._firingDuration>=this._perMuzzleData[n].elapsedTime||this.isLoopFiring)&&this.stretch[n].GetBatches(e,t,r)}}]),e}()},function(e,t,r){"use strict";var n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.EveStarField=void 0;var a=r(0);t.EveStarField=(i=n=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=a.util.generateID(),this.name="",this.display=!0,this.effect=null,this.maxDist=0,this.maxFlashRate=0,this.minFlashIntensity=0,this.minFlashRate=0,this.seed=20},n.partialImplementation=!0,i)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveEffectRoot=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(1),o=r(13),s=r(30);t.EveEffectRoot=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.curveSets=[],e.effectChildren=[],e.duration=0,e.scaling=i.vec3.fromValues(1,1,1),e.rotation=i.quat.create(),e.translation=i.vec3.create(),e.localTransform=i.mat4.create(),e.rotationTransform=i.mat4.create(),e.boundingSphereCenter=i.vec3.create(),e.boundingSphereRadius=0,e._perObjectData=new a.Tw2PerObjectData(s.EveSpaceObject.perObjectData),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.EveObject),n(t,[{key:"Start",value:function(){for(var e=0;e<this.curveSets.length;++e)this.curveSets[e].Play()}},{key:"Stop",value:function(){for(var e=0;e<this.curveSets.length;++e)this.curveSets[e].Stop()}},{key:"GetResources",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=0;t<this.effectChildren.length;++t)this.effectChildren[t].GetResources(e);return e}},{key:"Update",value:function(e){i.quat.normalize(this.rotation,this.rotation),i.mat4.fromRotationTranslationScale(this.localTransform,this.rotation,this.translation,this.scaling);for(var t=0;t<this.curveSets.length;++t)this.curveSets[t].Update(e);for(var r=0;r<this.effectChildren.length;++r)this.effectChildren[r].Update(e,this.localTransform)}},{key:"GetBatches",value:function(e,t){if(this.display)for(var r=0;r<this.effectChildren.length;++r)this.effectChildren[r].GetBatches(e,t,this._perObjectData)}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveMissile=t.EveMissileWarhead=void 0;var n,i,a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),s=r(1),u=r(13);function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var c=t.EveMissileWarhead=(i=n=function(e){function t(){l(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.mesh=null,e.spriteSet=null,e.state=t.State.READY,e.time=0,e.durationEjectPhase=0,e.startEjectVelocity=0,e.acceleration=1,e.maxExplosionDistance=40,e.impactSize=0,e.impactDuration=.6,e.pathOffset=o.vec3.create(),e.transform=o.mat4.create(),e.velocity=o.vec3.create(),e._perObjectData=new s.Tw2PerObjectData(t.perObjectData),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.EveObject),a(t,[{key:"Initialize",value:function(){this.spriteSet&&this.spriteSet.UseQuads(!0)}},{key:"Launch",value:function(e){o.mat4.copy(this.transform,e),this.velocity[0]=e[8]*this.startEjectVelocity,this.velocity[1]=e[9]*this.startEjectVelocity,this.velocity[2]=e[10]*this.startEjectVelocity,this.time=0,this.state=t.State.IN_FLIGHT}},{key:"Clone",value:function(){var e=new t;return e.mesh=this.mesh,e.spriteSet=this.spriteSet,e}},{key:"GetResources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.mesh&&this.mesh.GetResources(e),this.spriteSet&&this.spriteSet.GetResources(e)}},{key:"UpdateViewDependentData",value:function(){this.display&&this.state!==t.State.DEAD&&(o.mat4.transpose(this._perObjectData.perObjectVSData.Get("WorldMat"),this.transform),o.mat4.transpose(this._perObjectData.perObjectVSData.Get("WorldMatLast"),this.transform))}},{key:"Update",value:function(e,r,n){if(this.state===t.State.IN_FLIGHT){var i=t.global,a=o.mat4.getTranslation(i.vec3_0,this.transform),s=i.vec3_1,u=i.vec3_2,l=i.vec3_3;this.time+=e,this.time>this.durationEjectPhase?(o.vec3.subtract(a,this.velocity,r),o.vec3.lerp(a,a,r,1-Math.exp(.9999*-e)),o.mat4.setTranslation(this.transform,a),o.vec3.subtract(s,n,a),o.vec3.length(s)<this.maxExplosionDistance&&(console.log(a,s),this.state=t.State.DEAD)):(o.vec3.scale(s,this.velocity,e),this.transform[12]+=s[0],this.transform[13]+=s[1],this.transform[14]+=s[2]);var c=o.vec3.normalize(s,this.velocity);Math.abs(c[0])<.99?o.vec3.cross(u,c,[1,0,0]):o.vec3.cross(u,c,[0,1,0]),o.vec3.normalize(u,u),o.vec3.cross(l,u,c),this.transform[0]=u[0],this.transform[1]=u[1],this.transform[2]=u[2],this.transform[4]=l[0],this.transform[5]=l[1],this.transform[6]=l[2],this.transform[8]=c[0],this.transform[9]=c[1],this.transform[10]=c[2]}this.spriteSet&&this.spriteSet.Update(e)}},{key:"GetBatches",value:function(e,r){this.display&&this.mesh&&this.state!==t.State.DEAD&&(this.mesh&&this.mesh.GetBatches(e,r,this._perObjectData),this.spriteSet&&this.spriteSet.GetBatches(e,r,this._perObjectData,this.transform))}}]),t}(),n.perObjectData={PSData:[["WorldMat",16],["WorldMatLast",16],["Shipdata",4,[0,1,0,-10]],["Clipdata1",4]],VSData:[["Shipdata",4,[0,1,0,1]],["Clipdata1",4],["Clipdata2",4]]},i);c.State={READY:0,IN_FLIGHT:1,DEAD:2};t.EveMissile=function(){function e(){l(this,e),this._id=o.util.generateID(),this.name="",this.display=!0,this.warheads=[],this.curveSets=[],this.speed=1,this.position=o.vec3.create(),this.target=o.vec3.create(),this.boundingSphereCenter=o.vec3.create(),this.boundingSphereRadius=0,this.warheadExplosionCallback=null,this.missileFinishedCallback=null}return a(e,[{key:"Launch",value:function(e,t,r){if(o.vec3.copy(this.position,e),o.vec3.copy(this.target,r),this.warheads.length>t.length)this.warheads.splice(t.length);else for(;this.warheads.length<t.length;)this.warheads.push(this.warheads[0].Clone());for(var n=0;n<this.warheads.length;++n)this.warheads[0].Launch(t[n])}},{key:"GetResources",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=0;t<this.warheads.length;++t)this.warheads[t].GetResources(e)}},{key:"UpdateViewDependentData",value:function(){for(var e=0;e<this.warheads.length;++e)this.warheads[e].UpdateViewDependentData()}},{key:"Update",value:function(e){var t=o.vec3.subtract(c.global.vec3_0,this.target,this.position),r=o.vec3.length(t);r>.1&&(o.vec3.normalize(t,t),o.vec3.scale(t,t,Math.min(e*this.speed,r)),o.vec3.add(this.position,this.position,t));for(var n=0;n<this.curveSets.length;++n)this.curveSets[n].Update(e);for(var i=!1,a=0;a<this.warheads.length;++a){var s=this.warheads[a].state;this.warheads[a].Update(e,this.position,this.target),s!==c.State.DEAD&&this.warheads[a].state===c.State.DEAD&&(this.warheadExplosionCallback&&this.warheadExplosionCallback(this.warheads[a]),i=!0)}if(i&&this.missileFinishedCallback){for(var u=0;u<this.warheads.length;++u)if(this.warheads[u].state!==c.State.DEAD)return;this.missileFinishedCallback(this)}}},{key:"GetBatches",value:function(e,t){if(this.display)for(var r=0;r<this.warheads.length;++r)this.warheads[r].GetBatches(e,t)}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EvePlanet=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(1),o=r(64),s=r(13);t.EvePlanet=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.highDetail=new o.EveTransform,e.effectHeight=new a.Tw2Effect,e.heightMap=new a.Tw2RenderTarget,e.zOnlyModel=null,e.itemID=0,e.heightMapResPath1="",e.heightMapResPath2="",e.heightDirty=!1,e.lockedResources=[],e.watchedResources=[],e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.EveObject),n(t,[{key:"Create",value:function(){var e=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1],a=r.itemID,o=void 0===a?0:a,s=r.planetPath,u=r.atmospherePath,l=r.heightMap1,c=r.heightMap2;this.itemID=o,this.heightMapResPath1=l,this.heightMapResPath2=c,this.highDetail.children=[],this.heightDirty=!0;var f=1;function h(){--f<1&&n&&n()}s&&f++,u&&f++,s&&i.resMan.GetObject(s,function(r){t.MeshLoaded(e,r),h()}),u&&i.resMan.GetObject(u,function(t){e.highDetail.children.push(t),h()}),i.resMan.GetObject("res:/dx9/model/worldobject/planet/planetzonly.red",function(t){e.zOnlyModel=t,h()})}},{key:"GetPlanetResources",value:function(e,t,r){if(!t.includes(e))if(t.push(e),!e||i.util.isUndefined(e.doNotPurge))for(var n in e)e.hasOwnProperty(n)&&i.util.isObjectLike(e[n])&&this.GetPlanetResources(e[n],t,r);else r.push(e)}},{key:"GetResources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.highDetail&&this.highDetail.GetResources(e),this.effectHeight&&this.effectHeight.GetResources(e),e}},{key:"UpdateViewDependentData",value:function(e){this.highDetail.UpdateViewDependentData(e),this.zOnlyModel&&(this.zOnlyModel.translation=this.highDetail.translation,this.zOnlyModel.scaling=this.highDetail.scaling,this.zOnlyModel.UpdateViewDependentData(e))}},{key:"Update",value:function(e){this.highDetail.Update(e)}},{key:"GetBatches",value:function(e,t){if(this.display&&this.heightDirty&&this.watchedResources.length&&""!==this.heightMapResPath1){for(var r=0;r<this.watchedResources.length;++r)if(this.watchedResources[r]&&!this.watchedResources[r].IsGood())return;this.watchedResources=[],this.heightMap.Set(),i.device.SetStandardStates(i.device.RM_FULLSCREEN),i.device.gl.clearColor(0,0,0,0),i.device.gl.clear(i.device.gl.COLOR_BUFFER_BIT),i.device.RenderFullScreenQuad(this.effectHeight),this.heightMap.Unset(),this.heightDirty=!1;for(var n=0;n<this.lockedResources.length;++n)this.lockedResources[n].doNotPurge--;var a=this.highDetail.children[0].mesh,o=null;a.transparentAreas.length?o=a.transparentAreas[0].effect:a.opaqueAreas.length&&(o=a.opaqueAreas[0].effect),o&&(o.parameters.HeightMap.textureRes=this.heightMap.texture)}this.display&&this.highDetail.GetBatches(e,t)}},{key:"GetZOnlyBatches",value:function(e,t){this.display&&this.zOnlyModel&&this.zOnlyModel.GetBatches(e,t)}}],[{key:"MeshLoaded",value:function(e,t){e.highDetail.children.unshift(t),e.lockedResources=[],e.GetPlanetResources(e.highDetail,[],e.lockedResources);var r=e.highDetail.children[0].mesh,n=null,i=void 0;for(var o in i=(i=r.transparentAreas.length?(n=r.transparentAreas[0].effect).effectFilePath:r.opaqueAreas.length?(n=r.opaqueAreas[0].effect).effectFilePath:"res:/Graphics/Effect/Managed/Space/Planet/EarthlikePlanet.fx").replace(".fx","BlitHeight.fx"),e.watchedResources=[],n.parameters)n.parameters.hasOwnProperty(o)&&(e.effectHeight.parameters[o]=n.parameters[o],"textureRes"in n.parameters[o]&&e.watchedResources.push(n.parameters[o].textureRes));for(var s=0;s<e.highDetail.children[0].children.length;++s)if(r=e.highDetail.children[0].children[s].mesh){if(n=null,r.transparentAreas.length)n=r.transparentAreas[0].effect;else{if(!r.opaqueAreas.length)continue;n=r.opaqueAreas[0].effect}for(var u in n.parameters)n.parameters.hasOwnProperty(u)&&(e.effectHeight.parameters[u]=n.parameters[u],"textureRes"in n.parameters[u]&&e.watchedResources.push(n.parameters[u].textureRes))}var l=new a.Tw2TextureParameter("NormalHeight1",e.heightMapResPath1);l.Initialize(),e.watchedResources.push(l.textureRes),e.lockedResources.push(l.textureRes),e.effectHeight.parameters.NormalHeight1=l;var c=new a.Tw2TextureParameter("NormalHeight2",e.heightMapResPath2);c.Initialize(),e.watchedResources.push(c.textureRes),e.lockedResources.push(c.textureRes),e.effectHeight.parameters.NormalHeight2=c,e.effectHeight.parameters.Random=new a.Tw2FloatParameter("Random",e.itemID%100),e.effectHeight.parameters.TargetTextureHeight=new a.Tw2FloatParameter("TargetTextureHeight",1024),e.effectHeight.effectFilePath=i,e.effectHeight.Initialize(),e.heightDirty=!0,e.heightMap.Create(2048,1024,!1),e.watchedResources.push(e.effectHeight.effectRes);for(var f=0;f<e.lockedResources.length;++f)e.lockedResources[f].doNotPurge++,e.lockedResources[f].IsPurged()&&e.lockedResources[f].Reload()}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveShip=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(n):void 0},a=r(30);t.EveShip=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.visible.turretSets=!0,e.visible.boosters=!0,e.boosters=null,e.turretSets=[],e.boosterGain=1,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.EveSpaceObject),n(t,[{key:"Initialize",value:function(){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"Initialize",this).call(this),this.boosters&&this.RebuildBoosterSet()}},{key:"RebuildBoosterSet",value:function(){this.boosters&&this.boosters.UpdateItemsFromLocators(this.FindLocatorsByPrefix("locator_booster"))}},{key:"RebuildTurretPositions",value:function(){for(var e=0;e<this.turretSets.length;e++)this.RebuildTurretSet(e)}},{key:"RebuildTurretSet",value:function(e){if(void 0!==this.turretSets[e]){for(var t=this.turretSets[e],r=t.locatorName,n=this.GetLocatorCount(r),i=[],a=0;a<n;++a){var o=r+String.fromCharCode("a".charCodeAt(0)+a),s=this.FindLocatorByName(o);s&&(s.FindBone(this.animation),i.push(s))}t.UpdateItemsFromLocators(i)}}},{key:"GetResources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments[1];i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"GetResources",this).call(this,e,r);for(var n=0;n<this.turretSets.length;n++)this.turretSets[n].GetResources(e);return this.boosters&&this.boosters.GetResources(e),e}},{key:"UpdateViewDependentData",value:function(){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"UpdateViewDependentData",this).call(this);for(var e=0;e<this.turretSets.length;++e)this.turretSets[e].UpdateViewDependentData()}},{key:"Update",value:function(e){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"Update",this).call(this,e),this.boosters&&(this.boosters._locatorRebuildPending&&this.RebuildBoosterSet(),this.boosters.Update(e,this.transform));for(var r=0;r<this.turretSets.length;++r)this.turretSets[r]._locatorRebuildPending&&this.RebuildTurretSet(r),this.turretSets[r].Update(e,this.transform)}},{key:"GetBatches",value:function(e,r){if(this.display&&(i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"GetBatches",this).call(this,e,r),this._perObjectData.perObjectVSData.Get("Shipdata")[0]=this.boosterGain,this._perObjectData.perObjectPSData.Get("Shipdata")[0]=this.boosterGain,this.boosters&&this.visible.boosters&&this.boosters.GetBatches(e,r,this._perObjectData),this.visible.turretSets))if(this.lod>1)for(var n=0;n<this.turretSets.length;++n)this.turretSets[n].GetBatches(e,r,this._perObjectData,this.visible.firingEffects);else if(this.visible.firingEffects)for(var a=0;a<this.turretSets.length;++a)this.turretSets[a].firingEffect&&this.turretSets[a].firingEffect.GetBatches(e,r,this._perObjectData)}}]),t}()},function(e,t,r){"use strict";var n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.EveBoosterSet=t.EveBoosterSetItem=t.EveBoosterBatch=void 0;var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),s=r(1),u=r(9);function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var h=t.EveBoosterBatch=function(e){function t(){l(this,t);var e=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.boosters=null,e}return f(t,s.Tw2RenderBatch),a(t,[{key:"Commit",value:function(e){this.boosters.Render(e)}}]),t}(),p=t.EveBoosterSetItem=function(e){function t(){l(this,t);var e=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.visible={},e.visible.glow=!0,e.visible.symHalo=!0,e.visible.halo=!0,e.visible.trail=!0,e.visible.customValues=!1,e.locatorName=null,e.updateFromLocator=!1,e.seed=7*Math.random(),e.wavePhase=Math.random(),e.atlas0=0,e.atlas1=0,e.transform=o.mat4.create(),e.customValues=null,e}return f(t,u.EveObjectSetItem),a(t,[{key:"GetPosition",value:function(e){return o.mat4.getTranslation(e,this.transform)}},{key:"GetDirection",value:function(e){o.vec3.set(e,this.transform[8],this.transform[9],this.transform[10]),o.vec3.normalize(e,e);var t=this.GetScale();return t<3&&o.vec3.scale(e,e,t/3),e}},{key:"GetScale",value:function(){var e=this.transform;return Math.max(o.vec3.length([e[0],e[1],e[2]]),o.vec3.length([e[4],e[5],e[6]]))}}],[{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new this;return o.util.assignIfExists(t.visible,e.visible,["glow","symHalo","halo","trail"]),o.util.assignIfExists(t,e,["name","display","seed","wavePhase","transform","locatorName","updateFromLocator","atlas0","atlas1"]),t}}]),t}();t.EveBoosterSet=(i=n=function(e){function t(){l(this,t);var e=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.visible={},e.visible.glows=!0,e.visible.symHalos=!0,e.visible.halos=!0,e.visible.trails=!0,e.effect=null,e.glows=null,e.alwaysOn=!0,e.maxVel=250,e.glowDistance=2.5,e.glowScale=1,e.glowColor=o.vec4.create(),e.warpGlowColor=o.vec4.create(),e.haloDistance=3.01,e.haloScaleX=1,e.haloScaleY=1,e.haloColor=o.vec4.create(),e.warpHaloColor=o.vec4.create(),e.symHaloDistance=3,e.symHaloScale=1,e.trailColor=o.vec4.create(),e.trailSize=o.vec4.create(),e._parentTransform=o.mat4.create(),e._positions=null,e._decl=new s.Tw2VertexDeclaration(t.vertexDeclarations),e._perObjectData=new s.Tw2PerObjectData(t.perObjectData),e._locatorRebuildPending=!0,e}return f(t,u.EveObjectSet),a(t,[{key:"FindItemByLocatorName",value:function(e){for(var t=0;t<this.items.length;t++)if(this.items[t].locatorName&&this.items[t].locatorName===e)return this.items[t];return null}},{key:"UpdateItemsFromLocators",value:function(e){for(var t=Array.from(this.items),r=0;r<e.length;r++){var n=e[r],i=n.name,a=n.transform,s=n.atlasIndex0,u=n.atlasIndex1,l=this.FindItemByLocatorName(i);l?(t.splice(t.indexOf(l),1),l.updateFromLocator&&(o.mat4.copy(l.transform,a),l.atlas0=s,l.atlas1=u,l.OnValueChanged())):this.CreateItem({name:i,locatorName:i,updateFromLocator:!0,atlas0:s,atlas1:u,transform:a})}for(var c=0;c<t.length;c++)null!==t[c].locatorName&&(this.RemoveItem(t[c]),c--);this._locatorRebuildPending=!1,this._rebuildPending&&this.Rebuild()}},{key:"RebuildItemsFromLocators",value:function(){this._locatorRebuildPending=!0}},{key:"GetResources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.effect&&this.effect.GetResources(e),this.glows&&this.glows.effect.GetResources(e),e}},{key:"Update",value:function(e,t){o.mat4.copy(this._parentTransform,t),this._rebuildPending&&this.Rebuild(),this.glows&&this.glows.Update(e)}},{key:"Unload",value:function(){this._positions&&(o.device.gl.deleteBuffer(this._positions),this._positions=null),this.glows&&this.glows.Unload()}},{key:"Rebuild",value:function(){this.constructor.RebuildItems(this);var e=this._visibleItems.length;if(this._rebuildPending=!1,e){for(var r=o.device,n=t._box,i=new Float32Array(e*n.length*6*28),a=[0,3,1,3,2,1],s=0,u=0;u<e;++u)for(var l=this._visibleItems[u],c=0;c<n.length;++c)for(var f=0;f<a.length;++f)i[s++]=n[c][a[f]][0],i[s++]=n[c][a[f]][1],i[s++]=n[c][a[f]][2],i[s++]=0,i[s++]=0,i.set(l.transform,s),s+=16,i[s++]=0,i[s++]=1,i[s++]=1,i[s++]=1,i[s++]=l.wavePhase,i[s++]=l.atlas0,i[s++]=l.atlas1;this._positions=r.gl.createBuffer(),r.gl.bindBuffer(r.gl.ARRAY_BUFFER,this._positions),r.gl.bufferData(r.gl.ARRAY_BUFFER,i,r.gl.STATIC_DRAW),r.gl.bindBuffer(r.gl.ARRAY_BUFFER,null),this._positions.count=12*e*3,this.glows&&this.glows.Rebuild()}}},{key:"GetBatches",value:function(e,t,r){if(this.display&&e===o.device.RM_ADDITIVE&&this._positions&&this._visibleItems.length){if(this.effect){var n=new h;o.mat4.transpose(this._perObjectData.perObjectVSData.Get("WorldMat"),this._parentTransform),this._perObjectData.perObjectVSData.Set("Shipdata",r.perObjectVSData.Get("Shipdata")),this._perObjectData.perObjectPSData=r.perObjectPSData,n.perObjectData=this._perObjectData,n.boosters=this,n.renderMode=o.device.RM_ADDITIVE,t.Commit(n)}this.glows&&this.glows.GetBoosterGlowBatches(e,t,r,this._parentTransform,r.perObjectVSData.Get("Shipdata")[0],0)}}},{key:"Render",value:function(e){if(!this.effect||!this.effect.IsGood())return!1;o.device.gl.bindBuffer(o.device.gl.ARRAY_BUFFER,this._positions);for(var t=0;t<this.effect.GetPassCount(e);++t){if(this.effect.ApplyPass(e,t),!this._decl.SetDeclaration(this.effect.GetPassInput(e,t),112))return!1;o.device.ApplyShadowState(),o.device.gl.drawArrays(o.device.gl.TRIANGLES,0,this._positions.count)}return!0}}],[{key:"RebuildItems",value:function(e){var r=e.glows,n=t.global,i=n.vec3_0;r&&r.ClearItems(),e._visibleItems=[];for(var a=0;a<e.items.length;a++){var s=e.items[a];if(s._onModified=e._onChildModified,s.display){if(e._visibleItems.push(s),r){var u=s.customValues&&s.customValues.display?s.customValues:e,l=s.GetPosition(n.vec3_1),c=s.GetDirection(n.vec3_2),f=s.GetScale();e.visible.glows&&s.visible.glow&&r.CreateItem({name:s.name+"_glow",position:o.vec3.subtract(i,l,o.vec3.scale(i,c,u.glowDistance)),blinkRate:s.seed,blinkPhase:s.seed,minScale:u.glowScale*f,maxScale:u.glowScale*f,color:u.glowColor,warpColor:u.warpGlowColor}),e.visible.symHalos&&s.visible.symHalo&&r.CreateItem({name:s.name+"_symHalo",position:o.vec3.subtract(i,l,o.vec3.scale(i,c,u.symHaloDistance)),blinkRate:s.seed,blinkPhase:s.seed+1,minScale:u.symHaloScale*f,maxScale:u.symHaloScale*f,color:u.haloColor,warpColor:u.warpHaloColor}),e.visible.halos&&s.visible.halo&&r.CreateItem({name:s.name+"_halo",position:o.vec3.subtract(i,l,o.vec3.scale(i,c,u.haloDistance)),blinkRate:s.seed,blinkPhase:s.seed+1,minScale:u.haloScaleX*f,maxScale:u.haloScaleY*f,color:u.haloColor,warpColor:u.warpHaloColor})}s._rebuildPending=!1}}}}]),t}(),n.Item=p,n.perObjectData={VSData:[["WorldMat",16],["Shipdata",4]]},n.vertexDeclarations=[["POSITION",0,3],["TEXCOORD",0,2],["TEXCOORD",1,4],["TEXCOORD",2,4],["TEXCOORD",3,4],["TEXCOORD",4,4],["TEXCOORD",5,4],["TEXCOORD",6,1],["TEXCOORD",7,2]],n._box=[[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]],[[-1,-1,-1],[-1,1,-1],[1,1,-1],[1,-1,-1]],[[-1,-1,0],[-1,1,0],[-1,1,-1],[-1,-1,-1]],[[1,-1,0],[1,-1,-1],[1,1,-1],[1,1,0]],[[-1,-1,0],[-1,-1,-1],[1,-1,-1],[1,-1,0]],[[-1,1,0],[1,1,0],[1,1,-1],[-1,1,-1]]],i)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveCurveLineSet=t.EveCurveLineSetItem=void 0;var n,i,a,o,s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=r(0),l=r(1),c=r(9);function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var d=t.EveCurveLineSetItem=(i=n=function(e){function t(){f(this,t);var e=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type=t.Type.INVALID,e.position1=u.vec3.create(),e.color1=u.vec4.fromValues(1,1,1,1),e.position2=u.vec3.create(),e.color2=u.vec4.fromValues(1,1,1,1),e.intermediatePosition=u.vec3.create(),e.width=1,e.multiColor=u.vec4.fromValues(0,0,0,1),e.multiColorBorder=-1,e.overlayColor=u.vec4.fromValues(0,0,0,1),e.animationSpeed=0,e.animationScale=1,e.numOfSegments=1,e}return p(t,c.EveObjectSetItem),s(t,[{key:"ChangeColor",value:function(e,t){u.vec3.copy(this.color1,e),u.vec3.copy(this.color2,t),this.OnValueChanged()}},{key:"ChangeWidth",value:function(e){this.width=e,this.OnValueChanged()}},{key:"ChangeCartesian",value:function(e,t,r){u.vec3.copy(this.position1,e),u.vec3.copy(this.position2,t),u.vec3.copy(this.intermediatePosition,r),this.OnValueChanged()}},{key:"ChangePositionCartesian",value:function(e,t){u.vec3.copy(this.position1,e),u.vec3.copy(this.position2,t),this.OnValueChanged()}},{key:"ChangeIntermediateCartesian",value:function(e){u.vec3.copy(this.intermediatePosition,e),this.OnValueChanged()}},{key:"ChangeSpherical",value:function(e,t,r,n){u.vec3.fromSpherical(this.position1,e,n),u.vec3.fromSpherical(this.position2,t,n),u.vec3.fromSpherical(this.intermediatePosition,r,n),this.OnValueChanged()}},{key:"ChangePositionSpherical",value:function(e,t,r){u.vec3.fromSpherical(this.position1,e,r),u.vec3.fromSpherical(this.position2,t,r),this.OnValueChanged()}},{key:"ChangeIntermediateSpherical",value:function(e,t){u.vec3.fromSpherical(this.intermediatePosition,e,t),this.OnValueChanged()}},{key:"ChangeMultiColor",value:function(e,t){u.vec4.copy(this.multiColor,e),this.multiColorBorder=t,this.OnValueChanged()}},{key:"ChangeAnimation",value:function(e,t,r){u.vec4.copy(this.overlayColor,e),this.animationSpeed=t,this.animationScale=r,this.OnValueChanged()}},{key:"ChangeSegmentation",value:function(e){this.type!==t.Type.STRAIGHT&&(this.numOfSegments=e,this.OnValueChanged())}}],[{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new this;return u.util.assignIfExists(t,e,["name","display","type","position1","color1","position2","color2","intermediatePosition","width","multiColor","multiColorBorder","overlayColor","animationSpeed","animationScale","numOfSegments"]),t}}]),t}(),n.Type={INVALID:0,STRAIGHT:1,SPHERED:2,CURVED:3},n.DEFAULT_CURVED_SEGMENTS=20,n.DEFAULT_SPHERED_SEGMENTS=20,i);t.EveCurveLineSet=(o=a=function(e){function t(){f(this,t);var e=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.lineEffect=l.Tw2Effect.create({effectFilePath:"res:/Graphics/Effect/Managed/Space/SpecialFX/Lines3D.fx",textures:{TexMap:"res:/texture/global/white.dds.0.png",OverlayTexMap:"res:/texture/global/white.dds.0.png"}}),e.pickEffect=null,e.lineWidthFactor=1,e.additive=!1,e.pickable=!0,e.depthOffset=0,e.translation=u.vec3.create(),e.rotation=u.quat.create(),e.scaling=u.vec3.fromValues(1,1,1),e.transform=u.mat4.create(),e.parentTransform=u.mat4.create(),e._vertexSize=26,e._vbSize=0,e._vb=null,e._perObjectData=new l.Tw2PerObjectData(t.perObjectData),e._decl=new l.Tw2VertexDeclaration(t.vertexDeclarations,4*e._vertexSize),t.init(),e}return p(t,c.EveObjectSet),s(t,[{key:"Initialize",value:function(){this.OnValueChanged(),this.Rebuild()}},{key:"AddStraightLine",value:function(e,t,r,n,i){return this.CreateItem({type:d.Type.STRAIGHT,position1:e,position2:t,color1:n,color2:i,width:r})}},{key:"AddCurvedLineCrt",value:function(e,t,r,n,i,a){return this.CreateItem({type:d.Type.CURVED,position1:e,position2:t,intermediatePosition:r,color1:i,color2:a,width:n,numOfSegments:d.DEFAULT_CURVED_SEGMENTS})}},{key:"AddCurvedLineSph",value:function(e,r,n,i,a,o,s){var l=t.global;return this.CreateItem({type:d.Type.CURVED,position1:u.vec3.fromSpherical(l.vec3_0,e,n),position2:u.vec3.fromSpherical(l.vec3_1,r,n),intermediatePosition:u.vec3.fromSpherical(l.vec3_2,i,n),color1:o,color2:s,width:a,numOfSegments:d.DEFAULT_CURVED_SEGMENTS})}},{key:"AddSpheredLineCrt",value:function(e,t,r,n,i,a){return this.CreateItem({type:d.Type.SPHERED,position1:e,position2:t,intermediatePosition:r,color1:i,color2:a,width:n,numOfSegments:d.DEFAULT_SPHERED_SEGMENTS})}},{key:"AddSpheredLineSph",value:function(e,r,n,i,a,o,s){var l=t.global;return this.CreateItem({type:d.Type.SPHERED,position1:u.vec3.fromSpherical(l.vec3_0,e,n),position2:u.vec3.fromSpherical(l.vec3_1,r,n),intermediatePosition:u.vec3.fromSpherical(l.vec3_2,i,n),color1:o,color2:s,width:a,numOfSegments:d.DEFAULT_SPHERED_SEGMENTS})}},{key:"OnValueChanged",value:function(){u.mat4.fromRotationTranslationScale(this.transform,this.rotation,this.translation,this.scaling),this._rebuildPending=!0}},{key:"UpdateViewDependentData",value:function(e){u.mat4.copy(this.parentTransform,e)}},{key:"Update",value:function(){this._rebuildPending&&this.Rebuild()}},{key:"Unload",value:function(){this._vb&&(u.device.gl.deleteBuffer(this._vb),this._vb=null)}},{key:"Rebuild",value:function(){t.RebuildItems(this),this._vb=null,this._vbSize=this.lineCount,this._rebuildPending=!1;var e=this._visibleItems.length;if(e){for(var r=t.global,n=new Float32Array(6*this._vbSize*this._vertexSize),i=r.vec3_0,a=r.vec3_1,o=r.vec3_2,s=r.vec3_3,l=r.vec3_4,c=r.vec3_5,f=r.vec3_6,h=r.mat4_0,p=r.vec3_7,v=r.vec3_8,m=r.vec3_9,y=r.vec3_10,b=r.vec4_0,_=r.vec4_1,g=0,E=void 0,T=0;T<e;++T){var O=this._visibleItems[T];switch(O.type){case d.Type.INVALID:break;case d.Type.STRAIGHT:t.WriteLineVerticesToBuffer(this,O.position1,O.color1,0,O.position2,O.color2,1,T,n,g),g+=6*this._vertexSize;break;case d.Type.SPHERED:u.vec3.subtract(i,O.position1,O.intermediatePosition),u.vec3.subtract(a,O.position2,O.intermediatePosition),u.vec3.normalize(o,i),u.vec3.normalize(s,a),u.vec3.cross(l,i,a);var w=Math.acos(u.vec3.dot(o,s))/O.numOfSegments;u.mat4.identity(h),u.mat4.rotate(h,h,w,l),u.vec3.copy(p,i),u.vec4.copy(b,O.color1);for(var R=0;R<this.lines[T].numOfSegments;++R){var S=(R+1)/O.numOfSegments;u.vec3.transformMat4(v,p,h),_[0]=O.color1[0]*(1-S)+O.color2[0]*S,_[1]=O.color1[1]*(1-S)+O.color2[1]*S,_[2]=O.color1[2]*(1-S)+O.color2[2]*S,_[3]=O.color1[3]*(1-S)+O.color2[3]*S,u.vec3.add(m,p,O.intermediatePosition),u.vec3.add(y,v,O.intermediatePosition),t.WriteLineVerticesToBuffer(this,m,b,R/O.numOfSegments,y,_,S,T,n,g),g+=6*this._vertexSize,E=p,p=v,v=E,E=b,b=_,_=E}break;case d.Type.CURVED:u.vec3.subtract(c,O.intermediatePosition,O.position1),u.vec3.subtract(f,O.position2,O.intermediatePosition),u.vec3.copy(m,O.position1),u.vec3.copy(b,O.color1);for(var P=0;P<O.numOfSegments;++P){var A=(P+1)/O.numOfSegments;u.vec3.hermite(y,O.position1,c,O.position2,f,A),_[0]=O.color1[0]*(1-A)+O.color2[0]*A,_[1]=O.color1[1]*(1-A)+O.color2[1]*A,_[2]=O.color1[2]*(1-A)+O.color2[2]*A,_[3]=O.color1[3]*(1-A)+O.color2[3]*A,t.WriteLineVerticesToBuffer(this,m,b,P/O.numOfSegments,y,_,A,T,n,g),g+=6*this._vertexSize,E=m,m=y,y=E,E=b,b=_,_=E}}}this._vb=u.device.gl.createBuffer(),u.device.gl.bindBuffer(u.device.gl.ARRAY_BUFFER,this._vb),u.device.gl.bufferData(u.device.gl.ARRAY_BUFFER,n,u.device.gl.STATIC_DRAW),u.device.gl.bindBuffer(u.device.gl.ARRAY_BUFFER,null)}}},{key:"GetBatches",value:function(e,r){if(this.display&&this._vb){var n=void 0;switch(e){case u.device.RM_TRANSPARENT:if(this.additive||!this.lineEffect)return;n=this.lineEffect;break;case u.device.RM_ADDITIVE:if(!this.additive||!this.lineEffect)return;n=this.lineEffect;break;case u.device.RM_PICKABLE:if(!this.pickable||!this.pickEffect)return;n=this.pickEffect}var i=new l.Tw2ForwardingRenderBatch,a=t.global.mat4_0;u.mat4.multiply(a,this.transform,this.parentTransform),u.mat4.transpose(this._perObjectData.perObjectVSData.Get("WorldMat"),a),u.mat4.transpose(this._perObjectData.perObjectPSData.Get("WorldMat"),a),i.perObjectData=this._perObjectData,i.geometryProvider=this,i.renderMode=e,i.effect=n,r.Commit(i)}}},{key:"Render",value:function(e,t){if(!e.effect||!e.effect.IsGood())return!1;u.device.gl.bindBuffer(u.device.gl.ARRAY_BUFFER,this._vb);for(var r=e.effect.GetPassCount(t),n=0;n<r;++n){e.effect.ApplyPass(t,n);var i=e.effect.GetPassInput(t,n);if(!this._decl.SetDeclaration(i,this._decl.stride))return!1;u.device.ApplyShadowState(),u.device.gl.drawArrays(u.device.gl.TRIANGLES,0,6*this._vbSize)}return!0}},{key:"lines",get:function(){return this.items},set:function(e){this.items=e}},{key:"lineCount",get:function(){for(var e=0,t=0;t<this.items.length;t++)this.items[t].type!==d.Type.INVALID&&(e+=this.items[t].numOfSegments);return e}}],[{key:"FillColorVertices",value:function(e,t,r){return t[r++]=e.multiColor[0],t[r++]=e.multiColor[1],t[r++]=e.multiColor[2],t[r++]=e.multiColor[3],t[r++]=e.overlayColor[0],t[r++]=e.overlayColor[1],t[r++]=e.overlayColor[2],t[r++]=e.overlayColor[3],r}},{key:"WriteLineVerticesToBuffer",value:function(e,r,n,i,a,o,s,u,l,c){var f=e.items[u];l[c++]=r[0],l[c++]=r[1],l[c++]=r[2],l[c++]=a[0]-r[0],l[c++]=a[1]-r[1],l[c++]=a[2]-r[2],l[c++]=-e.lineWidthFactor*f.width,l[c++]=0,l[c++]=i,l[c++]=f.multiColorBorder,l[c++]=s-i,l[c++]=f.animationSpeed,l[c++]=f.animationScale,l[c++]=u,l[c++]=n[0],l[c++]=n[1],l[c++]=n[2],l[c++]=n[3],c=t.FillColorVertices(f,l,c),l[c++]=r[0],l[c++]=r[1],l[c++]=r[2],l[c++]=a[0]-r[0],l[c++]=a[1]-r[1],l[c++]=a[2]-r[2],l[c++]=e.lineWidthFactor*f.width,l[c++]=0,l[c++]=i,l[c++]=f.multiColorBorder,l[c++]=s-i,l[c++]=f.animationSpeed,l[c++]=f.animationScale,l[c++]=u,l[c++]=n[0],l[c++]=n[1],l[c++]=n[2],l[c++]=n[3],c=t.FillColorVertices(f,l,c),l[c++]=a[0],l[c++]=a[1],l[c++]=a[2],l[c++]=r[0]-a[0],l[c++]=r[1]-a[1],l[c++]=r[2]-a[2],l[c++]=-e.lineWidthFactor*f.width,l[c++]=1,l[c++]=s,l[c++]=f.multiColorBorder,l[c++]=s-i,l[c++]=f.animationSpeed,l[c++]=f.animationScale,l[c++]=u,l[c++]=o[0],l[c++]=o[1],l[c++]=o[2],l[c++]=o[3],c=t.FillColorVertices(f,l,c),l[c++]=r[0],l[c++]=r[1],l[c++]=r[2],l[c++]=a[0]-r[0],l[c++]=a[1]-r[1],l[c++]=a[2]-r[2],l[c++]=e.lineWidthFactor*f.width,l[c++]=0,l[c++]=i,l[c++]=f.multiColorBorder,l[c++]=s-i,l[c++]=f.animationSpeed,l[c++]=f.animationScale,l[c++]=u,l[c++]=n[0],l[c++]=n[1],l[c++]=n[2],l[c++]=n[3],c=t.FillColorVertices(f,l,c),l[c++]=a[0],l[c++]=a[1],l[c++]=a[2],l[c++]=r[0]-a[0],l[c++]=r[1]-a[1],l[c++]=r[2]-a[2],l[c++]=e.lineWidthFactor*f.width,l[c++]=1,l[c++]=s,l[c++]=f.multiColorBorder,l[c++]=s-i,l[c++]=f.animationSpeed,l[c++]=f.animationScale,l[c++]=u,l[c++]=o[0],l[c++]=o[1],l[c++]=o[2],l[c++]=o[3],c=t.FillColorVertices(f,l,c),l[c++]=a[0],l[c++]=a[1],l[c++]=a[2],l[c++]=r[0]-a[0],l[c++]=r[1]-a[1],l[c++]=r[2]-a[2],l[c++]=-e.lineWidthFactor*f.width,l[c++]=1,l[c++]=s,l[c++]=f.multiColorBorder,l[c++]=s-i,l[c++]=f.animationSpeed,l[c++]=f.animationScale,l[c++]=u,l[c++]=o[0],l[c++]=o[1],l[c++]=o[2],l[c++]=o[3],t.FillColorVertices(f,l,c)}},{key:"init",value:function(){t.global||(t.global={vec3_0:u.vec3.create(),vec3_1:u.vec3.create(),vec3_2:u.vec3.create(),vec3_3:u.vec3.create(),vec3_4:u.vec3.create(),vec3_5:u.vec3.create(),vec3_6:u.vec3.create(),vec3_7:u.vec3.create(),vec3_8:u.vec3.create(),vec3_9:u.vec3.create(),vec3_10:u.vec3.create(),vec4_0:u.vec4.create(),vec4_1:u.vec4.create(),mat4_0:u.mat4.create()})}}]),t}(),a.Item=d,a.global=null,a.perObjectData={VSData:[["WorldMat",16]],PSData:[["WorldMat",16]]},a.vertexDeclarations=[["POSITION",0,3],["TEXCOORD",0,4],["TEXCOORD",1,4],["TEXCOORD",2,3],["COLOR",0,4],["COLOR",1,4],["COLOR",2,4]],o)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveLocator=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);(t.EveLocator=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="",this.transform=i.mat4.create(),this.atlasIndex0=null,this.atlasIndex1=null,this.bone=null}return n(e,[{key:"FindBone",value:function(e){this.bone=null;var t=e.FindModelForMesh(0);if(t)for(var r=0;r<t.bones.length;++r)if(t.bones[r].boneRes.name===this.name){this.bone=t.bones[r];break}return this.bone}}]),e}()).Prefix={AUDIO:"locator_audio",ATTACH:"locator_attach",BOOSTER:"locator_booster",TURRET:"locator_turret",XL_TURRET:"locator_xl"}},function(e,t,r){"use strict";var n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.EvePlaneSet=t.EvePlaneSetItem=t.EvePlaneSetBatch=void 0;var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),s=r(1),u=r(9);function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var h=t.EvePlaneSetBatch=function(e){function t(){l(this,t);var e=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.planeSet=null,e}return f(t,s.Tw2RenderBatch),a(t,[{key:"Commit",value:function(e){this.planeSet.Render(e)}}]),t}(),p=t.EvePlaneSetItem=function(e){function t(){l(this,t);var e=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.boneIndex=0,e.groupIndex=-1,e.maskAtlasID=0,e.position=o.vec3.create(),e.scaling=o.vec3.fromValues(1,1,1),e.rotation=o.quat.create(),e.transform=o.mat4.create(),e.color=o.vec4.fromValues(1,1,1,1),e.layer1Transform=o.vec4.fromValues(1,1,0,0),e.layer2Transform=o.vec4.fromValues(1,1,0,0),e.layer1Scroll=o.vec4.create(),e.layer2Scroll=o.vec4.create(),e}return f(t,u.EveObjectSetItem),a(t,null,[{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new this;return o.util.assignIfExists(t,e,["name","display","boneIndex","groupIndex","maskAtlasID","position","scaling","rotation","transform","color","layer1Transform","layer2Transform","layer1Scroll","layer2Scroll"]),t}}]),t}();t.EvePlaneSet=(i=n=function(e){function t(){l(this,t);var e=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.effect=null,e.hideOnLowQuality=!1,e._time=0,e._vertexBuffer=null,e._indexBuffer=null,e._decl=new s.Tw2VertexDeclaration(t.vertexDeclarations),e}return f(t,u.EveObjectSet),a(t,[{key:"GetResources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.effect&&this.effect.GetResources(e),e}},{key:"Update",value:function(e){this._time+=e,this._rebuildPending&&this.Rebuild()}},{key:"Unload",value:function(){this._vertexBuffer&&(o.device.gl.deleteBuffer(this._vertexBuffer),this._vertexBuffer=null),this._indexBuffer&&(o.device.gl.deleteBuffer(this._indexBuffer),this._indexBuffer=null)}},{key:"Rebuild",value:function(){this.Unload(),t.RebuildItems(this),this._rebuildPending=!1;var e=this._visibleItems.length;if(e){for(var r=t.global.mat4_0,n=new Float32Array(4*e*35),i=0;i<e;++i){var a=this._visibleItems[i],s=4*i*35;n[s+35-3]=0,n[s+35+35-3]=1,n[s+70+35-3]=2,n[s+105+35-3]=3;for(var u=o.mat4.fromRotationTranslationScale(r,a.rotation,a.position,a.scaling),l=0;l<4;++l){var c=s+35*l;n[c]=u[0],n[c+1]=u[4],n[c+2]=u[8],n[c+3]=u[12],n[c+4]=u[1],n[c+5]=u[5],n[c+6]=u[9],n[c+7]=u[13],n[c+8]=u[2],n[c+9]=u[6],n[c+10]=u[10],n[c+11]=u[14],n[c+12]=a.color[0],n[c+13]=a.color[1],n[c+14]=a.color[2],n[c+15]=a.color[3],n[c+16]=a.layer1Transform[0],n[c+17]=a.layer1Transform[1],n[c+18]=a.layer1Transform[2],n[c+19]=a.layer1Transform[3],n[c+20]=a.layer2Transform[0],n[c+21]=a.layer2Transform[1],n[c+22]=a.layer2Transform[2],n[c+23]=a.layer2Transform[3],n[c+24]=a.layer1Scroll[0],n[c+25]=a.layer1Scroll[1],n[c+26]=a.layer1Scroll[2],n[c+27]=a.layer1Scroll[3],n[c+28]=a.layer2Scroll[0],n[c+29]=a.layer2Scroll[1],n[c+30]=a.layer2Scroll[2],n[c+31]=a.layer2Scroll[3],n[c+33]=a.boneIndex,n[c+34]=a.maskAtlasID}}this._vertexBuffer=o.device.gl.createBuffer(),o.device.gl.bindBuffer(o.device.gl.ARRAY_BUFFER,this._vertexBuffer),o.device.gl.bufferData(o.device.gl.ARRAY_BUFFER,n,o.device.gl.STATIC_DRAW),o.device.gl.bindBuffer(o.device.gl.ARRAY_BUFFER,null);for(var f=new Uint16Array(6*e),h=0;h<e;++h){var p=6*h,d=4*h;f[p]=d,f[p+1]=d+2,f[p+2]=d+1,f[p+3]=d,f[p+4]=d+3,f[p+5]=d+2}this._indexBuffer=o.device.gl.createBuffer(),o.device.gl.bindBuffer(o.device.gl.ELEMENT_ARRAY_BUFFER,this._indexBuffer),o.device.gl.bufferData(o.device.gl.ELEMENT_ARRAY_BUFFER,f,o.device.gl.STATIC_DRAW),o.device.gl.bindBuffer(o.device.gl.ELEMENT_ARRAY_BUFFER,null),this._indexBuffer.count=6*e}}},{key:"GetBatches",value:function(e,t,r){if(this.display&&e===o.device.RM_ADDITIVE&&this._indexBuffer&&this._visibleItems.length){var n=new h;n.renderMode=o.device.RM_ADDITIVE,n.planeSet=this,n.perObjectData=r,t.Commit(n)}}},{key:"Render",value:function(e){if(!this.effect||!this.effect.IsGood())return!1;o.device.SetStandardStates(o.device.RM_ADDITIVE),o.device.gl.bindBuffer(o.device.gl.ARRAY_BUFFER,this._vertexBuffer),o.device.gl.bindBuffer(o.device.gl.ELEMENT_ARRAY_BUFFER,this._indexBuffer);for(var t=0;t<this.effect.GetPassCount(e);++t){if(this.effect.ApplyPass(e,t),!this._decl.SetDeclaration(this.effect.GetPassInput(e,t),140))return!1;o.device.ApplyShadowState(),o.device.gl.drawElements(o.device.gl.TRIANGLES,this._indexBuffer.count,o.device.gl.UNSIGNED_SHORT,0)}return!0}},{key:"planes",get:function(){return this.items},set:function(e){this.items=e}}]),t}(),n.Item=p,n.vertexDeclarations=[["TEXCOORD",0,4],["TEXCOORD",1,4],["TEXCOORD",2,4],["COLOR",0,4],["TEXCOORD",3,4],["TEXCOORD",4,4],["TEXCOORD",5,4],["TEXCOORD",6,4],["TEXCOORD",7,3]],i)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveSpaceObjectDecal=void 0;var n,i,a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),s=r(1);t.EveSpaceObjectDecal=(i=n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=o.util.generateID(),this.name="",this.display=!0,this.decalEffect=null,this.pickEffect=null,this.parentGeometry=null,this.parentBoneIndex=-1,this.groupIndex=-1,this.pickable=!0,this.position=o.vec3.create(),this.rotation=o.quat.create(),this.scaling=o.vec3.create(),this.decalMatrix=o.mat4.create(),this.invDecalMatrix=o.mat4.create(),this.indexBuffer=[],this._indexBuffer=null,this._perObjectData=new s.Tw2PerObjectData(e.perObjectData)}return a(e,[{key:"Initialize",value:function(){this.SetIndexBuffer(this.indexBuffer)}},{key:"OnValueChanged",value:function(){if(!this._indexBuffer&&this.indexBuffer){var e=o.device.gl,t=new Uint16Array(this.indexBuffer);this._indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)}o.mat4.fromRotationTranslationScale(this.decalMatrix,this.rotation,this.position,this.scaling),o.mat4.invert(this.invDecalMatrix,this.decalMatrix)}},{key:"SetParentGeometry",value:function(e){this.parentGeometry=e}},{key:"SetIndexBuffer",value:function(e){this.indexBuffer=e,this.Unload(),this.OnValueChanged()}},{key:"GetResources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.parentGeometry&&!e.includes(this.parentGeometry)&&e.push(this.parentGeometry),this.decalEffect&&this.decalEffect.GetResources(e),this.pickEffect&&this.pickEffect.GetResources(e),e}},{key:"Unload",value:function(){this._indexBuffer&&(o.device.gl.deleteBuffer(this._indexBuffer),this._indexBuffer=null)}},{key:"GetBatches",value:function(e,t,r,n){var i=void 0;switch(e){case o.device.RM_DECAL:i=this.decalEffect;break;case o.device.RM_PICKABLE:i=this.pickable?this.pickEffect:null}if(this.display&&i&&i.IsGood()&&this.indexBuffer.length&&this.parentGeometry&&this.parentGeometry.IsGood()){var a=new s.Tw2ForwardingRenderBatch;if(this._perObjectData.perObjectVSData.Set("worldMatrix",r.perObjectVSData.Get("WorldMat")),this.parentBoneIndex>=0){var u=r.perObjectVSData.Get("JointMat"),l=12*this.parentBoneIndex;if(u[l]||u[l+4]||u[l+8]){var c=this._perObjectData.perObjectVSData.Get("parentBoneMatrix");c[0]=u[l],c[1]=u[l+4],c[2]=u[l+8],c[3]=0,c[4]=u[l+1],c[5]=u[l+5],c[6]=u[l+9],c[7]=0,c[8]=u[l+2],c[9]=u[l+6],c[10]=u[l+10],c[11]=0,c[12]=u[l+3],c[13]=u[l+7],c[14]=u[l+11],c[15]=1,o.mat4.transpose(c,c)}}o.mat4.invert(this._perObjectData.perObjectVSData.Get("invWorldMatrix"),this._perObjectData.perObjectVSData.Get("worldMatrix")),o.mat4.transpose(this._perObjectData.perObjectVSData.Get("decalMatrix"),this.decalMatrix),o.mat4.transpose(this._perObjectData.perObjectVSData.Get("invDecalMatrix"),this.invDecalMatrix),this._perObjectData.perObjectPSData.Get("displayData")[0]=n||0,this._perObjectData.perObjectPSData.Set("shipData",r.perObjectPSData.data),a.perObjectData=this._perObjectData,a.geometryProvider=this,a.renderMode=e,a.effect=i,t.Commit(a)}}},{key:"Render",value:function(e,t){var r=this.parentGeometry.meshes[0].indexes,n=this.parentGeometry.meshes[0].areas[0].start,i=this.parentGeometry.meshes[0].areas[0].count,a=this.parentGeometry.meshes[0].indexType;o.store.SetVariableValue("u_DecalMatrix",this.decalMatrix),o.store.SetVariableValue("u_InvDecalMatrix",this.invDecalMatrix),this.parentGeometry.meshes[0].indexes=this._indexBuffer,this.parentGeometry.meshes[0].areas[0].start=0,this.parentGeometry.meshes[0].areas[0].count=this.indexBuffer.length,this.parentGeometry.meshes[0].indexType=o.device.gl.UNSIGNED_SHORT,this.parentGeometry.RenderAreas(0,0,1,e.effect,t),this.parentGeometry.meshes[0].indexes=r,this.parentGeometry.meshes[0].areas[0].start=n,this.parentGeometry.meshes[0].areas[0].count=i,this.parentGeometry.meshes[0].indexType=a}}]),e}(),n.perObjectData={VSData:[["worldMatrix",16],["invWorldMatrix",16],["decalMatrix",16],["invDecalMatrix",16],["parentBoneMatrix",16,o.mat4.identity([])]],PSData:[["displayData",4],["shipData",12]]},i)},function(e,t,r){"use strict";var n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.EveSpotlightSet=t.EveSpotlightSetItem=t.EveSpotlightSetBatch=void 0;var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),s=r(1),u=r(9);function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var h=t.EveSpotlightSetBatch=function(e){function t(){l(this,t);var e=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.spotlightSet=null,e}return f(t,s.Tw2RenderBatch),a(t,[{key:"Commit",value:function(e){this.spotlightSet.RenderCones(e),this.spotlightSet.RenderGlow(e)}}]),t}(),p=t.EveSpotlightSetItem=function(e){function t(){l(this,t);var e=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.transform=o.mat4.create(),e.coneColor=o.vec4.create(),e.spriteColor=o.vec4.create(),e.flareColor=o.vec4.create(),e.spriteScale=o.vec3.fromValues(1,1,1),e.boosterGainInfluence=0,e.boneIndex=0,e.groupIndex=-1,e.coneIntensity=0,e.spriteIntensity=0,e.flareIntensity=0,e}return f(t,u.EveObjectSetItem),a(t,null,[{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new this;return o.util.assignIfExists(t,e,["name","display","boosterGainInfluence","boneIndex","groupIndex","coneIntensity","spriteIntensity","flareIntensity","transform","coneColor","spriteColor","flareColor","spriteScale"]),t}}]),t}();t.EveSpotlightSet=(i=n=function(e){function t(){l(this,t);var e=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.coneEffect=null,e.glowEffect=null,e._coneVertexBuffer=null,e._spriteVertexBuffer=null,e._indexBuffer=null,e._decl=new s.Tw2VertexDeclaration(t.vertexDeclarations),e}return f(t,u.EveObjectSet),a(t,[{key:"GetResources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.coneEffect&&this.coneEffect.GetResources(e),this.glowEffect&&this.glowEffect.GetResources(e),e}},{key:"Unload",value:function(){this._coneVertexBuffer&&(o.device.gl.deleteBuffer(this._coneVertexBuffer),this._coneVertexBuffer=null),this._spriteVertexBuffer&&(o.device.gl.deleteBuffer(this._spriteVertexBuffer),this._spriteVertexBuffer=null),this._indexBuffer&&(o.device.gl.deleteBuffer(this._indexBuffer),this._indexBuffer=null)}},{key:"Rebuild",value:function(){this.Unload(),t.RebuildItems(this),this._rebuildPending=!1;var e=this._visibleItems.length;if(e){for(var r=o.device,n=[1,0,2,3],i=new Float32Array(22*(4*e*4)),a=0;a<e;++a)for(var s=this._visibleItems[a],u=0;u<4;++u)for(var l=0;l<4;++l){var c=22*(4*a*4+4*u+l);i[c]=s.coneColor[0]*s.coneIntensity,i[c+1]=s.coneColor[1]*s.coneIntensity,i[c+2]=s.coneColor[2]*s.coneIntensity,i[c+3]=s.coneColor[3],i[c+4]=s.transform[0],i[c+5]=s.transform[4],i[c+6]=s.transform[8],i[c+7]=s.transform[12],i[c+8]=s.transform[1],i[c+9]=s.transform[5],i[c+10]=s.transform[9],i[c+11]=s.transform[13],i[c+12]=s.transform[2],i[c+13]=s.transform[6],i[c+14]=s.transform[10],i[c+15]=s.transform[14],i[c+16]=1,i[c+17]=1,i[c+18]=1,i[c+19]=4*u+n[l],i[c+20]=s.boneIndex,i[c+21]=s.boosterGainInfluence?255:0}this._coneVertexBuffer=r.gl.createBuffer(),r.gl.bindBuffer(r.gl.ARRAY_BUFFER,this._coneVertexBuffer),r.gl.bufferData(r.gl.ARRAY_BUFFER,i,r.gl.STATIC_DRAW),this._coneVertexBuffer.count=4*e*6;for(var f=new Float32Array(22*(2*e*4)),h=[1,0,2,3],p=0;p<e;++p)for(var d=this._visibleItems[p],v=0;v<2;++v)for(var m=0;m<4;++m){var y=22*(2*p*4+4*v+m);v%2==0?(f[y]=d.spriteColor[0]*d.spriteIntensity,f[y+1]=d.spriteColor[1]*d.spriteIntensity,f[y+2]=d.spriteColor[2]*d.spriteIntensity,f[y+3]=d.spriteColor[3],f[y+16]=d.spriteScale[0],f[y+17]=1,f[y+18]=1):(f[y]=d.flareColor[0]*d.flareIntensity,f[y+1]=d.flareColor[1]*d.flareIntensity,f[y+2]=d.flareColor[2]*d.flareIntensity,f[y+3]=d.flareColor[3],f[y+16]=1,f[y+17]=d.spriteScale[1],f[y+18]=d.spriteScale[2]),f[y+4]=d.transform[0],f[y+5]=d.transform[4],f[y+6]=d.transform[8],f[y+7]=d.transform[12],f[y+8]=d.transform[1],f[y+9]=d.transform[5],f[y+10]=d.transform[9],f[y+11]=d.transform[13],f[y+12]=d.transform[2],f[y+13]=d.transform[6],f[y+14]=d.transform[10],f[y+15]=d.transform[14],f[y+19]=4*v+h[m],f[y+20]=d.boneIndex,f[y+21]=d.boosterGainInfluence?255:0}this._spriteVertexBuffer=r.gl.createBuffer(),r.gl.bindBuffer(r.gl.ARRAY_BUFFER,this._spriteVertexBuffer),r.gl.bufferData(r.gl.ARRAY_BUFFER,f,r.gl.STATIC_DRAW),this._spriteVertexBuffer.count=2*e*6;for(var b=new Uint16Array(4*e*6),_=0;_<4*e;++_){var g=6*_,E=4*_;b[g]=E,b[g+1]=E+1,b[g+2]=E+2,b[g+3]=E+2,b[g+4]=E+3,b[g+5]=E}this._indexBuffer=r.gl.createBuffer(),r.gl.bindBuffer(r.gl.ELEMENT_ARRAY_BUFFER,this._indexBuffer),r.gl.bufferData(r.gl.ELEMENT_ARRAY_BUFFER,b,r.gl.STATIC_DRAW),r.gl.bindBuffer(r.gl.ELEMENT_ARRAY_BUFFER,null),this._indexBuffer.count=e}}},{key:"GetBatches",value:function(e,t,r){if(this.display&&e===o.device.RM_ADDITIVE&&this._indexBuffer&&this._indexBuffer.count){var n=new h;n.renderMode=o.device.RM_ADDITIVE,n.spotlightSet=this,n.perObjectData=r,t.Commit(n)}}},{key:"RenderCones",value:function(e){return t.Render(this,this.coneEffect,e,this._coneVertexBuffer)}},{key:"RenderGlow",value:function(e){return t.Render(this,this.glowEffect,e,this._spriteVertexBuffer)}},{key:"spotlightItems",get:function(){return this.items},set:function(e){this.items=e}}],[{key:"Render",value:function(e,t,r,n){if(!t||!t.IsGood()||!n)return!1;o.device.SetStandardStates(o.device.RM_ADDITIVE),o.device.gl.bindBuffer(o.device.gl.ARRAY_BUFFER,n),o.device.gl.bindBuffer(o.device.gl.ELEMENT_ARRAY_BUFFER,e._indexBuffer);for(var i=0;i<t.GetPassCount(r);++i){if(t.ApplyPass(r,i),!e._decl.SetDeclaration(t.GetPassInput(r,i),88))return!1;o.device.ApplyShadowState(),o.device.gl.drawElements(o.device.gl.TRIANGLES,n.count,o.device.gl.UNSIGNED_SHORT,0)}return!0}}]),t}(),n.Item=p,n.vertexDeclarations=[["COLOR",0,4],["TEXCOORD",0,4],["TEXCOORD",1,4],["TEXCOORD",2,4],["TEXCOORD",3,3],["TEXCOORD",4,3]],i)},function(e,t,r){"use strict";var n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.EveSpriteSet=t.EveSpriteSetItem=t.EveSpriteSetBatch=void 0;var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),s=r(1),u=r(9);function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var h=t.EveSpriteSetBatch=function(e){function t(){l(this,t);var e=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.boosterGlow=!1,e.spriteSet=null,e.world=null,e.boosterGain=0,e.warpIntensity=0,e}return f(t,s.Tw2RenderBatch),a(t,[{key:"Commit",value:function(e){this.boosterGlow?this.spriteSet.RenderBoosterGlow(e,this.world,this.boosterGain,this.warpIntensity):this.spriteSet.Render(e,this.world,this.perObjectData)}}]),t}(),p=t.EveSpriteSetItem=function(e){function t(){l(this,t);var e=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.position=o.vec3.create(),e.blinkRate=0,e.blinkPhase=0,e.minScale=1,e.maxScale=1,e.falloff=0,e.color=o.vec4.create(),e.warpColor=o.vec4.create(),e.boneIndex=0,e.groupIndex=-1,e}return f(t,u.EveObjectSetItem),a(t,null,[{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new this;return o.util.assignIfExists(t,e,["name","display","blinkRate","blinkPhase","minScale","maxScale","falloff","boneIndex","groupIndex","position","color","warpColor"]),t}}]),t}();t.EveSpriteSet=(i=n=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];l(this,t);var n=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.effect=null,n.useQuads=null,n.isSkinned=null,n._time=0,n._vertexBuffer=null,n._indexBuffer=null,n._instanceBuffer=null,n._decl=new s.Tw2VertexDeclaration,n._vdecl=new s.Tw2VertexDeclaration([["TEXCOORD",5,1]]),n.UseQuads(e,r),n}return f(t,u.EveObjectSet),a(t,[{key:"UseQuads",value:function(e,r){this.useQuads!==e&&(this.useQuads=e,this.isSkinned=r,this._decl.DeclareFromObject(e?t.quadVertexDeclarations:t.vertexDeclarations),this._rebuildPending=!0)}},{key:"GetResources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.effect&&this.effect.GetResources(e),e}},{key:"Update",value:function(e){this._time+=e,this._rebuildPending&&this.Rebuild()}},{key:"Unload",value:function(){var e=o.device.gl;this._vertexBuffer&&(e.deleteBuffer(this._vertexBuffer),this._vertexBuffer=null),this._indexBuffer&&(e.deleteBuffer(this._indexBuffer),this._indexBuffer=null),this._instanceBuffer&&(e.deleteBuffer(this._instanceBuffer),this._instanceBuffer=null)}},{key:"Rebuild",value:function(){this.constructor.RebuildItems(this),this._rebuildPending=!1;var e=this._visibleItems.length;if(e){var t=o.device.gl;if(this.useQuads)return this._vertexBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,1,2,2,3,0]),t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),void(this._instanceBuffer=t.createBuffer());for(var r=new Float32Array(4*e*13),n=0;n<e;++n){var i=this._visibleItems[n],a=4*n*13;r[a]=0,r[a+13]=1,r[a+26]=2,r[a+39]=3;for(var s=0;s<4;++s){var u=a+13*s;r[u+1]=i.boneIndex,r[u+2]=i.position[0],r[u+3]=i.position[1],r[u+4]=i.position[2],r[u+5]=i.color[0],r[u+6]=i.color[1],r[u+7]=i.color[2],r[u+8]=i.blinkPhase,r[u+9]=i.blinkRate,r[u+10]=i.minScale,r[u+11]=i.maxScale,r[u+12]=i.falloff}}this._vertexBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null);for(var l=new Uint16Array(6*e),c=0;c<e;++c){var f=6*c,h=4*c;l[f]=h,l[f+1]=h+2,l[f+2]=h+1,l[f+3]=h,l[f+4]=h+3,l[f+5]=h+2}this._indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,l,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),this._indexBuffer.count=6*e}}},{key:"GetBatches",value:function(e,t,r,n){if(this.display&&e===o.device.RM_ADDITIVE&&this._vertexBuffer&&this._visibleItems.length){var i=new h;i.world=n,i.renderMode=o.device.RM_ADDITIVE,i.spriteSet=this,i.perObjectData=r,t.Commit(i)}}},{key:"GetBoosterGlowBatches",value:function(e,t,r,n,i,a){if(this.display&&e===o.device.RM_ADDITIVE&&this._vertexBuffer&&this._visibleItems.length){var s=new h;s.boosterGlow=!0,s.world=n,s.boosterGain=i,s.warpIntensity=a,s.renderMode=o.device.RM_ADDITIVE,s.spriteSet=this,s.perObjectData=r,t.Commit(s)}}},{key:"Render",value:function(e,t,r){if(this.useQuads)return this.RenderQuads(e,t,r);if(!this.effect||!this.effect.IsGood()||!this._indexBuffer)return!1;var n=o.device,i=n.gl;n.SetStandardStates(n.RM_ADDITIVE),i.bindBuffer(i.ARRAY_BUFFER,this._vertexBuffer),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indexBuffer);for(var a=0;a<this.effect.GetPassCount(e);++a){if(this.effect.ApplyPass(e,a),!this._decl.SetDeclaration(this.effect.GetPassInput(e,a),52))return!1;n.ApplyShadowState(),i.drawElements(i.TRIANGLES,this._indexBuffer.count,i.UNSIGNED_SHORT,0)}return!0}},{key:"RenderBoosterGlow",value:function(e,t,r,n){if(!this.effect||!this.effect.IsGood()||!this._instanceBuffer)return!1;var i=o.device,a=i.gl,s=u.EveObjectSet.global.vec3_0,l=this._visibleItems.length,c=new Float32Array(17*l);i.SetStandardStates(i.RM_ADDITIVE);for(var f=0,h=0;h<l;++h){var p=this._visibleItems[h];o.vec3.transformMat4(s,p.position,t),c[f++]=s[0],c[f++]=s[1],c[f++]=s[2],c[f++]=t[8],c[f++]=p.blinkPhase,c[f++]=t[9],c[f++]=p.minScale,c[f++]=p.maxScale,c[f++]=t[10],c[f++]=p.color[0],c[f++]=p.color[1],c[f++]=p.color[2],c[f++]=r,c[f++]=p.warpColor[0],c[f++]=p.warpColor[1],c[f++]=p.warpColor[2],c[f++]=n}a.bindBuffer(a.ARRAY_BUFFER,this._instanceBuffer),a.bufferData(a.ARRAY_BUFFER,c,a.DYNAMIC_DRAW);for(var d=0;d<this.effect.GetPassCount(e);++d){this.effect.ApplyPass(e,d);var v=this.effect.GetPassInput(e,d);a.bindBuffer(a.ARRAY_BUFFER,this._vertexBuffer),this._vdecl.SetPartialDeclaration(v,4),a.bindBuffer(a.ARRAY_BUFFER,this._instanceBuffer);var m=this._decl.SetPartialDeclaration(v,68,0,1);i.ApplyShadowState(),i.ext.drawArraysInstanced(a.TRIANGLES,0,6,l),this._decl.ResetInstanceDivisors(m)}return!0}},{key:"RenderQuads",value:function(e,t,r){if(!this.effect||!this.effect.IsGood()||!this._instanceBuffer)return!1;var n=o.device,i=n.gl,a=this._visibleItems.length,s=new Float32Array(17*a),l=u.EveObjectSet.global.vec3_0,c=r.perObjectVSData.Get("JointMat");n.SetStandardStates(n.RM_ADDITIVE);for(var f=0,h=0;h<a;++h){var p=this._visibleItems[h];if(this.isSkinned){var d=12*p.boneIndex;l[0]=c[d]*p.position[0]+c[d+1]*p.position[1]+c[d+2]*p.position[2]+c[d+3],l[1]=c[d+4]*p.position[0]+c[d+5]*p.position[1]+c[d+6]*p.position[2]+c[d+7],l[2]=c[d+8]*p.position[0]+c[d+9]*p.position[1]+c[d+10]*p.position[2]+c[d+11],o.vec3.transformMat4(l,l,t)}else o.vec3.transformMat4(l,p.position,t);s[f++]=l[0],s[f++]=l[1],s[f++]=l[2],s[f++]=1,s[f++]=p.blinkPhase,s[f++]=p.blinkRate,s[f++]=p.minScale,s[f++]=p.maxScale,s[f++]=p.falloff,s[f++]=p.color[0],s[f++]=p.color[1],s[f++]=p.color[2],s[f++]=1,s[f++]=p.warpColor[0],s[f++]=p.warpColor[1],s[f++]=p.warpColor[2],s[f++]=1}i.bindBuffer(i.ARRAY_BUFFER,this._instanceBuffer),i.bufferData(i.ARRAY_BUFFER,s,i.DYNAMIC_DRAW);for(var v=0;v<this.effect.GetPassCount(e);++v){this.effect.ApplyPass(e,v);var m=this.effect.GetPassInput(e,v);i.bindBuffer(i.ARRAY_BUFFER,this._vertexBuffer),this._vdecl.SetPartialDeclaration(m,4),i.bindBuffer(i.ARRAY_BUFFER,this._instanceBuffer);var y=this._decl.SetPartialDeclaration(m,68,0,1);n.ApplyShadowState(),n.ext.drawArraysInstanced(i.TRIANGLES,0,6,a),this._decl.ResetInstanceDivisors(y)}return!0}},{key:"sprites",get:function(){return this.items},set:function(e){this.items=e}}]),t}(),n.Item=p,n.vertexDeclarations=[["TEXCOORD",5,2],["POSITION",0,3],["COLOR",0,3],["TEXCOORD",0,1],["TEXCOORD",1,1],["TEXCOORD",2,1],["TEXCOORD",3,1],["TEXCOORD",4,1]],n.quadVertexDeclarations=[["POSITION",0,3],["TEXCOORD",0,4],["TEXCOORD",1,2],["COLOR",0,4],["COLOR",1,4]],i)},function(e,t,r){"use strict";var n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.EveTurretSet=t.EveTurretSetItem=void 0;var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),s=r(1),u=r(9);function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var h=t.EveTurretSetItem=function(e){function t(){l(this,t);var e=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.bone=null,e.locatorName=null,e.updateFromLocator=!1,e.canFireWhenHidden=!1,e.position=o.vec3.create(),e.rotation=o.quat.create(),e._localTransform=o.mat4.create(),e._localRotation=o.quat.create(),e}return f(t,u.EveObjectSetItem),a(t,[{key:"UpdateTransforms",value:function(){o.mat4.fromRotationTranslation(this._localTransform,this.rotation,this.position),this.bone?(o.mat4.multiply(this._localTransform,this.bone.offsetTransform,this._localTransform),o.mat4.getRotation(this._localRotation,this._localTransform)):o.quat.copy(this._localRotation,this.rotation)}}],[{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new this;return o.util.assignIfExists(t,e,["name","display","locatorName","updateFromLocator","position","rotation","bone","canFireWhenHidden"]),t.UpdateTransforms(),t}}]),t}();(t.EveTurretSet=(i=n=function(e){function t(){l(this,t);var e=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.visible={},e.visible.turrets=!0,e.visible.firingEffects=!0,e.activeAnimation=new s.Tw2AnimationController,e.inactiveAnimation=new s.Tw2AnimationController,e.geometryResPath="",e.geometryResource=null,e.turretEffect=null,e.firingEffectResPath="",e.firingEffect=null,e.fireCallback=null,e.fireCallbackPending=!1,e.state=t.State.IDLE,e.bottomClipHeight=0,e.locatorName="",e.sysBoneHeight=0,e.hasCyclingFiringPos=!1,e.targetPosition=o.vec3.create(),e.parentMatrix=o.mat4.create(),e.boundingSphere=o.quat.create(),e._activeTurret=-1,e._recheckTimeLeft=0,e._currentCyclingFiresPos=0,e._perObjectDataActive=new s.Tw2PerObjectData(t.perObjectData),e._perObjectDataInactive=new s.Tw2PerObjectData(t.perObjectData),e._locatorRebuildPending=!0,e}return f(t,u.EveObjectSet),a(t,[{key:"Initialize",value:function(){var e=this;this.turretEffect&&""!==this.geometryResPath&&(this.geometryResource=o.resMan.GetResource(this.geometryResPath),this.activeAnimation.SetGeometryResource(this.geometryResource),this.inactiveAnimation.SetGeometryResource(this.geometryResource),this.geometryResource&&this.geometryResource.RegisterNotification(this)),""!==this.firingEffectResPath&&o.resMan.GetObject(this.firingEffectResPath,function(t){return e.firingEffect=t}),this.Rebuild()}},{key:"InitializeFiringEffect",value:function(){if(this.firingEffect&&this.geometryResource&&this.geometryResource.models.length)for(var e=this.geometryResource.models[0],r=0;r<this.firingEffect.GetPerMuzzleEffectCount();++r)this.firingEffect.SetMuzzleBoneID(r,e.FindBoneByName(t.positionBoneSkeletonNames[r]))}},{key:"GetClosestTurret",value:function(){for(var e=-1,r=-2,n=t.global,i=n.vec3_0,a=n.vec4_0,s=n.vec4_1,u=0;u<this.items.length;++u){var l=this.items[u];if(l.display||l.canFireWhenHidden){s[0]=l._localTransform[12],s[1]=l._localTransform[13],s[2]=l._localTransform[14],s[3]=1,o.vec4.transformMat4(s,s,this.parentMatrix),o.vec3.subtract(i,this.targetPosition,s),o.vec3.normalize(i,i),o.vec4.set(a,0,1,0,0),o.vec4.transformMat4(a,a,l._localTransform),o.vec4.transformMat4(a,a,this.parentMatrix);var c=o.vec3.dot(a,i);c>r&&(e=this.items.indexOf(l),r=c)}}return e}},{key:"EnterStateDeactive",value:function(){var e=this;this.state!==t.State.INACTIVE&&this.state!==t.State.PACKING&&(this.turretEffect?(this.activeAnimation.StopAllAnimations(),this.inactiveAnimation.StopAllAnimations(),this.activeAnimation.PlayAnimation("Pack",!1,function(){e.state=t.State.INACTIVE,e.activeAnimation.PlayAnimation("Inactive",!0)}),this.inactiveAnimation.PlayAnimation("Pack",!1,function(){e.state=t.State.INACTIVE,e.inactiveAnimation.PlayAnimation("Inactive",!0)}),this.state=t.State.PACKING):this.state=t.State.INACTIVE,this._activeTurret=-1,this.firingEffect&&this.firingEffect.StopFiring())}},{key:"EnterStateIdle",value:function(){var e=this;this.state!==t.State.IDLE&&this.state!==t.State.UNPACKING&&(this.turretEffect?(this.activeAnimation.StopAllAnimations(),this.inactiveAnimation.StopAllAnimations(),this.state===t.State.FIRING?(this.activeAnimation.PlayAnimation("Active",!0),this.inactiveAnimation.PlayAnimation("Active",!0)):(this.activeAnimation.PlayAnimation("Deploy",!1,function(){e.state=t.State.IDLE,e.activeAnimation.PlayAnimation("Active",!0)}),this.inactiveAnimation.PlayAnimation("Deploy",!1,function(){e.state=t.State.IDLE,e.inactiveAnimation.PlayAnimation("Active",!0)})),this.state=t.State.UNPACKING):this.state=t.State.IDLE,this._activeTurret=-1,this.firingEffect&&this.firingEffect.StopFiring())}},{key:"EnterStateFiring",value:function(){var e=this;if(!this.turretEffect||this.state===t.State.FIRING)return t.DoStartFiring(this),void(this.turretEffect&&this.activeAnimation.PlayAnimation("Fire",!1,function(){e.activeAnimation.PlayAnimation("Active",!0)}));this.activeAnimation.StopAllAnimations(),this.inactiveAnimation.StopAllAnimations(),this.state===t.State.INACTIVE?(this.activeAnimation.PlayAnimation("Deploy",!1,function(){t.DoStartFiring(e),e.activeAnimation.PlayAnimation("Fire",!1,function(){e.activeAnimation.PlayAnimation("Active",!0)})}),this.inactiveAnimation.PlayAnimation("Deploy",!1,function(){e.inactiveAnimation.PlayAnimation("Active",!0)}),this.state=t.State.UNPACKING):(t.DoStartFiring(this),this.activeAnimation.PlayAnimation("Fire",!1,function(){e.activeAnimation.PlayAnimation("Active",!0)}),this.inactiveAnimation.PlayAnimation("Active",!0))}},{key:"RebuildCachedData",value:function(){for(var e=new s.Tw2VertexElement(s.Tw2VertexDeclaration.Type.TEXCOORD,1,o.device.gl.FLOAT,2),r=this.geometryResource.meshes,n=this.activeAnimation,i=this.inactiveAnimation,a=0;a<r.length;++a)r[a].declaration.elements.push(e),r[a].declaration.RebuildHash();switch(this.state){case t.State.INACTIVE:n.PlayAnimation("Inactive",!0),i.PlayAnimation("Inactive",!0);break;case t.State.IDLE:n.PlayAnimation("Active",!0),i.PlayAnimation("Active",!0);break;case t.State.FIRING:n.PlayAnimation("Fire",!1,function(){return n.PlayAnimation("Active",!0)}),i.PlayAnimation("Active",!0);break;case t.State.PACKING:this.EnterStateIdle();break;case t.State.UNPACKING:this.EnterStateDeactive()}}},{key:"FindItemByLocatorName",value:function(e){for(var t=0;t<this.items.length;t++)if(this.items[t].locatorName===e)return this.items[t];return null}},{key:"UpdateItemsFromLocators",value:function(e){for(var r=t.global,n=Array.from(this.items),i=r.mat4_0,a=0;a<e.length;a++){var s=e[a],u=s.name,l=s.transform,c=s.bone,f=void 0===c?null:c,h=this.FindItemByLocatorName(u);h?n.splice(n.indexOf(h),1):h=this.CreateItem({name:u,locatorName:u,updateFromLocator:!0}),h.updateFromLocator&&(h.bone=f,o.mat4.copy(i,l),o.vec3.normalize(i.subarray(0,3),i.subarray(0,3)),o.vec3.normalize(i.subarray(4,7),i.subarray(4,7)),o.vec3.normalize(i.subarray(8,11),i.subarray(8,11)),o.mat4.getRotation(h.rotation,i),o.mat4.getTranslation(h.position,i),h.OnValueChanged())}for(var p=0;p<n.length;p++)n[p].locatorName&&(this.RemoveItem(n[p]),p--);this._locatorRebuildPending=!1,this._rebuildPending&&this.Rebuild()}},{key:"RebuildItemsFromLocators",value:function(){this._locatorRebuildPending=!0}},{key:"GetResources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.geometryResource&&!e.includes(this.geometryResource)&&e.push(this.geometryResource),this.turretEffect&&this.turretEffect.GetResources(e),this.firingEffect&&this.firingEffect.GetResources(e),e}},{key:"UpdateViewDependentData",value:function(){this.firingEffect&&this.firingEffect.UpdateViewDependentData()}},{key:"Update",value:function(e,r){if(this._rebuildPending&&this.Rebuild(),this.turretEffect&&(this.activeAnimation.Update(e),this.inactiveAnimation.Update(e)),o.mat4.copy(this.parentMatrix,r),this.firingEffect&&this._visibleItems.length){if(-1!==this._activeTurret){this.firingEffect.isLoopFiring&&this.state===t.State.FIRING&&(this._recheckTimeLeft-=e,this._recheckTimeLeft<=0&&t.DoStartFiring(this));var n=this.items[this._activeTurret];if(this.activeAnimation.models.length)for(var i=this.activeAnimation.models[0].bonesByName,a=0;a<this.firingEffect.GetPerMuzzleEffectCount();++a){var s=i[t.positionBoneSkeletonNames[a]].worldTransform,u=this.firingEffect.GetMuzzleTransform(a);o.mat4.multiply(u,n._localTransform,s),o.mat4.multiply(u,u,r)}else for(var l=0;l<this.firingEffect.GetPerMuzzleEffectCount();++l)o.mat4.multiply(this.firingEffect.GetMuzzleTransform(l),r,n._localTransform);if(this.fireCallbackPending){if(this.fireCallback){for(var c=[],f=0;f<this.firingEffect.GetPerMuzzleEffectCount();++f)c.push(this.firingEffect.GetMuzzleTransform(f));this.fireCallback(this,c)}this.fireCallbackPending=!1}}o.vec3.copy(this.firingEffect.endPosition,this.targetPosition),this.firingEffect.Update(e)}}},{key:"GetBatches",value:function(e,r,n,i){if(this.turretEffect&&this.geometryResource&&this.display&&this._visibleItems.length){if(e===o.device.RM_OPAQUE&&this.visible.turrets){var a=this.inactiveAnimation.GetBoneMatrices(0);if(0!==a.length){t.UpdatePerObjectData(this,this._perObjectDataInactive.perObjectVSData,a),this._perObjectDataInactive.perObjectPSData=n.perObjectPSData;var u=new s.Tw2ForwardingRenderBatch;if(u.renderMode=e,u.renderActive=!1,u.perObjectData=this._perObjectDataInactive,u.geometryProvider=this,r.Commit(u),this.state===t.State.FIRING){var l=this.activeAnimation.GetBoneMatrices(0);if(0!==l.length){t.UpdatePerObjectData(this,this._perObjectDataActive.perObjectVSData,l,!0),this._perObjectDataActive.perObjectPSData=n.perObjectPSData;var c=new s.Tw2ForwardingRenderBatch;c.renderActive=!0,c.perObjectData=this._perObjectDataActive,c.geometryProvider=this,r.Commit(c)}}}}this.GetFiringEffectBatches(e,r,n,i)}}},{key:"GetFiringEffectBatches",value:function(e,t,r,n){this.firingEffect&&this.display&&this._visibleItems.length&&this.visible.firingEffects&&!n&&this.firingEffect.GetBatches(e,t,r)}},{key:"Render",value:function(e,r){if(!this.turretEffect||!this.turretEffect.IsGood()||!this._visibleItems.length)return!1;for(var n=0,i=function(e){o.device.gl.disableVertexAttribArray(e.location),o.device.gl.vertexAttrib2f(e.location,n,n)},a=0;a<this.geometryResource.meshes.length;++a){this.geometryResource.meshes[a].declaration.FindUsage(s.Tw2VertexDeclaration.Type.TEXCOORD,1).customSetter=i}for(var u=0;n<this.items.length;++n)if(this.items[n].display){var l=this.state===t.State.FIRING&&n===this._activeTurret;e.renderActive===l&&(this.geometryResource.RenderAreas(0,0,1,this.turretEffect,r),u++)}return!!u}},{key:"turrets",get:function(){return this.items},set:function(e){this.items=e}}],[{key:"RebuildItems",value:function(e){e._visibleItems=[];for(var t=0;t<e.items.length;t++){var r=e.items[t];r._onModified=e._onChildModified,r.display&&(e._visibleItems.push(r),r._rebuildPending&&(r.UpdateTransforms(),r._rebuildPending=!1))}}},{key:"UpdatePerObjectData",value:function(e,r,n,i){o.mat4.transpose(r.Get("shipMatrix"),e.parentMatrix);var a=n.length/12;r.Get("turretSetData")[0]=a,r.Get("baseCutoffData")[0]=e.bottomClipHeight;for(var s=r.Get("turretTranslation"),u=r.Get("turretRotation"),l=r.Get("turretPoseTransAndRot"),c=0;c<e._visibleItems.length;++c){for(var f=e._visibleItems[c],h=0;h<a;++h)l[2*(c*a+h)*4]=n[12*h+3],l[2*(c*a+h)*4+1]=n[12*h+7],l[2*(c*a+h)*4+2]=n[12*h+11],l[2*(c*a+h)*4+3]=1,t.mat3x4toquat(n,h,l,2*(c*a+h)+1);f.bone&&!i&&f.UpdateTransforms(),s[4*c]=f._localTransform[12],s[4*c+1]=f._localTransform[13],s[4*c+2]=f._localTransform[14],s[4*c+3]=1,u[4*c]=f.rotation[0],u[4*c+1]=f.rotation[1],u[4*c+2]=f.rotation[2],u[4*c+3]=f.rotation[3]}}},{key:"DoStartFiring",value:function(e){e.hasCyclingFiringPos&&(e._currentCyclingFiresPos=1-e._currentCyclingFiresPos),e.firingEffect&&e.firingEffect.PrepareFiring(0,e.hasCyclingFiringPos?e._currentCyclingFiresPos:-1),e._activeTurret=e.GetClosestTurret(),e.state=t.State.FIRING,e._recheckTimeLeft=2,e.fireCallback&&(e.fireCallbackPending=!0)}}]),t}(),n.Item=h,n.State={INACTIVE:0,IDLE:1,FIRING:2,PACKING:2,UNPACKING:4},n.worldNames=["turretWorld0","turretWorld1","turretWorld2"],n.positionBoneSkeletonNames=["Pos_Fire01","Pos_Fire02","Pos_Fire03","Pos_Fire04","Pos_Fire05","Pos_Fire06","Pos_Fire07","Pos_Fire08"],n.perObjectData={VSData:[["baseCutoffData",4],["turretSetData",4],["shipMatrix",16],["turretTranslation",96],["turretRotation",96],["turretPoseTransAndRot",576]]},i)).mat3x4toquat=function(){var e=void 0,t=void 0;return function(r,n,i,a){e||(e=o.mat4.create(),t=o.quat.create()),n*=12,a*=4,e[0]=r[n],e[1]=r[n+4],e[2]=r[n+8],e[3]=0,e[4]=r[n+1],e[5]=r[n+5],e[6]=r[n+9],e[7]=0,e[8]=r[n+2],e[9]=r[n+6],e[10]=r[n+10],e[11]=0,e[12]=r[n+3],e[13]=r[n+7],e[14]=r[n+11],e[15]=1,o.mat4.getRotation(t,e),i[a]=t[0],i[a+1]=t[1],i[a+2]=t[2],i[a+3]=t[3]}}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveSpaceScene=void 0;var n,i,a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),s=r(1);t.EveSpaceScene=(i=n=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=o.util.generateID(),this.name="",this.display=!0,this.visible={},this.visible.lensflares=!0,this.visible.objects=!0,this.visible.planets=!0,this.visible.fog=!0,this.visible.clearColor=!0,this.visible.environmentReflection=!0,this.visible.environmentDiffuse=!0,this.visible.environmentBlur=!0,Object.defineProperty(this.visible,"environment",{get:function(){return t.backgroundRenderingEnabled},set:function(e){t.backgroundRenderingEnabled=e?1:0}}),this.lensflares=[],this.objects=[],this.planets=[],this.nebulaIntensity=1,this.ambientColor=o.quat.fromValues(.25,.25,.25,1),this.backgroundEffect=null,this.backgroundRenderingEnabled=1,this.clearColor=o.vec4.fromValues(0,0,0,0),this.lodEnabled=!1,this.fogStart=0,this.fogEnd=0,this.fogMax=0,this.fogType=0,this.fogBlur=0,this.fogColor=o.vec4.fromValues(.25,.25,.25,1),this.sunDirection=o.vec3.fromValues(1,-1,1),this.sunDiffuseColor=o.vec4.fromValues(1,1,1,1),this.envMapScaling=o.vec3.fromValues(1,1,1),this.envMapRotation=o.quat.create(),this.envMapResPath="",this.envMap1ResPath="",this.envMap2ResPath="",this.envMap3ResPath="",this.envMapRes=null,this.envMap1Res=null,this.envMap2Res=null,this.envMap3Res=null,this.renderDebugInfo=!1,this._debugHelper=null,this._batches=new s.Tw2BatchAccumulator,this._perFrameVS=new s.Tw2RawData(e.perFrameData.VSData),this._perFramePS=new s.Tw2RawData(e.perFrameData.PSData),e.init()}return a(e,[{key:"Initialize",value:function(){this.SetEnvMapPath(0,this.envMapResPath),this.SetEnvMapPath(1,this.envMap1ResPath),this.SetEnvMapPath(2,this.envMap2ResPath),this.SetEnvMapPath(3,this.envMap3ResPath)}},{key:"SetEnvMapReflection",value:function(e){this.SetEnvMapPath(0,e)}},{key:"SetEnvMapDiffuse",value:function(e){this.SetEnvMapPath(1,e)}},{key:"SetEnvMapBlur",value:function(e){this.SetEnvMapPath(2,e)}},{key:"SetEnvMapPath",value:function(e,t){var r=this,n=function(e,t,n){return e=e.toLowerCase(),r[t]=e,r[n]=""===e?null:o.resMan.GetResource(e),!0};switch(e){case 0:return n(t,"envMapResPath","envMapRes");case 1:return n(t,"envMap1ResPath","envMap1Res");case 2:return n(t,"envMap2ResPath","envMap2Res");case 3:return n(t,"envMap3ResPath","envMap3Res")}return!1}},{key:"EnableLod",value:function(e){if(this.lodEnabled=e,!e)for(var t=0;t<this.objects.length;++t)this.objects[t].ResetLod&&this.objects[t].ResetLod()}},{key:"KeepAlive",value:function(){for(var e=this.GetResources(),t=0;t<e.length;t++)e[t].KeepAlive()}},{key:"GetResources",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1],r=0;r<this.lensflares.length;r++)this.lensflares[r].GetResources(e);if(this.backgroundEffect&&this.backgroundEffect.GetResources(e),this.envMapRes&&!e.includes(this.envMapRes)&&e.push(this.envMapRes),this.envMap1Res&&!e.includes(this.envMap1Res)&&e.push(this.envMapRes),this.envMap2Res&&!e.includes(this.envMap2Res)&&e.push(this.envMapRes),this.envMap3Res&&!e.includes(this.envMap3Res)&&e.push(this.envMapRes),!t){for(var n=0;n<this.planets.length;n++)this.planets[n].GetResources(e);for(var i=0;i<this.objects.length;i++)"GetResources"in this.objects[i]&&this.objects[i].GetResources(e)}return e}},{key:"Update",value:function(e){for(var t=0;t<this.planets.length;++t)"Update"in this.planets[t]&&this.planets[t].Update(e);for(var r=0;r<this.objects.length;++r)"Update"in this.objects[r]&&this.objects[r].Update(e)}},{key:"RenderBatches",value:function(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._batches,n=0;n<t.length;++n)"GetBatches"in t[n]&&t[n].GetBatches(e,r)}},{key:"Render",value:function(){this.ApplyPerFrameData();var t=o.device,r=e.global,n=o.mat4.identity(r.mat4_ID),i=this.visible;if(i.environment&&this.backgroundEffect&&(t.SetStandardStates(t.RM_FULLSCREEN),t.RenderCameraSpaceQuad(this.backgroundEffect)),i.planets&&this.planets.length){var a=o.mat4.copy(r.mat4_0,t.projection),s=o.mat4.copy(r.mat4_1,t.projection);s[10]=1e11/(1e4-1e11),s[14]=1e15/(1e4-1e11),t.SetProjection(s,!0),this.ApplyPerFrameData();for(var u=0;u<this.planets.length;++u)this.planets[u].UpdateViewDependentData&&this.planets[u].UpdateViewDependentData(n);this._batches.Clear(),t.gl.depthRange(.9,1),this.RenderBatches(t.RM_OPAQUE,this.planets),this.RenderBatches(t.RM_DECAL,this.planets),this.RenderBatches(t.RM_TRANSPARENT,this.planets),this.RenderBatches(t.RM_ADDITIVE,this.planets),this._batches.Render(),t.SetProjection(a,!0),this.ApplyPerFrameData(),t.gl.depthRange(0,.9)}if(this.lodEnabled){r.frustum.Initialize(t.view,t.projection,t.viewportWidth,t.viewInverse,t.viewProjection);for(var l=0;l<this.objects.length;++l)this.objects[l].UpdateLod&&this.objects[l].UpdateLod(r.frustum)}if(i.objects)for(var c=0;c<this.objects.length;++c)this.objects[c].UpdateViewDependentData&&this.objects[c].UpdateViewDependentData(n);if(i.lensflares)for(var f=0;f<this.lensflares.length;++f)this.lensflares[f].PrepareRender();if(this._batches.Clear(),i.planets)for(var h=0;h<this.planets.length;++h)this.planets[h].GetZOnlyBatches(t.RM_OPAQUE,this._batches);if(i.objects&&(this.RenderBatches(t.RM_OPAQUE,this.objects),this.RenderBatches(t.RM_DECAL,this.objects),this.RenderBatches(t.RM_TRANSPARENT,this.objects),this.RenderBatches(t.RM_ADDITIVE,this.objects)),i.lensflares)for(var p=0;p<this.lensflares.length;++p)this.lensflares[p].GetBatches(t.RM_ADDITIVE,this._batches);if(this._batches.Render(),i.lensflares)for(var d=0;d<this.lensflares.length;++d)this.lensflares[d].UpdateOccluders();if(this.renderDebugInfo&&e.DebugRenderer){this._debugHelper||(this._debugHelper=new e.DebugRenderer);for(var v=0;v<this.objects.length;++v)this.objects[v].RenderDebugInfo&&this.objects[v].RenderDebugInfo(this._debugHelper);this._debugHelper.Render()}}},{key:"ApplyPerFrameData",value:function(){var t=o.device,r=e.global,n=r.mat4_2,i=r.vec3_0,a=this.visible;o.mat4.fromQuat(n,this.envMapRotation),o.mat4.scale(n,n,this.envMapScaling),o.mat4.transpose(n,n),o.vec3.negate(i,this.sunDirection),o.vec3.normalize(i,i);var s=this.fogEnd-this.fogStart;Math.abs(s)<1e-5&&(s=1e-5);var u=1/s,l=this._perFrameVS;l.Set("FogFactors",[this.fogEnd*u,u,this.visible.fog?this.fogMax:0,1]),l.Set("ViewportAdjustment",[1,1,1,1]),l.Set("MiscSettings",[t.currentTime,0,t.viewportWidth,t.viewportHeight]),l.Set("SunData.DirWorld",i),l.Set("SunData.DiffuseColor",this.sunDiffuseColor),l.Set("TargetResolution",t.targetResolution),l.Set("ViewInverseTransposeMat",t.viewInverse),l.Set("ViewProjectionMat",t.viewProjectionTranspose),l.Set("ViewMat",t.viewTranspose),l.Set("ProjectionMat",t.projectionTranspose),l.Set("EnvMapRotationMat",n),t.perFrameVSData=l;var c=this._perFramePS;c.Set("ViewInverseTransposeMat",t.viewInverse),c.Set("ViewMat",t.viewTranspose),c.Set("EnvMapRotationMat",n),c.Set("SunData.DirWorld",i),c.Set("SunData.DiffuseColor",this.sunDiffuseColor),c.Set("SceneData.AmbientColor",this.ambientColor),c.Set("MiscSettings",[t.currentTime,this.fogType,this.fogBlur,1]),c.Set("SceneData.FogColor",this.fogColor),c.Set("FovXY",[t.targetResolution[3],t.targetResolution[2]]),c.Set("ShadowMapSettings",[1,1,0,0]),c.Set("TargetResolution",t.targetResolution),c.Get("SceneData.NebulaIntensity")[0]=this.nebulaIntensity,c.Get("ViewportSize")[0]=t.viewportWidth,c.Get("ViewportSize")[1]=t.viewportHeight,c.Get("ShadowCameraRange")[0]=1,c.Get("ProjectionToView")[0]=-t.projection[14],c.Get("ProjectionToView")[1]=-t.projection[10]-1,t.perFramePSData=c;var f=this.envMapRes&&a.environmentReflection?this.envMapRes:r.emptyTexture,h=this.envMap1Res&&a.environmentDiffuse?this.envMap1Res:r.emptyTexture,p=this.envMap2Res&&a.environmentBlur?this.envMap2Res:r.emptyTexture,d=this.envMap3Res?this.envMap3Res:r.emptyTexture;o.store.GetVariable("EveSpaceSceneEnvMap").SetTextureRes(f),o.store.GetVariable("EnvMap1").SetTextureRes(h),o.store.GetVariable("EnvMap2").SetTextureRes(p),o.store.GetVariable("EnvMap3").SetTextureRes(d)}}],[{key:"init",value:function(){e.global||(e.global={vec3_0:o.vec3.create(),vec4_0:o.vec4.create(),mat4_0:o.mat4.create(),mat4_1:o.mat4.create(),mat4_2:o.mat4.create(),mat4_ID:o.mat4.create(),frustum:new s.Tw2Frustum,emptyTexture:o.resMan.GetResource("res:/texture/global/black.dds.0.png")})}}]),e}(),n.perFrameData={PSData:[["ViewInverseTransposeMat",16],["ViewMat",16],["EnvMapRotationMat",16],["SunData.DirWorld",4],["SunData.DiffuseColor",4],["SceneData.AmbientColor",3],["SceneData.NebulaIntensity",1],["SceneData.FogColor",4],["ViewportOffset",2],["ViewportSize",2],["TargetResolution",4],["ShadowMapSettings",4],["ShadowCameraRange",4],["ProjectionToView",2],["FovXY",2],["MiscSettings",4]],VSData:[["ViewInverseTransposeMat",16],["ViewProjectionMat",16],["ViewMat",16],["ProjectionMat",16],["ShadowViewMat",16],["ShadowViewProjectionMat",16],["EnvMapRotationMat",16],["SunData.DirWorld",4],["SunData.DiffuseColor",4],["FogFactors",4],["TargetResolution",4],["ViewportAdjustment",4],["MiscSettings",4]]},n.global=null,n.DebugRenderer=window.Tw2DebugRenderer||null,i)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveSOF=function(){var e=null,t=null;function r(e,t,r){return t in e?e[t]:r}function l(t){return r(e.generic,t?"shaderPrefixAnimated":"shaderPrefix","")}function c(e,t,n,i,a){var o=null;if(r(i,"resPathInsert","").length&&(o=i.resPathInsert),"respathinsert"in a&&1===a.respathinsert.length){if("none"===a.respathinsert[0])return e;o=a.respathinsert[0]}if("MaterialMap"===t||"PaintMaskMap"===t||"PmdgMap"===t){var s=e.lastIndexOf("/"),u=e;if(s>=0&&(u=e.substr(0,s+1)+o+"/"+e.substr(s+1)),(s=u.lastIndexOf("_"))>=0){u=u.substr(0,s)+"_"+o+u.substr(s);var l=r(n,"textureOverrides",{});if(t in l&&i.name in l[t])return u}}return e}function f(e,t){var r=l(t),n=(e="/"+e).lastIndexOf("/");return e.substr(0,n+1)+r+e.substr(n+1)}function h(e,t){for(var r=0;r<e.length;++r)if(t.substr(0,e[r].length)===e[r])return r;return null}function p(t,n,i,a){var o,s,u,l;return"mesh"in i&&(o=e.generic.materialPrefixes,null!==(s=h(o,t))&&s<i.mesh.length&&0==(r(n,"blockedMaterials",0)&1<<s)&&(u=r(e.material,i.mesh[s],null)))?(l=t.substr(o[s].length),r(u.parameters,l,void 0)):(o=e.generic.patternMaterialPrefixes,s=h(o,t),"pattern"in i&&null!==s&&1+s<i.pattern.length&&(u=r(e.material,i.pattern[1+s],null))?(l=t.substr(o[s].length),r(u.parameters,l,void 0)):null!==s&&(u=r(e.material,a.defaultPatternLayer1MaterialName,null))?(l=t.substr(o[s].length),r(u.parameters,l,void 0)):void 0)}function d(e){switch(e){case 2:return 4;case 1:return 3;default:return 1}}function v(t,n,a,o,s,u,l,h){for(var v=r(a,n,[]),m=0;m<v.length;++m){var y=v[m],b=new i.Tw2Effect;b.effectFilePath=e.generic.areaShaderLocation+f(h||y.shader,a.isSkinned);for(var _=r(r(e.generic.areaShaders,y.shader,{}),"parameters",[]),g=0;g<_.length;++g){var E=_[g],T=p(E,y,l,s);(T=(T=(T=(T=T||r(r(r(e.generic.hullAreas,y.name,{}),"parameters",{}),E))||r(r(r(s.hullAreas,y.name,{}),"parameters",{}),E))||r(r(r(o.areas,y.name,{}),"parameters",{}),E))||r(r(y,"parameters",{}),E))&&(b.parameters[E]=new i.Tw2Vector4Parameter(E,T))}var O=r(y,"textures",[]);for(g in O)if(O.hasOwnProperty(g)){var w=O[g];w=c(w,g,y,o,l),b.parameters[g]=new i.Tw2TextureParameter(g,w)}for(g=0;g<u.layers.length;++g)if(u.layers[g]&&!(u.layers[g].textureName in b.parameters)){var R=new i.Tw2TextureParameter(u.layers[g].textureName);R.resourcePath=u.layers[g].textureResFilePath,R.useAllOverrides=!0,R.addressUMode=d(r(u.layers[g],"projectionTypeU",0)),R.addressVMode=d(r(u.layers[g],"projectionTypeV",0)),R.Initialize(),b.parameters[u.layers[g].textureName]=R}var S=r(r(e.generic.areaShaders,y.shader,{}),"defaultTextures",{});for(var P in S)S.hasOwnProperty(P)&&(P in b.parameters||(b.parameters[P]=new i.Tw2TextureParameter(P,S[P])));b.Initialize();var A=new i.Tw2MeshArea;A.name=y.name,A.effect=b,A.index=r(y,"index",0),A.count=r(y,"count",1),t.push(A)}}function m(e,t,r){r in t&&(e[r]=t[r])}function y(e,t,a,o){function s(t){return function(s){s.isEffectChild?e.effectChildren.push(s):e.children.push(s),n.vec3.copy(s.translation,r(t,"translation",[0,0,0])),n.quat.copy(s.rotation,r(t,"rotation",[0,0,0,1])),n.vec3.copy(s.scaling,r(t,"scaling",[1,1,1]));var u=r(t,"id",-1);-1!==u&&o[u]&&function e(t,r,a){if(Array.isArray(t.particleEmitters)){for(var o=0;o<t.particleEmitters.length;++o)if("rate"in t.particleEmitters[o]){var s=new i.Tw2ValueBinding;s.sourceObject=a,s.sourceAttribute="currentValue",s.destinationObject=t.particleEmitters[o],s.destinationAttribute="rate",s.Initialize(),r.bindings.push(s)}for(o=0;o<t.children.length;++o)e(t.children[o],r,a)}else n.resMan.log({type:"warning",title:"Space object factory",message:"Unable to bind particle emitters: "+t.constructor.name})}(s,a,o[u])}}for(var u=r(t,"children",[]),l=0;l<u.length;++l)n.resMan.GetObject(u[l].redFilePath,s(u[l]))}var b=!1,_=[];function g(c){for(var f=c.split(":"),h={},p=3;p<f.length;++p){var d=f[p].split("?");h[d[0]]=d[1].split(";")}var b=e.hull[f[0]],_=e.faction[f[1]],g=e.race[f[2]],E=new(2===r(b,"buildClass",0)?u.EveSpaceObject:u.EveShip),T=function(t,n,i){var a={patterns:[],layers:[]};if("pattern"in i){for(var o={},s=0;s<e.pattern.length;++s)if(e.pattern[s].name===i.pattern[0]){o=e.pattern[s];break}var u=r(o,"layer1",null);u&&a.layers.push(u),(u=r(o,"layer2",null))&&a.layers.push(u);for(var l=r(o,"projections",[]),c=0;c<l.length;++c)l[c].name===t.name&&(o=l[c],(u=r(o,"transformLayer1",null))&&a.patterns.push(u),(u=r(o,"transformLayer2",null))&&a.patterns.push(u))}else r(t,"defaultPattern")&&(o=r(t,"defaultPattern",{}),(u=r(o,"transformLayer1",null))&&a.patterns.push(u),(u=r(o,"transformLayer2",null))&&a.patterns.push(u),o=r(n,"defaultPattern",{}),(u=r(o,"layer1",null))&&a.layers.push(u),(u=r(o,"layer2",null))&&a.layers.push(u));return a}(b,g,h);!function(e,t,n,a,o,s){var u=new i.Tw2Mesh;u.geometryResPath=t.geometryResFilePath,e.boundingSphereCenter[0]=t.boundingSphere[0],e.boundingSphereCenter[1]=t.boundingSphere[1],e.boundingSphereCenter[2]=t.boundingSphere[2],e.boundingSphereRadius=t.boundingSphere[3],v(r(u,"opaqueAreas",[]),"opaqueAreas",t,n,a,s,o),v(r(u,"transparentAreas",[]),"transparentAreas",t,n,a,s,o),v(r(u,"additiveAreas",[]),"additiveAreas",t,n,a,s,o),v(r(u,"decalAreas",[]),"decalAreas",t,n,a,s,o),v(r(u,"depthAreas",[]),"depthAreas",t,n,a,s,o),u.Initialize(),e.mesh=u,"shapeEllipsoidCenter"in t&&(e.shapeEllipsoidCenter=t.shapeEllipsoidCenter);"shapeEllipsoidRadius"in t&&(e.shapeEllipsoidRadius=t.shapeEllipsoidRadius)}(E,b,_,g,h,T),function(e,t){for(var i=0;i<t.patterns.length;++i)if(t.patterns[i]&&t.layers[i]){var a=t.patterns[i],o=t.layers[i];e.AddCustomMask(r(a,"position",n.vec3.create()),r(a,"scaling",n.vec3.fromValues(1,1,1)),r(a,"rotation",n.quat.create()),r(a,"isMirrored",!1),r(o,"materialSource",0),n.vec4.fromValues(r(o,"isTargetMtl1",!0)?1:0,r(o,"isTargetMtl2",!0)?1:0,r(o,"isTargetMtl3",!0)?1:0,r(o,"isTargetMtl4",!0)?1:0))}}(E,T),function(t,a,s){for(var u=r(a,"hullDecals",[]),c=0;c<u.length;++c){var f=u[c],h=null,p="group"+r(f,"groupIndex",-1);if(s.decals&&p in s.decals&&(h=s.decals[p]),!h||h.isVisible){var d=new i.Tw2Effect;if(h&&h.shader&&h.shader.length)d.effectFilePath=e.generic.decalShaderLocation+"/"+l(!1)+h.shader;else{if(!f.shader||!f.shader.length)continue;d.effectFilePath=e.generic.decalShaderLocation+"/"+l(!1)+f.shader}var v=r(f,"parameters",{});for(var m in v)v.hasOwnProperty(m)&&(d.parameters[m]=new i.Tw2Vector4Parameter(m,v[m]));var y=r(f,"textures",{});for(m in y)y.hasOwnProperty(m)&&(d.parameters[m]=new i.Tw2TextureParameter(m,y[m]));if(h){var b=r(h,"parameters",{});for(m in b)b.hasOwnProperty(m)&&(d.parameters[m]=new i.Tw2Vector4Parameter(m,b[m]));var _=r(h,"textures",{});for(m in _)!_.hasOwnProperty(m)||m in d.parameters||(d.parameters[m]=new i.Tw2TextureParameter(m,_[m]))}var g=r(r(e.generic.decalShaders,f.shader,{}),"defaultTextures",{});for(var E in g)g.hasOwnProperty(E)&&(E in d.parameters||(d.parameters[E]=new i.Tw2TextureParameter(E,g[E])));d.Initialize();var T=new o.EveSpaceObjectDecal;n.vec3.copy(T.position,r(f,"position",[0,0,0])),n.quat.copy(T.rotation,r(f,"rotation",[0,0,0,1])),n.vec3.copy(T.scaling,r(f,"scaling",[1,1,1])),T.parentBoneIndex=r(f,"boneIndex",-1),T.indexBuffer=new Uint16Array(f.indexBuffer),T.decalEffect=d,T.name=r(u[c],"name",""),"groupIndex"in u[c]&&(T.groupIndex=u[c].groupIndex),T.Initialize(),t.decals.push(T)}}}(E,b,_),function(e,i,a){for(var s=r(i,"spriteSets",[]),u=r(a,"spriteSets",{}),l=0;l<s.length;++l){var c=new o.EveSpriteSet(!0,!(!i.isSkinned||!s[l].skinned));c.name=r(s[l],"name",""),c.effect=t;for(var f=r(s[l],"items",[]),h=0;h<f.length;++h)if("group"+r(f[h],"groupIndex",-1)in u){var p=new o.EveSpriteSetItem;p.blinkPhase=r(f[h],"blinkPhase",0),p.blinkRate=r(f[h],"blinkRate",.1),p.boneIndex=r(f[h],"boneIndex",0),p.falloff=r(f[h],"falloff",0),p.maxScale=r(f[h],"maxScale",10),p.minScale=r(f[h],"minScale",1),p.name=r(f[h],"name",""),p.groupIndex=r(f[h],"groupIndex",-1),n.vec3.copy(p.position,r(f[h],"position",[0,0,0]));var d=u["group"+p.groupIndex];d&&(p.groupName=d.name,"color"in d&&n.vec4.copy(p.color,d.color)),c.sprites.push(p)}c.Initialize(),e.spriteSets.push(c)}}(E,b,_),function(e,t,a){for(var s=r(t,"spotlightSets",[]),u=r(a,"spotlightSets",{}),l=0;l<s.length;++l){var c=new o.EveSpotlightSet;c.name=r(s[l],"name",""),c.coneEffect=new i.Tw2Effect,c.glowEffect=new i.Tw2Effect,s[l].skinned?(c.coneEffect.effectFilePath="res:/graphics/effect/managed/space/spaceobject/fx/skinned_spotlightcone.fx",c.glowEffect.effectFilePath="res:/graphics/effect/managed/space/spaceobject/fx/skinned_spotlightglow.fx"):(c.coneEffect.effectFilePath="res:/graphics/effect/managed/space/spaceobject/fx/spotlightcone.fx",c.glowEffect.effectFilePath="res:/graphics/effect/managed/space/spaceobject/fx/spotlightglow.fx"),c.coneEffect.parameters.TextureMap=new i.Tw2TextureParameter("TextureMap",s[l].coneTextureResPath),c.glowEffect.parameters.TextureMap=new i.Tw2TextureParameter("TextureMap",s[l].glowTextureResPath),c.coneEffect.parameters.zOffset=new i.Tw2FloatParameter("zOffset",r(s[l],"zOffset",0)),c.coneEffect.Initialize(),c.glowEffect.Initialize();for(var f=r(s[l],"items",[]),h=0;h<f.length;++h){var p=new o.EveSpotlightSetItem;p.name=r(f[h],"name",""),p.groupIndex=r(f[h],"groupIndex",-1),p.boneIndex=r(f[h],"boneIndex",0),p.boosterGainInfluence=r(f[h],"boosterGainInfluence",0),p.coneIntensity=r(f[h],"coneIntensity",0),p.spriteIntensity=r(f[h],"spriteIntensity",0),p.flareIntensity=r(f[h],"flareIntensity",0);var d=u["group"+p.groupIndex];d&&(n.vec4.copy(p.coneColor,r(d,"coneColor",[0,0,0,0])),n.vec4.copy(p.spriteColor,r(d,"spriteColor",[0,0,0,0])),n.vec4.copy(p.flareColor,r(d,"flareColor",[0,0,0,0]))),n.vec3.copy(p.spriteScale,r(f[h],"spriteScale",[1,1,1])),"transform"in f[h]?n.mat4.copy(p.transform,f[h].transform):n.mat4.identity(p.transform),c.spotlightItems.push(p)}c.Initialize(),e.spotlightSets.push(c)}}(E,b,_),function(e,t,a){for(var s=r(t,"planeSets",[]),u=r(a,"planeSets",{}),l=0;l<s.length;++l){var c=new o.EvePlaneSet;c.name=r(s[l],"name",""),c.effect=new i.Tw2Effect,s[l].skinned?c.effect.effectFilePath="res:/graphics/effect/managed/space/spaceobject/fx/skinned_planeglow.fx":c.effect.effectFilePath="res:/graphics/effect/managed/space/spaceobject/fx/planeglow.fx",c.effect.parameters.Layer1Map=new i.Tw2TextureParameter("Layer1Map",s[l].layer1MapResPath),c.effect.parameters.Layer2Map=new i.Tw2TextureParameter("Layer2Map",s[l].layer2MapResPath),c.effect.parameters.MaskMap=new i.Tw2TextureParameter("MaskMap",s[l].maskMapResPath),c.effect.parameters.PlaneData=new i.Tw2Vector4Parameter("PlaneData",r(s[l],"planeData",[1,0,0,0])),c.effect.Initialize();for(var f=r(s[l],"items",[]),h=0;h<f.length;++h){var p=new o.EvePlaneSetItem;m(p,f[h],"groupIndex"),m(p,f[h],"name"),p.boneIndex=r(f[h],"boneIndex",-1),p.maskAtlasID=r(f[h],"maskMapAtlasIndex",0),n.vec3.copy(p.position,r(f[h],"position",[0,0,0])),n.quat.copy(p.rotation,r(f[h],"rotation",[0,0,0,1])),n.vec3.copy(p.scaling,r(f[h],"scaling",[1,1,1])),n.vec4.copy(p.color,r(f[h],"color",[0,0,0,0])),n.vec4.copy(p.layer1Transform,r(f[h],"layer1Transform",[0,0,0,0])),n.vec4.copy(p.layer1Scroll,r(f[h],"layer1Scroll",[0,0,0,0])),n.vec4.copy(p.layer2Transform,r(f[h],"layer2Transform",[0,0,0,0])),n.vec4.copy(p.layer2Scroll,r(f[h],"layer2Scroll",[0,0,0,0]));var d=u["group"+r(f[h],"groupIndex",-1)];d&&n.vec4.copy(p.color,r(d,"color",[0,0,0,0])),c.planes.push(p)}c.Initialize(),e.planeSets.push(c)}}(E,b,_),function(e,t,a){if(!("booster"in t))return;var s=new o.EveBoosterSet,u=t.booster,l=r(a,"booster",{});m(s,l,"glowScale"),m(s,l,"symHaloScale"),m(s,l,"haloScaleX"),m(s,l,"haloScaleY"),m(s,l,"haloColor"),n.vec4.copy(s.glowColor,r(l,"glowColor",[0,0,0,0])),n.vec4.copy(s.warpGlowColor,r(l,"warpGlowColor",[0,0,0,0])),n.vec4.copy(s.warpHaloColor,r(l,"warpHalpColor",[0,0,0,0])),n.vec4.copy(s.trailColor,r(l,"trailColor",[0,0,0,0])),n.vec4.copy(s.trailSize,r(l,"trailSize",[0,0,0,0])),s.effect=new i.Tw2Effect,s.effect.effectFilePath="res:/Graphics/Effect/Managed/Space/Booster/BoosterVolumetric.fx",s.effect.parameters.NoiseFunction0=new i.Tw2FloatParameter("NoiseFunction0",r(l.shape0,"noiseFunction",0)),s.effect.parameters.NoiseSpeed0=new i.Tw2FloatParameter("NoiseSpeed0",r(l.shape0,"noiseSpeed",0)),s.effect.parameters.NoiseAmplitudeStart0=new i.Tw2Vector4Parameter("NoiseAmplitudeStart0",r(l.shape0,"noiseAmplitureStart",[0,0,0,0])),s.effect.parameters.NoiseAmplitudeEnd0=new i.Tw2Vector4Parameter("NoiseAmplitudeEnd0",r(l.shape0,"noiseAmplitureEnd",[0,0,0,0])),s.effect.parameters.NoiseFrequency0=new i.Tw2Vector4Parameter("NoiseFrequency0",r(l.shape0,"noiseFrequency",[0,0,0,0])),s.effect.parameters.Color0=new i.Tw2Vector4Parameter("Color0",r(l.shape0,"color",[0,0,0,0])),s.effect.parameters.NoiseFunction1=new i.Tw2FloatParameter("NoiseFunction1",r(l.shape1,"noiseFunction",0)),s.effect.parameters.NoiseSpeed1=new i.Tw2FloatParameter("NoiseSpeed1",r(l.shape1,"noiseSpeed",0)),s.effect.parameters.NoiseAmplitudeStart1=new i.Tw2Vector4Parameter("NoiseAmplitudeStart1",r(l.shape1,"noiseAmplitureStart",[0,0,0,0])),s.effect.parameters.NoiseAmplitudeEnd1=new i.Tw2Vector4Parameter("NoiseAmplitudeEnd1",r(l.shape1,"noiseAmplitureEnd",[0,0,0,0])),s.effect.parameters.NoiseFrequency1=new i.Tw2Vector4Parameter("NoiseFrequency1",r(l.shape1,"noiseFrequency",[0,0,0,0])),s.effect.parameters.Color1=new i.Tw2Vector4Parameter("Color1",r(l.shape1,"color",[0,0,0,0])),s.effect.parameters.WarpNoiseFunction0=new i.Tw2FloatParameter("WarpNoiseFunction0",r(l.warpShape0,"noiseFunction",0)),s.effect.parameters.WarpNoiseSpeed0=new i.Tw2FloatParameter("WarpNoiseSpeed0",r(l.warpShape0,"noiseSpeed",0)),s.effect.parameters.WarpNoiseAmplitudeStart0=new i.Tw2Vector4Parameter("WarpNoiseAmplitudeStart0",r(l.warpShape0,"noiseAmplitureStart",[0,0,0,0])),s.effect.parameters.WarpNoiseAmplitudeEnd0=new i.Tw2Vector4Parameter("WarpNoiseAmplitudeEnd0",r(l.warpShape0,"noiseAmplitureEnd",[0,0,0,0])),s.effect.parameters.WarpNoiseFrequency0=new i.Tw2Vector4Parameter("WarpNoiseFrequency0",r(l.warpShape0,"noiseFrequency",[0,0,0,0])),s.effect.parameters.WarpColor0=new i.Tw2Vector4Parameter("WarpColor0",r(l.warpShape0,"color",[0,0,0,0])),s.effect.parameters.WarpNoiseFunction1=new i.Tw2FloatParameter("WarpNoiseFunction1",r(l.warpShape1,"noiseFunction",0)),s.effect.parameters.WarpNoiseSpeed1=new i.Tw2FloatParameter("WarpNoiseSpeed1",r(l.warpShape1,"noiseSpeed",0)),s.effect.parameters.WarpNoiseAmplitudeStart1=new i.Tw2Vector4Parameter("WarpNoiseAmplitudeStart1",r(l.warpShape1,"noiseAmplitureStart",[0,0,0,0])),s.effect.parameters.WarpNoiseAmplitudeEnd1=new i.Tw2Vector4Parameter("WarpNoiseAmplitudeEnd1",r(l.warpShape1,"noiseAmplitureEnd",[0,0,0,0])),s.effect.parameters.WarpNoiseFrequency1=new i.Tw2Vector4Parameter("WarpNoiseFrequency1",r(l.warpShape1,"noiseFrequency",[0,0,0,0])),s.effect.parameters.WarpColor1=new i.Tw2Vector4Parameter("WarpColor1",r(l.warpShape1,"color",[0,0,0,0])),s.effect.parameters.ShapeAtlasSize=new i.Tw2Vector4Parameter("ShapeAtlasSize",[r(l,"shapeAtlasHeight",0),r(l,"shapeAtlasCount",0),0,0]),s.effect.parameters.BoosterScale=new i.Tw2Vector4Parameter("BoosterScale",r(l,"scale",[1,1,1,1])),s.effect.parameters.ShapeMap=new i.Tw2TextureParameter("ShapeMap",l.shapeAtlasResPath),s.effect.parameters.GradientMap0=new i.Tw2TextureParameter("GradientMap0",l.gradient0ResPath),s.effect.parameters.GradientMap1=new i.Tw2TextureParameter("GradientMap1",l.gradient1ResPath),s.effect.parameters.NoiseMap=new i.Tw2TextureParameter("ShapeMap","res:/Texture/Global/noise32cube_volume.dds.0.png"),s.effect.Initialize(),s.glows=new o.EveSpriteSet(!0),s.glows.effect=new i.Tw2Effect,s.glows.effect.effectFilePath="res:/Graphics/Effect/Managed/Space/Booster/BoosterGlowAnimated.fx",s.glows.effect.parameters.DiffuseMap=new i.Tw2TextureParameter("DiffuseMap","res:/Texture/Particle/whitesharp.dds.0.png"),s.glows.effect.parameters.NoiseMap=new i.Tw2TextureParameter("NoiseMap","res:/Texture/global/noise.dds.0.png"),s.glows.effect.Initialize();for(var c=r(u,"items",[]),f=0;f<c.length;++f){var h=new o.EveLocator;h.name="locator_booster_"+(f+1),"transform"in c[f]?n.mat4.copy(h.transform,c[f].transform):n.mat4.identity(h.transform),h.atlasIndex0=r(c[f],"atlasIndex0",0),h.atlasIndex1=r(c[f],"atlasIndex1",0),e.locators.push(h)}s.Initialize(),e.boosters=s}(E,b,g),function(e,t){for(var i=r(t,"locatorTurrets",[]),a=0;a<i.length;++a){var s=new o.EveLocator;s.name=i[a].name,"transform"in i[a]?n.mat4.copy(s.transform,i[a].transform):n.mat4.identity(s.transform),e.locators.push(s)}}(E,b);var O=function(e,t){for(var n=[],o=null,s=r(t,"animations",[]),u=0;u<s.length;++u)if(-1!==r(s[u],"id",-1)&&-1!==r(s[u],"startRate",-1)){o||(o=new i.Tw2CurveSet);var l=new a.Tw2ScalarCurve2;l.keys.push(new a.Tw2ScalarKey2),l.keys.push(new a.Tw2ScalarKey2),l.keys[0].value=r(s[u],"startRate",-1),l.keys[1].time=1,l.keys[1].value=r(s[u],"endRate",-1),l.Initialize(),o.curves.push(l),e.curveSets.push(o),n[r(s[u],"id",-1)]=l}o&&o.Initialize();return[o,n]}(E,b);return y(E,b,O[0],O[1]),function(e,t,n,a,o,u){for(var l=r(t,"instancedMeshes",[]),c=0;c<l.length;++c){var f=l[c],h=new i.Tw2InstancedMesh;h.instanceGeometryResPath=f.instanceGeometryResPath,h.geometryResPath=f.geometryResPath,h.Initialize(),v(r(h,"opaqueAreas",[]),"opaqueAreas",t,n,a,u,o,f.shader);var p=new s.EveChildMesh;p.mesh=h,e.effectChildren.push(p)}}(E,b,_,g,h,T),E.Initialize(),E}function E(t,n,i){for(var a=-1,o=0;o<e.generic.materialPrefixes.length;++o)t.substr(0,e.generic.materialPrefixes[o].length)===e.generic.materialPrefixes[o]&&(a=o,t=t.substr(e.generic.materialPrefixes[o].length));if(-1!==a){var s=r(n,"materialUsageMtl"+(a+1),a);if(s>=0&&s<e.generic.materialPrefixes.length&&(t=e.generic.materialPrefixes[s]+t)in i.parameters)return i.parameters[t]}}this.LoadData=function(r){null===e?(r&&_.push(r),b||((t=new i.Tw2Effect).effectFilePath="res:/graphics/effect/managed/space/spaceobject/fx/blinkinglightspool.fx",t.parameters.MainIntensity=new i.Tw2FloatParameter("MainIntensity",1),t.parameters.GradientMap=new i.Tw2TextureParameter("GradientMap","res:/texture/particle/whitesharp_gradient.dds.0.png"),t.Initialize(),n.resMan.GetObject("res:/dx9/model/spaceobjectfactory/data.red",function(t){e=t;for(var r=0;r<_.length;++r)_[r]();_=[]}),b=!0)):r&&r()},this.BuildFromDNA=function(t,r){if(null===e)this.LoadData(function(){var e=g(t);r&&r(e)});else{var n=g(t);r&&r(n)}};var T=[0,0,0,0];function O(e,t,r,n){switch(n){case"overridable":return t||(r||T);case"half_overridable":return e.indexOf("GlowColor")>=0?r||T:t||(r||T);case"not_overridable":case"half_overridable_2":return r||T}return T}function w(t,r,a){var o=e.faction[r],s=e.faction[a],u=null;o&&o.areas&&"hull"in o.areas&&(u=o.areas.hull);var l=null;if(s&&s.areas&&"hull"in s.areas&&(l=s.areas.hull),(u||l)&&t.turretEffect){var c=t.turretEffect.parameters;for(var f in c)if(c.hasOwnProperty(f)){if(c[f].constructor.prototype!==i.Tw2Vector4Parameter.prototype)continue;var h=null,p=null;u&&(h=E(f,o,u)),l&&(p=E(f,o,u)),n.vec4.copy(c[f].value,O(f,h,p,t.turretEffect.name))}t.turretEffect.BindParameters()}}function R(t){if("all"!==t){var r={};for(var n in e[t])e[t].hasOwnProperty(n)&&(r[n]=e[t][n].description||"");return r}return e}this.SetupTurretMaterial=function(t,r,n,i){null===e?this.LoadData(function(){w(t,r,n),i&&i()}):(w(t,r,n),i&&i())},this.GetHullNames=function(e){this.LoadData(function(){e(R("hull"))})},this.GetFactionNames=function(e){this.LoadData(function(){e(R("faction"))})},this.GetRaceNames=function(e){this.LoadData(function(){e(R("race"))})},this.GetSofData=function(e){this.LoadData(function(){e(R("all"))})}};var n=r(0),i=r(1),a=r(60),o=r(65),s=r(61),u=r(63)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(189);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r(193);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(200);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var o=r(204);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var s=r(205);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var u=r(66);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var l=r(17);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(190);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r(191);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(192);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2StaticEmitter=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(1),o=r(31);t.Tw2StaticEmitter=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.geometryResourcePath="",e.geometryResource=null,e.geometryIndex=0,e._spawned=!1,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Tw2ParticleEmitter),n(t,[{key:"Initialize",value:function(){""!==this.geometryResourcePath&&(this.geometryResource=i.resMan.GetResource(this.geometryResourcePath),this.geometryResource.systemMirror=!0,this.geometryResource.RegisterNotification(this)),this._spawned=!1}},{key:"RebuildCachedData",value:function(){this.geometryResource&&this.geometryResource.meshes.length&&(this.geometryResource.meshes[0].bufferData||(this.geometryResource.systemMirror=!0,this.geometryResource.Reload()))}},{key:"Update",value:function(){var e=this.geometryResource;if(!this._spawned&&this.particleSystem&&e&&e.IsGood()&&e.meshes.length>this.geometryIndex&&e.meshes[this.geometryIndex].bufferData){this._spawned=!0;for(var t=e.meshes[this.geometryIndex],r=this.particleSystem.elements,n=new Array(r.length),i=0;i<r.length;++i){var o=r[i].GetDeclaration(),s=t.declaration.FindUsage(o.usage,o.usageIndex-8);if(null===s)return void e.OnError(new a.Tw2GeometryMeshParticleElementError({path:e.path,elementUsage:o.usage,elementUsageIndex:o.usageIndex}));if(s.elements<o.elements)return void e.OnError(new a.Tw2GeometryMeshElementComponentError({path:e.path,inputCount:s.elements,elementCount:o.elements,elementUsage:o.usage,elementUsageIndex:o.usageIndex}));n[i]=s.offset/4}for(var u=t.bufferData.length/t.declaration.stride*4,l=0;l<u;++l){var c=this.particleSystem.BeginSpawnParticle();if(null===c)break;for(var f=0;f<this.particleSystem._elements.length;++f)for(var h=this.particleSystem._elements[f],p=0;p<h.dimension;++p)h.buffer[h.instanceStride*c+h.startOffset+p]=t.bufferData[n[f]+p+l*t.declaration.stride/4];this.particleSystem.EndSpawnParticle()}}}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2DynamicEmitter=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(31);t.Tw2DynamicEmitter=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.rate=0,e.isValid=!1,e._accumulatedRate=0,e.generators=[],e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Tw2ParticleEmitter),n(t,[{key:"Initialize",value:function(){this.Rebind()}},{key:"Update",value:function(e){this.SpawnParticles(null,null,Math.min(e,.1))}},{key:"Rebind",value:function(){if(this.isValid=!1,this.particleSystem){for(var e=0;e<this.generators.length;++e)if(!this.generators[e].Bind(this.particleSystem))return;this.isValid=!0}}},{key:"SpawnParticles",value:function(e,t,r){if(this.isValid){this._accumulatedRate+=this.rate*r;var n=Math.floor(this._accumulatedRate);this._accumulatedRate-=n;for(var i=0;i<n;++i){var a=this.particleSystem.BeginSpawnParticle();if(null===a)break;for(var o=0;o<this.generators.length;++o)this.generators[o].Generate(e,t,a);this.particleSystem.EndSpawnParticle()}}}}]),t}()},function(e,t,r){"use strict";var n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.Tr2GpuUniqueEmitter=t.Tw2GpuUniqueEmitter=void 0;var a=r(0),o=r(31);var s=t.Tw2GpuUniqueEmitter=(i=n=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.angle=0,e.innerAngle=0,e.drag=0,e.rate=0,e.radius=0,e.gravity=0,e.maxSpeed=0,e.minSpeed=0,e.minLifeTime=0,e.maxLifeTime=0,e.sizeVariance=0,e.attractorPosition=a.vec3.create(),e.attractorStrength=0,e.turbulenceAmplitude=0,e.turbulenceFrequency=0,e.textureIndex=0,e.sizes=a.vec3.create(),e.position=a.vec3.create(),e.color0=a.vec4.create(),e.color1=a.vec4.create(),e.color2=a.vec4.create(),e.color3=a.vec4.create(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Tw2ParticleEmitter),t}(),n.partialImplementation=!0,i);t.Tr2GpuUniqueEmitter=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(194);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r(195);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(196);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var o=r(197);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var s=r(198);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var u=r(199);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleAttractorForce=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(14);t.Tw2ParticleAttractorForce=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.magnitude=0,e.position=i.vec3.create(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2ParticleForce),n(t,[{key:"ApplyForce",value:function(e,t,r){var n=a.Tw2ParticleForce.global.vec3_0;n[0]=this.position[0]-e.buffer[e.offset],n[1]=this.position[1]-e.buffer[e.offset+1],n[2]=this.position[2]-e.buffer[e.offset+2],i.vec3.normalize(n,n),i.vec3.scale(n,n,this.magnitude),i.vec3.add(r,r,n)}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleDirectForce=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(14);t.Tw2ParticleDirectForce=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.force=i.vec3.create(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2ParticleForce),n(t,[{key:"ApplyForce",value:function(e,t,r){i.vec3.add(r,r,this.force)}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleDragForce=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(14);t.Tw2ParticleDragForce=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.drag=.1,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Tw2ParticleForce),n(t,[{key:"ApplyForce",value:function(e,t,r){r[0]+=t.buffer[t.offset]*-this.drag,r[1]+=t.buffer[t.offset+1]*-this.drag,r[2]+=t.buffer[t.offset+2]*-this.drag}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleFluidDragForce=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(14);t.Tw2ParticleFluidDragForce=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.drag=.1,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2ParticleForce),n(t,[{key:"ApplyForce",value:function(e,t,r,n,o){var s=a.Tw2ParticleForce.global.vec3_0,u=a.Tw2ParticleForce.global.vec3_1,l=Math.sqrt(t.buffer[t.offset]*t.buffer[t.offset]+t.buffer[t.offset+1]*t.buffer[t.offset+1]+t.buffer[t.offset+2]*t.buffer[t.offset+2]);s[0]=t.buffer[t.offset]*-l*this.drag,s[1]=t.buffer[t.offset+1]*-l*this.drag,s[2]=t.buffer[t.offset+2]*-l*this.drag,i.vec3.scale(u,s,n*o),u[0]+=t.buffer[t.offset],u[1]+=t.buffer[t.offset+1],u[2]+=t.buffer[t.offset+2],t.buffer[t.offset]*u[0]+t.buffer[t.offset+1]*u[1]+t.buffer[t.offset+2]*u[2]<0?(r[0]=-t.buffer[t.offset]/n/o,r[1]=-t.buffer[t.offset+1]/n/o,r[2]=-t.buffer[t.offset+2]/n/o):i.vec3.copy(r,s)}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleSpring=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(14);t.Tw2ParticleSpring=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.springConstant=0,e.position=i.vec3.create(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2ParticleForce),n(t,[{key:"ApplyForce",value:function(e,t,r){r[0]+=(this.position[0]-e.buffer[e.offset])*this.springConstant,r[1]+=(this.position[1]-e.buffer[e.offset+1])*this.springConstant,r[2]+=(this.position[2]-e.buffer[e.offset+2])*this.springConstant}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleTurbulenceForce=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(14);t.Tw2ParticleTurbulenceForce=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.noiseLevel=3,e.noiseRatio=.5,e.amplitude=i.vec3.fromValues(1,1,1),e.frequency=i.vec4.fromValues(1,1,1,1),e._time=0,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Tw2ParticleForce),n(t,[{key:"ApplyForce",value:function(e,t,r){if(0!==this.noiseLevel){for(var n=e.buffer[e.offset]*this.frequency[0],o=e.buffer[e.offset+1]*this.frequency[1],s=e.buffer[e.offset+2]*this.frequency[2],u=this._time*this.frequency[3],l=0,c=.5,f=1/this.noiseRatio,h=i.vec4.set(a.Tw2ParticleForce.global.vec4_0,0,0,0,0),p=0;p<this.noiseLevel;++p)i.noise.turbulence(h,n,o,s,u,c),l+=c,n*=f,o*=f,s*=f,u*=f,c*=this.noiseRatio;r[0]+=h[0]*this.amplitude[0]*l,r[1]+=h[1]*this.amplitude[1]*l,r[2]+=h[2]*this.amplitude[2]*l}}},{key:"Update",value:function(e){this._time+=e}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(201);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var i=r(202);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(203);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2RandomIntegerAttributeGenerator=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(17),o=r(32);t.Tw2RandomIntegerAttributeGenerator=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.elementType=a.Tw2ParticleElementDeclaration.Type.CUSTOM,e.customName="",e.minRange=i.vec4.create(),e.maxRange=i.vec4.create(),e._element=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Tw2ParticleAttributeGenerator),n(t,[{key:"Bind",value:function(e){for(var t=0;t<e._elements.length;++t)if(e._elements[t].elementType===this.elementType&&(this.elementType!==a.Tw2ParticleElementDeclaration.Type.CUSTOM||e._elements[t].customName===this.customName))return this._element=e._elements[t],!0;return!1}},{key:"Generate",value:function(e,t,r){for(var n=0;n<this._element.dimension;++n)this._element.buffer[this._element.instanceStride*r+this._element.startOffset+n]=Math.floor(this.minRange[n]+Math.random()*(this.maxRange[n]-this.minRange[n])+.5)}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2RandomUniformAttributeGenerator=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(17),o=r(32);t.Tw2RandomUniformAttributeGenerator=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.elementType=a.Tw2ParticleElementDeclaration.Type.CUSTOM,e.customName="",e.minRange=i.vec4.create(),e.maxRange=i.vec4.create(),e._element=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Tw2ParticleAttributeGenerator),n(t,[{key:"Bind",value:function(e){for(var t=0;t<e._elements.length;++t)if(e._elements[t].elementType===this.elementType&&(this.elementType!==a.Tw2ParticleElementDeclaration.Type.CUSTOM||e._elements[t].customName===this.customName))return this._element=e._elements[t],!0;return!1}},{key:"Generate",value:function(e,t,r){for(var n=0;n<this._element.dimension;++n)this._element.buffer[this._element.instanceStride*r+this._element.startOffset+n]=this.minRange[n]+Math.random()*(this.maxRange[n]-this.minRange[n])}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2SphereShapeAttributeGenerator=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(17),o=r(32);t.Tw2SphereShapeAttributeGenerator=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.minRadius=0,e.maxRadius=0,e.minPhi=0,e.maxPhi=360,e.minTheta=0,e.maxTheta=360,e.controlPosition=!0,e.controlVelocity=!0,e.minSpeed=0,e.maxSpeed=0,e.parentVelocityFactor=1,e.position=i.vec3.create(),e.rotation=i.quat.create(),e._position=null,e._velocity=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Tw2ParticleAttributeGenerator),n(t,[{key:"Bind",value:function(e){this._position=null,this._velocity=null;for(var t=0;t<e._elements.length;++t)e._elements[t].elementType===a.Tw2ParticleElementDeclaration.Type.POSITION&&this.controlPosition?this._position=e._elements[t]:e._elements[t].elementType===a.Tw2ParticleElementDeclaration.Type.VELOCITY&&this.controlVelocity&&(this._velocity=e._elements[t]);return!(this.controlPosition&&null===this._position||this.controlVelocity&&null===this._velocity)}},{key:"Generate",value:function(e,t,r){var n=(this.minPhi+Math.random()*(this.maxPhi-this.minPhi))/180*Math.PI,a=(this.minTheta+Math.random()*(this.maxTheta-this.minTheta))/180*Math.PI,s=o.Tw2ParticleAttributeGenerator.global.vec3_0;if(s[0]=Math.sin(n)*Math.cos(a),s[1]=-Math.cos(n),s[2]=Math.sin(n)*Math.sin(a),i.vec3.transformQuat(s,s,this.rotation),this._velocity){var u=this.minSpeed+Math.random()*(this.maxSpeed-this.minSpeed),l=this._velocity.instanceStride*r+this._velocity.startOffset;this._velocity.buffer[l]=s[0]*u,this._velocity.buffer[l+1]=s[1]*u,this._velocity.buffer[l+2]=s[2]*u,t&&(this._velocity.buffer[l]+=t.buffer[t.offset]*this.parentVelocityFactor,this._velocity.buffer[l+1]+=t.buffer[t.offset+1]*this.parentVelocityFactor,this._velocity.buffer[l+2]+=t.buffer[t.offset+2]*this.parentVelocityFactor)}if(this._position){i.vec3.scale(s,s,this.minRadius+Math.random()*(this.maxRadius-this.minRadius)),i.vec3.add(s,s,this.position),e&&(s[0]+=e.buffer[e.offset],s[1]+=e.buffer[e.offset+1],s[2]+=e.buffer[e.offset+2]);var c=this._position.instanceStride*r+this._position.startOffset;this._position.buffer[c]=s[0],this._position.buffer[c+1]=s[1],this._position.buffer[c+2]=s[2]}}}]),t}()},function(e,t,r){"use strict"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleSystem=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(1),o=r(66),s=r(17);(t.Tw2ParticleSystem=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.name="",this.aliveCount=0,this.maxParticleCount=0,this.emitParticleOnDeathEmitter=null,this.emitParticleDuringLifeEmitter=null,this.elements=[],this.isValid=!1,this.requiresSorting=!1,this.updateSimulation=!0,this.applyForce=!0,this.applyAging=!0,this.isGlobal=!1,this.forces=[],this.constraints=[],this.updateBoundingBox=!1,this.aabbMin=i.vec3.create(),this.aabbMax=i.vec3.create(),this.peakAliveCount=0,this.bufferDirty=!1,this._vb=null,this._declaration=null,this._stdElements=[null,null,null,null],this._elements=[],this.instanceStride=[null,null],this.vertexStride=[null,null],this.buffers=[null,null],e.init()}return n(e,[{key:"Initialize",value:function(){this.UpdateElementDeclaration()}},{key:"UpdateElementDeclaration",value:function(){this.isValid=!1;var e=i.device.gl;if(this._vb&&(e.deleteBuffer(this._vb),this._vb=null),this._declaration=null,this.aliveCount=0,0!==this.elements.length){this._stdElements=[null,null,null,null],this._elements=[],this.instanceStride=[0,0],this.vertexStride=[0,0],this._declaration=new a.Tw2VertexDeclaration,this.buffers=[null,null];for(var t=0;t<this.elements.length;++t){var r=this.elements[t].usedByGPU?0:1,n=new o.Tw2ParticleElement(this.elements[t]);if(n.startOffset=this.vertexStride[r],n.offset=n.startOffset,this.elements[t].elementType!==s.Tw2ParticleElementDeclaration.Type.CUSTOM&&(this._stdElements[this.elements[t].elementType]=n),this.vertexStride[r]+=n.dimension,this._elements.push(n),0===r){var u=this.elements[t].GetDeclaration();u.offset=4*n.startOffset,this._declaration.elements.push(u)}}this._declaration.RebuildHash();for(var l=0;l<this._elements.length;++l){var c=this._elements[l].usedByGPU?0:1;this._elements[l].vertexStride=this.vertexStride[c]}this.instanceStride[0]=4*this.vertexStride[0],this.instanceStride[1]=4*this.vertexStride[1];for(var f=0;f<this._elements.length;++f){var h=this._elements[f].usedByGPU?0:1;this._elements[f].instanceStride=this.instanceStride[h]}this.buffers=[null,null],this.instanceStride[0]&&this.maxParticleCount&&(this.buffers[0]=new Float32Array(this.instanceStride[0]*this.maxParticleCount),this._vb=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._vb),e.bufferData(e.ARRAY_BUFFER,this.buffers[0].length,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null)),this.instanceStride[1]&&(this.buffers[1]=new Float32Array(this.instanceStride[1]*this.maxParticleCount));for(var p=0;p<this._elements.length;++p){var d=this._elements[p].usedByGPU?0:1;this._elements[p].buffer=this.buffers[d]}this.requiresSorting&&(this._sortedIndexes=new Array(this.maxParticleCount),this._sortedBuffer=new Float32Array(this.instanceStride[0]*this.maxParticleCount),this._distancesBuffer=new Float32Array(this.maxParticleCount)),this.isValid=!0,this.bufferDirty=!0}}},{key:"HasElement",value:function(e){return null!==this._stdElements[e]}},{key:"GetElement",value:function(e){return this._stdElements[e]&&(this._stdElements[e].offset=this._stdElements[e].startOffset),this._stdElements[e]}},{key:"BeginSpawnParticle",value:function(){return!this.isValid||this.aliveCount>=this.maxParticleCount?null:this.aliveCount++}},{key:"EndSpawnParticle",value:function(){this.bufferDirty=!0}},{key:"Update",value:function(t){if(t=Math.min(t,.1),this.applyAging&&this.HasElement(s.Tw2ParticleElementDeclaration.Type.LIFETIME)){for(var r=this.GetElement(s.Tw2ParticleElementDeclaration.Type.LIFETIME),n=this.emitParticleOnDeathEmitter?this.GetElement(s.Tw2ParticleElementDeclaration.Type.POSITION):null,a=this.emitParticleOnDeathEmitter?this.GetElement(s.Tw2ParticleElementDeclaration.Type.VELOCITY):null,o=0;o<this.aliveCount;++o)if(r.buffer[r.offset]+=t/r.buffer[r.offset+1],r.buffer[r.offset]>1){if(this.emitParticleOnDeathEmitter&&this.emitParticleOnDeathEmitter.SpawnParticles(n,a,1),this.aliveCount--,o<this.aliveCount){for(var u=0;u<2;++u)this.buffers[u]&&this.buffers[u].set(this.buffers[u].subarray(this.instanceStride[u]*this.aliveCount,this.instanceStride[u]*this.aliveCount+this.instanceStride[u]),o*this.instanceStride[u]);--o,this.bufferDirty=!0}}else r.offset+=r.instanceStride,n&&(n.offset+=n.instanceStride),a&&(a.offset+=a.instanceStride);r.dirty=!0}var l=e.global.vec3_0;if(this.updateSimulation&&this.HasElement(s.Tw2ParticleElementDeclaration.Type.POSITION)&&this.HasElement(s.Tw2ParticleElementDeclaration.Type.VELOCITY)){for(var c=this.applyForce&&this.forces.length,f=0;f<this.forces.length;++f)this.forces[f].Update(t);for(var h=this.GetElement(s.Tw2ParticleElementDeclaration.Type.POSITION),p=this.GetElement(s.Tw2ParticleElementDeclaration.Type.VELOCITY),d=c?this.GetElement(s.Tw2ParticleElementDeclaration.Type.MASS):null,v=0;v<this.aliveCount;++v){if(c){for(var m=d?d.buffer[d.offset]:1,y=i.vec3.set(l,0,0,0),b=0;b<this.forces.length;++b)this.forces[b].ApplyForce(h,p,y,t,m);d&&i.vec3.scale(y,y,1/d.buffer[d.offset]),p.buffer[p.offset]+=y[0]*t,p.buffer[p.offset+1]+=y[1]*t,p.buffer[p.offset+2]+=y[2]*t}h.buffer[h.offset]+=p.buffer[p.offset]*t,h.buffer[h.offset+1]+=p.buffer[p.offset+1]*t,h.buffer[h.offset+2]+=p.buffer[p.offset+2]*t,this.emitParticleDuringLifeEmitter&&this.emitParticleDuringLifeEmitter.SpawnParticles(h,p,t),h.offset+=h.instanceStride,p.offset+=p.instanceStride,d&&(d.offset+=d.instanceStride)}h.dirty=!0,p.dirty=!0}if(this.updateSimulation&&this.constraints.length)for(var _=0;_<this.constraints.length;++_)this.constraints[_].ApplyConstraint(this.buffers,this.instanceStride,this.aliveCount,t);if(this.updateBoundingBox&&this.GetBoundingBox(this.aabbMin,this.aabbMax),this.emitParticleDuringLifeEmitter&&(!this.HasElement(s.Tw2ParticleElementDeclaration.Type.POSITION)||!this.HasElement(s.Tw2ParticleElementDeclaration.Type.VELOCITY))&&this.updateSimulation)for(var g=this.GetElement(s.Tw2ParticleElementDeclaration.Type.POSITION),E=this.GetElement(s.Tw2ParticleElementDeclaration.Type.VELOCITY),T=0;T<this.aliveCount;++T)this.emitParticleDuringLifeEmitter.SpawnParticles(g,E,1),g&&(g.offset+=g.instanceStride),E&&(E.offset+=E.instanceStride);for(var O=0;O<this._elements.length;++O){var w=this._elements[O];w.offset=w.startOffset,w.dirty&&(this.bufferDirty=!0,w.dirty=!1)}}},{key:"GetBoundingBox",value:function(e,t){if(this.aliveCount&&this.HasElement(s.Tw2ParticleElementDeclaration.Type.POSITION)){var r=this.GetElement(s.Tw2ParticleElementDeclaration.Type.POSITION);e[0]=r.buffer[r.offset],e[1]=r.buffer[r.offset+1],e[2]=r.buffer[r.offset+2],t[0]=r.buffer[r.offset],t[1]=r.buffer[r.offset+1],t[2]=r.buffer[r.offset+2];for(var n=0;n<this.aliveCount;++n)e[0]=Math.min(e[0],r.buffer[r.offset]),e[1]=Math.min(e[1],r.buffer[r.offset+1]),e[2]=Math.min(e[2],r.buffer[r.offset+2]),t[0]=Math.max(t[0],r.buffer[r.offset]),t[1]=Math.max(t[1],r.buffer[r.offset+1]),t[2]=Math.max(t[2],r.buffer[r.offset+2]),r.offset+=r.instanceStride;return!0}return!1}},{key:"_Sort",value:function(){for(var t=i.mat4.multiply(e.global.mat4_0,i.device.projection,i.device.view),r=this.GetElement(s.Tw2ParticleElementDeclaration.Type.POSITION),n=this.aliveCount,a=this._distancesBuffer,o=0;o<n;++o){var u=r.offset+r.instanceStride*o,l=r.buffer[u]-t[12],c=l*l;c+=(l=r.buffer[u+1]-t[13])*l,c+=(l=r.buffer[u+2]-t[14])*l,a[o]=c}for(var f=0;f<this.maxParticleCount;++f)this._sortedIndexes[f]=f;this._sortedIndexes.sort(function(e,t){if(e>=n&&t>=n)return e<t?-1:e>t?1:0;if(e>=n)return 1;if(t>=n)return-1;var r=a[e],i=a[t];return r<i?1:r>i?-1:0})}},{key:"GetInstanceBuffer",value:function(){if(0!==this.aliveCount){var e=i.device.gl;if(this.requiresSorting&&this.HasElement(s.Tw2ParticleElementDeclaration.Type.POSITION)&&this.buffers){this._Sort();for(var t=this.instanceStride[0],r=this.buffers[0],n=0;n<this.aliveCount;++n)for(var a=n*t,o=this._sortedIndexes[n]*t,u=0;u<t;++u)this._sortedBuffer[a+u]=r[u+o];e.bindBuffer(e.ARRAY_BUFFER,this._vb),e.bufferSubData(e.ARRAY_BUFFER,0,this._sortedBuffer.subarray(0,this.vertexStride[0]*this.aliveCount)),this.bufferDirty=!1}else this.bufferDirty&&(e.bindBuffer(e.ARRAY_BUFFER,this._vb),e.bufferSubData(e.ARRAY_BUFFER,0,this.buffers[0].subarray(0,this.vertexStride[0]*this.aliveCount)),this.bufferDirty=!1);return this._vb}}},{key:"GetInstanceDeclaration",value:function(){return this._declaration}},{key:"GetInstanceStride",value:function(){return this.instanceStride[0]}},{key:"GetInstanceCount",value:function(){return this.aliveCount}}],[{key:"init",value:function(){e.global||(e.global={vec3_0:i.vec3.create(),mat4_0:i.mat4.create()})}}]),e}()).global=null}])});